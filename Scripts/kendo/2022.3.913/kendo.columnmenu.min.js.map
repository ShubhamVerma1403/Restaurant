{"version":3,"file":"kendo.columnmenu.min.js","sources":["kendo.columnmenu.js"],"sourcesContent":["(function(f, define) {\n    define('kendo.columnmenu',[ \"kendo.popup\", \"kendo.filtermenu\", \"kendo.menu\", \"kendo.expansionpanel\" ], f);\n})(function() {\n\nvar __meta__ = {\n    id: \"columnmenu\",\n    name: \"Column Menu\",\n    category: \"framework\",\n    depends: [ \"popup\", \"filtermenu\", \"menu\", 'expansionpanel' ],\n    advanced: true\n};\n\n(function($, undefined) {\n    var kendo = window.kendo,\n        ui = kendo.ui,\n        extend = $.extend,\n        grep = $.grep,\n        map = $.map,\n        inArray = $.inArray,\n        Comparer = kendo.data.Comparer,\n        ACTIVE = \"k-selected\",\n        ASC = \"asc\",\n        DESC = \"desc\",\n        CHANGE = \"change\",\n        INIT = \"init\",\n        OPEN = \"open\",\n        SELECT = \"select\",\n        STICK = \"stick\",\n        UNSTICK = \"unstick\",\n        POPUP = \"kendoPopup\",\n        FILTERMENU = \"kendoFilterMenu\",\n        MENU = \"kendoMenu\",\n        EXPANSIONPANEL = \"kendoExpansionPanel\",\n        NS = \".kendoColumnMenu\",\n        COLUMNHEADERATTR = \"[scope='col']\",\n        Widget = ui.Widget;\n\n    function trim(text) {\n        return kendo.trim(text).replace(/&nbsp;/gi, \"\");\n    }\n\n    function toHash(arr, key) {\n        var result = {};\n        var idx, len, current;\n        for (idx = 0, len = arr.length; idx < len; idx ++) {\n            current = arr[idx];\n            result[current[key]] = current;\n        }\n        return result;\n    }\n\n    function columnsGroupFilterHandler(column) {\n        return this.columns.indexOf(column.title) >= 0 || this.columns.indexOf(column.field) >= 0;\n    }\n\n    function leafColumns(columns) {\n        var result = [];\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (!columns[idx].columns) {\n                result.push(columns[idx]);\n                continue;\n            }\n            result = result.concat(leafColumns(columns[idx].columns));\n        }\n\n        return result;\n    }\n\n    function attrEquals(attrName, attrValue) {\n        return \"[\" + kendo.attr(attrName) + \"='\" + (attrValue || \"\").replace(/'/g, \"\\\"\") + \"']\";\n    }\n\n    function insertElementAt(index, element, container) {\n        if (index > 0) {\n            element.insertAfter(container.children().eq(index - 1));\n        } else {\n            container.prepend(element);\n        }\n    }\n\n    function columnOccurrences(columns) {\n        var columnDict = {};\n        var signature;\n\n        for (var i = 0; i < columns.length; i++) {\n            signature = JSON.stringify(columns[i]);\n\n            if (columnDict[signature]) {\n                columnDict[signature].push(i);\n            } else {\n                columnDict[signature] = [i];\n            }\n        }\n\n        return columnDict;\n    }\n\n    function oldColumnOccurrences(renderedListElements, checkBoxes) {\n        var indexAttr = kendo.attr(\"index\");\n        var fieldAttr = kendo.attr(\"field\");\n        var columnDict = {};\n        var signature;\n        var columCheckbox;\n        var index;\n        var field;\n        var title;\n\n        for (var j = 0; j < renderedListElements.length; j++) {\n            columCheckbox = checkBoxes.eq(j);\n            index = parseInt(columCheckbox.attr(indexAttr), 10);\n            field = columCheckbox.attr(fieldAttr);\n            title = columCheckbox.attr(\"title\");\n            signature = field ? field : title;\n\n            if (columnDict[signature]) {\n                columnDict[signature].push(index);\n            } else {\n                columnDict[signature] = [index];\n            }\n        }\n\n        return columnDict;\n    }\n\n    var ColumnMenu = Widget.extend({\n        init: function(element, options) {\n            var that = this,\n                columnHeader;\n\n            options = options || {};\n            options.componentType = options.componentType || \"classic\";\n            Widget.fn.init.call(that, element, options);\n\n            element = that.element;\n            options = that.options;\n            that.owner = options.owner;\n            that.dataSource = options.dataSource;\n\n            that.field = element.attr(kendo.attr(\"field\"));\n            that.title = element.attr(kendo.attr(\"title\"));\n\n            columnHeader = $(element.closest(COLUMNHEADERATTR));\n            if (columnHeader.length) {\n                that.appendTo = columnHeader.find(options.appendTo);\n            } else {\n                that.appendTo = $(options.appendTo);\n            }\n\n            that.link = that._createLink();\n\n            that.wrapper = $('<div class=\"k-column-menu\"/>');\n\n            that._refreshHandler = that.refresh.bind(that);\n\n            that.dataSource.bind(CHANGE, that._refreshHandler);\n        },\n\n        _init: function() {\n            var that = this;\n\n            that.pane = that.options.pane;\n            if (that.pane) {\n                that._isMobile = true;\n            }\n\n            if (that._isMobile) {\n                that._createMobileMenu();\n            } else {\n                that._createMenu();\n            }\n\n            that.owner._muteAngularRebind(function() {\n                that._angularItems(\"compile\");\n            });\n\n            that._sort();\n\n            that._columns();\n\n            that._filter();\n\n            that._lockColumns();\n\n            that._stickyColumns();\n\n            that.trigger(INIT, { field: that.field, container: that.wrapper });\n        },\n\n        events: [ INIT, OPEN, \"sort\", \"filtering\", STICK, UNSTICK ],\n\n        options: {\n            name: \"ColumnMenu\",\n            messages: {\n                sortAscending: \"Sort Ascending\",\n                sortDescending: \"Sort Descending\",\n                filter: \"Filter\",\n                column: \"Column\",\n                columns: \"Columns\",\n                columnVisibility: \"Column Visibility\",\n                clear: \"Clear\",\n                cancel: \"Cancel\",\n                done: \"Done\",\n                settings: \"Edit Column Settings\",\n                lock: \"Lock Column\",\n                unlock: \"Unlock Column\",\n                stick: \"Stick Column\",\n                unstick: \"Unstick Column\",\n                setColumnPosition: \"Set Column Position\",\n                apply: \"Apply\",\n                reset: \"Reset\",\n                buttonTitle: \"{0} edit column settings\"\n            },\n            filter: \"\",\n            columns: true,\n            sortable: true,\n            filterable: true,\n            animations: {\n                left: \"slide\"\n            },\n            encodeTitles: false,\n            componentType: \"classic\",\n            appendTo: null\n        },\n\n        _createMenu: function() {\n            var that = this,\n                options = that.options,\n                columns = that._ownerColumns(),\n                flattenMenuCols,\n                menuTemplate;\n\n            if (that._hasGroups()) {\n                columns = that._groupColumns(columns);\n                flattenMenuCols = that._flattenMenuCols(columns);\n                if (flattenMenuCols.length !== that.owner.columns.length) {\n                    that._syncMenuCols(flattenMenuCols, that.owner.columns);\n                }\n            }\n\n            if (that._isModernComponentType()) {\n                menuTemplate = kendo.template(modernTemplate);\n            } else {\n                menuTemplate = kendo.template(template);\n            }\n\n            that.wrapper.html(menuTemplate({\n                uid: kendo.guid(),\n                ns: kendo.ns,\n                messages: options.messages,\n                sortable: options.sortable,\n                filterable: options.filterable,\n                columns: columns,\n                showColumns: options.columns,\n                hasLockableColumns: options.hasLockableColumns,\n                hasStickableColumns: options.hasStickableColumns,\n                encodeTitles: options.encodeTitles,\n                omitWrapAttribute: kendo.attr(\"omit-wrap\")\n            }));\n\n            that.popup = that.wrapper[POPUP]({\n                anchor: that.link,\n                copyAnchorStyles: false,\n                open: that._open.bind(that),\n                activate: that._activate.bind(that),\n                deactivate: that._deactivate.bind(that),\n                close: function(e) {\n                    if (that.menu) {\n                        that.menu._closing = e.sender.element;\n                    }\n                    if (that.options.closeCallback) {\n                        that.options.closeCallback(that.element);\n                    }\n                }\n            }).data(POPUP);\n\n            if (that._isModernComponentType()) {\n                that.popup.element.addClass(\"k-grid-columnmenu-popup\");\n                that._createExpanders();\n            } else {\n                that.menu = that.wrapper.children()[MENU]({\n                    orientation: \"vertical\",\n                    closeOnClick: false,\n                    open: function() {\n                        that._updateMenuItems();\n                    }\n                }).data(MENU);\n            }\n        },\n\n        _createLink: function() {\n            var that = this,\n                element = that.element,\n                appendTarget = that.appendTo.length ? element.find(that.appendTo) : element,\n                link = element.find(\".k-header-column-menu\"),\n                title = kendo.format(that.options.messages.buttonTitle, that.title || that.field);\n\n            if (!link[0]) {\n                element.addClass(\"k-filterable\");\n\n                link = appendTarget\n                    .append('<a class=\"k-header-column-menu\" href=\"#\" title=\"' +\n                                title + '\"><span class=\"k-icon k-i-more-vertical\"></span></a>')\n                    .find(\".k-header-column-menu\");\n            }\n\n            link.attr(\"tabindex\", -1)\n                .on(\"click\" + NS, that._click.bind(that));\n\n            return link;\n        },\n\n        _createExpanders: function() {\n            var that = this;\n            var options = that.options;\n            var expanderOptions = {\n                expanded: false,\n                headerClass: \"k-columnmenu-item\",\n                useBareTemplate: true\n            };\n\n            that.wrapper.find(\".k-columns-item\")[EXPANSIONPANEL]($.extend(true, {}, expanderOptions,{\n                title: '<span class=\"k-icon k-i-columns\"></span><span>' + options.messages.columns + '</span>'\n            }));\n            that.wrapper.find(\".k-column-menu-filter\")[EXPANSIONPANEL]($.extend(true, {}, expanderOptions,{\n                title: '<span class=\"k-icon k-i-filter\"></span><span>' + options.messages.filter + '</span>'\n            }));\n            that.wrapper.find(\".k-column-menu-position\")[EXPANSIONPANEL]($.extend(true, {}, expanderOptions,{\n                title: '<span class=\"k-icon k-i-set-column-position\"></span><span>' + options.messages.setColumnPosition + '</span>'\n            }));\n        },\n\n        _syncMenuCols: function(menuCols, ownerCols) {\n            var length = ownerCols.length;\n            var ownerCol;\n            var menuColsFields = menuCols.map(function(col) {\n                return col.field;\n            });\n\n            for (var i = 0; i < length; i++) {\n                ownerCol = ownerCols[i];\n                if (menuColsFields.indexOf(ownerCol.field) < 0) {\n                    ownerCol.menu = false;\n                }\n            }\n        },\n\n        _flattenMenuCols: function(cols) {\n            var result = [];\n            var length = cols.length;\n\n            for (var i = 0; i < length; i++) {\n                if (cols[i].columns) {\n                    result = result.concat(this._flattenMenuCols(cols[i].columns));\n                } else if (!cols[i].groupHeader) {\n                    result.push(cols[i]);\n                }\n            }\n            return result;\n        },\n\n        _groupColumns: function(columns, nest) {\n            var result = [];\n            var groups = this.options.columns.groups;\n            var length = groups.length;\n            var i;\n            var currGroup;\n            var filterHandler;\n            var group;\n            var groupColumns;\n\n            for (i = 0; i < length; i++) {\n                currGroup = groups[i];\n                filterHandler = columnsGroupFilterHandler.bind(currGroup);\n                group = { title: currGroup.title, groupHeader: true };\n                groupColumns = columns.filter(filterHandler);\n                result.push(group);\n\n                if (nest) {\n                    group.columns = groupColumns;\n                } else {\n                    result = result.concat(groupColumns);\n                }\n            }\n\n            return result;\n        },\n\n        _hasGroups: function() {\n            return this.options.columns && this.options.columns.groups && this.options.columns.groups.length;\n        },\n\n        _isModernComponentType: function() {\n            return this.options.componentType === 'modern' && !this._isMobile;\n        },\n\n        _deactivate: function() {\n            if (this.menu) {\n                this.menu._closing = false;\n            }\n        },\n\n        _createMobileMenu: function() {\n            var that = this,\n                options = that.options,\n                columns = that._ownerColumns(),\n                groups,\n                flattenMenuCols;\n\n            if (that._hasGroups()) {\n                groups = that._groupColumns(columns, true);\n                flattenMenuCols = that._flattenMenuCols(groups);\n                if (flattenMenuCols.length !== that.owner.columns.length) {\n                    that._syncMenuCols(flattenMenuCols, that.owner.columns);\n                }\n            }\n\n            var html = kendo.template(mobileTemplate)({\n                ns: kendo.ns,\n                field: that.field,\n                title: that.title || that.field,\n                messages: options.messages,\n                sortable: options.sortable,\n                filterable: options.filterable,\n                columns: columns,\n                showColumns: options.columns,\n                hasLockableColumns: options.hasLockableColumns,\n                hasStickableColumns: options.hasStickableColumns,\n                hasGroups: that._hasGroups(),\n                groups: groups\n            });\n\n            that.view = that.pane.append(html);\n            that.view.state = { columns: {} };\n\n            that.wrapper = that.view.element.find(\".k-column-menu\");\n\n            that.menu = new MobileMenu(that.wrapper.children(), {\n                pane: that.pane,\n                columnMenu: that\n            });\n\n            // The toggle animation of the switches should not propagate to the view\n            that.menu.element.on(\"transitionend\" + NS, function(e) {\n                e.stopPropagation();\n            });\n\n            var viewElement = that.view.wrapper && that.view.wrapper[0] ? that.view.wrapper : that.view.element;\n\n            viewElement.on(\"click\", \".k-header-done\", function(e) {\n                e.preventDefault();\n\n                that.menu._applyChanges();\n                that.menu._cancelChanges(false);\n                that.close();\n            });\n\n            viewElement.on(\"click\", \".k-header-cancel\", function(e) {\n                e.preventDefault();\n\n                that.menu._cancelChanges(true);\n                that.close();\n            });\n\n            that.view.bind(\"showStart\", function() {\n                var view = that.view || { columns: {} };\n\n                if (that.options.hasLockableColumns) {\n                    that._updateLockedColumns();\n                }\n\n                if (that.options.hasStickableColumns) {\n                    that._updateStickyColumns();\n                }\n\n                if (view.element.find(\".k-sort-asc.k-selected\").length) {\n                    view.state.initialSort = \"asc\";\n                } else if (view.element.find(\".k-sort-desc.k-selected\").length) {\n                    view.state.initialSort = \"desc\";\n                }\n            });\n        },\n\n        _angularItems: function(action) {\n            var that = this;\n            that.angular(action, function() {\n                var items = that.wrapper.find(\".k-columns-item input[\" + kendo.attr(\"field\") + \"]\").map(function() {\n                    return $(this).closest(\"li\");\n                });\n                var data = map(that._ownerColumns(), function(col) {\n                    return { column: col._originalObject };\n                });\n                return {\n                    elements: items,\n                    data: data\n                };\n            });\n        },\n\n        destroy: function() {\n            var that = this;\n\n            that._angularItems(\"cleanup\");\n\n            Widget.fn.destroy.call(that);\n\n            if (that.filterMenu) {\n                that.filterMenu.destroy();\n            }\n\n            if (that._refreshHandler) {\n                that.dataSource.unbind(CHANGE, that._refreshHandler);\n            }\n\n            if (that.options.columns && that.owner) {\n                if (that._updateColumnsMenuHandler) {\n                    that.owner.unbind(\"columnShow\", that._updateColumnsMenuHandler);\n                    that.owner.unbind(\"columnHide\", that._updateColumnsMenuHandler);\n                }\n\n                if (that._updateColumnsLockedStateHandler) {\n                    that.owner.unbind(\"columnLock\", that._updateColumnsLockedStateHandler);\n                    that.owner.unbind(\"columnUnlock\", that._updateColumnsLockedStateHandler);\n                }\n            }\n\n            if (that.menu) {\n                that.menu.element.off(NS);\n                that.menu.destroy();\n            }\n\n            that.wrapper.off(NS);\n\n            if (that.popup) {\n                that.popup.destroy();\n            }\n\n            if (that.view) {\n                that.view.purge();\n            }\n\n            that.link.off(NS);\n            that.owner = null;\n            that.wrapper = null;\n            that.element = null;\n        },\n\n        close: function() {\n            if (this.menu) {\n                this.menu.close();\n            }\n            if (this.popup) {\n                this.popup.close();\n                this.popup.element.off(\"keydown\" + NS);\n            }\n        },\n\n        _click: function(e) {\n            var that = this;\n\n            e.preventDefault();\n            e.stopPropagation();\n\n            var options = this.options;\n\n            if (options.filter && this.element.is(!options.filter)) {\n                return;\n            }\n\n            if (!this.popup && !this.pane) {\n                this._init();\n            } else {\n                that._updateMenuItems();\n            }\n\n            if (this._isMobile) {\n                this.pane.navigate(this.view, this.options.animations.left);\n            } else {\n                this.popup.toggle();\n            }\n        },\n\n        _updateMenuItems: function() {\n            var that = this;\n            if (that.options.columns) {\n                that._setMenuItemsVisibility();\n                if (!that.options.columns.sort && !that.options.columns.groups) {\n                    that._reorderMenuItems();\n                } else {\n                    that._updateDataIndexes();\n                }\n            }\n        },\n\n        _setMenuItemsVisibility: function() {\n            var that = this;\n\n            that._eachRenderedMenuItem(function(index, column, renderedListElement) {\n                if (column.matchesMedia === false) {\n                    renderedListElement.hide();\n                } else {\n                    renderedListElement.show();\n                }\n            });\n        },\n\n        _reorderMenuItems: function() {\n            var that = this;\n\n            that._eachRenderedMenuItem(function(index, column, renderedListElement, renderedList) {\n                if (renderedListElement[0] && renderedListElement.index() !== index) {\n                    insertElementAt(index, renderedListElement, renderedList);\n                }\n            });\n            that._updateDataIndexes();\n        },\n\n        _updateDataIndexes: function() {\n            var that = this;\n            var renderedList = that._isMobile && that.view ?\n                $(that.view.element).find(\".k-columns-item\").children(\"ul\") :\n                $(that.wrapper).find(\".k-menu-group\").first(),\n                mappedColumns = that._ownerColumns(true).map(function(x) {\n                    return x.title || x.field;\n                });\n\n            renderedList.find(\"span.\" + (this._isMobile ? \"k-listgroup-form-field-wrapper\" : \"k-menu-link\") +\n                \" input\").each(function(i) {\n                var columns;\n                var index;\n                if (that.options.columns.sort) {\n                    columns = that._ownerColumns();\n                    index = mappedColumns.indexOf(columns[i].title);\n                    $(this).attr(kendo.attr(\"index\"), index);\n                } else {\n                    $(this).attr(kendo.attr(\"index\"), i);\n                }\n            });\n        },\n\n        _eachRenderedMenuItem: function(callback) {\n            var that = this;\n            var renderedListElement;\n            var duplicateColumnIndex;\n            var fieldValue;\n            var currentColumn;\n            var columns = grep(leafColumns(that.owner.columns), function(col) {\n                var result = true,\n                    title = trim(col.title || \"\");\n\n                if (col.menu === false || (!col.field && !title.length)) {\n                    result = false;\n                }\n\n                return result;\n            }).map(function(col) {\n                return {\n                     field: col.field,\n                     title: col.title,\n                     matchesMedia: col.matchesMedia\n                   };\n            });\n            var renderedList = that._getRenderedList();\n            var renderedListElements = that._getRenderedListElements(renderedList);\n            var oldOccurances = oldColumnOccurrences(renderedListElements, renderedList.find(\"input[type=checkbox]\"));\n            var columnOccurrence = columnOccurrences(columns);\n            var columnElements;\n\n            for (var i = 0; i < columns.length; i++) {\n                currentColumn = columns[i];\n                fieldValue = currentColumn.field ? currentColumn.field : currentColumn.title;\n                duplicateColumnIndex = $.inArray(i, columnOccurrence[JSON.stringify(currentColumn)]);\n                columnElements = $();\n\n                for (var idx = 0; idx < oldOccurances[fieldValue].length; idx++) {\n                    columnElements = columnElements.add(renderedListElements.eq(oldOccurances[fieldValue][idx]));\n                }\n                renderedListElement = columnElements.find(attrEquals(\"field\", fieldValue)).closest(that._isModernComponentType() ? \"label\" : \"li\").eq(duplicateColumnIndex);\n                callback(i, currentColumn, renderedListElement, renderedList);\n            }\n        },\n\n        _getRenderedList: function() {\n            var that = this;\n\n            if (that._isModernComponentType()) {\n                return $(that.wrapper).find('.k-columns-item');\n            } else {\n                return that._isMobile && that.view ?\n                $(that.view.element).find(\".k-columns-item\").children(\"ul\") :\n                $(that.wrapper).find(\".k-menu-group\").first();\n            }\n        },\n\n        _getRenderedListElements: function(renderedList) {\n            var that = this;\n\n            if (that._isModernComponentType()) {\n                return renderedList.find('label');\n            } else {\n                return renderedList.find(\"span.\" + (this._isMobile ? \"k-listgroup-form-field-wrapper\" : \"k-menu-link\"));\n            }\n        },\n\n        _open: function() {\n            var that = this,\n                instance, menuitem;\n\n            $(\".k-column-menu\").not(that.wrapper).each(function() {\n                $(this).data(POPUP).close();\n            });\n            that.popup.element.on(\"keydown\" + NS, function(e) {\n                var target = $(e.target);\n\n                if (that._isModernComponentType() && e.keyCode === kendo.keys.ENTER) {\n                    target.click();\n                }\n                if (e.keyCode == kendo.keys.ESC) {\n                    instance = kendo.widgetInstance(target.find(\"select\"));\n\n                    if (target.hasClass(\"k-picker\") &&\n                        instance &&\n                        instance.popup.visible()) {\n                            e.stopPropagation();\n                            return;\n                    }\n\n                    menuitem = target.closest(\".k-popup\").closest(\".k-menu-item\");\n\n                    if (menuitem.length > 0) {\n                        menuitem.addClass(\"k-focus\");\n\n                        if (that.menu) {\n                            that.menu.element.trigger(\"focus\");\n                        } else {\n                            that.popup.element.find('[tabindex=0]').eq(0).trigger(\"focus\");\n                        }\n                    }\n\n                    target.closest(\".k-popup\").getKendoPopup().close();\n                }\n            });\n\n            if (that.options.hasLockableColumns) {\n                that._updateLockedColumns();\n            }\n\n            if (that.options.hasStickableColumns) {\n                that._updateStickyColumns();\n            }\n        },\n\n        _activate: function() {\n            if (this.menu) {\n                this.menu.element.trigger(\"focus\");\n            } else {\n                this.popup.element.find('[tabindex=0]').eq(0).trigger(\"focus\");\n            }\n\n            this.trigger(OPEN, { field: this.field, container: this.wrapper });\n        },\n\n        _ownerColumns: function(omitSort) {\n            var columns = leafColumns(this.owner.columns),\n                menuColumns = grep(columns, function(col) {\n                    var result = true,\n                        title = trim(col.title || \"\");\n\n                    if (col.menu === false || (!col.field && !title.length)) {\n                        result = false;\n                    }\n\n                    return result;\n                }),\n                result,\n                sort = this.options.columns.sort;\n\n            result = map(menuColumns, function(col) {\n                return {\n                    originalField: col.field,\n                    field: col.field || col.title,\n                    title: col.title || col.field,\n                    hidden: col.hidden,\n                    matchesMedia: col.matchesMedia,\n                    index: inArray(col, columns),\n                    locked: !!col.locked,\n                    _originalObject: col,\n                    uid: col.headerAttributes.id\n                };\n            });\n\n            if (sort && !omitSort) {\n                result.sort(Comparer.create({ field: \"title\", dir: sort }));\n            }\n\n            return result;\n        },\n\n        _sort: function() {\n            var that = this;\n\n            if (that.options.sortable) {\n                that.refresh();\n\n                if (that._isModernComponentType()) {\n                    that.wrapper.on(\"click\" + NS, \".k-sort-asc, .k-sort-desc\", that._sortHandler.bind(that));\n                } else {\n                    that.menu.bind(SELECT, that._sortHandler.bind(that));\n                }\n            }\n        },\n\n        _sortHandler: function(e) {\n            var that = this,\n                item = e.item ? $(e.item) : $(e.target),\n                dir;\n\n            if (item.hasClass(\"k-sort-asc\")) {\n                dir = ASC;\n            } else if (item.hasClass(\"k-sort-desc\")) {\n                dir = DESC;\n            }\n\n            if (!dir) {\n                return;\n            }\n\n            that._getSortItemsContainer(item).find(\".k-sort-\" + (dir == ASC ? DESC : ASC)).removeClass(ACTIVE);\n\n            that._sortDataSource(item, dir);\n\n            if (!that._isMobile) {\n                that.close();\n            }\n        },\n\n        _getSortItemsContainer: function(item) {\n            return this._isModernComponentType() ? item.parents('.k-columnmenu-item-wrapper').first() : item.parent();\n        },\n\n        _sortDataSource: function(item, dir) {\n            var that = this,\n                sortable = that.options.sortable,\n                compare = sortable.compare === null ? undefined : sortable.compare,\n                dataSource = that.dataSource,\n                idx,\n                length,\n                sort = dataSource.sort() || [];\n\n            var removeClass = item.hasClass(ACTIVE) && sortable && sortable.allowUnsort !== false;\n\n            dir = !removeClass ? dir : undefined;\n\n            if (that.trigger(\"sort\", { sort: { field: that.field, dir: dir, compare: compare } })) {\n                return;\n            }\n\n            if (removeClass) {\n                item.removeClass(ACTIVE);\n            } else {\n                item.addClass(ACTIVE);\n            }\n\n            if (sortable.mode === \"multiple\") {\n                for (idx = 0, length = sort.length; idx < length; idx++) {\n                    if (sort[idx].field === that.field) {\n                        sort.splice(idx, 1);\n                        break;\n                    }\n                }\n                sort.push({ field: that.field, dir: dir, compare: compare });\n            } else {\n                sort = [ { field: that.field, dir: dir, compare: compare } ];\n            }\n\n            dataSource.sort(sort);\n        },\n\n        _columns: function() {\n            var that = this;\n\n            if (that.options.columns) {\n\n                that._updateColumnsMenu();\n\n                that._updateColumnsMenuHandler = that._updateColumnsMenu.bind(that);\n\n                that.owner.bind([\"columnHide\", \"columnShow\"], that._updateColumnsMenuHandler);\n\n                that._updateColumnsLockedStateHandler = that._updateColumnsLockedState.bind(that);\n\n                that.owner.bind([\"columnUnlock\", \"columnLock\" ], that._updateColumnsLockedStateHandler);\n\n                if (that._isModernComponentType()) {\n                    that.wrapper.on(\"click\" + NS, '.k-columns-item .k-button:not(.k-button-solid-primary)', function() {\n                        that._updateColumnsMenu();\n                    });\n                    that.wrapper.on(\"click\" + NS, '.k-columns-item .k-button.k-button-solid-primary', that._applyColumnVisibility.bind(that));\n                    that.wrapper.on(\"click\" + NS, '.k-columns-item .k-checkbox', function() {\n                        that._updateColumnsMenu(true);\n                    });\n                } else {\n                    that.menu.bind(SELECT, function(e) {\n                        var item = $(e.item),\n                            input,\n                            column,\n                            uidAttr = kendo.attr(\"uid\"),\n                            colIdx = 0,\n                            columns = grep(leafColumns(that.owner.columns), function(col) {\n                                var result = true,\n                                    title = trim(col.title || \"\");\n\n                                if (col.menu === false || (!col.field && !title.length)) {\n                                    result = false;\n                                }\n\n                                return result;\n                            });\n\n                        if (that._isMobile) {\n                            e.preventDefault();\n                        }\n\n                        if (!item.parent().closest(\"li.k-columns-item\")[0]) {\n                            return;\n                        }\n\n                        input = item.find(\":checkbox\");\n                        if (input.attr(\"disabled\")) {\n                            return;\n                        }\n\n                        colIdx = columns.map(function(col) {\n                            return col.headerAttributes.id;\n                        }).indexOf(input.attr(uidAttr));\n                        column = columns[colIdx];\n\n                        if (column.hidden === true) {\n                            that.owner.showColumn(column);\n                        } else {\n                            that.owner.hideColumn(column);\n                        }\n                    });\n                }\n            }\n        },\n\n        _applyColumnVisibility: function() {\n            var that = this;\n            var fieldAttr = kendo.attr(\"field\");\n            var uidAttr = kendo.attr(\"uid\");\n            var checkboxes = that.wrapper.find(\".k-columns-item input[\" + fieldAttr + \"]\");\n            var columnsInMenu = grep(leafColumns(this.owner.columns), function(col) {\n                var result = true,\n                    title = trim(col.title || \"\");\n\n                if (col.menu === false || (!col.field && !title.length)) {\n                    result = false;\n                }\n\n                return result;\n            });\n            var length = checkboxes.length;\n            var idx;\n            var colIdx;\n            var checkbox;\n            var column;\n\n            that.owner.unbind(\"columnShow\", that._updateColumnsMenuHandler);\n            that.owner.unbind(\"columnHide\", that._updateColumnsMenuHandler);\n\n            for (idx = 0; idx < length; idx++) {\n                checkbox = $(checkboxes[idx]);\n                colIdx = columnsInMenu.map(function(col) {\n                    return col.headerAttributes.id;\n                }).indexOf(checkbox.attr(uidAttr));\n                column = columnsInMenu[colIdx];\n\n               if (checkbox.is(\":checked\") && column.hidden) {\n                   that.owner.showColumn(column);\n               } else if (checkbox.is(\":not(:checked)\") && !column.hidden) {\n                   that.owner.hideColumn(column);\n               }\n            }\n            that.popup.close();\n            that.owner.bind([\"columnHide\", \"columnShow\"], that._updateColumnsMenuHandler);\n        },\n\n        _updateColumnsMenu: function(omitCheckState) {\n            var idx, length, current, checked, locked, that = this;\n            var fieldAttr = kendo.attr(\"field\"),\n                lockedAttr = kendo.attr(\"locked\"),\n                uidAttr = kendo.attr(\"uid\"),\n                columnIndexMap = {},\n                columnsCount = 0,\n                colIdx = 0;\n                omitCheckState = omitCheckState === true;\n                var columnsInMenu = grep(leafColumns(this.owner.columns), function(col, idx) {\n                    var result = true,\n                        title = trim(col.title || \"\");\n\n                    if (col.menu === false || (!col.field && !title.length)) {\n                        result = false;\n                    }\n\n                    if (result) {\n                        columnIndexMap[idx] = columnsCount;\n                        columnsCount++;\n                    }\n\n                    return result;\n                }),\n                visibleFields = grep(this._ownerColumns(), function(field) {\n                    if (omitCheckState) {\n                         return that.wrapper.find(\"[role='menuitemcheckbox'] [\" + uidAttr + \"='\" + field.uid + \"']\").prop('checked');\n                    }\n                    return !field.hidden && field.matchesMedia !== false;\n                }),\n                visibleDataFields = grep(visibleFields, function(field) {\n                    return field.originalField;\n                }),\n                lockedCount = grep(visibleDataFields, function(col) {\n                    return col.locked === true;\n                }).length,\n                nonLockedCount = grep(visibleDataFields, function(col) {\n                    return col.locked !== true;\n                }).length,\n                columnsNotInMenu = grep(this.owner.columns, function(col) {\n                    return col.menu === false;\n                }),\n                hiddenColumnsNotInMenu = grep(columnsNotInMenu, function(col) {\n                    return col.hidden;\n                });\n\n            this.wrapper.find(\"[role='menuitemcheckbox']\").attr(\"aria-checked\", false);\n\n            var checkboxes = this.wrapper\n                .find(\".k-columns-item input[\" + fieldAttr + \"]\")\n                .prop(\"disabled\", false);\n\n            if (!omitCheckState) {\n                checkboxes.prop(\"checked\", false);\n            }\n\n            var switchWidget;\n\n            for (idx = 0, length = checkboxes.length; idx < length; idx ++) {\n                current = checkboxes.eq(idx);\n                locked = current.attr(lockedAttr) === \"true\";\n                checked = false;\n                switchWidget = current.data(\"kendoSwitch\");\n                colIdx = columnsInMenu.map(function(col) {\n                    return col.headerAttributes.id;\n                }).indexOf(current.attr(uidAttr));\n\n                checked = omitCheckState ? current.prop('checked') : !columnsInMenu[colIdx].hidden && columnsInMenu[colIdx].matchesMedia !== false;\n                current.prop(\"checked\", checked);\n\n                if (switchWidget) {\n                    switchWidget.enable(true);\n                    switchWidget.check(checked);\n                }\n\n                current.closest(\"[role='menuitemcheckbox']\").attr(\"aria-checked\", checked);\n\n                if (checked) {\n                    if (lockedCount == 1 && locked) {\n                        current.prop(\"disabled\", true);\n\n                        if (switchWidget) {\n                            switchWidget.enable(false);\n                        }\n                    }\n\n                    if ((columnsNotInMenu.length === 0 || (columnsNotInMenu.length === hiddenColumnsNotInMenu.length)) && nonLockedCount == 1 && !locked) {\n                        current.prop(\"disabled\", true);\n\n                        if (switchWidget) {\n                            switchWidget.enable(false);\n                        }\n                    }\n                }\n            }\n        },\n\n        _updateColumnsLockedState: function() {\n            var idx, length, current, column;\n            var fieldAttr = kendo.attr(\"field\");\n            var lockedAttr = kendo.attr(\"locked\");\n            var columns = toHash(this._ownerColumns(), \"field\");\n            var checkboxes = this.wrapper\n                .find(\".k-columns-item input[type=checkbox]\");\n\n            for (idx = 0, length = checkboxes.length; idx < length; idx ++ ) {\n                current = checkboxes.eq(idx);\n                column = columns[current.attr(fieldAttr)];\n                if (column) {\n                    current.attr(lockedAttr, column.locked);\n                }\n            }\n\n            this._updateColumnsMenu();\n        },\n\n        _filter: function() {\n            var that = this,\n                widget = FILTERMENU,\n                options = that.options;\n\n            if (options.filterable !== false) {\n\n                if (options.filterable.multi) {\n                    widget = \"kendoFilterMultiCheck\";\n                    if (options.filterable.dataSource) {\n                        options.filterable.checkSource = options.filterable.dataSource;\n                        delete options.filterable.dataSource;\n                    }\n                }\n                that.filterMenu = that.wrapper.find(\".k-filterable\")[widget](\n                    extend(true, {}, {\n                        appendToElement: true,\n                        dataSource: options.dataSource,\n                        values: options.values,\n                        field: that.field,\n                        title: that.title,\n                        change: function(e) {\n                            if (that.trigger(\"filtering\", { filter: e.filter, field: e.field })) {\n                                e.preventDefault();\n                            }\n                        },\n                        componentType: that.options.componentType,\n                        cycleForm: !that._isModernComponentType()\n                    },\n                    options.filterable)\n                    ).data(widget);\n\n                if (that._isMobile) {\n                    that.menu.bind(SELECT, function(e) {\n                        var item = $(e.item);\n\n                        if (item.hasClass(\"k-filter-item\")) {\n                            that.pane.navigate(that.filterMenu.view, that.options.animations.left);\n                        }\n                    });\n                }\n            }\n        },\n\n        _lockColumns: function() {\n            var that = this;\n\n            if (that._isModernComponentType()) {\n                that.wrapper.on(\"click\" + NS, \".k-lock, .k-unlock\", that._lockableHandler.bind(that));\n            } else {\n                that.menu.bind(SELECT, that._lockableHandler.bind(that));\n            }\n        },\n\n        _lockableHandler: function(e) {\n            var that = this;\n            var item = e.item ? $(e.item) : $(e.target);\n\n            if (item.hasClass(\"k-lock\")) {\n                that.owner.lockColumn(that.field);\n                if (!that._isMobile) {\n                    that.close();\n                }\n            } else if (item.hasClass(\"k-unlock\")) {\n                that.owner.unlockColumn(that.field);\n                if (!that._isMobile) {\n                    that.close();\n                }\n            }\n        },\n\n        _stickyColumns: function() {\n            var that = this;\n\n            if (that._isModernComponentType()) {\n                that.wrapper.on(\"click\" + NS, \".k-stick, .k-unstick\", that._stickableHandler.bind(that));\n            } else {\n                that.menu.bind(SELECT, that._stickableHandler.bind(that));\n            }\n        },\n\n        _stickableHandler: function(e) {\n            var that = this;\n            var item = e.item ? $(e.item) : $(e.target);\n            var field = that.field;\n            var columns = that.owner.columns;\n            var column = grep(columns, function(column) {\n                return column.field == field || column.title == field;\n            })[0];\n\n            if (item.hasClass(\"k-stick\")) {\n                that.owner.stickColumn(that.field);\n                that.trigger(STICK, { column: column });\n                if (!that._isMobile) {\n                    that.close();\n                }\n            } else if (item.hasClass(\"k-unstick\")) {\n                that.owner.unstickColumn(that.field);\n                that.trigger(UNSTICK, { column: column });\n                if (!that._isMobile) {\n                    that.close();\n                }\n            }\n        },\n\n        _updateLockedColumns: function() {\n            var field = this.field;\n            var columns = this.owner.columns;\n            var column = grep(columns, function(column) {\n                return column.field == field || column.title == field;\n            })[0];\n\n            if (!column) {\n                return;\n            }\n\n            var locked = column.locked === true;\n            var length = grep(columns, function(column) {\n                return !column.hidden && ((column.locked && locked) || (!column.locked && !locked));\n            }).length;\n            var notLockable = column.lockable === false;\n\n            var lockItem = this.wrapper.find(\".k-lock\").removeClass(\"k-disabled\");\n            var unlockItem = this.wrapper.find(\".k-unlock\").removeClass(\"k-disabled\");\n\n            if (locked || length == 1 || notLockable) {\n                lockItem.addClass(\"k-disabled\");\n            }\n\n            if (!locked || length == 1 || notLockable) {\n                unlockItem.addClass(\"k-disabled\");\n            }\n\n            this._updateColumnsLockedState();\n        },\n\n        _updateStickyColumns: function() {\n            var field = this.field;\n            var columns = this.owner.columns;\n            var column = grep(columns, function(column) {\n                return column.field == field || column.title == field;\n            })[0];\n\n            if (!column) {\n                return;\n            }\n\n            var sticky = column.sticky === true;\n            var stickable = column.stickable === true;\n            var locked = column.locked === true;\n            var length = grep(columns, function(column) {\n                return !column.hidden && ((column.locked && locked) || (!column.locked && !locked));\n            }).length;\n\n            var stickItem = this.wrapper.find(\".k-stick\").removeClass(\"k-disabled\");\n            var unstickItem = this.wrapper.find(\".k-unstick\").removeClass(\"k-disabled\");\n\n            if (sticky || !stickable || (locked && length === 1)) {\n                stickItem.addClass(\"k-disabled\");\n            }\n\n            if (!sticky || !stickable) {\n                unstickItem.addClass(\"k-disabled\");\n            }\n        },\n\n        refresh: function() {\n            var that = this,\n                sort = that.options.dataSource.sort() || [],\n                descriptor,\n                field = that.field,\n                idx,\n                length;\n\n            that.wrapper.find(\".k-sort-asc, .k-sort-desc\").removeClass(ACTIVE);\n\n            for (idx = 0, length = sort.length; idx < length; idx++) {\n               descriptor = sort[idx];\n\n               if (field == descriptor.field) {\n                    that.wrapper.find(\".k-sort-\" + descriptor.dir).addClass(ACTIVE);\n               }\n            }\n\n            that.link[that._filterExist(that.dataSource.filter()) ? \"addClass\" : \"removeClass\"](\"k-active\");\n        },\n\n        _filterExist: function(filters) {\n            var found = false;\n            var filter;\n\n            if (!filters) {\n                return;\n            }\n\n            filters = filters.filters;\n\n            for (var idx = 0, length = filters.length; idx < length; idx++) {\n                filter = filters[idx];\n\n                if (filter.field == this.field) {\n                    found = true;\n                } else if (filter.filters) {\n                    found = found || this._filterExist(filter);\n                }\n            }\n\n            return found;\n        }\n    });\n\n    var modernTemplate = '#if(sortable){#' +\n                                '<div class=\"k-columnmenu-item-wrapper\">' +\n                                    '<div>' +\n                                        '<div class=\"k-columnmenu-item k-sort-asc\" tabindex=\"0\">' +\n                                            '<span class=\"k-icon k-i-sort-asc-sm\"></span>${messages.sortAscending}' +\n                                        '</div>' +\n                                    '</div>' +\n                                    '<div>' +\n                                        '<div class=\"k-columnmenu-item k-sort-desc\" tabindex=\"0\">' +\n                                            '<span class=\"k-icon k-i-sort-desc-sm\"></span>${messages.sortDescending}' +\n                                        '</div>' +\n                                    '</div>' +\n                                '</div>' +\n                            '#}#' +\n                            '#if(showColumns){#' +\n                                '<div class=\"k-columnmenu-item-wrapper\">' +\n                                    '<div>' +\n                                        '<div class=\"k-columnmenu-item-content k-columns-item\">' +\n                                            '<div class=\"k-column-list-wrapper\">' +\n                                                '<div class=\"k-column-list\" role=\"menu\">' +\n                                                '#for (var idx = 0; idx < columns.length; idx++) {#' +\n                                                    '#if(columns[idx].groupHeader){#' +\n                                                        '<span class=\"k-column-menu-group-header\"><span class=\"k-column-menu-group-header-text\">#=columns[idx].title#</span></span>' +\n                                                    '#} else {#' +\n                                                        '<label class=\"k-column-list-item\" role=\"menuitemcheckbox\" aria-checked=\"false\" #=columns[idx].matchesMedia === false ? \"style=\\'display:none;\\'\" : \"\"#><input class=\"k-checkbox k-checkbox-md k-rounded-md\" type=\"checkbox\" title=\"#=encodeTitles ? kendo.htmlEncode(columns[idx].title) : columns[idx].title#\" data-#=ns#field=\"#=columns[idx].field.replace(/\\\"/g,\"&\\\\#34;\")#\" data-#=ns#index=\"#=columns[idx].index#\" data-#=ns#locked=\"#=columns[idx].locked#\" data-#=ns#uid=\"#=columns[idx].uid#\"/><span class=\"k-checkbox-label\"> #=encodeTitles ? kendo.htmlEncode(columns[idx].title) : columns[idx].title#</span></label>' +\n                                                    '#}#' +\n                                                '#}#' +\n                                                '</div>' +\n                                            '</div>' +\n                                            '<div class=\"k-columnmenu-actions\">' +\n                                                '<button class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base\" type=\"button\">${messages.reset}</button>' +\n                                                '<button class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary\" type=\"button\">${messages.apply}</button>' +\n                                            '</div>' +\n                                        '</div>' +\n                                    '</div>' +\n                                '</div>' +\n                            '#}#' +\n                            '#if(filterable){#' +\n                                '<div class=\"k-columnmenu-item-wrapper\">' +\n                                    '<div class=\"k-columnmenu-item-content k-column-menu-filter\">' +\n                                        '<div class=\"k-filterable\"></div>' +\n                                    '</div>' +\n                                '</div>' +\n                            '#}#' +\n                            '#if(hasLockableColumns || hasStickableColumns){#' +\n                                '<div class=\"k-columnmenu-item-wrapper\">' +\n                                    '<div class=\"k-column-menu-position\">' +\n                                        '#if(hasLockableColumns){#' +\n                                            '<div class=\"k-columnmenu-item k-lock\" tabindex=\"0\">' +\n                                                '<span class=\"k-icon k-i-lock\"></span>${messages.lock}' +\n                                            '</div>' +\n                                            '<div class=\"k-columnmenu-item k-unlock\" tabindex=\"0\">' +\n                                                '<span class=\"k-icon k-i-unlock\"></span>${messages.unlock}' +\n                                            '</div>' +\n                                        '#}#' +\n                                        '#if(hasStickableColumns){#' +\n                                            '<div class=\"k-columnmenu-item k-stick\" tabindex=\"0\">' +\n                                                '<span class=\"k-icon k-i-stick\"></span>${messages.stick}' +\n                                            '</div>' +\n                                            '<div class=\"k-columnmenu-item k-unstick\" tabindex=\"0\">' +\n                                                '<span class=\"k-icon k-i-unstick\"></span>${messages.unstick}' +\n                                            '</div>' +\n                                        '#}#' +\n                                    '</div>' +\n                                '</div>' +\n                            '#}#';\n\n    var template = '<ul id=\"#=uid#\">' +\n                          '#if(sortable){#' +\n                              '<li class=\"k-item k-menu-item k-sort-asc\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-sort-asc-sm\"></span><span class=\"k-menu-link-text\">${messages.sortAscending}</span></span></li>' +\n                              '<li class=\"k-item k-menu-item k-sort-desc\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-sort-desc-sm\"></span><span class=\"k-menu-link-text\">${messages.sortDescending}</span></span></li>' +\n                              '#if(showColumns || filterable){#' +\n                                  '<li class=\"k-separator k-menu-separator\" role=\"presentation\"></li>' +\n                              '#}#' +\n                          '#}#' +\n                          '#if(showColumns){#' +\n                              '<li class=\"k-item k-menu-item k-columns-item\" aria-haspopup=\"true\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-columns\"></span><span class=\"k-menu-link-text\">${messages.columns}</span></span><ul>' +\n                              '#for (var idx = 0; idx < columns.length; idx++) {#' +\n                                  '#if(columns[idx].groupHeader){#' +\n                                      '<li class=\"k-column-menu-group-header\" #=omitWrapAttribute#=\"true\" ><span class=\"k-column-menu-group-header-text\">#=columns[idx].title#</span></li>' +\n                                  '#} else {#' +\n                                      '<li role=\"menuitemcheckbox\" aria-checked=\"false\" #=columns[idx].matchesMedia === false ? \"style=\\'display:none;\\'\" : \"\"#><input type=\"checkbox\" class=\"k-checkbox k-checkbox-md k-rounded-md\" title=\"#=encodeTitles ? kendo.htmlEncode(columns[idx].title) : columns[idx].title#\" data-#=ns#field=\"#=columns[idx].field.replace(/\\\"/g,\"&\\\\#34;\")#\" data-#=ns#index=\"#=columns[idx].index#\" data-#=ns#locked=\"#=columns[idx].locked#\" data-#=ns#uid=\"#=columns[idx].uid#\"/>#=encodeTitles ? kendo.htmlEncode(columns[idx].title) : columns[idx].title#</li>' +\n                                  '#}#' +\n                              '#}#' +\n                              '</ul></li>' +\n                              '#if(filterable || hasLockableColumns || hasStickableColumns){#' +\n                                  '<li class=\"k-separator k-menu-separator\" role=\"presentation\"></li>' +\n                              '#}#' +\n                          '#}#' +\n                          '#if(filterable){#' +\n                              '<li class=\"k-item k-menu-item k-filter-item\" aria-haspopup=\"true\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-filter\"></span><span class=\"k-menu-link-text\">${messages.filter}</span></span><ul>' +\n                                  '<li><div class=\"k-filterable\"></div></li>' +\n                              '</ul></li>' +\n                              '#if(hasLockableColumns || hasStickableColumns){#' +\n                                  '<li class=\"k-separator k-menu-separator\" role=\"presentation\"></li>' +\n                              '#}#' +\n                          '#}#' +\n                          '#if(hasLockableColumns || hasStickableColumns){#' +\n                              '<li class=\"k-item k-menu-item k-position-item\" aria-haspopup=\"true\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-set-column-position\"></span><span class=\"k-menu-link-text\">${messages.setColumnPosition}</span></span><ul>' +\n                                  '#if(hasLockableColumns){#' +\n                                      '<li class=\"k-item k-menu-item k-lock\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-lock\"></span><span class=\"k-menu-link-text\">${messages.lock}</span></span></li>' +\n                                      '<li class=\"k-item k-menu-item k-unlock\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-unlock\"></span><span class=\"k-menu-link-text\">${messages.unlock}</span></span></li>' +\n                                      '#if(hasStickableColumns){#' +\n                                          '<li class=\"k-separator k-menu-separator\" role=\"presentation\"></li>' +\n                                      '#}#' +\n                                  '#}#' +\n                                  '#if(hasStickableColumns){#' +\n                                      '<li class=\"k-item k-menu-item k-stick\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-stick\"></span><span class=\"k-menu-link-text\">${messages.stick}</span></span></li>' +\n                                      '<li class=\"k-item k-menu-item k-unstick\"><span class=\"k-link k-menu-link\"><span class=\"k-icon k-i-unstick\"></span><span class=\"k-menu-link-text\">${messages.unstick}</span></span></li>' +\n                                  '#}#' +\n                              '</ul></li>' +\n                          '#}#' +\n                    '</ul>';\n\n    var mobileTemplate =\n            '<div data-#=ns#role=\"view\" class=\"k-grid-column-menu\">' +\n                '<div data-#=ns#role=\"header\" class=\"k-header\">' +\n                    '<a href=\"\\\\#\" class=\"k-header-cancel k-link\" title=\"#=messages.cancel#\" ' +\n                    'aria-label=\"#=messages.cancel#\"><span class=\"k-icon k-i-arrow-chevron-left\"></span></a>' +\n                    '${messages.settings}' +\n                    '<a href=\"\\\\#\" class=\"k-header-done k-link\" title=\"#=messages.done#\" ' +\n                    'aria-label=\"#=messages.done#\"><span class=\"k-icon k-i-check\"></span></a>' +\n                '</div>' +\n                '<div class=\"k-column-menu\">' +\n                    '<ul class=\"k-reset\">' +\n                        '<li>' +\n                            '<span class=\"k-list-title\">#=messages.column#: ${title}</span>' +\n                            '<ul class=\"k-listgroup k-listgroup-flush k-mb-4\">' +\n                                '#if(sortable){#' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-sort-asc\"><span class=\"k-link\"><span class=\"k-icon k-i-sort-asc-sm\"></span><span class=\"k-item-title\">${messages.sortAscending}</span></span></li>' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-sort-desc\"><span class=\"k-link\"><span class=\"k-icon k-i-sort-desc-sm\"></span><span class=\"k-item-title\">${messages.sortDescending}</span></span></li>' +\n                                '#}#' +\n                                '#if(hasLockableColumns){#' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-lock\"><span class=\"k-link\"><span class=\"k-icon k-i-lock\"></span><span class=\"k-item-title\">${messages.lock}</span></span></li>' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-unlock\"><span class=\"k-link\"><span class=\"k-icon k-i-unlock\"></span><span class=\"k-item-title\">${messages.unlock}</span></span></li>' +\n                                '#}#' +\n                                '#if(hasStickableColumns){#' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-stick\"><span class=\"k-link\"><span class=\"k-icon k-i-stick\"></span><span class=\"k-item-title\">${messages.stick}</span></span></li>' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-unstick\"><span class=\"k-link\"><span class=\"k-icon k-i-unstick\"></span><span class=\"k-item-title\">${messages.unstick}</span></span></li>' +\n                                '#}#' +\n                                '#if(filterable){#' +\n                                    '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item k-filter-item\">' +\n                                        '<span class=\"k-link k-filterable\">' +\n                                            '<span class=\"k-icon k-i-filter\"></span>' +\n                                            '<span class=\"k-item-title\">${messages.filter}</span>' +\n                                            '<span class=\"k-select\"><span class=\"k-icon k-i-arrow-chevron-right\"></span></span>' +\n                                        '</span>' +\n                                    '</li>' +\n                                '#}#' +\n                            '</ul>' +\n                        '</li>' +\n                        '#if(showColumns){#' +\n                            '<li class=\"k-columns-item\"><span class=\"k-list-title\">${messages.columnVisibility}</span>' +\n                                '#if(hasGroups){#' +\n                                    '#for (var i = 0; i < groups.length; i++) {#' +\n                                        '<span class=\"k-list-group-header k-pb-1\">#:groups[i].title#</span>' +\n                                        '<ul class=\"k-listgroup k-listgroup-flush k-mb-4\">' +\n                                            '#for (var idx = 0; idx < groups[i].columns.length; idx++) {#' +\n                                                '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item\">' +\n                                                    '<span class=\"k-listgroup-form-row\">' +\n                                                        '<span class=\"k-listgroup-form-field-label k-item-title\">' +\n                                                            '#=groups[i].columns[idx].title#' +\n                                                        '</span>' +\n                                                        '<span class=\"k-listgroup-form-field-wrapper\">' +\n                                                            '<input type=\"checkbox\" title=\"#=groups[i].columns[idx].title#\" ' +\n                                                                ' data-#=ns#field=\"#=groups[i].columns[idx].field.replace(/\\\"/g,\"&\\\\#34;\")#\"' +\n                                                                ' data-#=ns#index=\"#=groups[i].columns[idx].index#\"' +\n                                                                ' data-#=ns#uid=\"#=groups[i].columns[idx].uid#\"' +\n                                                                ' data-#=ns#locked=\"#=groups[i].columns[idx].locked#\" />' +\n                                                        '</span>' +\n                                                    '</span>' +\n                                                '</li>' +\n                                            '#}#' +\n                                        '</ul>' +\n                                    '#}#' +\n                                '#} else {#' +\n                                    '<ul class=\"k-listgroup k-listgroup-flush k-mb-4\">' +\n                                    '#for (var idx = 0; idx < columns.length; idx++) {#' +\n                                        '<li id=\"#=kendo.guid()#\" class=\"k-item k-listgroup-item\">' +\n                                            '<span class=\"k-listgroup-form-row\">' +\n                                                '<span class=\"k-listgroup-form-field-label k-item-title\">' +\n                                                    '#=columns[idx].title#' +\n                                                '</span>' +\n                                                '<span class=\"k-listgroup-form-field-wrapper\">' +\n                                                    '<input type=\"checkbox\" title=\"#=columns[idx].title#\" ' +\n                                                        ' data-#=ns#field=\"#=columns[idx].field.replace(/\\\"/g,\"&\\\\#34;\")#\"' +\n                                                        ' data-#=ns#index=\"#=columns[idx].index#\"' +\n                                                        ' data-#=ns#uid=\"#=columns[idx].uid#\"' +\n                                                        ' data-#=ns#locked=\"#=columns[idx].locked#\" />' +\n                                                '</span>' +\n                                            '</span>' +\n                                        '</li>' +\n                                    '#}#' +\n                                    '</ul>' +\n                                '#}#' +\n                            '</li>' +\n                        '#}#' +\n                        '<li class=\"k-item k-clear-wrap\">' +\n                            '<ul class=\"k-listgroup k-listgroup-flush\">' +\n                                '<li class=\"k-listgroup-item\">' +\n                                    '<span class=\"k-link k-label k-clear\" title=\"#=messages.clear#\" aria-label=\"#=messages.clear#\">' +\n                                        '#=messages.clear#' +\n                                    '</span>' +\n                                '</li>' +\n                            '</ul>' +\n                        '</li>' +\n                    '</ul>' +\n                '</div>' +\n            '</div>';\n\n    var MobileMenu = Widget.extend({\n        init: function(element, options) {\n            var that = this;\n\n            Widget.fn.init.call(that, element, options);\n\n            that._createCheckBoxes();\n\n            that.element.on(\"click\" + NS, \"li.k-item:not(.k-separator):not(.k-disabled):not(:has(.k-switch))\", \"_click\");\n        },\n\n        events: [ SELECT ],\n\n        _click: function(e) {\n            var that = this;\n\n            if (!$(e.target).is(\"[type=checkbox]\")) {\n                e.preventDefault();\n            }\n\n            if ($(e.target).hasClass(\"k-clear\")) {\n                that._cancelChanges(true);\n\n                return;\n            }\n\n            if ($(e.target).hasClass(\"k-filterable\")) {\n                that._cancelChanges(true);\n                that.trigger(SELECT, { item: e.currentTarget });\n\n                return;\n            }\n\n            that._updateSelectedItems(e.currentTarget);\n        },\n\n        _updateSelectedItems: function(el) {\n            var that = this;\n            var item = $(el);\n            var state = that.options.columnMenu.view.state || { columns: {} };\n            var id = item.prop(\"id\");\n\n            if (item.hasClass(\"k-filter-item\")) {\n                return;\n            }\n\n            if (state[id]) {\n                state[id] = false;\n            } else {\n                state[id] = true;\n            }\n\n            if (item.hasClass(\"k-sort-asc\") || item.hasClass(\"k-sort-desc\")) {\n                var dir;\n                var otherItem;\n                var otherItemId;\n\n                if (item.hasClass(\"k-sort-asc\")) {\n                    dir = \"asc\";\n                    otherItem = that.element.find(\".k-sort-desc\");\n                } else {\n                    dir = \"desc\";\n                    otherItem = that.element.find(\".k-sort-asc\");\n                }\n\n                otherItemId = otherItem.prop(\"id\");\n\n                if (dir === state.initialSort && !item.hasClass(\"k-selected\")) {\n                    state[id] = false;\n                }\n\n                if (state[otherItemId]) {\n                    state[otherItemId] = false;\n                }\n\n                otherItem.removeClass(ACTIVE);\n            }\n\n            if (item.hasClass(ACTIVE)) {\n                item.removeClass(ACTIVE);\n            } else {\n                item.addClass(ACTIVE);\n            }\n        },\n\n        _cancelChanges: function(force) {\n            var that = this;\n            var menu = that.options.columnMenu;\n            var view = menu.view;\n            var state = view.state || { columns: {} };\n            var columns = state.columns;\n\n            that.element.find(\".\" + ACTIVE).removeClass(ACTIVE);\n            menu.refresh();\n\n            if (force) {\n                var selectedItems = [];\n\n                for (var key in columns) {\n                    if (columns.hasOwnProperty(key)) {\n                        if (columns[key] === true) {\n                            var item = view.element.find(\"#\" + key);\n\n                            selectedItems.push(item[0]);\n                        }\n                    }\n                }\n                // In order to use the columns hide/show validation,\n                // triggering the Select event must be done backwards\n                for (var i = selectedItems.length - 1; i >= 0; i--) {\n                    that.trigger(SELECT, { item: selectedItems[i] });\n                }\n\n                if (menu.options.hasLockableColumns) {\n                    menu._updateLockedColumns();\n                }\n\n                if (menu.options.hasStickableColumns) {\n                    menu._updateStickyColumns();\n                }\n            }\n\n            that.options.columnMenu.view.state = { columns: {} };\n        },\n\n        _applyChanges: function() {\n            var that = this;\n            var view = that.options.columnMenu.view;\n            var state = view.state || { columns: {} };\n\n            for (var key in state) {\n                if (state.hasOwnProperty(key)) {\n                    if (key !== \"initialSort\" && key !== \"columns\" && state[key] === true) {\n                        var item = view.element.find(\"#\" + key);\n\n                        if (item.hasClass(ACTIVE)) {\n                            item.removeClass(ACTIVE);\n                        } else {\n                            item.addClass(ACTIVE);\n                        }\n\n                        that.trigger(SELECT, { item: item[0] });\n                    }\n                }\n            }\n        },\n\n        _createCheckBoxes: function() {\n            var that = this;\n\n            that.element.find(\".k-columns-item\").find(\"[type='checkbox']\").kendoSwitch({\n                messages: {\n                    checked: \"\",\n                    unchecked: \"\"\n                },\n                change: function(e) {\n                    var item = e.sender.element.closest(\".k-item\");\n                    var state = that.options.columnMenu.view.state || { columns: {} };\n                    var id = item.prop(\"id\");\n\n                    if (state.columns[id]) {\n                        state.columns[id] = false;\n                    } else {\n                        state.columns[id] = true;\n                    }\n\n                    that.trigger(SELECT, { item: item });\n                }\n            });\n        },\n\n        _destroyCheckBoxes: function() {\n            var that = this;\n            var elements = that.element.find(\".k-columns-item\").find(\"[type='checkbox']\");\n            var switchWidget;\n\n            for (var i = 0; i < elements.length; i++) {\n                switchWidget = elements.eq(i).data(\"kendoSwitch\");\n\n                if (switchWidget) {\n                    switchWidget.destroy();\n                }\n            }\n        },\n\n        close: function() {\n            this.options.pane.navigate(\"\");\n        },\n\n        destroy: function() {\n            var that = this;\n\n            Widget.fn.destroy.call(that);\n\n            that.element.off(NS);\n            that._destroyCheckBoxes();\n        }\n    });\n\n    ui.plugin(ColumnMenu);\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","depends","advanced","$","window","kendo","jQuery","undefined","ui","extend","grep","map","inArray","Comparer","data","ACTIVE","ASC","DESC","CHANGE","INIT","OPEN","SELECT","STICK","UNSTICK","POPUP","FILTERMENU","MENU","EXPANSIONPANEL","NS","COLUMNHEADERATTR","Widget","trim","text","replace","toHash","arr","key","result","idx","len","current","length","columnsGroupFilterHandler","column","this","columns","indexOf","title","field","leafColumns","push","concat","attrEquals","attrName","attrValue","attr","insertElementAt","index","element","container","insertAfter","children","eq","prepend","columnOccurrences","columnDict","signature","i","JSON","stringify","oldColumnOccurrences","renderedListElements","checkBoxes","indexAttr","fieldAttr","columCheckbox","j","parseInt","ColumnMenu","init","options","that","columnHeader","componentType","fn","call","owner","dataSource","closest","appendTo","find","link","_createLink","wrapper","_refreshHandler","refresh","bind","_init","pane","_isMobile","_createMobileMenu","_createMenu","_muteAngularRebind","_angularItems","_sort","_columns","_filter","_lockColumns","_stickyColumns","trigger","events","messages","sortAscending","sortDescending","filter","columnVisibility","clear","cancel","done","settings","lock","unlock","stick","unstick","setColumnPosition","apply","reset","buttonTitle","sortable","filterable","animations","left","encodeTitles","_ownerColumns","flattenMenuCols","menuTemplate","_hasGroups","_groupColumns","_flattenMenuCols","_syncMenuCols","_isModernComponentType","template","modernTemplate","html","uid","guid","ns","showColumns","hasLockableColumns","hasStickableColumns","omitWrapAttribute","popup","anchor","copyAnchorStyles","open","_open","activate","_activate","deactivate","_deactivate","close","e","menu","_closing","sender","closeCallback","addClass","_createExpanders","orientation","closeOnClick","_updateMenuItems","appendTarget","format","append","on","_click","expanderOptions","expanded","headerClass","useBareTemplate","menuCols","ownerCols","ownerCol","menuColsFields","col","cols","groupHeader","nest","groups","currGroup","filterHandler","group","groupColumns","mobileTemplate","hasGroups","view","state","MobileMenu","columnMenu","stopPropagation","viewElement","preventDefault","_applyChanges","_cancelChanges","_updateLockedColumns","_updateStickyColumns","initialSort","action","angular","items","_originalObject","elements","destroy","filterMenu","unbind","_updateColumnsMenuHandler","_updateColumnsLockedStateHandler","off","purge","is","navigate","toggle","_setMenuItemsVisibility","sort","_reorderMenuItems","_updateDataIndexes","_eachRenderedMenuItem","renderedListElement","matchesMedia","hide","show","renderedList","first","mappedColumns","x","each","callback","duplicateColumnIndex","fieldValue","currentColumn","_getRenderedList","_getRenderedListElements","oldOccurances","columnOccurrence","columnElements","add","instance","menuitem","not","target","keyCode","keys","ENTER","click","ESC","widgetInstance","hasClass","visible","getKendoPopup","omitSort","menuColumns","originalField","hidden","locked","headerAttributes","create","dir","_sortHandler","item","_getSortItemsContainer","removeClass","_sortDataSource","parents","parent","compare","allowUnsort","mode","splice","_updateColumnsMenu","_updateColumnsLockedState","_applyColumnVisibility","input","uidAttr","colIdx","showColumn","hideColumn","checkboxes","columnsInMenu","checkbox","omitCheckState","checked","lockedAttr","columnIndexMap","columnsCount","visibleFields","prop","visibleDataFields","lockedCount","nonLockedCount","columnsNotInMenu","hiddenColumnsNotInMenu","switchWidget","enable","check","widget","multi","checkSource","appendToElement","values","change","cycleForm","_lockableHandler","lockColumn","unlockColumn","_stickableHandler","stickColumn","unstickColumn","notLockable","lockable","lockItem","unlockItem","sticky","stickable","stickItem","unstickItem","descriptor","_filterExist","filters","found","_createCheckBoxes","currentTarget","_updateSelectedItems","el","otherItem","otherItemId","force","selectedItems","hasOwnProperty","kendoSwitch","unchecked","_destroyCheckBoxes","plugin","amd","a1","a2","a3"],"mappings":"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"}