{"version":3,"file":"kendo.filtercell.min.js","sources":["kendo.filtercell.js"],"sourcesContent":["(function(f, define) {\n    define('kendo.filtercell',[ \"kendo.autocomplete\", \"kendo.datepicker\", \"kendo.numerictextbox\", \"kendo.combobox\", \"kendo.dropdownlist\" ], f);\n})(function() {\n\nvar __meta__ = {\n    id: \"filtercell\",\n    name: \"Row filter\",\n    category: \"framework\",\n    depends: [ \"autocomplete\" ],\n    advanced: true\n};\n\n(function($, undefined) {\n    var kendo = window.kendo,\n        ui = kendo.ui,\n        DataSource = kendo.data.DataSource,\n        Widget = ui.Widget,\n        CHANGE = \"change\",\n        BOOL = \"boolean\",\n        ENUM = \"enums\",\n        STRING = \"string\",\n        EQ = \"Is equal to\",\n        NEQ = \"Is not equal to\",\n        nonValueOperators = [\"isnull\", \"isnotnull\", \"isempty\", \"isnotempty\", \"isnullorempty\", \"isnotnullorempty\"];\n\n    function isNonValueFilter(filter) {\n        var operator = typeof filter === \"string\" ? filter : filter.operator;\n        return $.inArray(operator, nonValueOperators) > -1;\n    }\n\n    function findFilterForField(filter, field) {\n        var filters = [];\n        if ($.isPlainObject(filter)) {\n            if (filter.hasOwnProperty(\"filters\")) {\n                filters = filter.filters;\n            } else if (filter.field == field) {\n                return filter;\n            }\n        }\n        if ((Array.isArray(filter))) {\n           filters = filter;\n        }\n\n        for (var i = 0; i < filters.length; i++) {\n          var result = findFilterForField(filters[i], field);\n          if (result) {\n             return result;\n          }\n        }\n    }\n\n    function removeFiltersForField(expression, field) {\n        if (expression.filters) {\n            expression.filters = $.grep(expression.filters, function(filter) {\n                removeFiltersForField(filter, field);\n                if (filter.filters) {\n                    return filter.filters.length;\n                } else {\n                    return filter.field != field;\n                }\n            });\n        }\n    }\n\n    function removeDuplicates(dataSelector, dataTextField) {\n        var getter = kendo.getter(dataTextField, true);\n\n        return function(e) {\n            var items = dataSelector(e),\n                result = [],\n                index = 0,\n                seen = {};\n\n            while (index < items.length) {\n                var item = items[index++],\n                    text = getter(item);\n\n                if (!seen.hasOwnProperty(text)) {\n                    result.push(item);\n                    seen[text] = true;\n                }\n            }\n\n            return result;\n        };\n    }\n\n    var FilterCell = Widget.extend( {\n        init: function(element, options) {\n            element = $(element).addClass(\"k-filtercell\");\n            var wrapper = this.wrapper = $(\"<span/>\").appendTo(element);\n            var that = this,\n                dataSource,\n                viewModel,\n                passedOptions = options,\n                first,\n                type,\n                operators = that.operators = options.operators || {},\n                input = that.input = $(\"<input/>\")\n                    .attr(kendo.attr(\"bind\"), \"value: value\")\n                    .appendTo(wrapper);\n\n            var suggestDataSource = options ? options.suggestDataSource : null;\n\n            if (suggestDataSource) {\n                // avoid deep cloning the suggest data source\n                options = $.extend({}, options, { suggestDataSource: {} });\n            }\n\n            Widget.fn.init.call(that, element[0], options);\n\n            if (suggestDataSource) {\n                that.options.suggestDataSource = suggestDataSource;\n            }\n\n            options = that.options;\n\n            dataSource = that.dataSource = options.dataSource;\n\n            //gets the type from the dataSource or sets default to string\n            that.model = dataSource.reader.model;\n            type = options.type = STRING;\n            var fields = kendo.getter(\"reader.model.fields\", true)(dataSource) || {};\n            var target = fields[options.field];\n            if (target && target.type) {\n                type = options.type = target.type;\n            }\n            if (options.values) {\n                options.type = type = ENUM;\n            }\n\n            operators = operators[type] || options.operators[type];\n\n            if (!passedOptions.operator) {\n                for (first in operators) { // get the first operator\n                    options.operator = first;\n                    break;\n                }\n            }\n\n            that._parse = function(value) {\n\n                return value != null ? (value + \"\") : value;\n            };\n\n            if (that.model && that.model.fields) {\n                var field = that.model.fields[options.field];\n\n                if (field) {\n                    if (field.parse) {\n                        that._parse = field.parse.bind(field);\n                    }\n                }\n            }\n\n            that.defaultOperator = options.operator;\n\n            that.viewModel = viewModel = kendo.observable({\n                operator: options.operator,\n                value: null,\n                operatorVisible: function() {\n                    var val = this.get(\"value\");\n                    return (val !== null && val !== undefined && val != \"undefined\") || (isNonValueFilter(this.get(\"operator\")) && that.dataSource.filter() && !that._clearInProgress);\n                }\n            });\n            that._prevOperator = options.operator;\n            viewModel.bind(CHANGE, that.updateDsFilter.bind(that));\n\n            if (type == STRING) {\n                that.initSuggestDataSource(options);\n            }\n\n            if (options.inputWidth !== null) {\n                input.addClass('k-sized-input');\n                input.width(options.inputWidth);\n            }\n\n            input.attr(\"aria-label\", that._getColumnTitle());\n            input.attr(\"title\", that._getColumnTitle());\n\n            that._setInputType(options, type);\n\n            if (type != BOOL && options.showOperators !== false) {\n                that._createOperatorDropDown(operators);\n            } else {\n                $('<div unselectable=\"on\" />')\n                    .css(\"display\", \"none\")\n                    .text(\"eq\")\n                    .appendTo(wrapper);\n\n                wrapper.addClass(\"k-operator-hidden\");\n            }\n\n            that._createClearIcon();\n\n            kendo.bind(this.wrapper, viewModel);\n\n            if (type == STRING) {\n                if (!options.template) {\n                    that.setAutoCompleteSource();\n                }\n            }\n\n            if (type == ENUM) {\n                that.setComboBoxSource(that.options.values);\n            }\n\n            that._refreshUI();\n\n            that._refreshHandler = that._refreshUI.bind(that);\n\n            that.dataSource.bind(CHANGE, that._refreshHandler);\n\n        },\n\n        _setInputType: function(options, type) {\n            var that = this,\n                input = that.input;\n\n            if (typeof (options.template) == \"function\") {\n                options.template.call(that.viewModel, {\n                    element: that.input,\n                    dataSource: that.suggestDataSource\n                });\n\n                that._angularItems(\"compile\");\n\n            } else if (type == STRING) {\n                input.attr(kendo.attr(\"role\"), \"autocomplete\")\n                        .attr(kendo.attr(\"text-field\"), options.dataTextField || options.field)\n                        .attr(kendo.attr(\"filter\"), options.suggestionOperator)\n                        .attr(kendo.attr(\"delay\"), options.delay)\n                        .attr(kendo.attr(\"min-length\"), options.minLength)\n                        .attr(kendo.attr(\"value-primitive\"), true);\n            } else if (type == \"date\") {\n                input.attr(kendo.attr(\"role\"), \"datepicker\")\n                    .attr(\"id\", kendo.guid());\n            } else if (type == BOOL) {\n                input.remove();\n                var radioInput = $(\"<input type='radio'/>\");\n                var wrapper = that.wrapper;\n                var inputName = kendo.guid();\n\n                var labelTrue = $(\"<label/>\").text(options.messages.isTrue).append(radioInput);\n                radioInput.attr(kendo.attr(\"bind\"), \"checked:value\")\n                    .attr(\"name\", inputName)\n                    .val(\"true\");\n\n                var labelFalse = labelTrue.clone().text(options.messages.isFalse);\n                radioInput.clone().val(\"false\").appendTo(labelFalse);\n                wrapper.append([labelTrue, labelFalse]);\n\n            } else if (type == \"number\") {\n                input.attr(kendo.attr(\"role\"), \"numerictextbox\")\n                        .attr(\"title\", that._getColumnTitle());\n            } else if (type == ENUM) {\n                input.attr(kendo.attr(\"role\"), \"combobox\")\n                        .attr(kendo.attr(\"text-field\"), \"text\")\n                        .attr(kendo.attr(\"suggest\"), true)\n                        .attr(kendo.attr(\"filter\"), \"contains\")\n                        .attr(kendo.attr(\"value-field\"), \"value\")\n                        .attr(kendo.attr(\"value-primitive\"), true);\n            }\n        },\n\n        _getColumnTitle: function() {\n            var column = this.options.column;\n            return column ? column.title || column.field : \"\";\n        },\n\n        _createOperatorDropDown: function(operators) {\n            var items = [],\n                viewModel = this.viewModel;\n            for (var prop in operators) {\n                items.push({\n                    text: operators[prop],\n                    value: prop\n                });\n            }\n            var dropdown = $('<input class=\"k-dropdown-operator\" ' + kendo.attr(\"bind\") + '=\"value: operator\"/>').appendTo(this.wrapper);\n            dropdown.attr(\"aria-label\", this._getColumnTitle());\n\n            this.operatorDropDown = dropdown.kendoDropDownList({\n                dataSource: items,\n                dataTextField: \"text\",\n                dataValueField: \"value\",\n                open: function() {\n                    //TODO calc this\n                    this.popup.element.width(150);\n                },\n                valuePrimitive: true\n            }).data(\"kendoDropDownList\");\n\n            viewModel.bind(\"change\", function() {\n                var ariaLabel = operators[viewModel.operator];\n                dropdown.attr(\"aria-label\", ariaLabel);\n            });\n\n            this.operatorDropDown.wrapper\n                .attr(\"aria-label\", this._getColumnTitle())\n                .find(\".k-i-arrow-s\")\n                .removeClass(\"k-i-arrow-s\")\n                .addClass(\"k-i-filter\");\n        },\n\n        initSuggestDataSource: function(options) {\n            var suggestDataSource = options.suggestDataSource;\n\n            if (!(suggestDataSource instanceof DataSource)) {\n                if (!options.customDataSource && suggestDataSource) {\n                    suggestDataSource.group = undefined;\n                    suggestDataSource.filter = undefined;\n                }\n                suggestDataSource =\n                    this.suggestDataSource =\n                        DataSource.create(suggestDataSource);\n\n\n            }\n\n            if (!options.customDataSource) {\n                suggestDataSource._pageSize = undefined;\n                suggestDataSource.reader.data = removeDuplicates(suggestDataSource.reader.data, this.options.field);\n            }\n\n            this.suggestDataSource = suggestDataSource;\n        },\n\n        setAutoCompleteSource: function() {\n            var autoComplete = this.input.data(\"kendoAutoComplete\");\n            if (autoComplete) {\n                autoComplete.setDataSource(this.suggestDataSource);\n            }\n        },\n\n        setComboBoxSource: function(values) {\n            var dataSource = DataSource.create({\n                data: values\n            });\n            var comboBox = this.input.data(\"kendoComboBox\");\n            if (comboBox && !this.options.template) {\n                comboBox.setDataSource(dataSource);\n            }\n        },\n\n        _refreshUI: function() {\n            var that = this,\n                filter = findFilterForField(that.dataSource.filter(), this.options.field) || {},\n                viewModel = that.viewModel;\n\n            that.manuallyUpdatingVM = true;\n            filter = $.extend(true, {}, filter);\n            //MVVM check binding does not update the UI when changing the value to null/undefined\n            if (that.options.type == BOOL) {\n                if (viewModel.value !== filter.value) {\n                    that.wrapper.find(\":radio\").prop(\"checked\", false);\n                }\n            }\n\n            if (filter.operator) {\n                viewModel.set(\"operator\", filter.operator);\n            }\n            viewModel.set(\"value\", filter.value);\n            if ($.isEmptyObject(filter)) {\n                viewModel.trigger(CHANGE, { field: \"operatorVisible\" });\n            }\n            that.manuallyUpdatingVM = false;\n        },\n\n        _applyFilter: function(filter) {\n            if (filter.filters.length) {\n                this.dataSource.filter(filter);\n            } else {\n                this.dataSource.filter({});\n            }\n        },\n\n        updateDsFilter: function(e) {\n            var that = this,\n                model = that.viewModel,\n                filter;\n\n            if (e.field == \"operator\" && model.value === undefined && !isNonValueFilter(model) && isNonValueFilter(that._prevOperator)) {\n                filter = that.dataSource.filter() || { filters: [], logic: \"and\" };\n                removeFiltersForField(filter, that.options.field);\n                that._prevOperator = model.operator;\n                that._applyFilter(filter);\n                return;\n            }\n\n            if (that.manuallyUpdatingVM || (e.field == \"operator\" && model.value === undefined && !isNonValueFilter(model)) ||\n                (e.field == \"operator\" && that._clearInProgress && model.value !== null)) {\n                return;\n            }\n\n            var currentFilter = $.extend({}, that.viewModel.toJSON(), { field: that.options.field });\n            that._prevOperator = currentFilter.operator;\n\n            var expression = {\n                logic: \"and\",\n                filters: []\n            };\n\n            var prevented = false;\n\n            if ((currentFilter.value !== undefined && currentFilter.value !== null) || (isNonValueFilter(currentFilter) && !this._clearInProgress)) {\n                expression.filters.push(currentFilter);\n\n                prevented = that.trigger(CHANGE, { filter: expression, field: that.options.field });\n            }\n\n            if (that._clearInProgress || currentFilter.value === null) {\n                prevented = that.trigger(CHANGE, { filter: null, field: that.options.field });\n            }\n\n            if (prevented) {\n                return;\n            }\n\n            var mergeResult = that._merge(expression);\n            that._applyFilter(mergeResult);\n        },\n\n        _merge: function(expression) {\n            var that = this,\n                logic = expression.logic || \"and\",\n                filters = expression.filters,\n                filter,\n                result = that.dataSource.filter() || { filters: [], logic: \"and\" },\n                idx,\n                length;\n\n            removeFiltersForField(result, that.options.field);\n\n            for (idx = 0, length = filters.length; idx < length; idx++) {\n                filter = filters[idx];\n                filter.value = that._parse(filter.value);\n            }\n\n            filters = $.grep(filters, function(filter) {\n                return (filter.value !== \"\" && filter.value !== null) || isNonValueFilter(filter);\n            });\n\n            if (filters.length) {\n                if (result.filters.length) {\n                    expression.filters = filters;\n\n                    if (result.logic !== \"and\") {\n                        result.filters = [ { logic: result.logic, filters: result.filters }];\n                        result.logic = \"and\";\n                    }\n\n                    if (filters.length > 1) {\n                        result.filters.push(expression);\n                    } else {\n                        result.filters.push(filters[0]);\n                    }\n                } else {\n                    result.filters = filters;\n                    result.logic = logic;\n                }\n            }\n\n            return result;\n        },\n\n        _createClearIcon: function() {\n            var that = this;\n\n            $(\"<button type='button' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-icon-button' title = '\" + that.options.messages.clear + \"'/>\")\n                .attr(\"aria-label\", that.options.messages.clear)\n                .attr(kendo.attr(\"bind\"), \"visible:operatorVisible\")\n                .html(\"<span class='k-button-icon k-icon k-i-filter-clear'></span>\")\n                .on(\"click\", that.clearFilter.bind(that))\n                .appendTo(that.wrapper);\n        },\n\n        clearFilter: function() {\n            this._clearInProgress = true;\n\n            if (isNonValueFilter(this.viewModel.operator)) {\n                this.viewModel.set(\"operator\", this.defaultOperator);\n            }\n\n            this.viewModel.set(\"value\", null);\n            this._clearInProgress = false;\n        },\n\n        _angularItems: function(action) {\n            var elements = this.wrapper.closest(\"td\").get();\n            var column = this.options.column;\n\n            this.angular(action, function() {\n                return {\n                    elements: elements,\n                    data: [{ column: column }]\n                };\n            });\n        },\n\n        destroy: function() {\n            var that = this;\n\n            that.filterModel = null;\n            that.operatorDropDown = null;\n\n            that._angularItems(\"cleanup\");\n\n            if (that._refreshHandler) {\n                that.dataSource.bind(CHANGE, that._refreshHandler);\n                that._refreshHandler = null;\n            }\n\n            kendo.unbind(that.element);\n\n            Widget.fn.destroy.call(that);\n\n            kendo.destroy(that.element);\n        },\n\n        events: [\n            CHANGE\n        ],\n\n        options: {\n            name: \"FilterCell\",\n            delay: 200,\n            minLength: 1,\n            inputWidth: null,\n            values: undefined,\n            customDataSource: false,\n            field: \"\",\n            dataTextField: \"\",\n            type: \"string\",\n            suggestDataSource: null,\n            suggestionOperator: \"startswith\",\n            operator: \"eq\",\n            showOperators: true,\n            template: null,\n            messages: {\n                isTrue: \"is true\",\n                isFalse: \"is false\",\n                filter: \"Filter\",\n                clear: \"Clear\",\n                operator: \"Operator\"\n            },\n            operators: {\n                string: {\n                    eq: EQ,\n                    neq: NEQ,\n                    startswith: \"Starts with\",\n                    contains: \"Contains\",\n                    doesnotcontain: \"Does not contain\",\n                    endswith: \"Ends with\",\n                    isnull: \"Is null\",\n                    isnotnull: \"Is not null\",\n                    isempty: \"Is empty\",\n                    isnotempty: \"Is not empty\",\n                    isnullorempty: \"Has no value\",\n                    isnotnullorempty: \"Has value\"\n                },\n                number: {\n                    eq: EQ,\n                    neq: NEQ,\n                    gte: \"Is greater than or equal to\",\n                    gt: \"Is greater than\",\n                    lte: \"Is less than or equal to\",\n                    lt: \"Is less than\",\n                    isnull: \"Is null\",\n                    isnotnull: \"Is not null\"\n                },\n                date: {\n                    eq: EQ,\n                    neq: NEQ,\n                    gte: \"Is after or equal to\",\n                    gt: \"Is after\",\n                    lte: \"Is before or equal to\",\n                    lt: \"Is before\",\n                    isnull: \"Is null\",\n                    isnotnull: \"Is not null\"\n                },\n                enums: {\n                    eq: EQ,\n                    neq: NEQ,\n                    isnull: \"Is null\",\n                    isnotnull: \"Is not null\"\n                }\n            }\n        }\n    });\n\n    ui.plugin(FilterCell);\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","depends","advanced","$","window","kendo","jQuery","undefined","ui","DataSource","data","Widget","CHANGE","BOOL","ENUM","STRING","EQ","NEQ","nonValueOperators","isNonValueFilter","filter","operator","inArray","findFilterForField","field","filters","isPlainObject","hasOwnProperty","Array","isArray","i","length","result","removeFiltersForField","expression","grep","removeDuplicates","dataSelector","dataTextField","getter","e","items","index","seen","item","text","push","FilterCell","extend","init","element","options","addClass","wrapper","this","appendTo","that","dataSource","viewModel","passedOptions","first","type","operators","input","attr","suggestDataSource","fn","call","model","reader","fields","target","values","_parse","value","parse","bind","defaultOperator","observable","operatorVisible","val","get","_clearInProgress","_prevOperator","updateDsFilter","initSuggestDataSource","inputWidth","width","_getColumnTitle","_setInputType","showOperators","_createOperatorDropDown","css","_createClearIcon","template","setAutoCompleteSource","setComboBoxSource","_refreshUI","_refreshHandler","_angularItems","suggestionOperator","delay","minLength","guid","remove","radioInput","inputName","labelTrue","messages","isTrue","append","labelFalse","clone","isFalse","column","title","prop","dropdown","operatorDropDown","kendoDropDownList","dataValueField","open","popup","valuePrimitive","ariaLabel","find","removeClass","customDataSource","group","create","_pageSize","autoComplete","setDataSource","comboBox","manuallyUpdatingVM","set","isEmptyObject","trigger","_applyFilter","logic","currentFilter","toJSON","prevented","mergeResult","_merge","idx","clear","html","on","clearFilter","action","elements","closest","angular","destroy","filterModel","unbind","events","string","eq","neq","startswith","contains","doesnotcontain","endswith","isnull","isnotnull","isempty","isnotempty","isnullorempty","isnotnullorempty","number","gte","gt","lte","lt","date","enums","plugin","amd","a1","a2","a3"],"mappings":"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"}