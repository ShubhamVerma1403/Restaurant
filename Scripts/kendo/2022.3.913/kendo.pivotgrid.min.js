/**
 * Kendo UI v2022.3.913 (http://www.telerik.com/kendo-ui)
 * Copyright 2022 Progress Software Corporation and/or one of its subsidiaries or affiliates. All rights reserved.
 *
 * Kendo UI commercial licenses may be obtained at
 * http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
 * If you do not own a commercial license, this file shall be governed by the trial license terms.
 */
!function(define){define("kendo.pivotgrid.min",["kendo.pivot.common.min","kendo.dom.min","kendo.data.min"],function(){var t={id:"pivotgrid",name:"PivotGrid",category:"web",description:"The PivotGrid widget is a data summarization tool.",depends:["dom","data","data.xml","sortable","pivot.common"],features:[{id:"pivotgrid-configurator",name:"Configurator",description:"The PivotConfigurator widget allows the user to select data slices displayed in PivotGrid",depends:["pivot.configurator"]},{id:"pivotgrid-filtering",name:"Filtering",description:"Support for filtering",depends:["pivot.fieldmenu"]},{id:"pivotgrid-excel-export",name:"Excel export",description:"Export pivot grid data as Excel spreadsheet",depends:["ooxml"]},{id:"pivotgrid-pdf-export",name:"PDF export",description:"Export pivot grid data as PDF",depends:["pdf","drawing"]},{id:"mobile-scroller",name:"Mobile scroller",description:"Support for kinetic scrolling in mobile device",depends:["mobile.scroller"]}]},x=window.kendo.jQuery,H=void 0,k=window.kendo,l=k.ui,r=k.Class,u=k.data.Comparer,a=l.Widget,c=k.data.DataSource,n=k._outerWidth,d=k._outerHeight,e=window.kendo.pivotgrid.common,m=e.fetchDiscover,p=k.data.Query.normalizeFilter,f=k.data.Query.normalizeSort,v={}.toString,s=function(e){return e},g=x.map,i=x.extend,_=k.isFunction,w=e.fetchData,b=e.createLocalDataState,S=e.createDataTree,N=e.sumAggregate,E=e.averageAggregate,C=e.minAggregate,T=e.maxAggregate,M=e.createDataState,A=e.toColumns,I=e.toRows,D=e.toTree,R=e.toData,L=e.headersReducer,P="resize",O="read",h="change",F="error",B="requestStart",U="progress",q="requestEnd",W="Measures",z="stateReset",G="auto",j="<div></div>",o=".kendoPivotGrid",V="__row_total__",Y="dataBinding",K="dataBound",Q="expandMember",$='<th data-key="#:key#" class="#:headerClass#" #if (colspan) {#colspan="#:colspan#"#}# #if (rowspan) {#rowspan="#:rowspan#"#}#>'+'#if (expandable) {# <span class="k-icon k-i-arrow-chevron-#:iconClass# k-color-inherit" role="presentation"></span>#}#'+"</th>",J="collapseMember",X="k-i-collapse",Z="k-i-expand",ee="<span>#: data.member.caption || data.member.name #</span>",te='<span class="k-icon k-i-kpi-status-#=data.dataItem.value > 0 ? "open" : data.dataItem.value < 0 ? "deny" : "hold"#" title="#:data.dataItem.value#"></span>',re='<span class="k-icon k-i-kpi-trend-#=data.dataItem.value > 0 ? "increase" : data.dataItem.value < 0 ? "decrease" : "equal"#" title="#:data.dataItem.value#"></span>',ae='#= data.dataItem ? kendo.htmlEncode(data.dataItem.fmtValue || data.dataItem.value) || "&nbsp;" : "&nbsp;" #',ne='<table class="k-pivot-layout">'+"<tr>"+"<td>"+'<div class="k-pivot-rowheaders"></div>'+"</td>"+"<td>"+'<div class="k-pivot-table"></div>'+"</td>"+"</tr>"+"</table>",se="rows",ie="columns";function oe(e){var t=typeof e==="string"?[{name:e}]:e;var r=v.call(t)==="[object Array]"?t:t!==H?[t]:[];return g(r,function(e){if(typeof e==="string")return{name:e};return x.extend(true,e,{name:e.name,type:e.type})})}function le(e){var t=typeof e==="string"?[{name:[e],expand:false}]:e;var r=v.call(t)==="[object Array]"?t:t!==H?[t]:[];return g(r,function(e){if(typeof e==="string")return{name:[e],expand:false};return{name:v.call(e.name)==="[object Array]"?e.name.slice():[e.name],expand:e.expand}})}function ue(e){if(e.indexOf(" ")!==-1)e='["'+e+'"]';return e}function ce(e,t,r,a){var n,s;var i;var o;if(!r)r=t;if(!a)a=0;o=r.members[a];if(!o||o.measure)return;i=o.children;s=i.length;if(r===t)e[k.stringify([o.name])]=!!s;else if(s)e[k.stringify(Ct(r,a))]=true;if(s)for(n=0;n<s;n++)ce(e,t,i[n],a);ce(e,t,r,a+1)}function he(e){var t={};if(e.length)ce(t,e[0]);var r=[];for(var a in t)r.push({name:JSON.parse(a),expand:t[a]});return r}function de(e,t){var r=t.tuples||[];var a=r[0];if(a&&e.length<a.members.length){var n=a.members;for(var s=0;s<n.length;s++){if(n[s].measure)continue;var i=false;for(var o=0;o<e.length;o++)if(tt(e[o]).indexOf(n[s].hierarchy)===0){i=true;break}if(!i)e.push({name:[n[s].name],expand:false})}}}function me(e){var t=[];var r=e.members;for(var a=0;a<r.length;a++){if(r[a].measure)continue;t.push({name:[r[a].name],expand:r[a].children.length>0})}return t}function pe(e,t,r){e=e||{};de(t,e);if(r.length>1)t.push({name:W,measure:true,children:le(r)});var a={members:t};if(e.tuples){var n=Be(e.tuples,a);if(n.tuple)t=me(n.tuple)}return t}function fe(r){var a=k.getter(r.field,true);return function(e,t){return r.aggregate(a(e.dataItem),t,e)}}function ve(e){return typeof e==="number"&&!isNaN(e)}function ge(e){return e&&e.getTime}function _e(){var e=0;var t;if(document&&document.createElement){t=document.createElement("div");t.style.cssText="overflow:scroll;overflow-x:hidden;zoom:1;clear:both;display:block";t.innerHTML="&nbsp;";document.body.appendChild(t);e=t.offsetWidth-t.scrollWidth;document.body.removeChild(t)}return e}function xe(e){var t=[];for(var r=0;r<e.length;r++)t.push({dir:e[r].dir,field:e[r].field.split(".").pop()});return t}function we(e,t,r){var a=function(e){return k.format(this.format,e)};var n={Sum:N,Average:E,Min:C,Max:T};var s=function(e){return e[this.field]};var i={value:s.bind({field:e}),aggregate:n[t],caption:t,uniqueName:t,type:2,name:[t]};if(r)i.aggregate.format=a.bind({format:r});return i}var be={sum:function(e,t){var r=t.accumulator;if(!ve(r))r=e;else if(ve(e))r+=e;return r},count:function(e,t){return(t.accumulator||0)+1},average:{aggregate:function(e,t){var r=t.accumulator;if(t.count===H)t.count=0;if(!ve(r))r=e;else if(ve(e))r+=e;if(ve(e))t.count++;return r},result:function(e){var t=e.accumulator;if(ve(t))t=t/e.count;return t}},max:function(e,t){var r=t.accumulator;if(!ve(r)&&!ge(r))r=e;if(r<e&&(ve(e)||ge(e)))r=e;return r},min:function(e,t){var r=t.accumulator;if(!ve(r)&&!ge(r))r=e;if(r>e&&(ve(e)||ge(e)))r=e;return r}},Se=r.extend({init:function(e){this.options=i({},this.options,e);this.dimensions=this._normalizeDescriptors("field",this.options.dimensions);this.measures=this._normalizeDescriptors("name",this.options.measures)},_normalizeDescriptors:function(e,t){t=t||{};var r={};var a;if(v.call(t)==="[object Array]"){for(var n=0,s=t.length;n<s;n++){a=t[n];if(typeof a==="string")r[a]={};else if(a[e])r[a[e]]=a}t=r}return t},_rootTuples:function(e,t){var r=t.length||1;var c=this.dimensions||[];var a,n,s;var i=0;var o;var l=e.length;var u=[];var h=[];if(l||t.length){for(i=0;i<r;i++){a={members:[]};for(o=0;o<l;o++){n=e[o];s=n.split("&");a.members[a.members.length]={children:[],caption:(c[n]||{}).caption||"All",name:n,levelName:n,levelNum:"0",hasChildren:true,parentName:s.length>1?s[0]:H,hierarchy:n}}if(r>1)a.members[a.members.length]={children:[],caption:t[i].caption,name:t[i].descriptor.name,levelName:"MEASURES",levelNum:"0",hasChildren:false,parentName:H,hierarchy:"MEASURES"};u[u.length]=a}h.push(V)}return{keys:h,tuples:u}},_sortMap:function(e,t){var r=[];var a=[];var n=[];var s;var i;for(i in e)if(!e[i].directParentName)a.push(x.extend({},{name:i,parentName:e[i].parentName}));if(!a.length)for(i in e)a.push(x.extend({},{name:i,parentName:e[i].parentName}));Te(a,e);for(var o=0;o<t.length;o++)Ce(t[o].field.split(".").pop(),a,u.create({field:"name",dir:t[o].dir}));n=ye(a);for(var l=0;l<n.length;l++){s=e[n[l].name];s.index=l;r[l]=s}return r},_expandedTuples:function(e,c,t,r){var h=t.length||1;var d=this.dimensions||[];var a;var n;var m;var s;var i;var p;var f=[];var v=[];var o;var g;var _;var l;var u;if(r&&r.length&&!x.isEmptyObject(e))e=this._sortMap(e,r);for(m in e){s=e[m];o=this._findExpandedMember(c,s.uniquePath);i=f[o.index]||[];p=v[o.index]||[];g=o.member.names;for(a=0;a<h;a++){n={members:[]};for(u=0;u<g.length;u++)if(u===o.member.expandedIdx){n.members[n.members.length]={children:[],caption:s.value,name:s.name,hasChildren:false,levelNum:1,levelName:s.parentName+s.name,parentName:s.parentName,hierarchy:s.parentName+s.name};if(a===0)p.push(Ct(n,u).join(""))}else{l=g[u];_=l.split("&");n.members[n.members.length]={children:[],caption:(d[l]||{}).caption||"All",name:l,levelName:l,levelNum:"0",hasChildren:true,parentName:_.length>1?_[0]:H,hierarchy:l}}if(h>1)n.members[n.members.length]={children:[],caption:t[a].caption,name:t[a].descriptor.name,levelName:"MEASURES",levelNum:"0",hasChildren:true,parentName:H,hierarchy:"MEASURES"};i[i.length]=n}f[o.index]=i;v[o.index]=p}return{keys:v,tuples:f}},_findExpandedMember:function(e,t){for(var r=0;r<e.length;r++)if(e[r].uniquePath===t)return{member:e[r],index:r}},_asTuples:function(e,t,r,a){r=r||[];var n=this._rootTuples(t.root,r);var s=this._expandedTuples(e,t.expanded,r,a);return{keys:[].concat.apply(n.keys,s.keys),tuples:[].concat.apply(n.tuples,s.tuples)}},_measuresInfo:function(e,t){var r=0;var a=e&&e.length;var n=[];var s={};var i={};var o=this.measures||{};var l;var u;for(;r<a;r++){u=e[r].descriptor.name;l=o[u]||{};n.push(u);if(l.result)s[u]=l.result;if(l.format)i[u]=l.format}return{names:n,formats:i,resultFuncs:s,rowAxis:t}},_toDataArray:function(c,e,h,d){var m=[];var t;var r,a,n,s,i;var o,l,p;var f=1;var v=[];var u;var g=h.length||1;var _=d.length||1;if(e.rowAxis){v=e.names;f=v.length}else u=e.names;for(a=0;a<g;a++){o=c[h[a]||V];for(i=0;i<f;i++){if(e.rowAxis)u=[v[i]];for(n=0;n<_;n++){p=d[n]||V;l=o.items[p];if(p===V)t=o.aggregates;else t=l?l.aggregates:{};for(s=0;s<u.length;s++){r=u[s];this._addData(m,t[r],e.formats[r],e.resultFuncs[r])}}}}return m},_addData:function(e,t,r,a){var n="";var s;if(t){t=a?a(t):t.accumulator;n=r?k.format(r,t):t}s=e.length;e[s]={ordinal:s,value:t||"",fmtValue:n}},_matchDescriptors:function(e,t,r){var a;var n;var s;var i=t.names;var o=t.expandedIdx;var l;while(o>0){a=i[--o].split("&");if(a.length>1){n=a[0];s=a[1];l=r[n](e);l=l!==H&&l!==null?l.toString():l;if(l!=s)return false}}return true},_calculateAggregate:function(e,t,r){var a={};var n;var s;for(var i=0;i<e.length;i++){s=e[i].descriptor.name;n=r.aggregates[s]||{};n.accumulator=e[i].aggregator(t,n);a[s]=n}return a},_processColumns:function(c,e,h,t,d,m,p,f){var r;var a;var n;var v;var s,i,o,l;var g=d.dataItem;var u=0;for(;u<e.length;u++){a=e[u];if(!this._matchDescriptors(g,a,h))continue;l=a.names.slice(0,a.expandedIdx).join("");i=a.names[a.expandedIdx];r=h[i](g);r=r!==H&&r!==null?r.toString():r;o=i;i=i+"&"+r;s=l+i;n=t[s]||{index:p.columnIndex,parentName:o,name:i,directParentName:l.indexOf("&")!==-1?l:"",uniquePath:l+o,childrenMap:{},value:r};if(l&&t[l]&&!t[l].childrenMap[l+o+"&"+r])t[l].childrenMap[l+o+"&"+r]=true;v=m.items[s]||{aggregates:{}};m.items[s]={index:n.index,aggregates:this._calculateAggregate(c,d,v)};if(f){if(!t[s])p.columnIndex++;t[s]=n}}},_measureAggregators:function(e){var t=e.measures||[];var r=this.measures||{};var a=[];var n,s,i,o;var l,u;if(t.length)for(i=0,o=t.length;i<o;i++){n=t[i];s=r[n.name];l=null;if(s){u=s.aggregate;if(typeof u==="string"){l=be[u.toLowerCase()];if(!l)throw new Error("There is no such aggregate function");s.aggregate=l.aggregate||l;s.result=l.result}a.push({descriptor:n,caption:s.caption,result:s.result,aggregator:fe(s)})}}else a.push({descriptor:{name:"default"},caption:"default",aggregator:function(){return 1}});return a},_buildGetters:function(e){var t={};var r;var a;for(var n=0;n<e.length;n++){a=e[n];r=a.split("&");if(r.length>1)t[r[0]]=k.getter(r[0],true);else t[a]=k.getter(ue(a),true)}return t},_parseDescriptors:function(e){var t=nt(e);var r=rt(t.root);var a=t.expanded;var n=[];for(var s=0;s<a.length;s++)n.push(at(a[s].name,r));return{root:r,expanded:n}},_filter:function(e,t){if(!t)return e;var r;var a=0;var n=t.filters;for(;a<n.length;a++){r=n[a];if(r.operator==="in")n[a]=this._normalizeFilter(r)}return new k.data.Query(e).filter(t).data},_normalizeFilter:function(e){var t=e.value.split(",");var r=[];if(!t.length)return t;for(var a=0;a<t.length;a++)r.push({field:e.field,operator:"eq",value:t[a]});return{logic:"or",filters:r}},process:function(e,t){e=e||[];t=t||{};e=this._filter(e,t.filter);var c=t.measures||[];var r=t.measuresAxis==="rows";var a=t.columns||[];var n=t.rows||[];if(!a.length&&n.length&&(!c.length||c.length&&r)){a=n;n=[];r=false}if(!a.length&&!n.length)r=false;if(!a.length&&c.length)a=le(t.measures);a=this._parseDescriptors(a);n=this._parseDescriptors(n);var s={};var i={};var h={};var o;var d={columnIndex:0};var l=this._measureAggregators(t);var m=this._buildGetters(a.root);var p=this._buildGetters(n.root);var f=false;var v=a.expanded;var g=n.expanded;var _;var x;var w=g.length!==0;var b,S,u,N;var E,k,y,C;var T,M;var A=e.length;var I=0;if(a.root.length||n.root.length){f=true;for(I=0;I<A;I++){_=e[I];x={dataItem:_,index:I};N=s[V]||{items:{},aggregates:{}};this._processColumns(l,v,m,i,x,N,d,!w);N.aggregates=this._calculateAggregate(l,x,N);s[V]=N;for(b=0;b<g.length;b++){S=g[b];if(!this._matchDescriptors(_,S,p)){this._processColumns(l,v,m,i,x,{items:{},aggregates:{}},d,true);continue}k=S.names.slice(0,S.expandedIdx).join("");u=S.names[S.expandedIdx];y=u;o=p[u](_);o=o!==H?o.toString():o;u=u+"&"+o;E=k+u;h[E]={uniquePath:k+y,parentName:y,name:u,value:o};C=s[E]||{items:{},aggregates:{}};this._processColumns(l,v,m,i,x,C,d,true);C.aggregates=this._calculateAggregate(l,x,C);s[E]=C}}}if(f&&A){if(l.length>1&&(!t.columns||!t.columns.length))a={root:[],expanded:[]};T=this._asTuples(i,a,r?[]:l,t.sort?t.sort:[]);M=this._asTuples(h,n,r?l:[],t.sort?t.sort:[]);i=T.tuples;h=M.tuples;s=this._toDataArray(s,this._measuresInfo(l,r),M.keys,T.keys)}else s=i=h=[];return{axes:{columns:{tuples:i},rows:{tuples:h}},data:s}}}),Ne=r.extend({init:function(e,t){this.transport=t;this.options=t.options||{};if(!this.transport.discover)if(_(e.discover))this.discover=e.discover},read:function(e){return this.transport.read(e)},update:function(e){return this.transport.update(e)},create:function(e){return this.transport.create(e)},destroy:function(e){return this.transport.destroy(e)},discover:function(e){if(this.transport.discover)return this.transport.discover(e);e.success({})},catalog:function(e){var t=this.options||{};if(e===H)return(t.connection||{}).catalog;var r=t.connection||{};r.catalog=e;this.options.connection=r;x.extend(this.transport.options,{connection:r})},cube:function(e){var t=this.options||{};if(e===H)return(t.connection||{}).cube;var r=t.connection||{};r.cube=e;this.options.connection=r;i(true,this.transport.options,{connection:r})}}),Ee=c.extend({init:function(e){var t=((e||{}).schema||{}).cube;var r={axes:s,cubes:s,catalogs:s,measures:s,dimensions:s,hierarchies:s,levels:s,members:s};if(t)this.cubeSchema=x.extend(r,this._cubeSchema(t));c.fn.init.call(this,i(true,{},{},e));var a=this.options.transport||{};if((this.options.type||"xmla").toLowerCase()==="xmla"){this._online=true;this.transport=new mt(a)}this._columns=le(this.options.columns);this._rows=le(this.options.rows);var n=this.cubeSchema?this.cubeSchema.measures():this.options.measures||[];if(v.call(n)==="[object Object]"){this._measuresAxis=n.axis||"columns";n=n.values||[]}this._measures=oe(n)},options:{serverSorting:true,serverPaging:true,serverFiltering:true,serverGrouping:true,serverAggregates:true},axes:function(){return{columns:Le(this.columns()),rows:Le(this.rows())}},catalog:function(e){if(e===H)return this.transport.catalog();this.transport.catalog(e);this._mergeState({});this.read()},cube:function(e){if(e===H)return this.transport.cube();this.transport.cube(e);this._mergeState({});this.read()},measuresAxis:function(){return this._measuresAxis||"columns"},fetch:function(e){var t=this;if(this._data===H||this._data.length===0){var r=function(){if(_(e))e.call(t)};return this._query().done(r)}},_createSettings:function(e){var t=[];var r;var a=this.cubeSchema.dimensionsSettings();var n=function(e){return e[this.key]};var s=function(e){return e};for(var i=0;i<e.length;i++){r=e[i].name[0];t.push({key:r,displayValue:n.bind({key:r}),sortValue:s,caption:(a[r]||{}).caption||r})}return t},_cubeSchema:function(o){return{dimensionsSettings:function(){return o.dimensions},dimensions:function(){var e=[];var t=o.dimensions;for(var r in t)e.push({name:r,caption:t[r].caption||r,uniqueName:r,defaultHierarchy:r,type:1});if(o.measures)e.push({name:W,caption:W,uniqueName:W,type:2});return e},restoreMeasure:function(e,t){for(var r=0;r<e.length;r++)if(!e[r].aggregate){e[r].aggregate=t.aggregate;e[r].value=t.value;e[r].caption=t.caption;e[r].uniqueName=t.uniqueName;e[r].type=2}},measures:function(){var e=[];var t=o.measures;for(var r in t)e.push(we(t[r].field,r,t[r].format));return e},memberType:function(e){var t=k.getter(ue(e),true);var r=this.options.data||this._pristineData||[];if(!r.length)return null;return typeof t(r[0])}.bind(this),members:function(e){var t=this.options.data||this._pristineData||[];var r=[];var a={};var n;var s;var i=0;if(e.indexOf("[(ALL)]")!==-1)return[{caption:o.dimensions[e.split(".")[0]].caption||e,levelUniqueName:e,name:e,childrenCardinality:1,uniqueName:e}];n=k.getter(ue(e),true);for(;i<t.length;i++){s=n(t[i]);if((s||s===0||s===false)&&!a[s]){a[s]=true;r.push({caption:s+"",name:s+"",childrenCardinality:0,uniqueName:s})}}return r}.bind(this)}},read:function(e){var t=this;var r=t.trigger(B,{type:O});var a=t._params(e);var n=x.Deferred();if(!r){t.trigger(U);if(t.options.data){var s=(this.reader.data(this.options.data)||[]).slice(0);if(s&&!this._pristineData)this._pristineData=s;var i=t._createSettings(a.columnAxes);var o=t._createSettings(a.rowAxes);var l=t.measures();var u=S(t.options.data,o,i,l,{dataField:"aggregate",columnsData:"columns"},t.filter()||[]);var c={dataTree:u,columnSettings:i,rowSettings:o,columnAxes:a.columnAxes,rowAxes:a.rowAxes,measures:l.map(function(e){return e}).reverse(),fields:{dataField:"aggregate",columnsData:"columns"},sort:xe(a.sort||[])};t._saveState(b(c));t.trigger(h);n.resolve()}else t.transport.read({data:a,success:function(e){t._saveState(e);t.trigger(q,{response:e,type:O});t.trigger(h);if(t._preventRefresh)t._preventRefresh=false;n.resolve()},error:function(e){t.trigger(F,{error:e})}})}return n.promise()},_params:function(e){var t=this;var r=c.fn._params.call(t,e);r=i({columnAxes:JSON.parse(JSON.stringify(t._columns)),rowAxes:JSON.parse(JSON.stringify(t._rows)),measuresAxis:t.measuresAxis(),measureAxes:t._measures},r);if((this.options.type||"").toLowerCase()==="xmla")r.connection=t.options.transport.connection;if(r.filter){r.filter=p(r.filter);r.filter=(r.filter||{}).filters}if(r.sort)r.sort=f(r.sort);return r},discover:function(e){var t=this,r=t.transport;if(r.discover)return r.discover(e)},schemaMeasures:function(){var e=this;return e.discover({command:"schemaMeasures",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}},function(e){return e})},schemaKPIs:function(){var e=this;return e.discover({command:"schemaKPIs",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}},function(e){return e})},schemaDimensions:function(){var e=this;return e.discover({command:"schemaDimensions",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}},function(e){return e})},schemaHierarchies:function(e){var t=this;return t.discover({command:"schemaHierarchies",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),dimensionUniqueName:e}},function(e){return e})},schemaLevels:function(e){var t=this;return t.discover({command:"schemaLevels",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),hierarchyUniqueName:e}},function(e){return e})},schemaCubes:function(){var e=this;return e.discover({command:"schemaCubes",restrictions:{catalogName:e.transport.catalog()}},function(e){return e})},schemaCatalogs:function(){var e=this;return e.discover({command:"schemaCatalogs"},function(e){return e})},schemaMembers:function(e){var t=this;return t.discover({command:"schemaMembers",restrictions:i({catalogName:t.transport.catalog(),cubeName:t.transport.cube()},e)},function(e){return e})},_saveState:function(e){var t=this;t._columnTuples=e.columns;t._rowTuples=e.rows;t._view=t._data=e.data},columns:function(e){if(e===H)return this._columns;this._columns=le(e);this.read()},rows:function(e){if(e===H)return this._rows;this._rows=le(e);this.read()},measures:function(e){if(e===H)return this._measures;this._measures=oe(e);this.read()},_mergeState:function(e){e=c.fn._mergeState.call(this,e);return e},_query:function(e){var t=this;var r=i({},{sort:t.sort(),measuresAxis:t.measuresAxis(),filter:t.filter()},e);this._mergeState(r);return this.read()}}),ke=c.extend({init:function(e){var t=((e||{}).schema||{}).cube;var r="columns";var a;var n={axes:s,cubes:s,catalogs:s,measures:s,dimensions:s,hierarchies:s,levels:s,members:s};if(t){n=x.extend(n,this._cubeSchema(t));this.cubeBuilder=new Se(t)}c.fn.init.call(this,i(true,{},{schema:n},e));this.transport=new Ne(this.options.transport||{},this.transport);this._columns=le(this.options.columns);this._rows=le(this.options.rows);a=this.options.measures||[];if(v.call(a)==="[object Object]"){r=a.axis||"columns";a=a.values||[]}this._measures=oe(a);this._measuresAxis=r;this._skipNormalize=0;this._axes={}},_cubeSchema:function(h){return{dimensions:function(){var e=[];var t=h.dimensions;for(var r in t)e.push({name:r,caption:t[r].caption||r,uniqueName:r,defaultHierarchy:r,type:1});if(h.measures)e.push({name:W,caption:W,uniqueName:W,type:2});return e},hierarchies:function(){return[]},measures:function(){var e=[];var t=h.measures;for(var r in t)e.push({name:r,caption:r,uniqueName:r,aggregator:r});return e},members:function(c,e){var t=e.levelUniqueName||e.memberUniqueName;var r=this.options.schema.data;var a=_(r)?r:k.getter(r,true);var n=this.options.data&&a(this.options.data)||this._rawData||[];var s=[];var i;var o;var l=0;var u={};if(t)t=t.split(".")[0];if(!e.treeOp){s.push({caption:h.dimensions[t].caption||t,childrenCardinality:"1",dimensionUniqueName:t,hierarchyUniqueName:t,levelUniqueName:t,name:t,uniqueName:t});return s}i=k.getter(ue(t),true);for(;l<n.length;l++){o=i(n[l]);if((o||o===0)&&!u[o]){u[o]=true;s.push({caption:o,childrenCardinality:"0",dimensionUniqueName:t,hierarchyUniqueName:t,levelUniqueName:t,name:o,uniqueName:o})}}return s}.bind(this)}},options:{serverSorting:true,serverPaging:true,serverFiltering:true,serverGrouping:true,serverAggregates:true},catalog:function(e){if(e===H)return this.transport.catalog();this.transport.catalog(e);this._mergeState({});this._axes={};this.data([])},cube:function(e){if(e===H)return this.transport.cube();this.transport.cube(e);this._axes={};this._mergeState({});this.data([])},axes:function(){return this._axes},columns:function(e){if(e===H)return this._columns;this._skipNormalize+=1;this._clearAxesData=true;this._columns=le(e);this.query({columns:e,rows:this.rowsAxisDescriptors(),measures:this.measures(),sort:this.sort(),filter:this.filter()})},rows:function(e){if(e===H)return this._rows;this._skipNormalize+=1;this._clearAxesData=true;this._rows=le(e);this.query({columns:this.columnsAxisDescriptors(),rows:e,measures:this.measures(),sort:this.sort(),filter:this.filter()})},measures:function(e){if(e===H)return this._measures;this._skipNormalize+=1;this._clearAxesData=true;this.query({columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:oe(e),sort:this.sort(),filter:this.filter()})},measuresAxis:function(){return this._measuresAxis||"columns"},_expandPath:function(e,t){var r=t==="columns"?"columns":"rows";var a=t==="columns"?"rows":"columns";var n=le(e);var s=tt(n[n.length-1]);this._lastExpanded=r;n=pe(this.axes()[r],n,this.measures());for(var i=0;i<n.length;i++){var o=tt(n[i]);if(o===s){if(n[i].expand)return;n[i].expand=true}else n[i].expand=false}var l={};l[r]=n;l[a]=this._descriptorsForAxis(a);this._query(l)},_descriptorsForAxis:function(e){var t=this.axes();var r=this[e]()||[];if(t&&t[e]&&t[e].tuples&&t[e].tuples[0])r=he(t[e].tuples||[]);return r},columnsAxisDescriptors:function(){return this._descriptorsForAxis("columns")},rowsAxisDescriptors:function(){return this._descriptorsForAxis("rows")},_process:function(e,t){this._view=e;t=t||{};t.items=t.items||this._view;this.trigger(h,t)},_query:function(e){var t=this;if(!e){this._skipNormalize+=1;this._clearAxesData=true}return t.query(i({},{page:t.page(),pageSize:t.pageSize(),sort:t.sort(),filter:t.filter(),group:t.group(),aggregate:t.aggregate(),columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:this.measures()},e))},query:function(e){var t=this._mergeState(e);if(this._data.length&&this.cubeBuilder){this._params(t);this._updateLocalData(this._pristineData);return x.Deferred().resolve().promise()}return this.read(t)},_mergeState:function(e){e=c.fn._mergeState.call(this,e);if(e!==H){this._measures=oe(e.measures);if(e.columns)e.columns=le(e.columns);else if(!e.columns)this._columns=[];if(e.rows)e.rows=le(e.rows);else if(!e.rows)this._rows=[]}return e},filter:function(e){if(e===H)return this._filter;this._skipNormalize+=1;this._clearAxesData=true;this._query({filter:e,page:1})},expandColumn:function(e){this._expandPath(e,"columns")},expandRow:function(e){this._expandPath(e,"rows")},success:function(e){var t;if(this.cubeBuilder)t=(this.reader.data(e)||[]).slice(0);c.fn.success.call(this,e);if(t)this._pristineData=t},_processResult:function(e,t){if(this.cubeBuilder){var r=this.cubeBuilder.process(e,this._requestData);e=r.data;t=r.axes}var a,c;var n,s,i,o;var l=this.columns();var u=this.rows();var h=t.columns&&t.columns.tuples;if(!l.length&&u.length&&h&&(this._rowMeasures().length||!this.measures().length))t={columns:{},rows:t.columns};if(!l.length&&!u.length&&this.measuresAxis()==="rows"&&h)t={columns:{},rows:t.columns};this._axes={columns:Le(this._axes.columns),rows:Le(this._axes.rows)};t={columns:Le(t.columns),rows:Le(t.rows)};a=this._normalizeTuples(t.columns.tuples,this._axes.columns.tuples,l,this._columnMeasures());c=this._normalizeTuples(t.rows.tuples,this._axes.rows.tuples,u,this._rowMeasures());if(this._skipNormalize>0)this._skipNormalize-=1;if(!this.cubeBuilder)e=this._normalizeData({columnsLength:t.columns.tuples.length,rowsLength:t.rows.tuples.length,columnIndexes:a,rowIndexes:c,data:e});if(this._lastExpanded=="rows"){n=t.columns.tuples;i=this._columnMeasures();s=Ae(t.columns,this._axes.columns,i);if(s){o="columns";t.columns=s;Ie(n,s.tuples,t.rows.tuples.length,i,e);if(!this.cubeBuilder)e=this._normalizeData({columnsLength:Re(t.columns.tuples,i),rowsLength:t.rows.tuples.length,data:e})}}else if(this._lastExpanded=="columns"){n=t.rows.tuples;i=this._rowMeasures();s=Ae(t.rows,this._axes.rows,i);if(s){o="rows";t.rows=s;He(n,s.tuples,t.columns.tuples.length,i,e);if(!this.cubeBuilder)e=this._normalizeData({columnsLength:Re(t.rows.tuples,i),rowsLength:t.columns.tuples.length,data:e})}}this._lastExpanded=null;var d=this._mergeAxes(t,e,o);this._axes=d.axes;return d.data},_readData:function(e){var t=this.reader.axes(e);var r=this.reader.data(e);if(this.cubeBuilder)this._rawData=r;return this._processResult(r,t)},_createTuple:function(c,e,h){var d=c.members;var m=d.length;var t={members:[]};var r,a;var n,s;var i;var o;var l;var u;var p=0;if(e)m-=1;for(;p<m;p++){u=d[p];a=Number(u.levelNum);n=u.name;s=u.parentName;l=u.caption||n;i=u.hasChildren;o=u.hierarchy;r=u.levelName;if(h){l="All";if(a===0)s=u.name;else a-=1;i=true;n=o=r=s}t.members.push({name:n,children:[],caption:l,levelName:r,levelNum:a.toString(),hasChildren:i,hierarchy:o,parentName:!h?s:""})}if(e)t.members.push({name:e.name,children:[]});return t},_hasRoot:function(e,t,r){if(t.length)return Be(t,e).tuple;var a=e.members;var n;var s;var i=true;var o;for(var l=0,u=a.length;l<u;l++){n=a[l];o=Number(n.levelNum)||0;s=r[l];if(!(o===0||s&&n.name===tt(s))){i=false;break}}return i},_mergeAxes:function(e,t,c){var r=this._columnMeasures();var a=this._rowMeasures();var n=this.axes();var s,i;var h=Re(n.rows.tuples,a);var d=e.rows.tuples.length;var m=Re(n.columns.tuples,r);var o=e.columns.tuples.length;if(c=="columns"){o=m;i=e.columns.tuples}else{i=Ge(e.columns.tuples,r);t=Ve(i,t)}var l=Oe(n.columns.tuples,i,r);if(c=="rows"){d=Re(e.rows.tuples,a);i=e.rows.tuples}else{i=Ge(e.rows.tuples,a);t=je(i,t)}var u=Oe(n.rows.tuples,i,a);n.columns.tuples=l.tuples;n.rows.tuples=u.tuples;if(m!==Re(n.columns.tuples,r)){s=l.index+Pe(l.parsedRoot,l.memberIndex,r);var p=m+o;t=this._mergeColumnData(t,s,d,o,p)}else if(h!==Re(n.rows.tuples,a)){s=u.index+Pe(u.parsedRoot,u.memberIndex,a);t=this._mergeRowData(t,s,d,o)}if(n.columns.tuples.length===0&&n.rows.tuples.length===0)t=[];return{axes:n,data:t}},_mergeColumnData:function(e,t,r,c,a){var n=this.data().toJSON();var s,i,o=0,l;var u=Math.max(this._columnMeasures().length,1);r=Math.max(r,1);if(n.length>0){o=u;a-=u}for(s=0;s<r;s++){i=t+s*a;l=e.splice(0,c);l.splice(0,o);[].splice.apply(n,[i,0].concat(l))}return n},_mergeRowData:function(e,t,r,a){var n=this.data().toJSON();var s,i,o;var l=Math.max(this._rowMeasures().length,1);a=Math.max(a,1);if(n.length>0){r-=l;e.splice(0,a*l)}for(s=0;s<r;s++){o=e.splice(0,a);i=t*a+s*a;[].splice.apply(n,[i,0].concat(o))}return n},_columnMeasures:function(){var e=this.measures();var t=[];if(this.measuresAxis()==="columns")if(this.columns().length===0)t=e;else if(e.length>1)t=e;return t},_rowMeasures:function(){var e=this.measures();var t=[];if(this.measuresAxis()==="rows")if(this.rows().length===0)t=e;else if(e.length>1)t=e;return t},_updateLocalData:function(e,t){if(this.cubeBuilder){if(t)this._requestData=t;e=this._processResult(e)}this._data=this._observe(e);this._ranges=[];this._addRange(this._data);this._total=this._data.length;this._pristineTotal=this._total;this._process(this._data)},data:function(e){var t=this;if(e!==H){this._pristineData=e.slice(0);this._updateLocalData(e,{columns:this.columns(),rows:this.rows(),measures:this.measures()})}else return t._data},_normalizeTuples:function(e,c,h,t){var r=t.length||1;var a=0;var n=[];var s={};var i=0;var o,l,u;if(!e.length)return;if(this._skipNormalize<=0&&!this._hasRoot(e[0],c,h)){this._skipNormalize=0;for(;a<r;a++){n.push(this._createTuple(e[0],t[a],true));s[a]=a}e.splice.apply(e,[0,e.length].concat(n).concat(e));a=r}if(t.length){u=o=e[a];l=o.members.length-1;while(o){if(i>=r)i=0;if(o.members[l].name!==t[i].name){e.splice(a,0,this._createTuple(o,t[i]));s[a]=a}a+=1;i+=1;o=e[a];if(r>i&&(!o||Tt(u,l-1)!==Tt(o,l-1))){for(;i<r;i++){e.splice(a,0,this._createTuple(u,t[i]));s[a]=a;a+=1}o=e[a]}u=o}}return s},_addMissingDataItems:function(e,t){while(t.rowIndexes[parseInt(e.length/t.columnsLength,10)]!==H)for(var r=0;r<t.columnsLength;r++)e=Me(e);while(t.columnIndexes[e.length%t.columnsLength]!==H)e=Me(e);return e},_normalizeOrdinals:function(e,t,r){var a=r.lastOrdinal;if(!t)return Me(e);if(t.ordinal-a>1){a+=1;while(a<t.ordinal&&e.length<r.length){e=this._addMissingDataItems(Me(e),r);a+=1}}t.ordinal=e.length;e[e.length]=t;return e},_normalizeData:function(e){var t=e.data;var r=0;var a;var n=[];var s;var i;e.lastOrdinal=0;e.columnIndexes=e.columnIndexes||{};e.rowIndexes=e.rowIndexes||{};e.columnsLength=e.columnsLength||1;e.rowsLength=e.rowsLength||1;e.length=e.columnsLength*e.rowsLength;i=e.length;if(t.length===i)return t;while(n.length<i){a=t[r++];if(a)s=a.ordinal;n=this._normalizeOrdinals(this._addMissingDataItems(n,e),a,e);e.lastOrdinal=s}return n},discover:function(e,t){var n=this,r=n.transport;return x.Deferred(function(a){r.discover(i({success:function(e){e=n.reader.parse(e);if(n._handleCustomErrors(e))return;if(t)e=t(e);a.resolve(e)},error:function(e,t,r){a.reject(e);n.error(e,t,r)}},e))}).promise().done(function(){n.trigger("schemaChange")})},schemaMeasures:function(){var t=this;return t.discover({data:{command:"schemaMeasures",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube()}}},function(e){return t.reader.measures(e)})},schemaKPIs:function(){var t=this;return t.discover({data:{command:"schemaKPIs",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube()}}},function(e){return t.reader.kpis(e)})},schemaDimensions:function(){var t=this;return t.discover({data:{command:"schemaDimensions",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube()}}},function(e){return t.reader.dimensions(e)})},schemaHierarchies:function(e){var t=this;return t.discover({data:{command:"schemaHierarchies",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),dimensionUniqueName:e}}},function(e){return t.reader.hierarchies(e)})},schemaLevels:function(e){var t=this;return t.discover({data:{command:"schemaLevels",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),hierarchyUniqueName:e}}},function(e){return t.reader.levels(e)})},schemaCubes:function(){var t=this;return t.discover({data:{command:"schemaCubes",restrictions:{catalogName:t.transport.catalog()}}},function(e){return t.reader.cubes(e)})},schemaCatalogs:function(){var t=this;return t.discover({data:{command:"schemaCatalogs"}},function(e){return t.reader.catalogs(e)})},schemaMembers:function(e){var r=this;var t=function(t){return function(e){return r.reader.members(e,t)}}(e);return r.discover({data:{command:"schemaMembers",restrictions:i({catalogName:r.transport.catalog(),cubeName:r.transport.cube()},e)}},t)},_params:function(e){if(this._clearAxesData){this._axes={};this._data=this._observe([]);this._clearAxesData=false;this.trigger(z)}var t=c.fn._params.call(this,e);t=i({measures:this.measures(),measuresAxis:this.measuresAxis(),columns:this.columns(),rows:this.rows()},t);if(this.cubeBuilder)this._requestData=t;return t}});function ye(e){var t=[];for(var r=0;r<e.length;r++){t.push(e[r]);if(e[r].children)t=t.concat(ye(e[r].children))}return t}function Ce(e,t,r){for(var a=0;a<t.length;a++)if(t[a].children&&t[a].children.length)Ce(e,t[a].children,r);if(t[0].parentName!=e)return;t=t.sort(r)}function Te(e,t){for(var r=0;r<e.length;r++){var a=t[e[r].name];if(!x.isEmptyObject(a.childrenMap)){e[r].children=[];for(var n in a.childrenMap)e[r].children.push(x.extend({},{name:n,parentName:t[n].parentName}));Te(e[r].children,t)}}}function Me(e){e[e.length]={value:"",fmtValue:"",ordinal:e.length};return e}function Ae(e,t,r){if(e.tuples.length<Re(t.tuples,r))return t;return}function Ie(e,t,r,a,n){var s,i,o;var l=e.length;var c=Re(t,a);var u=a.length||1;for(i=0;i<r;i++)for(s=0;s<l;s++){o=De(e[s],t)*u;o+=s%u;n[i*l+s].ordinal=i*c+o}}function He(e,t,r,a,n){var s,i,o;var l=e.length;var u=a.length||1;for(i=0;i<l;i++){o=De(e[i],t);o*=u;o+=i%u;for(s=0;s<r;s++)n[i*r+s].ordinal=o*r+s}}function De(e,t){return Be(t,e).index}function Re(e,t){if(!e.length)return 0;var r=e.slice();var a=r.shift();var n=1;while(a){if(a.members)[].push.apply(r,a.members);else if(a.children){if(!a.measure)n+=a.children.length;[].push.apply(r,a.children)}a=r.shift()}if(t.length)n=n*t.length;return n}function Le(e){if(!e)e={tuples:[]};if(!e.tuples)e.tuples=[];return e}function Pe(e,t,r){if(!e)return 0;var a=Math.max(r.length,1);var n=e.members.slice(0,t);var s=n.shift();var i=a;while(s){if(s.name===W)i+=a-1;else if(s.children)[].push.apply(n,s.children);else{i++;[].push.apply(n,s.members)}s=n.shift()}return i}function Oe(e,t,r){if(!t[0])return{parsedRoot:null,tuples:e,memberIndex:0,index:0};var a=Be(e,t[0]);if(!a.tuple)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};var n=a.tuple.members;var s=t[0].members;var i=-1;if(n.length!==s.length)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};for(var o=0,l=n.length;o<l;o++)if(!n[o].measure&&s[o].children[0]){if(i==-1&&s[o].children.length)i=o;n[o].children=s[o].children}r=Math.max(r.length,1);return{parsedRoot:a.tuple,index:a.index*r,memberIndex:i,tuples:e}}function Fe(e,t){var r=true;var a,n;e=e.members;t=t.members;for(a=0,n=e.length;a<n;a++){if(e[a].measure||t[a].measure)continue;r=r&&tt(e[a])===tt(t[a])}return r}function Be(e,t){var r,a,n,s,i=0;var o,l,u;for(r=0,a=e.length;r<a;r++){n=e[r];if(Fe(n,t))return{tuple:n,index:i};i++;for(o=0,l=n.members.length;o<l;o++){u=n.members[o];if(u.measure)continue;s=Be(u.children,t);i+=s.index;if(s.tuple)return{tuple:s.tuple,index:i}}}return{index:i}}function Ue(e,t){var r,a,n,s="";for(a=0,n=e.length;a<n;a++){r=e[a];s+=r.name;if(!t[s])t[s]=r}}function qe(e,t){var r=e.members;var a,n,s,i="";var o="";var l;for(a=0,n=r.length;a<n;a++){s=r[a];if(l)if(t[i+s.name]){i+=s.name;l=t[i];continue}else if(t[i+s.parentName])return t[i+s.parentName];else if(t[o+s.parentName])return t[o+s.parentName];else return t[o];i+=s.name;l=t[s.parentName];if(!l){l=t[i];if(!l)return null}if(l)o+=l.name}return l}function We(e,t){if(t.length===0)return-1;var r=t[0];var a=e.members;for(var n=0,s=a.length;n<s;n++)if(a[n].name==r.name)return n}function ze(e,t){if(t<0)return;var r={name:W,measure:true,children:[x.extend({members:[],dataIndex:e.dataIndex},e.members[t])]};e.members.splice(t,1,r);e.dataIndex=H}function Ge(e,t){if(e.length<1)return[];var r=[];var a={};var n=We(e[0],t);for(var s=0;s<e.length;s++){var i=e[s];i.dataIndex=s;ze(i,n);var o=qe(i,a);if(o)if(n<0||!o.measure)o.children.push(i);else o.children.push(i.members[n].children[0]);else r.push(i);Ue(i.members,a)}return r}function je(e,t){if(!e||!e.length)return t;var r=[];var a=Ye(e);var n=a.length;var s=Math.max(t.length/n,1);var i,o,l,c;var u;for(i=0;i<n;i++){l=s*i;c=s*a[i];for(o=0;o<s;o++){u=parseInt(c+o,10);r[parseInt(l+o,10)]=t[u]||{value:"",fmtValue:"",ordinal:u}}}return r}function Ve(e,t){if(!e||!e.length)return t;var r=[];var a=Ye(e);var n=a.length;var s=Math.max(t.length/n,1);var i,o,l,u;for(o=0;o<s;o++){l=n*o;for(i=0;i<n;i++){u=a[i]+l;r[l+i]=t[u]||{value:"",fmtValue:"",ordinal:u}}}return r}function Ye(e){e=e.slice();var t=[];var r=e.shift();var a,n,s,i,o;while(r){if(r.dataIndex!==H)t.push(r.dataIndex);s=0;for(a=0,n=r.members.length;a<n;a++){o=r.members[a];i=o.children;if(o.measure)[].splice.apply(e,[0,0].concat(i));else[].splice.apply(e,[s,0].concat(i));s+=i.length}r=e.shift()}return t}function Ke(e){var t=e.split(".");if(t.length>2)return t[0]+"."+t[1];return e}function Qe(e,t){var r=e.length-1;var a=e[r];var n;n=$e(t,a);if(n&&n.dir)a="ORDER("+a+".Children,"+n.field+".CurrentMember.MEMBER_CAPTION,"+n.dir+")";else a+=".Children";e[r]=a;return e}function $e(e,t){for(var r=0,a=e.length;r<a;r++)if(t.indexOf(e[r].field)===0)return e[r];return null}function Je(e){var t="CROSSJOIN({";var r;if(e.length>2){r=e.pop();t+=Je(e)}else{t+=e.shift();r=e.pop()}t+="},{";t+=r;t+="})";return t}function Xe(e,t){var r=e.slice(0);if(t.length>1)r.push("{"+Ze(t).join(",")+"}");return Je(r)}function Ze(e){var t=0;var r=e.length;var a=[];var n;for(;t<r;t++){n=e[t];a.push(n.name!==H?n.name:n)}return a}function et(e,t){var r,a,n=-1;for(r=0,a=t.length;r<a;r++)if(tt(t[r])===e){n=r;break}return n}function tt(e){e=e.name||e;if(v.call(e)==="[object Array]")e=e[e.length-1];return e}function rt(e){var t=e.length;var r=[];var a=0;for(;a<t;a++)r.push(e[a].name[0]);return r}function at(e,t){var r;var a;var n;var s=0;var i=e.length;var o=t.length;t=t.slice(0);for(;s<i;s++){r=e[s];for(n=0;n<o;n++){a=Ke(t[n]);if(r.indexOf(a)!==-1){t[n]=r;break}}}return{names:t,expandedIdx:n,uniquePath:t.slice(0,n+1).join("")}}function nt(e){var t=[];var r=[];var a=[];var n;var s,i;var o=0;var c=e.length;var l;var h;var u;for(;o<c;o++){n=e[o];l=n.name;u=false;if(v.call(l)!=="[object Array]")n.name=l=[l];if(l.length>1)r.push(n);else{h=Ke(l[0]);for(s=0,i=a.length;s<i;s++)if(a[s].name[0].indexOf(h)===0){u=true;break}if(!u)a.push(n);if(n.expand)t.push(n)}}t=t.concat(r);return{root:a,expanded:t}}function st(e,t,r){var a="";e=e||[];var n=nt(e);var c=n.root;var s=rt(c);var i=[];n=n.expanded;var h=n.length;var o=0;var l;var u=[];if(s.length>1||t.length>1){i.push(Xe(s,t));for(;o<h;o++){l=Qe(n[o].name,r);u=at(l,s).names;i.push(Xe(u,t))}a+=i.join(",")}else{for(;o<h;o++){l=Qe(n[o].name,r);u.push(l[0])}a+=s.concat(u).join(",")}return a}Ee.create=function(e){e=e&&e.push?{data:e}:e;var t=e||{},r=t.data;t.data=r;if(!(t instanceof Ee)&&t instanceof k.data.DataSource)throw new Error("Incorrect DataSource type. Only PivotDataSource instances are supported");return t instanceof Ee?t:new Ee(t)},ke.create=function(e){e=e&&e.push?{data:e}:e;var t=e||{},r=t.data;t.data=r;if(!(t instanceof ke)&&t instanceof k.data.DataSource)throw new Error("Incorrect DataSource type. Only PivotDataSource instances are supported");return t instanceof ke?t:new ke(t)};var it={contains:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") > 0',doesnotcontain:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}")',startswith:', Left({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',endswith:', Right({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',eq:', {0}.CurrentMember.MEMBER_CAPTION = "{1}"',neq:', {0}.CurrentMember.MEMBER_CAPTION = "{1}"'};function ot(e){var t="";var r=e.value;var a=e.field;var n=e.operator;if(n=="in"){t+="{";t+=r;t+="}"}else{t+=n=="neq"||n=="doesnotcontain"?"-":"";t+="Filter(";t+=a+".MEMBERS";t+=k.format(it[n],a,r);t+=")"}return t}function lt(e,t){var r="",a;var n=e.filters;var s=n.length;var i;for(i=s-1;i>=0;i--){a="SELECT (";a+=ot(n[i]);a+=") ON 0";if(i==s-1){a+=" FROM ["+t+"]";r=a}else r=a+" FROM ( "+r+" )"}return r}function ut(e,t,r){var a="";if(t){a+="<"+e+">";var n;for(var s in t){n=t[s];if(r)s=s.replace(/([A-Z]+(?=$|[A-Z][a-z])|[A-Z]?[a-z]+)/g,"$1_").toUpperCase().replace(/_$/,"");a+="<"+s+">"+n+"</"+s+">"}a+="</"+e+">"}else a+="<"+e+"/>";return a}var ct={schemaCubes:"MDSCHEMA_CUBES",schemaCatalogs:"DBSCHEMA_CATALOGS",schemaMeasures:"MDSCHEMA_MEASURES",schemaDimensions:"MDSCHEMA_DIMENSIONS",schemaHierarchies:"MDSCHEMA_HIERARCHIES",schemaLevels:"MDSCHEMA_LEVELS",schemaMembers:"MDSCHEMA_MEMBERS",schemaKPIs:"MDSCHEMA_KPIS"},ht={read:function(e){var t='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement>';t+="SELECT NON EMPTY {";var r=e.columns||[];var a=e.rows||[];var n=e.measures||[];var s=e.measuresAxis==="rows";var i=e.sort||[];if(!r.length&&a.length&&(!n.length||n.length&&s)){r=a;a=[];s=false}if(!r.length&&!a.length)s=false;if(r.length)t+=st(r,!s?n:[],i);else if(n.length&&!s)t+=Ze(n).join(",");t+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON COLUMNS";if(a.length||s&&n.length>1){t+=", NON EMPTY {";if(a.length)t+=st(a,s?n:[],i);else t+=Ze(n).join(",");t+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON ROWS"}if(e.filter){t+=" FROM ";t+="(";t+=lt(e.filter,e.connection.cube);t+=")"}else t+=" FROM ["+e.connection.cube+"]";if(n.length==1&&r.length)t+=" WHERE ("+Ze(n).join(",")+")";t+="</Statement></Command><Properties><PropertyList><Catalog>"+e.connection.catalog+"</Catalog><Format>Multidimensional</Format></PropertyList></Properties></Execute></Body></Envelope>";return t.replace(/\&/g,"&amp;")},discover:function(e){e=e||{};var t='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis">';t+="<RequestType>"+(ct[e.command]||e.command)+"</RequestType>";t+="<Restrictions>"+ut("RestrictionList",e.restrictions,true)+"</Restrictions>";if(e.connection&&e.connection.catalog)e.properties=x.extend({},{Catalog:e.connection.catalog},e.properties);t+="<Properties>"+ut("PropertyList",e.properties)+"</Properties>";t+="</Discover></Body></Envelope>";return t}},dt=k.data.RemoteTransport.extend({init:function(e){var t=e;e=this.options=i(true,{},this.options,e);k.data.RemoteTransport.call(this,e);if(_(t.discover))this.discover=t.discover;else if(typeof t.discover==="string")this.options.discover={url:t.discover};else if(!t.discover)this.options.discover=this.options.read},setup:function(e,t){e.data=e.data||{};x.extend(true,e.data,{connection:this.options.connection});return k.data.RemoteTransport.fn.setup.call(this,e,t)},options:{read:{dataType:"text",contentType:"text/xml",type:"POST"},discover:{dataType:"text",contentType:"text/xml",type:"POST"},parameterMap:function(e,t){return ht[t](e,t)}},discover:function(e){return x.ajax(this.setup(e,"discover"))}}),mt=r.extend({init:function(e){e=this.options=i(true,{},this.options,e)},setup:function(e){return x.extend(true,e||{},{connection:this.options.connection})},read:function(e){var t=this,r,a;var n=t.setup(e.data,O);r=e.success||x.noop;a=e.error||x.noop;if(e.parameterMap)n=t.parameterMap(n,O);w({url:t.options.read},n).then(M).then(function(e){r(e)}).catch(function(e){a(e)})},catalog:function(e){var t=this.options||{};if(e===H)return(t.connection||{}).catalog;var r=t.connection||{};r.catalog=e;this.options.connection=r;x.extend(this.transport.options,{connection:r})},cube:function(e){var t=this.options||{};if(e===H)return(t.connection||{}).cube;var r=t.connection||{};r.cube=e;this.options.connection=r;i(true,this.transport.options,{connection:r})},discover:function(e){return m({url:this.options.read},e)}});function pt(e){if(e==null)return[];var t=v.call(e);if(t!=="[object Array]")return[e];return e}function ft(e){var t={tuples:[]};var r=pt(k.getter("Tuples.Tuple",true)(e));var a=k.getter("Caption['#text']");var n=k.getter("UName['#text']");var s=k.getter("LName['#text']");var c=k.getter("LNum['#text']");var h=k.getter("CHILDREN_CARDINALITY['#text']",true);var d=k.getter("['@Hierarchy']");var m=k.getter("PARENT_UNIQUE_NAME['#text']",true);for(var i=0;i<r.length;i++){var o=[];var l=pt(r[i].Member);for(var u=0;u<l.length;u++)o.push({children:[],caption:a(l[u]),name:n(l[u]),levelName:s(l[u]),levelNum:c(l[u]),hasChildren:parseInt(h(l[u]),10)>0,parentName:m(l[u]),hierarchy:d(l[u])});t.tuples.push({members:o})}return t}var vt={cubes:{name:k.getter("CUBE_NAME['#text']",true),caption:k.getter("CUBE_CAPTION['#text']",true),description:k.getter("DESCRIPTION['#text']",true),type:k.getter("CUBE_TYPE['#text']",true)},catalogs:{name:k.getter("CATALOG_NAME['#text']",true),description:k.getter("DESCRIPTION['#text']",true)},measures:{name:k.getter("MEASURE_NAME['#text']",true),caption:k.getter("MEASURE_CAPTION['#text']",true),uniqueName:k.getter("MEASURE_UNIQUE_NAME['#text']",true),description:k.getter("DESCRIPTION['#text']",true),aggregator:k.getter("MEASURE_AGGREGATOR['#text']",true),groupName:k.getter("MEASUREGROUP_NAME['#text']",true),displayFolder:k.getter("MEASURE_DISPLAY_FOLDER['#text']",true),defaultFormat:k.getter("DEFAULT_FORMAT_STRING['#text']",true)},kpis:{name:k.getter("KPI_NAME['#text']",true),caption:k.getter("KPI_CAPTION['#text']",true),value:k.getter("KPI_VALUE['#text']",true),goal:k.getter("KPI_GOAL['#text']",true),status:k.getter("KPI_STATUS['#text']",true),trend:k.getter("KPI_TREND['#text']",true),statusGraphic:k.getter("KPI_STATUS_GRAPHIC['#text']",true),trendGraphic:k.getter("KPI_TREND_GRAPHIC['#text']",true),description:k.getter("KPI_DESCRIPTION['#text']",true),groupName:k.getter("MEASUREGROUP_NAME['#text']",true)},dimensions:{name:k.getter("DIMENSION_NAME['#text']",true),caption:k.getter("DIMENSION_CAPTION['#text']",true),description:k.getter("DESCRIPTION['#text']",true),uniqueName:k.getter("DIMENSION_UNIQUE_NAME['#text']",true),defaultHierarchy:k.getter("DEFAULT_HIERARCHY['#text']",true),type:k.getter("DIMENSION_TYPE['#text']",true)},hierarchies:{name:k.getter("HIERARCHY_NAME['#text']",true),caption:k.getter("HIERARCHY_CAPTION['#text']",true),description:k.getter("DESCRIPTION['#text']",true),uniqueName:k.getter("HIERARCHY_UNIQUE_NAME['#text']",true),dimensionUniqueName:k.getter("DIMENSION_UNIQUE_NAME['#text']",true),displayFolder:k.getter("HIERARCHY_DISPLAY_FOLDER['#text']",true),origin:k.getter("HIERARCHY_ORIGIN['#text']",true),defaultMember:k.getter("DEFAULT_MEMBER['#text']",true)},levels:{name:k.getter("LEVEL_NAME['#text']",true),caption:k.getter("LEVEL_CAPTION['#text']",true),description:k.getter("DESCRIPTION['#text']",true),uniqueName:k.getter("LEVEL_UNIQUE_NAME['#text']",true),dimensionUniqueName:k.getter("DIMENSION_UNIQUE_NAME['#text']",true),displayFolder:k.getter("LEVEL_DISPLAY_FOLDER['#text']",true),orderingProperty:k.getter("LEVEL_ORDERING_PROPERTY['#text']",true),origin:k.getter("LEVEL_ORIGIN['#text']",true),hierarchyUniqueName:k.getter("HIERARCHY_UNIQUE_NAME['#text']",true)},members:{name:k.getter("MEMBER_NAME['#text']",true),caption:k.getter("MEMBER_CAPTION['#text']",true),uniqueName:k.getter("MEMBER_UNIQUE_NAME['#text']",true),dimensionUniqueName:k.getter("DIMENSION_UNIQUE_NAME['#text']",true),hierarchyUniqueName:k.getter("HIERARCHY_UNIQUE_NAME['#text']",true),levelUniqueName:k.getter("LEVEL_UNIQUE_NAME['#text']",true),childrenCardinality:k.getter("CHILDREN_CARDINALITY['#text']",true)}},gt=["axes","catalogs","cubes","dimensions","hierarchies","levels","measures"],_t=k.data.XmlDataReader.extend({init:function(e){k.data.XmlDataReader.call(this,e);this._extend(e)},_extend:function(e){var t=0;var r=gt.length;var a;var n;for(;t<r;t++){a=gt[t];n=e[a];if(n&&n!==s)this[a]=n}},parse:function(e){var t=k.data.XmlDataReader.fn.parse(e.replace(/<(\/?)(\w|-)+:/g,"<$1"));return k.getter("['Envelope']['Body']",true)(t)},errors:function(e){var t=k.getter("['Fault']",true)(e);if(t)return[{faultstring:k.getter("faultstring['#text']",true)(t),faultcode:k.getter("faultcode['#text']",true)(t)}];return null},axes:function(e){e=k.getter('ExecuteResponse["return"].root',true)(e);var t=pt(k.getter("Axes.Axis",true)(e));var r;var a={columns:{},rows:{}};for(var n=0;n<t.length;n++){r=t[n];if(r["@name"].toLowerCase()!=="sliceraxis")if(!a.columns.tuples)a.columns=ft(r);else a.rows=ft(r)}return a},data:function(e){e=k.getter('ExecuteResponse["return"].root',true)(e);var t=pt(k.getter("CellData.Cell",true)(e));var r=[];var a=k.getter("['@CellOrdinal']");var n=k.getter("Value['#text']");var s=k.getter("FmtValue['#text']");for(var i=0;i<t.length;i++)r.push({value:n(t[i]),fmtValue:s(t[i]),ordinal:parseInt(a(t[i]),10)});return r},_mapSchema:function(e,t){e=k.getter('DiscoverResponse["return"].root',true)(e);var r=pt(k.getter("row",true)(e));var a=[];for(var n=0;n<r.length;n++){var s={};for(var i in t)s[i]=t[i](r[n]);a.push(s)}return a},measures:function(e){return this._mapSchema(e,vt.measures)},kpis:function(e){return this._mapSchema(e,vt.kpis)},hierarchies:function(e){return this._mapSchema(e,vt.hierarchies)},levels:function(e){return this._mapSchema(e,vt.levels)},dimensions:function(e){return this._mapSchema(e,vt.dimensions)},cubes:function(e){return this._mapSchema(e,vt.cubes)},catalogs:function(e){return this._mapSchema(e,vt.catalogs)},members:function(e){return this._mapSchema(e,vt.members)}}),xt=(i(true,k.data,{PivotDataSource:ke,PivotDataSourceV2:Ee,XmlaTransport:dt,XmlaDataReader:_t,PivotCubeBuilder:Se,transports:{xmla:dt},readers:{xmla:_t}}),function(e,t){if(!e)return null;for(var r=0,a=e.length;r<a;r++)if(e[r].field===t)return e[r];return null}),wt=function(e,t){var r=[];for(var a=0,n=e.length;a<n;a++)if(e[a].field!==t)r.push(e[a]);return r},bt=(k.ui.PivotSettingTarget=a.extend({init:function(e,t){var s=this;a.fn.init.call(s,e,t);s.element.addClass("k-pivot-setting");s.dataSource=k.data.PivotDataSource.create(t.dataSource);s._refreshHandler=s.refresh.bind(s);s.dataSource.first(h,s._refreshHandler);if(!t.template){var r="";if(s.options.enabled)r='<span class="k-setting-delete k-chip-action"><span class="k-icon k-i-close"></span></span>';s.options.template=""+'<span class="k-chip k-chip-md k-rounded-full k-chip-solid k-chip-solid-base" data-'+k.ns+'name="${data.name || data}">'+'<span class="k-chip-content">'+'<span class="k-chip-text">${data.name || data}</span>'+"</span>"+'<span class="k-chip-actions">'+r+"</span>"+"</span>"}s.template=k.template(s.options.template);s.emptyTemplate=k.template(s.options.emptyTemplate);s._sortable();s.element.on("click"+o,".k-chip, .k-button",function(e){var t=x(e.target);var r=t.closest(".k-chip-action");var a=t.closest("["+k.attr("name")+"]").attr(k.attr("name"));if(!a)return;if(r.hasClass("k-setting-delete")){s.remove(a);return}if(t.closest(".k-chip-actions").length>0)return;if(s.options.sortable){var n=x(e.currentTarget).find(".k-i-sort-asc-sm").length?"desc":"asc";s.sort({field:a,dir:n})}});if(t.filterable||t.sortable)s.fieldMenu=new l.PivotFieldMenu(s.element,{messages:s.options.messages.fieldMenu,filter:".k-setting-fieldmenu",filterable:t.filterable,sortable:t.sortable,dataSource:s.dataSource});s.refresh()},options:{name:"PivotSettingTarget",template:null,filterable:false,sortable:false,emptyTemplate:"<div class='k-empty'>${data}</div>",setting:"columns",enabled:true,messages:{empty:"Drop Fields Here"}},setDataSource:function(e){this.dataSource.unbind(h,this._refreshHandler);this.dataSource=this.options.dataSource=e;if(this.fieldMenu)this.fieldMenu.setDataSource(e);e.first(h,this._refreshHandler);this.refresh()},_sortable:function(){var r=this;if(r.options.enabled)this.sortable=this.element.kendoSortable({connectWith:this.options.connectWith,hint:r.options.hint,filter:">*:not(.k-empty)",cursor:"move",start:function(e){e.item.trigger("focus").trigger("blur")},change:function(e){var t=e.item.attr(k.attr("name"));if(e.action=="receive")r.add(t);else if(e.action=="remove")r.remove(t);else if(e.action=="sort")r.move(t,e.newIndex)}}).data("kendoSortable")},_isKPI:function(e){return e.type==="kpi"||e.measure},validate:function(e){var t=e.type==2||"aggregator"in e||this._isKPI(e);if(t)return this.options.setting==="measures";if(this.options.setting==="measures")return t;var r=this.dataSource[this.options.setting]();var a=e.defaultHierarchy||e.uniqueName;if(et(a,r)>-1)return false;r=this.dataSource[this.options.setting==="columns"?"rows":"columns"]();if(et(a,r)>-1)return false;return true},add:function(e){var t=this.dataSource[this.options.setting]();var r,a;e=Array.isArray(e)?e.slice(0):[e];for(r=0,a=e.length;r<a;r++)if(et(e[r],t)!==-1){e.splice(r,1);r-=1;a-=1}if(e.length){t=t.concat(e);this.dataSource[this.options.setting](t)}},move:function(e,t){var r=this.dataSource[this.options.setting]();var a=et(e,r);if(a>-1){e=r.splice(a,1)[0];r.splice(t,0,e);this.dataSource[this.options.setting](r)}},remove:function(e){var t=this.dataSource[this.options.setting]();var r=et(e,t);var a=this.dataSource.sort();var n=this.dataSource.filter();if(r>-1){if(n){n.filters=wt(n.filters,e);this.dataSource._filter.filters=n.filters;if(!n.filters.length)this.dataSource._filter=null}if(a){a=wt(a,e);this.dataSource._sort=a}t.splice(r,1);this.dataSource[this.options.setting](t)}},sort:function(e){var t=this.options.sortable;var r=t===true||t.allowUnsort;var a=r&&e.dir==="asc";var n=this.dataSource.sort()||[];var s=wt(n,e.field);if(a&&n.length!==s.length)e=null;if(e)s.push(e);this.dataSource.sort(s)},refresh:function(){var e="";var t=this.dataSource[this.options.setting]();var r=t.length;var a=0;var n;if(r)for(;a<r;a++){n=t[a];n=n.name===H?{name:n}:n;e+=this.template(i({sortIcon:this._sortIcon(n.name)},n))}else e=this.emptyTemplate(this.options.messages.empty);this.element.html(e)},destroy:function(){a.fn.destroy.call(this);this.dataSource.unbind(h,this._refreshHandler);this.element.off(o);if(this.sortable)this.sortable.destroy();if(this.fieldMenu)this.fieldMenu.destroy();this.element=null;this._refreshHandler=null},_sortIcon:function(e){var t=this.dataSource.sort();var r=xt(t,tt(e));var a="";if(r)a="k-i-sort-"+r.dir;return a}}),k.ui.PivotSettingTargetV2=a.extend({init:function(e,t){var n=this;a.fn.init.call(n,e,t);n.dataSource=k.data.PivotDataSourceV2.create(t.dataSource);n._refreshHandler=n.refresh.bind(n);n.dataSource.first(h,n._refreshHandler);n.template=k.template(n.options.template);n._sortable();n.element.on("click"+o,".k-i-close-circle",function(e){var t=x(e.target);var r=t.closest(".k-chip");var a=r.find(".k-chip-label").text();if(!a)return;n.remove(a);r.remove();n.trigger("remove",{name:a})});if(t.filterable||t.sortable)n.fieldMenu=new l.PivotFieldMenuV2(n.element,{messages:n.options.messages.fieldMenu,filterable:t.filterable,filter:".k-i-more-vertical",sortable:t.sortable,dataSource:n.dataSource});n.refresh()},events:["remove"],options:{name:"PivotSettingTargetV2",template:null,filterable:false,sortable:false,setting:"columns",enabled:true,messages:{empty:"Drop Fields Here"}},setDataSource:function(e){this.dataSource.unbind(h,this._refreshHandler);this.dataSource=this.options.dataSource=e;if(this.fieldMenu)this.fieldMenu.setDataSource(e);e.first(h,this._refreshHandler);this.refresh()},_applyState:function(){if(this._sortState!==H){this.dataSource._sort=this._sortState;this._sortState=H}if(this._stateFilter!==H){this.dataSource._filter=this._stateFilter;this._stateFilter=H}this.dataSource["_"+this.options.setting]=this.options.setting==="measures"?oe(this._savedState):le(this._savedState)},_cancelChanges:function(){this._sortState=H;this._stateFilter=H;this._savedState=k.deepExtend([],this._initialState);this._redraw()},_state:function(e,t){var r=this;if(!e)return r._savedState||[];else{if(!r._savedState||t)r._initialState=k.deepExtend([],e);r._savedState=k.deepExtend([],e)}},_sortable:function(){var r=this;this.sortable=this.element.kendoSortable({connectWith:this.options.connectWith,hint:r.options.hint,filter:">*:not(.k-empty)",cursor:"move",start:function(e){e.item.focus().blur()},change:function(e){var t=e.item.find(".k-chip-label").text();if(e.action=="receive")r.add(t);else if(e.action=="remove")r.remove(t);else if(e.action=="sort")r.move(t,e.newIndex)}}).data("kendoSortable")},add:function(e){var t=this._state();var r,a;e=Array.isArray(e)?e.slice(0):[e];for(r=0,a=e.length;r<a;r++)if(et(e[r],t)!==-1){e.splice(r,1);r-=1;a-=1}if(e.length){t=t.concat(e);this._state(t);this._redraw()}},move:function(e,t){var r=this._state();var a=et(e,r);if(a>-1){e=r.splice(a,1)[0];r.splice(t,0,e);this._state(r);this._redraw()}},remove:function(e){var t=this._state();var r=et(e,t);var a=this.dataSource.sort();var n=this.dataSource.filter();if(r>-1){if(n){n.filters=wt(n.filters,e);this._savedFilter=this.dataSource._filter;this._savedFilter.filters=n.filters;if(!n.filters.length)this._savedFilter=null}if(a){a=wt(a,e);this._sortState=a}t.splice(r,1);this._state(t);this._redraw()}},_emptyState:function(e){var t=this;if(e)t.element.html(this.options.messages.empty).addClass("k-settings-description").removeClass("k-chip-list");else t.element.removeClass("k-settings-description").addClass("k-chip-list")},_redraw:function(){var e=this._state()||[];this._emptyState(!e.length);if(e.length)this.element.html(this._targetsHTML(e))},_targetsHTML:function(e){var t;var r="";var a=0;var n=this.options;var s=false;if(this.options.setting!="measures")s=n.filterable||n.sortable;if(e.length)for(;a<e.length;a++){t=e[a];t=t.name===H?{name:t}:t;r+=this.template({name:t.name,menuenabled:s})}return r},refresh:function(){if(this.dataSource._preventRefresh)return;var e=this.dataSource[this.options.setting]();this._state(e,true);this._emptyState(!this._state().length);if(e.length)this.element.html(this._targetsHTML(e))},destroy:function(){a.fn.destroy.call(this);this.dataSource.unbind(h,this._refreshHandler);this.element.off(o);if(this.sortable)this.sortable.destroy();if(this.fieldMenu)this.fieldMenu.destroy();this.element=null;this._refreshHandler=null}}),a.extend({init:function(e,t){var r=this;a.fn.init.call(r,e,t);r.element=x(e);r._element();r._attachEvents()},options:{name:"PivotConfiguratorButton",text:"Change settings",configurator:""},destroy:function(){this.element.off(o)},setOptions:function(e){var t=this;k.deepExtend(t.options,e);this.init(this.element,this.options)},toggle:function(){var e=k.attr("role");var t=this.element.closest("["+e+"=pivotcontainer]").find("["+e+"=pivotgridv2]");var r;x("#"+this.options.configurator).toggleClass("k-hidden");if(t.length){r=t.getKendoPivotGridV2();r._setContentWidth();r._updateDimensions()}},_attachEvents:function(){this.element.on("click"+o,this.toggle.bind(this))},_element:function(){var e=this.options;this.element.addClass("k-pivotgrid-configurator-button");this.element.html(k.format("<span>{0}<span class='k-icon k-i-gear k-color-inherit'></span></span>",e.text))}})),St=a.extend({init:function(e,t){var r=this;a.fn.init.call(r,e,t);r.element=x(e);r.options=t;r._addClasses()},options:{name:"PivotContainer",configuratorPosition:"left"},setOptions:function(e){var t=this;k.deepExtend(t.options,e);this.init(this.element,this.options)},_addClasses:function(){var e=this.options;var t;this.element.removeClass("k-flex-row k-flex-row-reverse k-flex-column k-flex-column-reverse");switch(e.configuratorPosition){case"right":t="k-flex-row";break;case"left":t="k-flex-row-reverse";break;case"bottom":t="k-flex-column";break;case"top":t="k-flex-column-reverse";break;default:t="k-flex-row"}this.element.addClass("k-d-flex k-pos-relative").addClass(t)}}),Nt=a.extend({init:function(e,t){var u=this;a.fn.init.call(u,e,t);u._dataSource();u._bindConfigurator();u._wrapper();u._columnHeadersWrapper=x('<div class="k-pivotgrid-column-headers"></div>');u._rowHeadersWrapper=x('<div class="k-pivotgrid-row-headers"></div>');u._contentWrapper=x('<div class="k-pivotgrid-values"></div>');u.wrapper.append(u._columnHeadersWrapper);u.wrapper.append(u._rowHeadersWrapper);u.wrapper.append(u._contentWrapper);u._columnBuilder=new At({template:this.options.columnHeaderTemplate,axes:"columns"});u._rowBuilder=new At({template:this.options.rowHeaderTemplate,axes:"rows"});u._contentBuilder=new Mt({template:this.options.dataCellTemplate||ae});u._scrollable();u._rowHeadersWrapper.add(u._columnHeadersWrapper).on("click","span.k-icon",function(){var e=x(this);var t=e.parent().attr(k.attr("key"));var r=e.hasClass("k-i-arrow-chevron-up");var a=e.closest(".k-pivotgrid-row-headers").length!==0;var n=t.split(",");var s=r?J:Q;if(u.trigger(s,{path:n,axis:a?"rows":"columns"}))return;var i={type:"HEADERS_ACTION_TOGGLE",payload:n,tree:a?u._rowBuilder.getTree():u._columnBuilder.getTree()};var o=a?u.dataSource._rows:u.dataSource._columns;var l=L(o,i);u.dataSource._preventRefresh=true;if(a)u.dataSource.rows(l);else u.dataSource.columns(l)});if(u.options.autoBind)u.dataSource.fetch();k.notify(u)},events:[Y,K,Q,J],options:{name:"PivotGridV2",autoBind:true,height:null,columnWidth:null,configurator:"",columnHeaderTemplate:null,rowHeaderTemplate:null,dataCellTemplate:null},destroy:function(){var e=this;a.fn.destroy.call(e);if(e._windowResizeHandler){x(window).off(P+o,e._windowResizeHandler);e._windowResizeHandler=null}},_dataSource:function(){var e=this;var t=e.options.dataSource;t=Array.isArray(t)?{data:t}:t;if(e.dataSource&&this._refreshHandler)e.dataSource.unbind(h,e._refreshHandler).unbind(U,e._progressHandler).unbind(F,e._errorHandler);else{e._refreshHandler=e.refresh.bind(e);e._progressHandler=e._requestStart.bind(e);e._errorHandler=e._error.bind(e)}e.dataSource=k.data.PivotDataSourceV2.create(t).bind(h,e._refreshHandler).bind(U,e._progressHandler).bind(F,e._errorHandler)},_resize:function(){var e=this;e.wrapper[0].style.setProperty("--kendo-scrollbar-width",k.format("{0}px",_e()))},_scrollable:function(){var e=this;var t=e._columnHeadersWrapper;var r=e._rowHeadersWrapper;e._resize();e._windowResizeHandler=e._resize.bind(e);e._contentWrapper.scroll(function(){k.scrollLeft(t,this.scrollLeft);r.scrollTop(this.scrollTop)});r.bind("DOMMouseScroll"+o+" mousewheel"+o,e._wheelScroll.bind(e));x(window).on(P+o,e._windowResizeHandler)},_wheelScroll:function(e){if(e.ctrlKey)return;var t=k.wheelDeltaY(e);var r=this._contentWrapper.scrollTop();if(t){e.preventDefault();x(e.currentTarget).one("wheel"+o,false);this._rowHeadersWrapper.scrollTop(r+-t);this._contentWrapper.scrollTop(r+-t)}},_wrapper:function(){var e=this.options.height;this.wrapper=this.element.addClass("k-widget k-pivotgrid");this.wrapper.append('<span class="k-pivotgrid-empty-cell" />');if(e)this.wrapper.css("height",e)},_progress:function(e){k.ui.progress(this.wrapper,e)},_error:function(){this._progress(false)},_requestStart:function(){this._progress(true)},_updateDimensions:function(){var e=this;e.wrapper.css({"grid-template-columns":k.format("{0}px 1fr",e._rowHeadersWrapper.find(".k-pivotgrid-table")[0].offsetWidth),"grid-template-rows":k.format("{0}px 1fr",e._columnHeadersWrapper.find(".k-pivotgrid-table")[0].offsetHeight)})},_setContentWidth:function(){if(!this.options.columnWidth)return;var e=this._contentWrapper.find("table");var t=this._columnHeadersWrapper.children("table");var r=this._rowHeadersWrapper.children("table");e.add(t).add(r).find("col").width(this.options.columnWidth)},_bindConfigurator:function(){var e=this.options.configurator;if(e)x(e).kendoPivotConfiguratorV2("setDataSource",this.dataSource)},cellInfoByElement:function(e){e=x(e);return this.cellInfo(e.index(),e.parent("tr").index())},cellInfo:function(e,t){var r=this._contentBuilder;var a;var n;if(e>=r.columnsCount||e<0||t>=r.rowsCount||t<0)return null;a=t*r.columnsCount+e;n=r.hash[a<0?0:a];return{columnTuple:n.columnTuple,rowTuple:n.rowTuple,dataItem:n.data}},refresh:function(){var e=this;var t=e.dataSource;if(e.trigger(Y,{action:"rebind"}))return;e._columnBuilder.setTuples(t._columnTuples);e._columnHeadersWrapper.html(e._columnBuilder.build());e._rowBuilder.setTuples(t._rowTuples);e._rowHeadersWrapper.html(e._rowBuilder.build());e._contentBuilder.setRowColumnInfo({columnHeaderLeafs:e._columnBuilder.getHeaderLeafs(),rowHeaderLeafs:e._rowBuilder.getHeaderLeafs(),columnHeaderBreadth:e._columnBuilder.getBreadth(),rowHeaderDepth:e._rowBuilder.getBreadth(),data:t._view});e._contentWrapper.html(e._contentBuilder.build());e._setContentWidth();e._updateDimensions();e._progress(false);e.trigger(K)}}),Et=(l.plugin(bt),l.plugin(St),l.plugin(Nt),a.extend({init:function(e,t){var u=this;var c;var h;a.fn.init.call(u,e,t);u._dataSource();u._bindConfigurator();u._wrapper();u._createLayout();u._columnBuilder=c=new It;u._rowBuilder=h=new Ht;u._contentBuilder=new Dt;u._templates();u.columnsHeader.add(u.rowsHeader).on("click","span.k-icon",function(){var e=x(this);var t=c;var r="expandColumn";var a;var n=e.attr(k.attr("path"));var s={axis:"columns",path:x.parseJSON(n)};if(e.parent().is("td")){t=h;r="expandRow";s.axis="rows"}var i=e.hasClass(X);var o=t.metadata[n];var l=o.expanded===H;a=i?J:Q;s.childrenLoaded=o.maxChildren>o.children;if(u.trigger(a,s))return;t.metadata[n].expanded=!i;e.toggleClass(X,!i).toggleClass(Z,i);if(!i&&l)u.dataSource[r](s.path);else u.refresh()});u._scrollable();if(u.options.autoBind)u.dataSource.fetch();k.notify(u)},events:[Y,K,Q,J],options:{name:"PivotGrid",autoBind:true,reorderable:true,filterable:false,sortable:false,height:null,columnWidth:100,configurator:"",columnHeaderTemplate:null,rowHeaderTemplate:null,dataCellTemplate:null,kpiStatusTemplate:null,kpiTrendTemplate:null,messages:{measureFields:"Drop Data Fields Here",columnFields:"Drop Column Fields Here",rowFields:"Drop Rows Fields Here"}},_templates:function(){var e=this.options.columnHeaderTemplate;var t=this.options.rowHeaderTemplate;var r=this.options.dataCellTemplate;var a=this.options.kpiStatusTemplate;var n=this.options.kpiTrendTemplate;this._columnBuilder.template=k.template(e||ee,{useWithBlock:!!e});this._contentBuilder.dataTemplate=k.template(r||ae,{useWithBlock:!!r});this._contentBuilder.kpiStatusTemplate=k.template(a||te,{useWithBlock:!!a});this._contentBuilder.kpiTrendTemplate=k.template(n||re,{useWithBlock:!!n});this._rowBuilder.template=k.template(t||ee,{useWithBlock:!!t})},_bindConfigurator:function(){var e=this.options.configurator;if(e)x(e).kendoPivotConfigurator("setDataSource",this.dataSource)},cellInfoByElement:function(e){e=x(e);return this.cellInfo(e.index(),e.parent("tr").index())},cellInfo:function(e,t){var r=this._contentBuilder;var a=r.columnIndexes[e||0];var n=r.rowIndexes[t||0];var s;if(!a||!n)return null;s=n.index*r.rowLength+a.index;return{columnTuple:a.tuple,rowTuple:n.tuple,measure:a.measure||n.measure,dataItem:this.dataSource.view()[s]}},setDataSource:function(e){this.options.dataSource=e;this._dataSource();if(this.measuresTarget)this.measuresTarget.setDataSource(e);if(this.rowsTarget)this.rowsTarget.setDataSource(e);if(this.columnsTarget)this.columnsTarget.setDataSource(e);this._bindConfigurator();if(this.options.autoBind)e.fetch()},setOptions:function(e){a.fn.setOptions.call(this,e);this._templates()},destroy:function(){a.fn.destroy.call(this);clearTimeout(this._headerReflowTimeout)},_dataSource:function(){var e=this;var t=e.options.dataSource;t=Array.isArray(t)?{data:t}:t;if(e.dataSource&&this._refreshHandler)e.dataSource.unbind(h,e._refreshHandler).unbind(z,e._stateResetHandler).unbind(U,e._progressHandler).unbind(F,e._errorHandler);else{e._refreshHandler=e.refresh.bind(e);e._progressHandler=e._requestStart.bind(e);e._stateResetHandler=e._stateReset.bind(e);e._errorHandler=e._error.bind(e)}e.dataSource=k.data.PivotDataSource.create(t).bind(h,e._refreshHandler).bind(U,e._progressHandler).bind(z,e._stateResetHandler).bind(F,e._errorHandler)},_error:function(){this._progress(false)},_requestStart:function(){this._progress(true)},_stateReset:function(){this._columnBuilder.reset();this._rowBuilder.reset()},_wrapper:function(){var e=this.options.height;this.wrapper=this.element.addClass("k-widget k-pivot");if(e)this.wrapper.css("height",e)},_measureFields:function(){this.measureFields=x(j).addClass("k-pivot-toolbar k-toolbar k-settings-measures");this.measuresTarget=this._createSettingTarget(this.measureFields,{setting:"measures",messages:{empty:this.options.messages.measureFields}})},_createSettingTarget:function(e,t){var r;var a=t.sortable;var n="";if(a){n+="#if (data.sortIcon) {#";n+='<span class="k-chip-action"><span class="k-icon ${data.sortIcon}-sm"></span></span>';n+="#}#"}if(t.filterable||a)n+='<span class="k-setting-fieldmenu k-chip-action"><span class="k-icon k-i-more-vertical"></span></span>';if(this.options.reorderable)n+='<span class="k-setting-delete k-chip-action"><span class="k-icon k-i-close"></span></span>';r=""+'<span class="k-chip k-chip-md k-rounded-full k-chip-solid k-chip-solid-base" tabindex="0" data-'+k.ns+'name="${data.name}">'+'<span class="k-chip-content">'+'<span class="k-chip-text">${data.name}</span>'+"</span>"+'<span class="k-chip-actions k-field-actions">'+n+"</span>"+"</span>";return new k.ui.PivotSettingTarget(e,x.extend({dataSource:this.dataSource,template:r,emptyTemplate:'<span class="k-empty">${data}</span>',enabled:this.options.reorderable},t))},_initSettingTargets:function(){this.columnsTarget=this._createSettingTarget(this.columnFields,{connectWith:this.rowFields,setting:"columns",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.columnFields,fieldMenu:this.options.messages.fieldMenu}});this.rowsTarget=this._createSettingTarget(this.rowFields,{connectWith:this.columnFields,setting:"rows",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.rowFields,fieldMenu:this.options.messages.fieldMenu}})},_createLayout:function(){var e=this;var t=x(ne);var r=t.find(".k-pivot-rowheaders");var a=t.find(".k-pivot-table");var n=x(j).addClass("k-grid k-widget");e._measureFields();e.columnFields=x(j).addClass("k-pivot-toolbar k-toolbar k-settings-columns");e.rowFields=x(j).addClass("k-pivot-toolbar k-toolbar k-settings-rows");e.columnsHeader=x('<div class="k-grid-header-wrap" />').wrap('<div class="k-grid-header" />');e.columnsHeader.parent().css("padding-right",k.support.scrollbar());e.rowsHeader=x('<div class="k-grid k-widget k-alt"/>');e.content=x('<div class="k-grid-content" />');r.append(e.measureFields);r.append(e.rowFields);r.append(e.rowsHeader);n.append(e.columnsHeader.parent());n.append(e.content);a.append(e.columnFields);a.append(n);e.wrapper.append(t);e.columnsHeaderTree=new k.dom.Tree(e.columnsHeader[0]);e.rowsHeaderTree=new k.dom.Tree(e.rowsHeader[0]);e.contentTree=new k.dom.Tree(e.content[0]);e._initSettingTargets()},_progress:function(e){k.ui.progress(this.wrapper,e)},_resize:function(){if(this.content[0].firstChild){this._setSectionsWidth();this._setSectionsHeight();this._setContentWidth();this._setContentHeight();this._columnHeaderReflow()}},_columnHeaderReflow:function(){var e=this.columnsHeader.children("table");if(!k.support.browser.mozilla)return;clearTimeout(this._headerReflowTimeout);e.css("table-layout","auto");this._headerReflowTimeout=setTimeout(function(){e.css("table-layout","")})},_setSectionsWidth:function(){var e=this.rowsHeader;var t=e.parent(".k-pivot-rowheaders").width(G);var r;r=Math.max(n(this.measureFields),n(this.rowFields));r=Math.max(e.children("table").width(),r);t.width(r)},_setSectionsHeight:function(){var e=this.measureFields.height(G).height();var t=this.columnFields.height(G).height();var r=this.rowFields.height(G).innerHeight();var a=this.columnsHeader.height(G).innerHeight();var n=r-this.rowFields.height();var s=t>e?t:e;var i=a>r?a:r;this.measureFields.height(s);this.columnFields.height(s);this.rowFields.height(i-n);this.columnsHeader.height(i)},_setContentWidth:function(){var e=this.content.find("table");var t=this.columnsHeader.children("table");var r=e.children("colgroup").children().length;var a=r*this.options.columnWidth;var n=Math.ceil(a/this.content.width()*100);if(n<100)n=100;e.add(t).css("width",n+"%");this._resetColspan(t)},_setContentHeight:function(){var e=this;var t=e.content;var r=e.rowsHeader;var a=e.wrapper.innerHeight();var n=k.support.scrollbar();var s=t[0].offsetHeight===t[0].clientHeight;var i=e.options.height;if(e.wrapper.is(":visible")){if(!a||!i){if(s)n=0;t.height("auto");r.height(t.height()-n);return}a-=d(e.columnFields);a-=d(e.columnsHeader.parent());if(a<=n*2){a=n*2+1;if(!s)a+=n}t.height(a);if(s)n=0;r.height(a-n)}},_resetColspan:function(e){var t=this;var r=e.children("tbody").children().first().children().first();if(t._colspan===H)t._colspan=r.attr("colspan");r.attr("colspan",1);clearTimeout(t._layoutTimeout);t._layoutTimeout=setTimeout(function(){r.attr("colspan",t._colspan);t._colspan=H})},_axisMeasures:function(e){var t=[];var r=this.dataSource;var a=r.measures();var n=a.length>1||a[0]&&a[0].type;if(r.measuresAxis()===e)if(r[e]().length===0||n)t=a;return t},items:function(){return[]},refresh:function(){var t=this;var e=t.dataSource;var r=e.axes();var a=(r.columns||{}).tuples||[];var n=(r.rows||{}).tuples||[];var s=t._columnBuilder;var i=t._rowBuilder;var o={};var l={};if(t.trigger(Y,{action:"rebind"}))return;s.measures=t._axisMeasures(ie);i.measures=t._axisMeasures(se);t.columnsHeaderTree.render(s.build(a));t.rowsHeaderTree.render(i.build(n));o={indexes:s._indexes,measures:s.measures,metadata:s.metadata};l={indexes:i._indexes,measures:i.measures,metadata:i.metadata};t.contentTree.render(t._contentBuilder.build(e.view(),o,l));t._resize();if(t.touchScroller)t.touchScroller.contentResized();else{var u=k.touchScroller(t.content);if(u&&u.movable){t.touchScroller=u;u.movable.bind("change",function(e){k.scrollLeft(t.columnsHeader,-e.sender.x);t.rowsHeader.scrollTop(-e.sender.y)})}}t._progress(false);t.trigger(K)},_scrollable:function(){var e=this;var t=e.columnsHeader;var r=e.rowsHeader;e.content.on("scroll",function(){k.scrollLeft(t,this.scrollLeft);r.scrollTop(this.scrollTop)});r.on("DOMMouseScroll"+o+" mousewheel"+o,e._wheelScroll.bind(e))},_wheelScroll:function(e){if(e.ctrlKey)return;var t=k.wheelDeltaY(e);var r=this.content.scrollTop();if(t){e.preventDefault();x(e.currentTarget).one("wheel"+o,false);this.rowsHeader.scrollTop(r+-t);this.content.scrollTop(r+-t)}}})),y=k.dom.element,kt=k.dom.html,yt=function(e,t){return{maxChildren:0,children:0,maxMembers:0,members:0,measures:1,levelNum:e,parentMember:t!==0}},Ct=function(e,t){var r=[];var a=0;for(;a<=t;a++)r.push(e.members[a].name);return r},Tt=function(e,t){var r="";var a=0;for(;a<=t;a++)r+=e.members[a].name;return r},Mt=r.extend({init:function(e){this.template=k.template(e.template);this.hash=[]},setRowColumnInfo:function(e){this.data=e.data;this.columnHeaderLeafs=e.columnHeaderLeafs;this.rowHeaderLeafs=e.rowHeaderLeafs;this.columnHeaderBreadth=e.columnHeaderBreadth;this.rowHeaderDepth=e.rowHeaderDepth;this.hash.length=0},addColElements:function(e){var t="";for(var r=0;r<e;r++)t+="<col>";this.table.find("colgroup").append(t)},addRowElements:function(e){var t=this;var r=t.table.find("tbody");var a;for(var n=0;n<e.length;n++){a=x('<tr class="k-pivotgrid-row"></tr>');r.append(a);t.addColumCell(a,e[n],n)}this.rowsCount=e.length},addColumCell:function(e,t,r){var a=this;for(var n=0;n<t.cells.length;n++){var s=t.cells[n];if(s){var i=x('<td class="k-pivotgrid-cell"></td>');if(this.rowHeaderLeafs[r].total||this.columnHeaderLeafs[n].total)i.addClass("k-pivotgrid-header-total");i.append(a.template({dataItem:s.data,rowTuple:s.rowTuple,columnTuple:s.columnTuple}));this.hash.push(s);e.append(i)}}},build:function(){var e=R((this.data||[]).slice(),this.columnHeaderLeafs,this.rowHeaderLeafs,this.columnHeaderBreadth,this.rowHeaderDepth);var t=this;var r=x("<table class='k-pivotgrid-table'><colgroup></colgroup><tbody class='k-pivotgrid-tbody'></tbody></table>");t.table=r;t.addColElements(this.columnHeaderLeafs.length);t.addRowElements(e);this.rowsCount=e.length;this.columnsCount=this.columnHeaderLeafs.length;return t.table}}),At=r.extend({init:function(e){this.tuples=e.tuples;this.axes=e.axes;this.headerTemplate=k.template($);if(e.template)this.template=k.template(e.template)},setTuples:function(e){this.tuples=e},addColElements:function(e){var t="";for(var r=0;r<e;r++)t+="<col>";this.table.find("colgroup").append(t)},addRowElements:function(e){var t=this;var r=t.table.find("tbody");var a;for(var n=0;n<e.length;n++){a=x('<tr class="k-pivotgrid-row"></tr>');r.append(a);t.addColumCell(a,e[n])}},addColumCell:function(e,t){var r=this;var a;var n;for(var s=0;s<t.cells.length;s++){n=t.cells[s];if(n){a=x(r.headerTemplate({rowspan:n.rowSpan,colspan:n.colSpan,key:n.path.join(",")+(n.total?"|[TOTAL]":""),iconClass:n.children&&n.children.length?"up":"down",expandable:n.hasChildren&&!n.total,headerClass:k.format("k-pivotgrid-cell{0}{1}",n.total?" k-pivotgrid-header-total":"",n.levelNum===0?" k-pivotgrid-header-root":"")}));a.append(r.template?r.template({member:n}):n.caption);e.append(a)}}},build:function(){var e=D((this.tuples||[]).slice());var t=this.axes=="columns"?A(e):I(e);var r=t[0];var a=t[1];var n=t[2];var s=t[3];var i=this;i._tree=e;i._breadth=n;i._headerLeafs=a;var o=x("<table class='k-pivotgrid-table'><colgroup></colgroup><tbody class='k-pivotgrid-tbody'></tbody></table>");i.table=o;i.addColElements(this.axes=="columns"?a.length:s);i.addRowElements(r);return i.table},getTree:function(){return this._tree},getBreadth:function(){return this._breadth},getHeaderLeafs:function(){return this._headerLeafs}}),It=r.extend({init:function(){this.measures=1;this.metadata={}},build:function(e){var t=this._tbody(e);var r=this._colGroup();return[y("table",null,[r,t])]},reset:function(){this.metadata={}},_colGroup:function(){var e=this._rowLength();var t=[];var r=0;for(;r<e;r++)t.push(y("col",null));return y("colgroup",null,t)},_tbody:function(e){var t=e[0];this.map={};this.rows=[];this.rootTuple=t;this._indexes=[];if(t){this._buildRows(t,0);this._normalize()}else this.rows.push(y("tr",null,[y("th",null,[kt("&nbsp;")])]));return y("tbody",null,this.rows)},_normalize:function(){var e=this.rows;var t=e.length;var r=0;var a;var n;var s;var i;var o;for(;r<t;r++){a=e[r];if(a.rowSpan===1)continue;i=a.children;s=0;n=i.length;for(;s<n;s++){o=i[s];if(o.tupleAll)o.attr.rowSpan=a.rowSpan}}},_rowIndex:function(e){var t=this.rows;var r=t.length;var a=0;for(;a<r;a++)if(t[a]===e)break;return a},_rowLength:function(){var e=this.rows[0]?this.rows[0].children:[];var t=e.length;var r=0;var a=0;if(t)for(;a<t;a++)r+=e[a].attr.colSpan||1;if(!r)r=this.measures;return r},_row:function(e,t,r){var a=this.rootTuple.members[t].name;var n=e.members[t].levelNum;var s=a+n;var i=this.map;var o;var l;var u=i[s];if(!u){u=y("tr",null,[]);u.parentMember=r;u.collapsed=0;u.colSpan=0;u.rowSpan=1;i[s]=u;o=i[a+(Number(n)-1)];if(o){l=o.children;if(l[1]&&l[1].attr.className.indexOf("k-alt")===-1)u.notFirst=true;else u.notFirst=o.notFirst}this.rows.splice(this._rowIndex(o)+1,0,u)}else{u.notFirst=false;if(!u.parentMember||u.parentMember!==r){u.parentMember=r;u.collapsed=0;u.colSpan=0}}return u},_measures:function(e,t,r){var a=this.map;var n=a.measureRow;var s;if(!n){n=y("tr",null,[]);a.measureRow=n;this.rows.push(n)}for(var i=0,o=e.length;i<o;i++){s=e[i];n.children.push(this._cell(r||"",[this._content(s,t)],s))}return o},_content:function(e,t){return kt(this.template({member:e,tuple:t}))},_cell:function(e,t,r){var a=y("th",{className:"k-header"+e},t);a.value=r.caption||r.name;return a},_buildRows:function(e,t,c){var h=e.members;var r=h[t];var a=h[t+1];var n,s,i,o;var d,m,p;var f=[];var v;var g=0;var l;var u;var _=0;var x=0;if(r.measure){this._measures(r.children,e);return}v=k.stringify(Ct(e,t));n=this._row(e,t,c);i=r.children;o=i.length;l=this.metadata[v];if(!l){this.metadata[v]=l=yt(Number(r.levelNum),t);l.rootLevelNum=Number(this.rootTuple.members[t].levelNum)}this._indexes.push({path:v,tuple:e});if(r.hasChildren){if(l.expanded===false){_=l.maxChildren;n.collapsed+=_;l.children=0;o=0}p={className:"k-icon "+(o?X:Z)};p[k.attr("path")]=v;f.push(y("span",p))}f.push(this._content(r,e));d=this._cell(n.notFirst?" k-first":"",f,r);n.children.push(d);n.colSpan+=1;if(o){m=this._cell(" k-alt",[this._content(r,e)],r);n.children.push(m);for(;g<o;g++)s=this._buildRows(i[g],t,r);u=s.colSpan;_=s.collapsed;d.attr.colSpan=u;l.children=u;l.members=1;n.colSpan+=u;n.collapsed+=_;n.rowSpan=s.rowSpan+1;if(a){if(a.measure)u=this._measures(a.children,e," k-alt");else{s=this._buildRows(e,t+1);u=s.colSpan;n.collapsed+=s.collapsed;x=s.collapsed}m.attr.colSpan=u;u-=1;l.members+=u;n.colSpan+=u}}else if(a){if(a.measure)u=this._measures(a.children,e);else{s=this._buildRows(e,t+1);u=s.colSpan;n.collapsed+=s.collapsed;x=s.collapsed}l.members=u;if(u>1){d.attr.colSpan=u;n.colSpan+=u-1}}if(l.maxMembers<l.members+x)l.maxMembers=l.members+x;i=l.children+_;if(l.maxChildren<i)l.maxChildren=i;(m||d).tupleAll=true;return n}}),Ht=r.extend({init:function(){this.metadata={}},build:function(e){var t=this._tbody(e);var r=this._colGroup();return[y("table",null,[r,t])]},reset:function(){this.metadata={}},_rowLength:function(){var e=this.rows[0].children;var t=0;var r=0;var a=e[r];while(a){t+=a.attr.colSpan||1;a=e[++r]}return t},_colGroup:function(){var e=this._rowLength();var t=[];var r=0;for(;r<e;r++)t.push(y("col",null));return y("colgroup",null,t)},_tbody:function(e){var t=e[0];this.rootTuple=t;this.rows=[];this.map={};this._indexes=[];if(t){this._buildRows(t,0);this._normalize()}else this.rows.push(y("tr",null,[y("td",null,[kt("&nbsp;")])]));return y("tbody",null,this.rows)},_normalize:function(){var e=this.rows;var c=e.length;var t=0;var r=this.rootTuple.members;var a=r[0].name;var h=r.length;var n=0;var s;var i;var o;var l=this.map;var u;for(;t<c;t++){s=e[t];for(n=0;n<h;n++){o=this[r[n].name];i=s.colSpan["dim"+n];if(i&&i.colSpan<o)i.attr.colSpan=o-i.colSpan+1}}s=l[a];u=l[a+"all"];if(s)s.children[0].attr.className="k-first";if(u)u.children[0].attr.className+=" k-first"},_row:function(e){var t=y("tr",null,e);t.rowSpan=1;t.colSpan={};this.rows.push(t);return t},_content:function(e,t){return kt(this.template({member:e,tuple:t}))},_cell:function(e,t,r){var a=y("td",{className:e},t);a.value=r.caption||r.name;return a},_buildRows:function(e,t){var c=this.map;var h;var d=e.members;var r=d[t];var m=d[t+1];var a=r.children;var n=a.length;var p=Number(r.levelNum);var f=this.rootTuple.members[t].name;var v=Ct(e,t-1).join("");var g=Number(this.rootTuple.members[t].levelNum);var _=v+(g===p?"":r.parentName||"");var s=c[_+"all"]||c[_];var x=p+1;var i,o;var w,b;var l;var S;var N=[];var E;var u;if(!s||s.hasChild)s=this._row();else s.hasChild=true;if(r.measure){S=s.allCell?"k-grid-footer":"";s.children.push(this._cell(S,[this._content(a[0],e)],a[0]));s.rowSpan=n;for(u=1;u<n;u++)this._row([this._cell(S,[this._content(a[u],e)],a[u])]);return s}c[v+r.name]=s;h=k.stringify(Ct(e,t));l=this.metadata[h];if(!l){this.metadata[h]=l=yt(p,t);l.rootLevelNum=g}this._indexes.push({path:h,tuple:e});if(r.hasChildren){if(l.expanded===false){n=0;l.children=0}E={className:"k-icon "+(n?X:Z)};E[k.attr("path")]=h;N.push(y("span",E))}N.push(this._content(r,e));S=s.allCell&&!n?"k-grid-footer":"";i=this._cell(S,N,r);i.colSpan=x;s.children.push(i);s.colSpan["dim"+t]=i;if(!this[f]||this[f]<x)this[f]=x;if(n){s.allCell=false;s.hasChild=false;for(u=0;u<n;u++){w=this._buildRows(a[u],t);if(s!==w)s.rowSpan+=w.rowSpan}if(s.rowSpan>1)i.attr.rowSpan=s.rowSpan;l.children=s.rowSpan;o=this._cell("k-grid-footer",[this._content(r,e)],r);o.colSpan=x;b=this._row([o]);b.colSpan["dim"+t]=o;b.allCell=true;c[v+r.name+"all"]=b;if(m){w=this._buildRows(e,t+1);o.attr.rowSpan=w.rowSpan}s.rowSpan+=b.rowSpan;l.members=b.rowSpan}else if(m){s.hasChild=false;this._buildRows(e,t+1);(o||i).attr.rowSpan=s.rowSpan;l.members=s.rowSpan}if(l.maxChildren<l.children)l.maxChildren=l.children;if(l.maxMembers<l.members)l.maxMembers=l.members;return s}}),Dt=r.extend({init:function(){this.columnAxis={};this.rowAxis={}},build:function(e,t,r){var a=t.indexes[0];var n=t.metadata[a?a.path:H];this.columnAxis=t;this.rowAxis=r;this.data=e;this.rowLength=n?n.maxChildren+n.maxMembers:t.measures.length||1;if(!this.rowLength)this.rowLength=1;var s=this._tbody();var i=this._colGroup();return[y("table",null,[i,s])]},_colGroup:function(){var e=this.columnAxis.measures.length||1;var t=[];var r=0;if(this.rows[0])e=this.rows[0].children.length;for(;r<e;r++)t.push(y("col",null));return y("colgroup",null,t)},_tbody:function(){this.rows=[];if(this.data[0]){this.columnIndexes=this._indexes(this.columnAxis,this.rowLength);this.rowIndexes=this._indexes(this.rowAxis,Math.ceil(this.data.length/this.rowLength));this._buildRows()}else this.rows.push(y("tr",null,[y("td",null,[kt("&nbsp;")])]));return y("tbody",null,this.rows)},_indexes:function(e,c){var t=[];var r;var h=e.indexes;var d=e.metadata;var a=e.measures;var n=a.length||1;var s;var i=0;var o=0;var m=0;var p=h.length;var l;var f;var u;var v;if(!p){for(l=0;l<n;l++)t[l]={index:l,measure:a[l],tuple:null};return t}for(;m<p;m++){r=h[m];s=d[r.path];u=s.children+s.members;v=0;if(u)u-=n;if(s.expanded===false&&s.children!==s.maxChildren)v=s.maxChildren;if(s.parentMember&&s.levelNum===s.rootLevelNum)u=-1;if(u>-1){for(l=0;l<n;l++){f=u+l;if(!s.children)f+=o;t[u+o+l]={children:u,index:i,measure:a[l],tuple:r.tuple};i+=1}while(t[o]!==H)o+=1}if(o===c)break;i+=v}return t},_buildRows:function(){var e=this.rowIndexes;var t=e.length;var r=0;for(;r<t;r++){var a=e[r];if(a)this.rows.push(this._buildRow(a))}},_buildRow:function(e){var c=e.index*this.rowLength;var t=this.columnIndexes;var h=t.length;var r;var d=[];var a=0;var n;var s,i;var o,l,u;for(;a<h;a++){r=t[a];if(r===H)continue;o={};if(r.children)o.className="k-alt";i="";l=this.data[c+r.index];u=r.measure||e.measure;n={columnTuple:r.tuple,rowTuple:e.tuple,measure:u,dataItem:l};if(l.value!==""&&u&&u.type)if(u.type==="status")i=this.kpiStatusTemplate(n);else if(u.type==="trend")i=this.kpiTrendTemplate(n);if(!i)i=this.dataTemplate(n);s=y("td",o,[kt(i)]);s.value=l.value;d.push(s)}o={};if(e.children)o.className="k-grid-footer";return y("tr",o,d)}}),Rt=(l.plugin(Et),k.PivotExcelExporter=k.Class.extend({init:function(e){this.options=e;this.widget=e.widget;this.dataSource=this.widget.dataSource},_columns:function(){var e=this.widget.columnsHeaderTree.children[0];var t=this.widget.rowsHeaderTree.children[0];var r=e.children[0].children.length;var a=t.children[0].children.length;var n=this.widget.options.columnWidth;var s=[];var i;if(a&&this.dataSource.data()[0])for(i=0;i<a;i++)s.push({autoWidth:true});for(i=0;i<r;i++)s.push({autoWidth:false,width:n});return s},_cells:function(e,t,r){var a=[];var n=0;var c=e.length;var s;var i,o;var l,u;for(;n<c;n++){i=[];o=e[n].children;s=o.length;for(l=0;l<s;l++){u=o[l];i.push({background:"#7a7a7a",color:"#fff",value:u.value,colSpan:u.attr.colSpan||1,rowSpan:u.attr.rowSpan||1})}if(r)r(i,n);a.push({cells:i,type:t})}return a},_rows:function(){var e=this.widget.columnsHeaderTree.children[0];var t=this.widget.rowsHeaderTree.children[0];var i=e.children[0].children.length;var r=t.children[0].children.length;var a=e.children[1].children;var n=t.children[1].children;var o=this.widget.contentTree.children[0].children[1].children;var s=this._cells(a,"header");if(r)s[0].cells.splice(0,0,{background:"#7a7a7a",color:"#fff",value:"",colSpan:r,rowSpan:a.length});var l=function(e,t){var r=0;var a,n;var s=o[t].children;for(;r<i;r++){a=s[r];n=Number(a.value);if(isNaN(n))n=a.value;e.push({background:"#dfdfdf",color:"#333",value:n,colSpan:1,rowSpan:1})}};var u=this._cells(n,"data",l);return s.concat(u)},_freezePane:function(){var e=this.widget.columnsHeaderTree.children[0];var t=this.widget.rowsHeaderTree.children[0];var r=t.children[0].children.length;var a=e.children[1].children;return{colSplit:r,rowSplit:a.length}},workbook:function(){var e,t=function(){return{sheets:[{columns:this._columns(),rows:this._rows(),freezePane:this._freezePane(),filter:null}]}};if(this.dataSource.view()[0]){e=x.Deferred();e.resolve()}else e=this.dataSource.fetch();return e.then(t.bind(this))}}),{extend:function(e){e.events.push("excelExport");e.options.excel=x.extend(e.options.excel,this.options);e.saveAsExcel=this.saveAsExcel},options:{proxyURL:"",filterable:false,fileName:"Export.xlsx"},saveAsExcel:function(){var r=this.options.excel||{};var e=new k.PivotExcelExporter({widget:this});var t=function(t){if(!this.trigger("excelExport",{workbook:t})){var e=new k.ooxml.Workbook(t);e.toDataURLAsync().then(function(e){k.saveAs({dataURI:e,fileName:t.fileName||r.fileName,proxyURL:r.proxyURL,forceProxy:r.forceProxy})})}};e.workbook().then(t.bind(this))}});if(k.PivotExcelMixin=Rt,k.ooxml&&k.ooxml.Workbook)Rt.extend(Et.prototype);if(k.PDFMixin){k.PDFMixin.extend(Et.prototype);Et.fn._drawPDF=function(){return this._drawPDFShadow({width:this.wrapper.width()},{avoidLinks:this.options.pdf.avoidLinks})}}if(k.PDFMixin){k.PDFMixin.extend(Nt.prototype);Nt.fn._drawPDF=function(){return this._drawPDFShadow({width:this.wrapper.width()},{avoidLinks:this.options.pdf.avoidLinks})}}return window.kendo})}("function"==typeof define&&define.amd?define:function(e,t,r){(r||t)()});
//# sourceMappingURL=kendo.pivotgrid.min.js.map
