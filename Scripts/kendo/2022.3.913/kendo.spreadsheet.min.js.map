{"version":3,"file":"kendo.spreadsheet.min.js","sources":["kendo.spreadsheet.js"],"sourcesContent":["(function(f, define){\n    define('util/undoredostack',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo) {\n    var UndoRedoStack = kendo.Observable.extend({\n        init: function(options) {\n            kendo.Observable.fn.init.call(this, options);\n            this.clear();\n        },\n        events: [ \"undo\", \"redo\" ],\n        push: function (command) {\n            this.stack = this.stack.slice(0, this.currentCommandIndex + 1);\n            this.currentCommandIndex = this.stack.push(command) - 1;\n        },\n        undo: function () {\n            if (this.canUndo()) {\n                var command = this.stack[this.currentCommandIndex--];\n                command.undo();\n                this.trigger(\"undo\", { command: command });\n            }\n        },\n        redo: function () {\n            if (this.canRedo()) {\n                var command = this.stack[++this.currentCommandIndex];\n                command.redo();\n                this.trigger(\"redo\", { command: command });\n            }\n        },\n        clear: function() {\n            this.stack = [];\n            this.currentCommandIndex = -1;\n        },\n        canUndo: function () {\n            return this.currentCommandIndex >= 0;\n        },\n        canRedo: function () {\n            return this.currentCommandIndex != this.stack.length - 1;\n        }\n    });\n\n    kendo.deepExtend(kendo, {\n        util: {\n            UndoRedoStack: UndoRedoStack\n        }\n    });\n})(kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n/***********************************************************************\n * WARNING: this file is auto-generated.  If you change it directly,\n * your modifications will eventually be lost.  The source code is in\n * `kendo-drawing` repository, you should make your changes there and\n * run `src-modules/sync.sh` in this repository.\n */\n(function(f, define) {\n    define('util/text-metrics',[\n        \"kendo.core\"\n    ], f);\n})(function() {\n\n(function($) {\n/* eslint-disable space-before-blocks, space-before-function-paren */\n\nwindow.kendo.util = window.kendo.util || {};\n\nvar LRUCache = kendo.Class.extend({\n    init: function(size) {\n\n        this._size = size;\n        this._length = 0;\n        this._map = {};\n    },\n\n    put: function(key, value) {\n        var map = this._map;\n        var entry = { key: key, value: value };\n\n        map[key] = entry;\n\n        if (!this._head) {\n            this._head = this._tail = entry;\n        } else {\n            this._tail.newer = entry;\n            entry.older = this._tail;\n            this._tail = entry;\n        }\n\n        if (this._length >= this._size) {\n            map[this._head.key] = null;\n            this._head = this._head.newer;\n            this._head.older = null;\n        } else {\n            this._length++;\n        }\n    },\n\n    get: function(key) {\n        var entry = this._map[key];\n\n        if (entry) {\n            if (entry === this._head && entry !== this._tail) {\n                this._head = entry.newer;\n                this._head.older = null;\n            }\n\n            if (entry !== this._tail) {\n                if (entry.older) {\n                    entry.older.newer = entry.newer;\n                    entry.newer.older = entry.older;\n                }\n\n                entry.older = this._tail;\n                entry.newer = null;\n\n                this._tail.newer = entry;\n                this._tail = entry;\n            }\n\n            return entry.value;\n        }\n    }\n});\n\nvar REPLACE_REGEX = /\\r?\\n|\\r|\\t/g;\nvar SPACE = ' ';\n\nfunction normalizeText(text) {\n    return String(text).replace(REPLACE_REGEX, SPACE);\n}\n\nfunction objectKey(object) {\n    var parts = [];\n    for (var key in object) {\n        parts.push(key + object[key]);\n    }\n\n    return parts.sort().join(\"\");\n}\n\n// Computes FNV-1 hash\n// See http://en.wikipedia.org/wiki/Fowler%E2%80%93Noll%E2%80%93Vo_hash_function\nfunction hashKey(str) {\n    // 32-bit FNV-1 offset basis\n    // See http://isthe.com/chongo/tech/comp/fnv/#FNV-param\n    var hash = 0x811C9DC5;\n\n    for (var i = 0; i < str.length; ++i) {\n        hash += (hash << 1) + (hash << 4) + (hash << 7) + (hash << 8) + (hash << 24);\n        hash ^= str.charCodeAt(i);\n    }\n\n    return hash >>> 0;\n}\n\nfunction zeroSize() {\n    return { width: 0, height: 0, baseline: 0 };\n}\n\nvar DEFAULT_OPTIONS = {\n    baselineMarkerSize: 1\n};\n\nvar defaultMeasureBox;\n\nif (typeof document !== \"undefined\") {\n    defaultMeasureBox = document.createElement(\"div\");\n    defaultMeasureBox.style.cssText = \"position: absolute !important; top: -4000px !important; width: auto !important; height: auto !important;\" +\n              \"padding: 0 !important; margin: 0 !important; border: 0 !important;\" +\n              \"line-height: normal !important; visibility: hidden !important; white-space: pre!important;\";\n}\n\nvar TextMetrics = kendo.Class.extend({\n    init: function(options) {\n\n        this._cache = new LRUCache(1000);\n        this.options = $.extend({}, DEFAULT_OPTIONS, options);\n    },\n\n    measure: function(text, style, options) {\n        if (options === void 0) { options = {}; }\n\n        if (typeof text === 'undefined' || text === null) {\n            return zeroSize();\n        }\n\n        var styleKey = objectKey(style);\n        var cacheKey = hashKey(text + styleKey);\n        var cachedResult = this._cache.get(cacheKey);\n\n        if (cachedResult) {\n            return cachedResult;\n        }\n\n        var size = zeroSize();\n        var measureBox = options.box || defaultMeasureBox;\n        var baselineMarker = this._baselineMarker().cloneNode(false);\n\n        for (var key in style) {\n            var value = style[key];\n            if (typeof value !== \"undefined\") {\n                measureBox.style[key] = value;\n            }\n        }\n\n        var textStr = options.normalizeText !== false ? normalizeText(text) : String(text);\n\n        measureBox.textContent = textStr;\n        measureBox.appendChild(baselineMarker);\n        document.body.appendChild(measureBox);\n\n        if (textStr.length) {\n            size.width = measureBox.offsetWidth - this.options.baselineMarkerSize;\n            size.height = measureBox.offsetHeight;\n            size.baseline = baselineMarker.offsetTop + this.options.baselineMarkerSize;\n        }\n\n        if (size.width > 0 && size.height > 0) {\n            this._cache.put(cacheKey, size);\n        }\n\n        measureBox.parentNode.removeChild(measureBox);\n\n        return size;\n    },\n\n    _baselineMarker: function() {\n        var marker = document.createElement(\"div\");\n        marker.style.cssText = \"display: inline-block; vertical-align: baseline;width: \" +\n            this.options.baselineMarkerSize + \"px; height: \" + this.options.baselineMarkerSize + \"px;overflow: hidden;\";\n\n        return marker;\n    }\n});\n\nTextMetrics.current = new TextMetrics();\n\nfunction measureText(text, style, measureBox) {\n    return TextMetrics.current.measure(text, style, measureBox);\n}\n\nkendo.deepExtend(kendo.util, {\n    LRUCache: LRUCache,\n    TextMetrics: TextMetrics,\n    measureText: measureText,\n    objectKey: objectKey,\n    hashKey: hashKey,\n    normalizeText: normalizeText\n});\n\n})(window.kendo.jQuery);\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n(function(f, define) {\r\n    define('util/main',[\r\n        \"kendo.core\"\r\n    ], f);\r\n})(function() {\r\n\r\n(function () {\r\n    // Imports ================================================================\r\n    var kendo = window.kendo,\r\n        deepExtend = kendo.deepExtend;\r\n\r\n    function sqr(value) {\r\n        return value * value;\r\n    }\r\n\r\n    var now = Date.now;\r\n    if (!now) {\r\n        now = function() {\r\n            return new Date().getTime();\r\n        };\r\n    }\r\n\r\n    // Template helpers =======================================================\r\n\r\n    function renderSize(size) {\r\n        if (typeof size !== \"string\") {\r\n            size += \"px\";\r\n        }\r\n\r\n        return size;\r\n    }\r\n\r\n    function renderPos(pos) {\r\n        var result = [];\r\n\r\n        if (pos) {\r\n            var parts = kendo.toHyphens(pos).split(\"-\");\r\n\r\n            for (var i = 0; i < parts.length; i++) {\r\n                result.push(\"k-pos-\" + parts[i]);\r\n            }\r\n        }\r\n\r\n        return result.join(\" \");\r\n    }\r\n\r\n    function arabicToRoman(n) {\r\n        var literals = {\r\n            1    : \"i\",       10   : \"x\",       100  : \"c\",\r\n            2    : \"ii\",      20   : \"xx\",      200  : \"cc\",\r\n            3    : \"iii\",     30   : \"xxx\",     300  : \"ccc\",\r\n            4    : \"iv\",      40   : \"xl\",      400  : \"cd\",\r\n            5    : \"v\",       50   : \"l\",       500  : \"d\",\r\n            6    : \"vi\",      60   : \"lx\",      600  : \"dc\",\r\n            7    : \"vii\",     70   : \"lxx\",     700  : \"dcc\",\r\n            8    : \"viii\",    80   : \"lxxx\",    800  : \"dccc\",\r\n            9    : \"ix\",      90   : \"xc\",      900  : \"cm\",\r\n            1000 : \"m\"\r\n        };\r\n        var values = [ 1000,\r\n                       900 , 800, 700, 600, 500, 400, 300, 200, 100,\r\n                       90  , 80 , 70 , 60 , 50 , 40 , 30 , 20 , 10 ,\r\n                       9   , 8  , 7  , 6  , 5  , 4  , 3  , 2  , 1 ];\r\n        var roman = \"\";\r\n        while (n > 0) {\r\n            if (n < values[0]) {\r\n                values.shift();\r\n            } else {\r\n                roman += literals[values[0]];\r\n                n -= values[0];\r\n            }\r\n        }\r\n        return roman;\r\n    }\r\n\r\n    function romanToArabic(r) {\r\n        r = r.toLowerCase();\r\n        var digits = {\r\n            i: 1,\r\n            v: 5,\r\n            x: 10,\r\n            l: 50,\r\n            c: 100,\r\n            d: 500,\r\n            m: 1000\r\n        };\r\n        var value = 0, prev = 0;\r\n        for (var i = 0; i < r.length; ++i) {\r\n            var v = digits[r.charAt(i)];\r\n            if (!v) {\r\n                return null;\r\n            }\r\n            value += v;\r\n            if (v > prev) {\r\n                value -= 2 * prev;\r\n            }\r\n            prev = v;\r\n        }\r\n        return value;\r\n    }\r\n\r\n    function memoize(f) {\r\n        var cache = Object.create(null);\r\n        return function() {\r\n            var id = \"\";\r\n            for (var i = arguments.length; --i >= 0;) {\r\n                id += \":\" + arguments[i];\r\n            }\r\n            return id in cache ? cache[id] : (cache[id] = f.apply(this, arguments));\r\n        };\r\n    }\r\n\r\n    function isUnicodeLetter(ch) {\r\n        return RX_UNICODE_LETTER.test(ch);\r\n    }\r\n\r\n    function withExit(f, obj) {\r\n        try {\r\n            return f.call(obj, function(value){\r\n                throw new Return(value);\r\n            });\r\n        } catch(ex) {\r\n            if (ex instanceof Return) {\r\n                return ex.value;\r\n            }\r\n            throw ex;\r\n        }\r\n        function Return(value) {\r\n            this.value = value;\r\n        }\r\n    }\r\n\r\n    // Exports ================================================================\r\n    deepExtend(kendo, {\r\n        util: {\r\n            now: now,\r\n            renderPos: renderPos,\r\n            renderSize: renderSize,\r\n            sqr: sqr,\r\n            romanToArabic: romanToArabic,\r\n            arabicToRoman: arabicToRoman,\r\n            memoize: memoize,\r\n            isUnicodeLetter: isUnicodeLetter,\r\n            withExit: withExit\r\n        }\r\n    });\r\n\r\n    var RX_UNICODE_LETTER = new RegExp(\"[\\\\u0041-\\\\u005A\\\\u0061-\\\\u007A\\\\u00AA\\\\u00B5\\\\u00BA\\\\u00C0-\\\\u00D6\\\\u00D8-\\\\u00F6\\\\u00F8-\\\\u02C1\\\\u02C6-\\\\u02D1\\\\u02E0-\\\\u02E4\\\\u02EC\\\\u02EE\\\\u0370-\\\\u0374\\\\u0376\\\\u0377\\\\u037A-\\\\u037D\\\\u037F\\\\u0386\\\\u0388-\\\\u038A\\\\u038C\\\\u038E-\\\\u03A1\\\\u03A3-\\\\u03F5\\\\u03F7-\\\\u0481\\\\u048A-\\\\u052F\\\\u0531-\\\\u0556\\\\u0559\\\\u0561-\\\\u0587\\\\u05D0-\\\\u05EA\\\\u05F0-\\\\u05F2\\\\u0620-\\\\u064A\\\\u066E\\\\u066F\\\\u0671-\\\\u06D3\\\\u06D5\\\\u06E5\\\\u06E6\\\\u06EE\\\\u06EF\\\\u06FA-\\\\u06FC\\\\u06FF\\\\u0710\\\\u0712-\\\\u072F\\\\u074D-\\\\u07A5\\\\u07B1\\\\u07CA-\\\\u07EA\\\\u07F4\\\\u07F5\\\\u07FA\\\\u0800-\\\\u0815\\\\u081A\\\\u0824\\\\u0828\\\\u0840-\\\\u0858\\\\u08A0-\\\\u08B2\\\\u0904-\\\\u0939\\\\u093D\\\\u0950\\\\u0958-\\\\u0961\\\\u0971-\\\\u0980\\\\u0985-\\\\u098C\\\\u098F\\\\u0990\\\\u0993-\\\\u09A8\\\\u09AA-\\\\u09B0\\\\u09B2\\\\u09B6-\\\\u09B9\\\\u09BD\\\\u09CE\\\\u09DC\\\\u09DD\\\\u09DF-\\\\u09E1\\\\u09F0\\\\u09F1\\\\u0A05-\\\\u0A0A\\\\u0A0F\\\\u0A10\\\\u0A13-\\\\u0A28\\\\u0A2A-\\\\u0A30\\\\u0A32\\\\u0A33\\\\u0A35\\\\u0A36\\\\u0A38\\\\u0A39\\\\u0A59-\\\\u0A5C\\\\u0A5E\\\\u0A72-\\\\u0A74\\\\u0A85-\\\\u0A8D\\\\u0A8F-\\\\u0A91\\\\u0A93-\\\\u0AA8\\\\u0AAA-\\\\u0AB0\\\\u0AB2\\\\u0AB3\\\\u0AB5-\\\\u0AB9\\\\u0ABD\\\\u0AD0\\\\u0AE0\\\\u0AE1\\\\u0B05-\\\\u0B0C\\\\u0B0F\\\\u0B10\\\\u0B13-\\\\u0B28\\\\u0B2A-\\\\u0B30\\\\u0B32\\\\u0B33\\\\u0B35-\\\\u0B39\\\\u0B3D\\\\u0B5C\\\\u0B5D\\\\u0B5F-\\\\u0B61\\\\u0B71\\\\u0B83\\\\u0B85-\\\\u0B8A\\\\u0B8E-\\\\u0B90\\\\u0B92-\\\\u0B95\\\\u0B99\\\\u0B9A\\\\u0B9C\\\\u0B9E\\\\u0B9F\\\\u0BA3\\\\u0BA4\\\\u0BA8-\\\\u0BAA\\\\u0BAE-\\\\u0BB9\\\\u0BD0\\\\u0C05-\\\\u0C0C\\\\u0C0E-\\\\u0C10\\\\u0C12-\\\\u0C28\\\\u0C2A-\\\\u0C39\\\\u0C3D\\\\u0C58\\\\u0C59\\\\u0C60\\\\u0C61\\\\u0C85-\\\\u0C8C\\\\u0C8E-\\\\u0C90\\\\u0C92-\\\\u0CA8\\\\u0CAA-\\\\u0CB3\\\\u0CB5-\\\\u0CB9\\\\u0CBD\\\\u0CDE\\\\u0CE0\\\\u0CE1\\\\u0CF1\\\\u0CF2\\\\u0D05-\\\\u0D0C\\\\u0D0E-\\\\u0D10\\\\u0D12-\\\\u0D3A\\\\u0D3D\\\\u0D4E\\\\u0D60\\\\u0D61\\\\u0D7A-\\\\u0D7F\\\\u0D85-\\\\u0D96\\\\u0D9A-\\\\u0DB1\\\\u0DB3-\\\\u0DBB\\\\u0DBD\\\\u0DC0-\\\\u0DC6\\\\u0E01-\\\\u0E30\\\\u0E32\\\\u0E33\\\\u0E40-\\\\u0E46\\\\u0E81\\\\u0E82\\\\u0E84\\\\u0E87\\\\u0E88\\\\u0E8A\\\\u0E8D\\\\u0E94-\\\\u0E97\\\\u0E99-\\\\u0E9F\\\\u0EA1-\\\\u0EA3\\\\u0EA5\\\\u0EA7\\\\u0EAA\\\\u0EAB\\\\u0EAD-\\\\u0EB0\\\\u0EB2\\\\u0EB3\\\\u0EBD\\\\u0EC0-\\\\u0EC4\\\\u0EC6\\\\u0EDC-\\\\u0EDF\\\\u0F00\\\\u0F40-\\\\u0F47\\\\u0F49-\\\\u0F6C\\\\u0F88-\\\\u0F8C\\\\u1000-\\\\u102A\\\\u103F\\\\u1050-\\\\u1055\\\\u105A-\\\\u105D\\\\u1061\\\\u1065\\\\u1066\\\\u106E-\\\\u1070\\\\u1075-\\\\u1081\\\\u108E\\\\u10A0-\\\\u10C5\\\\u10C7\\\\u10CD\\\\u10D0-\\\\u10FA\\\\u10FC-\\\\u1248\\\\u124A-\\\\u124D\\\\u1250-\\\\u1256\\\\u1258\\\\u125A-\\\\u125D\\\\u1260-\\\\u1288\\\\u128A-\\\\u128D\\\\u1290-\\\\u12B0\\\\u12B2-\\\\u12B5\\\\u12B8-\\\\u12BE\\\\u12C0\\\\u12C2-\\\\u12C5\\\\u12C8-\\\\u12D6\\\\u12D8-\\\\u1310\\\\u1312-\\\\u1315\\\\u1318-\\\\u135A\\\\u1380-\\\\u138F\\\\u13A0-\\\\u13F4\\\\u1401-\\\\u166C\\\\u166F-\\\\u167F\\\\u1681-\\\\u169A\\\\u16A0-\\\\u16EA\\\\u16EE-\\\\u16F8\\\\u1700-\\\\u170C\\\\u170E-\\\\u1711\\\\u1720-\\\\u1731\\\\u1740-\\\\u1751\\\\u1760-\\\\u176C\\\\u176E-\\\\u1770\\\\u1780-\\\\u17B3\\\\u17D7\\\\u17DC\\\\u1820-\\\\u1877\\\\u1880-\\\\u18A8\\\\u18AA\\\\u18B0-\\\\u18F5\\\\u1900-\\\\u191E\\\\u1950-\\\\u196D\\\\u1970-\\\\u1974\\\\u1980-\\\\u19AB\\\\u19C1-\\\\u19C7\\\\u1A00-\\\\u1A16\\\\u1A20-\\\\u1A54\\\\u1AA7\\\\u1B05-\\\\u1B33\\\\u1B45-\\\\u1B4B\\\\u1B83-\\\\u1BA0\\\\u1BAE\\\\u1BAF\\\\u1BBA-\\\\u1BE5\\\\u1C00-\\\\u1C23\\\\u1C4D-\\\\u1C4F\\\\u1C5A-\\\\u1C7D\\\\u1CE9-\\\\u1CEC\\\\u1CEE-\\\\u1CF1\\\\u1CF5\\\\u1CF6\\\\u1D00-\\\\u1DBF\\\\u1E00-\\\\u1F15\\\\u1F18-\\\\u1F1D\\\\u1F20-\\\\u1F45\\\\u1F48-\\\\u1F4D\\\\u1F50-\\\\u1F57\\\\u1F59\\\\u1F5B\\\\u1F5D\\\\u1F5F-\\\\u1F7D\\\\u1F80-\\\\u1FB4\\\\u1FB6-\\\\u1FBC\\\\u1FBE\\\\u1FC2-\\\\u1FC4\\\\u1FC6-\\\\u1FCC\\\\u1FD0-\\\\u1FD3\\\\u1FD6-\\\\u1FDB\\\\u1FE0-\\\\u1FEC\\\\u1FF2-\\\\u1FF4\\\\u1FF6-\\\\u1FFC\\\\u2071\\\\u207F\\\\u2090-\\\\u209C\\\\u2102\\\\u2107\\\\u210A-\\\\u2113\\\\u2115\\\\u2119-\\\\u211D\\\\u2124\\\\u2126\\\\u2128\\\\u212A-\\\\u212D\\\\u212F-\\\\u2139\\\\u213C-\\\\u213F\\\\u2145-\\\\u2149\\\\u214E\\\\u2160-\\\\u2188\\\\u2C00-\\\\u2C2E\\\\u2C30-\\\\u2C5E\\\\u2C60-\\\\u2CE4\\\\u2CEB-\\\\u2CEE\\\\u2CF2\\\\u2CF3\\\\u2D00-\\\\u2D25\\\\u2D27\\\\u2D2D\\\\u2D30-\\\\u2D67\\\\u2D6F\\\\u2D80-\\\\u2D96\\\\u2DA0-\\\\u2DA6\\\\u2DA8-\\\\u2DAE\\\\u2DB0-\\\\u2DB6\\\\u2DB8-\\\\u2DBE\\\\u2DC0-\\\\u2DC6\\\\u2DC8-\\\\u2DCE\\\\u2DD0-\\\\u2DD6\\\\u2DD8-\\\\u2DDE\\\\u2E2F\\\\u3005-\\\\u3007\\\\u3021-\\\\u3029\\\\u3031-\\\\u3035\\\\u3038-\\\\u303C\\\\u3041-\\\\u3096\\\\u309D-\\\\u309F\\\\u30A1-\\\\u30FA\\\\u30FC-\\\\u30FF\\\\u3105-\\\\u312D\\\\u3131-\\\\u318E\\\\u31A0-\\\\u31BA\\\\u31F0-\\\\u31FF\\\\u3400-\\\\u4DB5\\\\u4E00-\\\\u9FCC\\\\uA000-\\\\uA48C\\\\uA4D0-\\\\uA4FD\\\\uA500-\\\\uA60C\\\\uA610-\\\\uA61F\\\\uA62A\\\\uA62B\\\\uA640-\\\\uA66E\\\\uA67F-\\\\uA69D\\\\uA6A0-\\\\uA6EF\\\\uA717-\\\\uA71F\\\\uA722-\\\\uA788\\\\uA78B-\\\\uA78E\\\\uA790-\\\\uA7AD\\\\uA7B0\\\\uA7B1\\\\uA7F7-\\\\uA801\\\\uA803-\\\\uA805\\\\uA807-\\\\uA80A\\\\uA80C-\\\\uA822\\\\uA840-\\\\uA873\\\\uA882-\\\\uA8B3\\\\uA8F2-\\\\uA8F7\\\\uA8FB\\\\uA90A-\\\\uA925\\\\uA930-\\\\uA946\\\\uA960-\\\\uA97C\\\\uA984-\\\\uA9B2\\\\uA9CF\\\\uA9E0-\\\\uA9E4\\\\uA9E6-\\\\uA9EF\\\\uA9FA-\\\\uA9FE\\\\uAA00-\\\\uAA28\\\\uAA40-\\\\uAA42\\\\uAA44-\\\\uAA4B\\\\uAA60-\\\\uAA76\\\\uAA7A\\\\uAA7E-\\\\uAAAF\\\\uAAB1\\\\uAAB5\\\\uAAB6\\\\uAAB9-\\\\uAABD\\\\uAAC0\\\\uAAC2\\\\uAADB-\\\\uAADD\\\\uAAE0-\\\\uAAEA\\\\uAAF2-\\\\uAAF4\\\\uAB01-\\\\uAB06\\\\uAB09-\\\\uAB0E\\\\uAB11-\\\\uAB16\\\\uAB20-\\\\uAB26\\\\uAB28-\\\\uAB2E\\\\uAB30-\\\\uAB5A\\\\uAB5C-\\\\uAB5F\\\\uAB64\\\\uAB65\\\\uABC0-\\\\uABE2\\\\uAC00-\\\\uD7A3\\\\uD7B0-\\\\uD7C6\\\\uD7CB-\\\\uD7FB\\\\uF900-\\\\uFA6D\\\\uFA70-\\\\uFAD9\\\\uFB00-\\\\uFB06\\\\uFB13-\\\\uFB17\\\\uFB1D\\\\uFB1F-\\\\uFB28\\\\uFB2A-\\\\uFB36\\\\uFB38-\\\\uFB3C\\\\uFB3E\\\\uFB40\\\\uFB41\\\\uFB43\\\\uFB44\\\\uFB46-\\\\uFBB1\\\\uFBD3-\\\\uFD3D\\\\uFD50-\\\\uFD8F\\\\uFD92-\\\\uFDC7\\\\uFDF0-\\\\uFDFB\\\\uFE70-\\\\uFE74\\\\uFE76-\\\\uFEFC\\\\uFF21-\\\\uFF3A\\\\uFF41-\\\\uFF5A\\\\uFF66-\\\\uFFBE\\\\uFFC2-\\\\uFFC7\\\\uFFCA-\\\\uFFCF\\\\uFFD2-\\\\uFFD7\\\\uFFDA-\\\\uFFDC]\");\r\n\r\n})();\r\n\r\nreturn window.kendo;\r\n\r\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\r\n\n(function(f, define){\r\n    define('util/parse-xml',[ \"kendo.core\", \"./main\" ], f);\r\n})(function(){\r\n    \"use strict\";\r\n\r\n    // SAX-style XML parser ====================================================\r\n    var STRING = String.fromCharCode;\r\n\r\n    // XXX: add more here?\r\n    var ENTITIES = {\r\n        \"amp\"  : 38,\r\n        \"lt\"   : 60,\r\n        \"gt\"   : 62,\r\n        \"quot\" : 34,\r\n        \"apos\" : 39,\r\n        \"nbsp\" : 160\r\n    };\r\n\r\n    function CODE(str) {\r\n        var out = [];\r\n        for (var i = 0; i < str.length; ++i) {\r\n            out.push(str.charCodeAt(i));\r\n        }\r\n        return out;\r\n    }\r\n\r\n    function UCS2(out, code) {\r\n        if (code > 0xFFFF) {\r\n            code -= 0x10000;\r\n            out.push(code >>> 10 & 0x3FF | 0xD800,\r\n                     0xDC00 | code & 0x3FF);\r\n        } else {\r\n            out.push(code);\r\n        }\r\n    }\r\n\r\n    var START_CDATA     = CODE(\"<![CDATA[\");\r\n    var END_CDATA       = CODE(\"]]>\");\r\n    var END_COMMENT     = CODE(\"-->\");\r\n    var START_COMMENT   = CODE(\"!--\");\r\n    var END_SHORT_TAG   = CODE(\"/>\");\r\n    var END_TAG         = CODE(\"</\");\r\n    var END_DECLARATION = CODE(\"?>\");\r\n    var QUESTION_MARK   = CODE(\"?\");\r\n    var LESS_THAN       = CODE(\"<\");\r\n    var GREATER_THAN    = CODE(\">\");\r\n    var SEMICOLON       = CODE(\";\");\r\n    var EQUAL           = CODE(\"=\");\r\n    var AMPERSAND       = CODE(\"&\");\r\n    var QUOTE           = CODE('\"');\r\n    var APOSTROPHE      = CODE(\"'\");\r\n    var SHARP           = CODE(\"#\");\r\n    var LOWERCASE_X     = CODE(\"x\");\r\n    var UPPERCASE_X     = CODE(\"X\");\r\n\r\n    var EXIT = {};\r\n\r\n    function parse(data, callbacks) {\r\n        var index = 0;\r\n        var stack = [];\r\n        var object = {\r\n            is: function(selector) {\r\n                var i = stack.length, j = selector.length;\r\n                while (--i >= 0 && --j >= 0) {\r\n                    if (stack[i].$tag != selector[j] && selector[j] != \"*\") {\r\n                        return false;\r\n                    }\r\n                }\r\n                return j < 0 ? stack[stack.length - 1] : null;\r\n            },\r\n            exit: function() {\r\n                throw EXIT;\r\n            },\r\n            stack: stack\r\n        };\r\n\r\n        function readChar(body) {\r\n            var code = data[index++];\r\n            if (!(code & 0xF0 ^ 0xF0)) {// 4 bytes\r\n                UCS2(body,\r\n                     ((code & 0x03) << 18) |\r\n                     ((data[index++] & 0x3F) << 12) |\r\n                     ((data[index++] & 0x3F) << 6) |\r\n                     (data[index++] & 0x3F));\r\n            } else if (!(code & 0xE0 ^ 0xE0)) {// 3 bytes\r\n                UCS2(body,\r\n                     ((code & 0x0F) << 12) |\r\n                     ((data[index++] & 0x3F) << 6) |\r\n                     (data[index++] & 0x3F));\r\n            } else if (!(code & 0xC0 ^ 0xC0)) {// 2 bytes\r\n                UCS2(body,\r\n                     ((code & 0x1F) << 6) |\r\n                     (data[index++] & 0x3F));\r\n            } else {\r\n                body.push(code);\r\n            }\r\n        }\r\n\r\n        function croak(msg) {\r\n            throw new Error(msg + \", at \" + index);\r\n        }\r\n\r\n        function readWhile(pred) {\r\n            var a = [];\r\n            while (index < data.length && pred(data[index])) {\r\n                a.push(data[index++]);\r\n            }\r\n            return a;\r\n        }\r\n\r\n        function readAsciiWhile(pred) {\r\n            return STRING.apply(0, readWhile(pred));\r\n        }\r\n\r\n        function skipWhitespace() {\r\n            readWhile(isWhitespace);\r\n        }\r\n\r\n        function eat(a) {\r\n            var save = index;\r\n            for (var i = 0; i < a.length; ++i) {\r\n                if (data[index++] != a[i]) {\r\n                    index = save;\r\n                    return false;\r\n                }\r\n            }\r\n            return a;\r\n        }\r\n\r\n        function skip(code) {\r\n            if (!eat(code)) {\r\n                croak(\"Expecting \" + code.join(\", \"));\r\n            }\r\n        }\r\n\r\n        function isWhitespace(code) {\r\n            return code == 9 || code == 10 || code == 13 || code == 32;\r\n        }\r\n\r\n        function isDigit(code) {\r\n            return code >= 48 && code <= 57;\r\n        }\r\n\r\n        function isHexDigit(code) {\r\n            return (code >= 48 && code <= 57) ||\r\n                   ((code|=32) >= 97 && code <= 102); // a..f or A..F\r\n        }\r\n\r\n        function isNameStart(code) {\r\n            return code == 58 ||                      // :\r\n                   code == 95 ||                      // _\r\n                   ((code|=32) >= 97 && code <= 122); // a..z or A..Z\r\n        }\r\n\r\n        function isName(code) {\r\n            return code == 45 ||                      // -\r\n                   isDigit(code) ||\r\n                   isNameStart(code);\r\n        }\r\n\r\n        function xmlComment() {\r\n            var body = [];\r\n            while (index < data.length) {\r\n                if (eat(END_COMMENT)) {\r\n                    return call(\"comment\", STRING.apply(0, body));\r\n                }\r\n                readChar(body);\r\n            }\r\n        }\r\n\r\n        function xmlTag() {\r\n            var name, attrs;\r\n            if (eat(QUESTION_MARK)) {\r\n                xmlDecl();\r\n            } else if (eat(START_COMMENT)) {\r\n                xmlComment();\r\n            } else {\r\n                name = xmlName();\r\n                attrs = xmlAttrs(name);\r\n                stack.push(attrs);\r\n                if (eat(END_SHORT_TAG)) {\r\n                    call(\"enter\", name, attrs, true);\r\n                } else {\r\n                    skip(GREATER_THAN);\r\n                    call(\"enter\", name, attrs);\r\n                    xmlContent(name);\r\n                    if (name != xmlName()) {\r\n                        croak(\"Bad closing tag\");\r\n                    }\r\n                    call(\"leave\", name, attrs);\r\n                    skipWhitespace();\r\n                    skip(GREATER_THAN);\r\n                }\r\n                stack.pop();\r\n            }\r\n        }\r\n\r\n        function xmlContent(name) {\r\n            var body = [];\r\n            while (index < data.length) {\r\n                if (eat(END_TAG)) {\r\n                    return body.length && call(\"text\", STRING.apply(0, body));\r\n                } else if (eat(START_CDATA)) {\r\n                    while (index < data.length && !eat(END_CDATA)) {\r\n                        readChar(body);\r\n                    }\r\n                } else if (eat(LESS_THAN)) {\r\n                    if (body.length) {\r\n                        call(\"text\", STRING.apply(0, body));\r\n                    }\r\n                    xmlTag();\r\n                    body = [];\r\n                } else if (eat(AMPERSAND)) {\r\n                    xmlEntity(body);\r\n                } else {\r\n                    readChar(body);\r\n                }\r\n            }\r\n            croak(\"Unclosed tag \" + name);\r\n        }\r\n\r\n        function xmlName() {\r\n            if (!isNameStart(data[index])) {\r\n                croak(\"Expecting XML name\");\r\n            }\r\n            return readAsciiWhile(isName);\r\n        }\r\n\r\n        function xmlString() {\r\n            var quote = eat(QUOTE) || eat(APOSTROPHE);\r\n            if (!quote) {\r\n                croak(\"Expecting string\");\r\n            }\r\n            var body = [];\r\n            while (index < data.length) {\r\n                if (eat(quote)) {\r\n                    return STRING.apply(0, body);\r\n                } else if (eat(AMPERSAND)) {\r\n                    xmlEntity(body);\r\n                } else {\r\n                    readChar(body);\r\n                }\r\n            }\r\n            croak(\"Unfinished string\");\r\n        }\r\n\r\n        function xmlEntity(body) {\r\n            var code;\r\n            if (eat(SHARP)) {\r\n                if (eat(LOWERCASE_X) || eat(UPPERCASE_X)) {\r\n                    code = parseInt(readAsciiWhile(isHexDigit), 16);\r\n                } else {\r\n                    code = parseInt(readAsciiWhile(isDigit), 10);\r\n                }\r\n                if (isNaN(code)) {\r\n                    croak(\"Bad numeric entity\");\r\n                }\r\n            } else {\r\n                var name = xmlName();\r\n                code = ENTITIES[name];\r\n                if (code === undefined) {\r\n                    croak(\"Unknown entity \" + name);\r\n                }\r\n            }\r\n            UCS2(body, code);\r\n            skip(SEMICOLON);\r\n        }\r\n\r\n        function xmlDecl() {\r\n            call(\"decl\", xmlName(), xmlAttrs());\r\n            skip(END_DECLARATION);\r\n        }\r\n\r\n        function xmlAttrs(name) {\r\n            var map = { $tag: name };\r\n            while (index < data.length) {\r\n                skipWhitespace();\r\n                var code = data[index];\r\n                if (code == 63 || code == 62 || code == 47) { // ?, > or /\r\n                    break;\r\n                }\r\n                map[xmlName()] = ( skip(EQUAL), xmlString() );\r\n            }\r\n            return map;\r\n        }\r\n\r\n        function call(what, thing, arg1, arg2) {\r\n            var f = callbacks && callbacks[what];\r\n            if (f) {\r\n                f.call(object, thing, arg1, arg2);\r\n            }\r\n        }\r\n\r\n        // skip BOM\r\n        var tmp = [];\r\n        readChar(tmp);\r\n        if (tmp[0] != 65279) {\r\n            index = 0;\r\n        }\r\n\r\n        while (index < data.length) {\r\n            skipWhitespace();\r\n            skip(LESS_THAN);\r\n            xmlTag();\r\n            skipWhitespace();\r\n        }\r\n    }\r\n\r\n    // Exports ================================================================\r\n    kendo.util.parseXML = function parseXML() {\r\n        try {\r\n            return parse.apply(this, arguments);\r\n        } catch(ex) {\r\n            if (ex !== EXIT) {\r\n                throw ex;\r\n            }\r\n        }\r\n    };\r\n\r\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\r\n\n(function(f, define){\n    define('spreadsheet/commands',[\n        \"kendo.core\",\n        \"kendo.binder\",\n        \"kendo.window\",\n        \"kendo.list\",\n        \"kendo.tabstrip\"\n    ], f);\n})(function(){\n\n(function(kendo) {\n    var $ = kendo.jQuery;\n\n    var COMMAND_TYPES = {\n        AUTO_FILL: \"autoFill\",\n        CLEAR: \"clear\",\n        CUT: \"cut\",\n        EDIT: \"edit\",\n        PASTE: \"paste\",\n        VALIDATION: \"validation\"\n    };\n\n    var Command = kendo.spreadsheet.Command = kendo.Class.extend({\n        init: function(options) {\n            this.options = options;\n            this._workbook = options.workbook;\n            this._property = options && options.property;\n            this._state = {};\n        },\n        range: function(range) {\n            if (range !== undefined) {\n                this._setRange(range);\n            }\n\n            return this._range;\n        },\n        _setRange: function(range) {\n            this._range = range;\n        },\n        redo: function() {\n            this.range().select();\n            this.exec();\n        },\n        undo: function() {\n            this.setState(this._state);\n        },\n        getState: function() {\n            this._state = this.range().getState(this._property);\n        },\n        setState: function(state) {\n            this.range().setState(state);\n        },\n        rejectState: function(validationState) {\n            this.undo();\n            return {\n                title: validationState.title,\n                body: validationState.message,\n                reason: \"error\",\n                type: \"validationError\"\n            };\n        },\n        _forEachCell: function(callback) {\n            var range = this.range();\n            var ref = range._ref;\n\n            ref.forEach(function(ref) {\n                range.sheet().forEach(ref.toRangeRef(), callback.bind(this));\n            }.bind(this));\n        },\n        usesImage: function(/* image id from workbook._images */) {\n            return false;\n        }\n    });\n\n    kendo.spreadsheet.DrawingUpdateCommand = Command.extend({\n        init: function(options) {\n            this._sheet = options.sheet;\n            this._drawing = options.drawing;\n            this._orig = this._drawing.clone();\n            this._previous = options.previous;\n        },\n        exec: function() {},\n        undo: function() {\n            this._drawing.reset(this._previous);\n            this._sheet._activeDrawing = this._drawing;\n            this._sheet.triggerChange({ layout: true });\n        },\n        redo: function() {\n            this._drawing.reset(this._orig);\n            this._sheet._activeDrawing = this._drawing;\n            this._sheet.triggerChange({ layout: true });\n        },\n        usesImage: function(img) {\n            return this._drawing.image === img\n                || this._orig.image === img\n                || this._previous.image === img;\n        }\n    });\n\n    var DrawingCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this._drawing = options.drawing;\n        },\n        usesImage: function(img) {\n            return this._drawing.image === img;\n        }\n    });\n\n    kendo.spreadsheet.InsertImageCommand = DrawingCommand.extend({\n        init: function(options) {\n            DrawingCommand.fn.init.call(this, options);\n            this._blob = options.blob;\n            this._width = options.width;\n            this._height = options.height;\n        },\n        exec: function() {\n            var range = this.range();\n            var sheet = range.sheet();\n            var width = this._width;\n            var height = this._height;\n            var aspect = width / height;\n            if (width > height) {\n                width = Math.min(width, 300);\n                height = width / aspect;\n            } else {\n                height = Math.min(height, 300);\n                width = height * aspect;\n            }\n            this._drawing = sheet.addDrawing({\n                topLeftCell : range.topLeft(),\n                offsetX     : 5,\n                offsetY     : 5,\n                width       : width,\n                height      : height,\n                opacity     : 1,\n                image       : this._workbook.addImage(this._blob)\n            }, true);\n            this._blob = null;\n        },\n        undo: function() {\n            var sheet = this.range().sheet();\n            sheet._activeDrawing = null;\n            sheet.removeDrawing(this._drawing);\n        },\n        redo: function() {\n            var sheet = this.range().sheet();\n            sheet._activeDrawing = this._drawing;\n            sheet.addDrawing(this._drawing);\n        }\n    });\n\n    kendo.spreadsheet.DeleteDrawingCommand = DrawingCommand.extend({\n        exec: function() {\n            var sheet = this.range().sheet();\n            sheet._activeDrawing = null;\n            sheet.removeDrawing(this._drawing);\n        },\n        undo: function() {\n            var sheet = this.range().sheet();\n            sheet._activeDrawing = this._drawing;\n            sheet.addDrawing(this._drawing);\n        },\n        redo: function() {\n            this.exec();\n        }\n    });\n\n    var ReorderDrawingsCommand = DrawingCommand.extend({\n        exec: function() {\n            var sheet = this.range().sheet();\n            this._origIndex = sheet._drawings.indexOf(this._drawing);\n            sheet._drawings.splice(this._origIndex, 1);\n            this._newIndex = this._reorder();\n            sheet._drawings.splice(this._newIndex, 0, this._drawing);\n            sheet.triggerChange({ drawings: true });\n        },\n        undo: function() {\n            var sheet = this.range().sheet();\n            sheet._drawings.splice(this._newIndex, 1);\n            sheet._drawings.splice(this._origIndex, 0, this._drawing);\n            sheet.triggerChange({ drawings: true });\n        }\n    });\n\n    kendo.spreadsheet.BringToFrontCommand = ReorderDrawingsCommand.extend({\n        _reorder: function() {\n            return this.range().sheet()._drawings.length;\n        }\n    });\n\n    kendo.spreadsheet.SendToBackCommand = ReorderDrawingsCommand.extend({\n        _reorder: function() {\n            return 0;\n        }\n    });\n\n    var TargetValueCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this._target = options.target;\n            this._value = options.value;\n        },\n        exec: function() {\n            this.getState();\n            this.setState(this._value);\n        }\n    });\n\n    kendo.spreadsheet.ColumnWidthCommand = TargetValueCommand.extend({\n        getState: function() {\n            this._state = this.range().sheet().columnWidth(this._target);\n        },\n        setState: function(state) {\n            this.range().sheet().columnWidth(this._target, state);\n        }\n    });\n\n    kendo.spreadsheet.RowHeightCommand = TargetValueCommand.extend({\n        getState: function() {\n            this._state = this.range().sheet().rowHeight(this._target);\n        },\n        setState: function(state) {\n            this.range().sheet().rowHeight(this._target, state);\n        }\n    });\n\n    kendo.spreadsheet.HyperlinkCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this._link = options.link;\n        },\n        exec: function() {\n            var range = this.range();\n            this._prevLink = range.link();\n            this._prevUnderline = range.underline();\n            range.link(this._link);\n            range.underline(true);\n            if (range.value() == null) {\n                this._hasSetValue = true;\n                range.value(this._link);\n            }\n        },\n        undo: function() {\n            var range = this.range();\n            range.link(this._prevLink);\n            range.underline(this._prevUnderline);\n            if (this._hasSetValue) {\n                range.value(null);\n            }\n        }\n    });\n\n    kendo.spreadsheet.GridLinesChangeCommand = TargetValueCommand.extend({\n        getState: function() {\n            this._state = this._range.sheet().showGridLines();\n        },\n        setState: function(v) {\n            this._range.sheet().showGridLines(v);\n        }\n    });\n\n    var PropertyChangeCommand = kendo.spreadsheet.PropertyChangeCommand = Command.extend({\n        _setRange: function(range) {\n            Command.prototype._setRange.call(this, range.skipHiddenCells());\n        },\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this._value = options.value;\n        },\n        exec: function() {\n            var range = this.range();\n            if (range.enable()) {\n                this.getState();\n\n                if (this.options.property === \"format\") {\n                    this._workbook.trigger(\"changeFormat\", { range: range });\n                }\n\n                range[this._property](this._value);\n            }\n        }\n    });\n\n    kendo.spreadsheet.ClearContentCommand = Command.extend({\n        exec: function() {\n            var values = [], range, rowValues, nullValues, validationState, currentRange;\n            if (!this.range().enable()) {\n                return { reason: \"error\", type: \"cannotModifyDisabled\" };\n            }\n            if (!this.range().canEditArrayFormula()) {\n                return { reason: \"error\", type: \"intersectsArray\" };\n            }\n            this.getState();\n            range = this.range().skipHiddenCells();\n\n            if(range._ref.refs && range._ref.refs.length > 1) {\n                range._ref.refs.forEach(function(ref) {\n                    currentRange = range.sheet().range(ref);\n                    values = values.concat(currentRange.values());\n                });\n            } else {\n                values = range.values();\n            }\n            nullValues = [];\n            values.forEach(function(row) {\n                rowValues = [];\n                row.forEach(function() {\n                    rowValues.push(null);\n                });\n                nullValues.push(rowValues);\n            });\n            if (range.sheet().trigger(\"changing\", { data: nullValues, range: range, changeType: COMMAND_TYPES.CLEAR })) {\n                return;\n            }\n            range.clearContent();\n            validationState = range._getValidationState();\n            if (validationState) {\n                return this.rejectState(validationState);\n            }\n        },\n        undo: function() {\n            var range = this.range().skipHiddenCells();\n            var sheet = range.sheet();\n            var data = this._state.data;\n            var values = [];\n            var rowValues;\n            data.forEach(function(row) {\n                rowValues = [];\n                row.forEach(function(cell) {\n                    rowValues.push(cell.value);\n                });\n                values.push(rowValues);\n            });\n            if (sheet.trigger(\"changing\", { data: values, range: range, changeType: COMMAND_TYPES.CLEAR })) {\n                return;\n            }\n            this.setState(this._state);\n        }\n    });\n\n    kendo.spreadsheet.EditCommand = PropertyChangeCommand.extend({\n        init: function(options) {\n            options.property = options.property || \"input\";\n            PropertyChangeCommand.fn.init.call(this, options);\n        },\n        _setRange: function(range) {\n            PropertyChangeCommand.prototype._setRange.apply(this, arguments);\n            this._editRange = this.options.arrayFormula ? range : range.sheet().activeCellSelection();\n        },\n        getState: function() {\n            this._state = this.range().getState();\n        },\n        exec: function() {\n            return this.range().sheet().withCultureDecimals(this._exec.bind(this));\n        },\n        undo: function() {\n            var editRange = this._editRange;\n            var state = this._state;\n            if (editRange.sheet().trigger(\"changing\", { data: state.data[0][0].value, range: editRange, changeType: COMMAND_TYPES.EDIT })) {\n                return;\n            }\n            this.setState(this._state);\n        },\n        _exec: function() {\n            var arrayFormula = this.options.arrayFormula;\n            var editRange = this._editRange;\n\n            if (!editRange.enable()) {\n                return { reason: \"error\", type: \"rangeDisabled\" };\n            }\n\n            if (!editRange.canEditArrayFormula()) {\n                return { reason: \"error\", type: \"intersectsArray\" };\n            }\n\n            var value = this._value;\n            this.getState();\n            if (this.range().sheet().trigger(\"changing\", { data: value, range: this._editRange, changeType: COMMAND_TYPES.EDIT })) {\n                return;\n            }\n\n            if (this._property == \"value\") {\n                editRange.value(value);\n                return;\n            }\n\n            try {\n                editRange.link(null);\n                if (value === \"\") {\n                    editRange.value(null);\n                } else {\n                    editRange.input(value, { arrayFormula: arrayFormula });\n                    if (/\\n/.test(editRange.value())) {\n                        editRange.wrap(true);\n                    }\n                }\n                editRange._adjustRowHeight();\n\n                var validationState = editRange._getValidationState();\n                if (validationState) {\n                    return this.rejectState(validationState);\n                }\n            } catch(ex) {\n                if (ex instanceof kendo.spreadsheet.calc.ParseError) {\n                    return {\n                        title : \"Error in formula\",\n                        body  : ex+\"\",\n                        reason: \"error\"\n                    };\n                } else {\n                    throw ex;\n                }\n            }\n        }\n    });\n\n    kendo.spreadsheet.InsertCommentCommand = PropertyChangeCommand.extend({\n        init: function(options) {\n            options.property = \"comment\";\n            PropertyChangeCommand.fn.init.call(this, options);\n        }\n    });\n\n    kendo.spreadsheet.TextWrapCommand = PropertyChangeCommand.extend({\n        init: function(options) {\n            options.property = \"wrap\";\n            PropertyChangeCommand.fn.init.call(this, options);\n\n            this._value = options.value;\n        },\n        getState: function() {\n            var rowHeight = {};\n            this.range().forEachRow(function(range) {\n                var index = range.topLeft().row;\n\n                rowHeight[index] = range.sheet().rowHeight(index);\n            });\n\n            this._state = this.range().getState(this._property);\n            this._rowHeight = rowHeight;\n        },\n        undo: function() {\n            var sheet = this.range().sheet();\n            var rowHeight = this._rowHeight;\n\n            this.range().setState(this._state);\n\n            for (var row in rowHeight) {\n                sheet.rowHeight(row, rowHeight[row]);\n            }\n        }\n    });\n\n    kendo.spreadsheet.AdjustDecimalsCommand = Command.extend({\n        init: function(options) {\n            this._delta = options.value;\n            options.property = \"format\";\n            Command.fn.init.call(this, options);\n        },\n        exec: function() {\n            var sheet = this.range().sheet();\n            var delta = this._delta;\n            var formatting = kendo.spreadsheet.formatting;\n\n            this.getState();\n\n            sheet.batch(function() {\n                this.range().forEachCell(function(row, col, cell) {\n                    var format = cell.format;\n\n                    if (!format) {\n                        var value = cell.value;\n                        if (typeof value == \"number\" && /\\./.test(value)) {\n                            format = \"0.\" + String(value).split(\".\")[1].replace(/\\d/g, \"0\");\n                        }\n                    }\n\n                    if (format || delta > 0) {\n                        format = formatting.adjustDecimals(format || \"0\", delta);\n                        sheet.range(row, col).format(format);\n                    }\n                });\n            }.bind(this));\n        }\n    });\n\n    kendo.spreadsheet.BorderChangeCommand = Command.extend({\n        init: function(options) {\n            options.property = \"border\";\n            Command.fn.init.call(this, options);\n            this._type = options.border;\n            this._style = options.style;\n        },\n        _batch: function(f) {\n            return this.range().sheet().batch(f, {});\n        },\n        exec: function() {\n            var self = this;\n            self.getState();\n            self._batch(function(){\n                self[self._type](self._style);\n            });\n        },\n        noBorders: function() {\n            this.range().insideBorders(null);\n            this.outsideBorders(null);\n        },\n        allBorders: function(style) {\n            this.range().insideBorders(style);\n            this.outsideBorders(style);\n        },\n        leftBorder: function(style) {\n            this.range().leftColumn().borderLeft(style);\n        },\n        rightBorder: function(style) {\n            this.range().rightColumn().borderRight(style);\n        },\n        topBorder: function(style) {\n            this.range().topRow().borderTop(style);\n        },\n        bottomBorder: function(style) {\n            this.range().bottomRow().borderBottom(style);\n        },\n        outsideBorders: function(style) {\n            var range = this.range();\n            range.leftColumn().borderLeft(style);\n            range.topRow().borderTop(style);\n            range.rightColumn().borderRight(style);\n            range.bottomRow().borderBottom(style);\n        },\n        insideBorders: function(style) {\n            this.range().insideBorders(style);\n            this.outsideBorders(null);\n        },\n        insideHorizontalBorders: function(style) {\n            this.range().insideHorizontalBorders(style);\n        },\n        insideVerticalBorders: function(style) {\n            this.range().insideVerticalBorders(style);\n        }\n    });\n\n    kendo.spreadsheet.MergeCellCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this._type = options.value;\n        },\n        exec: function() {\n            this.getState();\n            this[this._type]();\n            this.range().sheet().triggerChange({ recalc: true });\n        },\n        activate: function(ref) {\n            this.range().sheet().activeCell(ref);\n        },\n        getState: function() {\n            this._state = this.range().getState();\n        },\n        undo: function() {\n            if (this._type !== \"unmerge\") {\n                this.range().unmerge();\n                this.activate(this.range().topLeft());\n            }\n            this.range().setState(this._state);\n        },\n        cells: function() {\n            var range = this.range();\n            var ref = range._ref;\n\n            range.merge();\n            this.activate(ref);\n        },\n        horizontally: function() {\n            var ref = this.range().topRow()._ref;\n\n            this.range().forEachRow(function(range) {\n                range.merge();\n            });\n\n            this.activate(ref);\n        },\n        vertically: function() {\n            var ref = this.range().leftColumn()._ref;\n\n            this.range().forEachColumn(function(range) {\n                range.merge();\n            });\n\n            this.activate(ref);\n        },\n        unmerge: function() {\n            var range = this.range();\n            var ref = range._ref.topLeft;\n\n            range.unmerge();\n            this.activate(ref);\n        }\n    });\n\n    kendo.spreadsheet.FreezePanesCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this._type = options.value;\n        },\n        exec: function() {\n            this.getState();\n            this._topLeft = this.range().topLeft();\n            this[this._type]();\n        },\n        getState: function() {\n            this._state = this.range().sheet().getState();\n        },\n        undo: function() {\n            this.range().sheet().setState(this._state);\n        },\n        panes: function() {\n            var topLeft = this._topLeft;\n            var sheet = this.range().sheet();\n\n            sheet.frozenColumns(topLeft.col).frozenRows(topLeft.row);\n        },\n        rows: function() {\n            var topLeft = this._topLeft;\n            var sheet = this.range().sheet();\n\n            sheet.frozenRows(topLeft.row);\n        },\n        columns: function() {\n            var topLeft = this._topLeft;\n            var sheet = this.range().sheet();\n\n            sheet.frozenColumns(topLeft.col);\n        },\n        unfreeze: function() {\n            var sheet = this.range().sheet();\n            sheet.frozenRows(0).frozenColumns(0);\n        }\n    });\n\n    kendo.spreadsheet.PasteCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this._clipboard = options.workbook.clipboard();\n            this._clipboard.parse();\n            this._event = options.event;\n            this._clipboardContent = this._clipboard._content;\n            this._sheet = this._workbook.activeSheet();\n            this._range = this._sheet.selection ? this._sheet.selection() : this._sheet.range(this._clipboard.pasteRef());\n            this._state = this._range.getState();\n            this._targetRangeRefs = (this._range._ref instanceof kendo.spreadsheet.UnionRef ? this._range._ref.refs : [this._range._ref]).map(function(ref){\n                return ref.toRangeRef();\n            });\n        },\n        exec: function() {\n            return this.range().sheet().withCultureDecimals(this._exec.bind(this));\n        },\n        undo: function() {\n            var sheet = this._sheet;\n            var range = this._range;\n\n            if (sheet.trigger(\"changing\", { data: this._state.data, range: range, changeType: COMMAND_TYPES.PASTE })) {\n                return;\n            }\n\n            this.setState(this._state);\n        },\n        _exec: function() {\n            var status = this._clipboard.canPaste();\n\n            if (!status.canPaste) {\n                if (status.menuInvoked) {\n                    return { reason: \"error\", type: \"useKeyboard\" };\n                }\n                if (status.pasteOnMerged) {\n                    return { reason: \"error\", type: \"modifyMerged\" };\n                }\n                if (status.pasteOnDisabled) {\n                    this._event.preventDefault();\n                    return { reason: \"error\", type: \"cannotModifyDisabled\" };\n                }\n                return { reason: \"error\" };\n            }\n\n            var sheet = this._sheet;\n            var range = this._range;\n\n            if(this._workbook.trigger(\"paste\", {range: range, clipboardContent: this._clipboardContent}) ||\n                sheet.trigger(\"changing\", { data: this._clipboardContent.data, range: range, changeType: COMMAND_TYPES.PASTE })) {\n                this._event.preventDefault();\n                return;\n            } else {\n                this._processPaste();\n            }\n        },\n        _adjustPasteTarget: function(multipliers, sourceRows, sourceCols) {\n            var that = this;\n            var targetRangeRefs = that._targetRangeRefs;\n            var sheet = that._sheet;\n            var RangeRef = kendo.spreadsheet.RangeRef;\n            var UnionRef = kendo.spreadsheet.UnionRef;\n            var refs = [];\n            var compare = function (a, b) {\n                var result = 0;\n                var topLeftA = a.topLeft;\n                var topLeftB = b.topLeft;\n\n                if (topLeftA.row > topLeftB.row) {\n                    result = 1;\n                } else if (topLeftA.row < topLeftB.row) {\n                    result = -1;\n                } else if (topLeftA.col > topLeftB.col) {\n                    result = 1;\n                } else if (topLeftA.col < topLeftB.col) {\n                    result = -1;\n                }\n\n                return result;\n            };\n\n            var refToSelect, rangeToSelect, ref, topLeft, multiplier, i, bottomRight;\n\n            for(i = 0; i < targetRangeRefs.length; i += 1) {\n                ref = targetRangeRefs[i];\n                multiplier = multipliers[i];\n                topLeft = ref.topLeft;\n                bottomRight = {\n                    row: multiplier.rows * sourceRows + topLeft.row - 1,\n                    col: multiplier.cols * sourceCols + topLeft.col - 1\n                };\n\n                refToSelect = new RangeRef(topLeft, bottomRight);\n                refs.push(refToSelect);\n            }\n\n            if(refs.length === 1) {\n                rangeToSelect = sheet.range(refToSelect);\n            } else {\n                refs.sort(compare);\n                rangeToSelect = sheet.range(new UnionRef(refs));\n            }\n\n            rangeToSelect.select();\n            that._range = rangeToSelect;\n            that._state = that._range.getState();\n        },\n        _processPaste: function() {\n            var that = this;\n            var sheet = that._sheet;\n            var clipboardContent = that._clipboardContent;\n            var range = that._range;\n            var sourceData = clipboardContent.data;\n            var sourceRows = sourceData.length;\n            var sourceCols = sourceData[0].length;\n            var targetRangeRefs = that._targetRangeRefs;\n            var multipliers = that._targetRanges(sourceRows, sourceCols);\n            var i;\n\n            var pasteRef = this._clipboard.pasteRef();\n            if (pasteRef.bottomRight.row >= sheet._rows._count || pasteRef.bottomRight.col >= sheet._columns._count) {\n                sheet.resize(\n                    Math.max(pasteRef.bottomRight.row + 1, sheet._rows._count),\n                    Math.max(pasteRef.bottomRight.col + 1, sheet._columns._count)\n                );\n            }\n\n            that._adjustPasteTarget(multipliers, sourceRows, sourceCols);\n\n            sheet.batch(function() {\n                for(i = 0; i < targetRangeRefs.length; i++) {\n                    that._populateTargetRange(targetRangeRefs[i], sourceRows, sourceCols, multipliers[i]);\n                }\n            }, {\n                recalc: true,\n                ref: that._range._ref\n            });\n\n            range._adjustRowHeight();\n        },\n        _populateTargetRange: function(ref, sourceRows, sourceCols, multipliers) {\n            var topLeft = ref.topLeft;\n            var range, i, j;\n\n            for(i = 0; i < multipliers.rows; i++) {\n                for(j = 0; j < multipliers.cols; j++) {\n                    range = this._sheet.range(topLeft.row + sourceRows * i, topLeft.col + sourceCols * j);\n                    range.setState(this._clipboardContent, this._clipboard);\n                }\n            }\n        },\n        _targetRangeDimensions: function(ref, sourceRows, sourceCols) {\n            var topLeft = ref.topLeft;\n            var bottomRight = ref.bottomRight;\n            var targetRangeRows = bottomRight.row - topLeft.row + 1;\n            var targetRangeCols = bottomRight.col - topLeft.col + 1;\n            var rowsMultiplier = 1;\n            var colsMultiplier = 1;\n\n            if((targetRangeRows % sourceRows === 0 && targetRangeCols % sourceCols === 0)) {\n                rowsMultiplier = targetRangeRows / sourceRows;\n                colsMultiplier = targetRangeCols / sourceCols;\n            }\n\n            return {\n                rows: rowsMultiplier,\n                cols: colsMultiplier\n            };\n        },\n        _targetRanges: function(sourceRows, sourceCols) {\n            var targetRangeRefs = this._targetRangeRefs;\n            var multipliers = [];\n            var i;\n\n            for(i = 0; i < targetRangeRefs.length; i++) {\n                multipliers.push(this._targetRangeDimensions(targetRangeRefs[i], sourceRows, sourceCols));\n            }\n\n            return multipliers;\n        }\n    });\n\n    kendo.spreadsheet.AdjustRowHeightCommand = Command.extend({\n        exec: function() {\n            var options = this.options;\n            var sheet = this._workbook.activeSheet();\n            var range = options.range || sheet.range(options.rowIndex);\n\n            range._adjustRowHeight();\n        }\n    });\n\n    kendo.spreadsheet.ToolbarPasteCommand = Command.extend({\n        exec: function() {\n            if (kendo.support.clipboard.paste) {\n                this._workbook._view.clipboard.focus().select();\n                //reason : focusclipbord\n                document.execCommand('paste');\n            } else {\n                return { reason: \"error\", type: \"useKeyboard\" };\n            }\n        }\n    });\n\n    kendo.spreadsheet.CutCommand = Command.extend({\n        _eventType: \"cut\",\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this._clipboard = options.workbook.clipboard();\n            this._event = options.event;\n        },\n        exec: function() {\n            var status = this._clipboard.canCopy();\n            var data = [], rangeValues, currentRow;\n            if (!status.canCopy) {\n                if (status.menuInvoked) {\n                    return { reason: \"error\", type: \"useKeyboard\" };\n                } else if (status.multiSelection) {\n                    return { reason: \"error\", type: \"unsupportedSelection\" };\n                }\n                return;\n            }\n            var range = this._workbook.activeSheet().selection();\n            if (this._eventType == \"cut\") {\n                if (!range.enable()) {\n                    this._event.preventDefault();\n                    return { reason: \"error\", type: \"cannotModifyDisabled\" };\n                }\n                this.getState();\n            }\n            if (this._workbook.trigger(this._eventType, { range: range })) {\n                this._event.preventDefault();\n            } else if (this._eventType == \"cut\") {\n                rangeValues = range.values();\n                rangeValues.forEach(function(row){\n                    currentRow = [];\n                    row.forEach(function(){\n                        currentRow.push({});\n                    });\n                    data.push(currentRow);\n                });\n                if (range.sheet().trigger(\"changing\", { data: data, range: range, changeType: COMMAND_TYPES.CUT })) {\n                    return;\n                }\n                this._clipboard.cut();\n            } else {\n                this._clipboard.copy();\n            }\n        },\n        undo: function() {\n            var range = this.range();\n            if (range.sheet().trigger(\"changing\", { data: this._state.data, range: range, changeType: COMMAND_TYPES.CUT })) {\n                return;\n            }\n            this.setState(this._state);\n        }\n    });\n\n    kendo.spreadsheet.CopyCommand = kendo.spreadsheet.CutCommand.extend({\n        _eventType: \"copy\",\n        undo: $.noop\n    });\n\n    // function copyToClipboard(html) {\n    //     var textarea = document.createElement('textarea');\n    //     $(textarea).addClass(\"k-spreadsheet-clipboard\")\n    //         .val(html)\n    //         .appendTo(document.body)\n    //         .trigger(\"focus\")\n    //         .select();\n\n    //     document.execCommand('copy');\n\n    //     $(textarea).remove();\n    // }\n\n    kendo.spreadsheet.ToolbarCopyCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this._clipboard = options.workbook.clipboard();\n        },\n        undo: $.noop,\n        exec: function() {\n            if (kendo.support.clipboard.copy) {\n                document.execCommand('copy');\n            } else {\n                return { reason: \"error\", type: \"useKeyboard\" };\n            }\n        }\n    });\n\n    kendo.spreadsheet.AutoFillCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n        },\n        origin: function(origin) {\n            this._origin = origin;\n        },\n        exec: function() {\n            var range = this.range(), autoFillData;\n            if (!range.enable()) {\n                return { reason: \"error\", type: \"rangeDisabled\" };\n            }\n            if (range.intersectingArrayFormula()) {\n                return { reason: \"error\", type: \"intersectsArray\" };\n            }\n            this.getState();\n            try {\n                autoFillData = range._previewFillFrom(this._origin);\n                if (range.sheet().trigger(\"changing\", { data: autoFillData.props, range: autoFillData.dest, changeType: COMMAND_TYPES.AUTO_FILL })) {\n                    return;\n                }\n                autoFillData.dest._properties(autoFillData.props, true);\n            } catch(ex) {\n                if (ex instanceof kendo.spreadsheet.Range.FillError) {\n                    return { reason: \"error\", type: ex.code };\n                }\n                throw ex;\n            }\n        },\n        undo: function() {\n            var range = this.range();\n            var state = this._state;\n            if (range.sheet().trigger(\"changing\", { data: state.data, range: range, changeType: COMMAND_TYPES.AUTO_FILL })) {\n                return;\n            }\n            this.setState(this._state);\n        }\n    });\n\n    kendo.spreadsheet.ToolbarCutCommand = Command.extend({\n        cannotUndo: true,\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this._clipboard = options.workbook.clipboard();\n        },\n        exec: function() {\n            if (kendo.support.clipboard.copy) {\n                document.execCommand('cut');\n            } else {\n                return { reason: \"error\", type: \"useKeyboard\" };\n            }\n        }\n    });\n\n    kendo.spreadsheet.FilterCommand = Command.extend({\n        undo: function() {\n            this.range().filter(this._state);\n        },\n        exec: function() {\n            var range = this.range();\n            this._state = range.hasFilter();\n            range.filter(!this._state);\n        }\n    });\n\n    kendo.spreadsheet.SortCommand = Command.extend({\n        undo: function() {\n            var sheet = this.range().sheet();\n            sheet.setState(this._state);\n        },\n        exec: function() {\n            var range = this.range();\n            var sheet = range.sheet();\n            var activeCell = sheet.activeCell();\n            var col = this.options.sheet ? activeCell.topLeft.col : (this.options.column || 0);\n            var ascending = this.options.value === \"asc\" ? true : false;\n\n            this._state = sheet.getState();\n\n            if (this.options.sheet) {\n                range = this.expandRange();\n            }\n\n            var reason = range.cantSort();\n            if (reason) {\n                return { reason: \"error\", type: reason.code };\n            }\n\n            range.sort({ column: col, ascending: ascending });\n        },\n        expandRange: function() {\n            var sheet = this.range().sheet();\n            return new kendo.spreadsheet.Range(sheet._sheetRef, sheet);\n        }\n    });\n\n    var ApplyFilterCommand = kendo.spreadsheet.ApplyFilterCommand = Command.extend({\n        column: function() {\n            return this.options.column || 0;\n        },\n        undo: function() {\n            var sheet = this.range().sheet();\n\n            sheet.clearFilter(this.column());\n\n            if (this._state.length) {\n                this.range().filter(this._state);\n            }\n        },\n        getState: function() {\n            var sheet = this.range().sheet();\n            var current = sheet.filter();\n\n            if (current) {\n                this._state = current.columns.filter(function(c) {\n                    return c.index == this.column();\n                }.bind(this));\n            }\n        },\n        exec: function() {\n            var range = this.range();\n            var column = this.column();\n            var current = range.sheet().filter();\n            var options;\n            var filterRule;\n            var exists = false;\n\n            if (this.options.valueFilter) {\n                filterRule = { column: column, filter: new kendo.spreadsheet.ValueFilter(this.options.valueFilter) };\n            } else if (this.options.customFilter) {\n                filterRule = { column: column, filter: new kendo.spreadsheet.CustomFilter(this.options.customFilter) };\n            }\n\n            this.getState();\n\n            if (current && current.ref.eq(range._ref) && current.columns.length) {\n                current.columns.forEach(function(element) {\n                    if (element.index === column) {\n                        exists = true;\n                    }\n                });\n\n                options = current.columns.map(function(element) {\n                    return element.index === column ? filterRule : { column: element.index, filter: element.filter };\n                });\n\n                if (!exists) {\n                    options.push(filterRule);\n                }\n            } else {\n                options = filterRule;\n            }\n\n            range.filter(options);\n        }\n    });\n\n    kendo.spreadsheet.ClearFilterCommand = ApplyFilterCommand.extend({\n        exec: function() {\n            var range = this.range();\n            var column = this.column();\n\n            this.getState();\n            range.clearFilter(column);\n        }\n    });\n\n    kendo.spreadsheet.HideLineCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this.axis = options.axis;\n        },\n\n        undo: function() {\n            var sheet = this.range().sheet();\n            sheet.setAxisState(this._state);\n        },\n\n        exec: function() {\n            var sheet = this.range().sheet();\n            this._state = sheet.getAxisState();\n\n            if (this.axis == \"row\") {\n                sheet.axisManager().hideSelectedRows();\n            } else {\n                sheet.axisManager().hideSelectedColumns();\n            }\n        }\n    });\n\n    kendo.spreadsheet.UnHideLineCommand = kendo.spreadsheet.HideLineCommand.extend({\n        exec: function() {\n            var sheet = this.range().sheet();\n            this._state = sheet.getAxisState();\n\n            if (this.axis == \"row\") {\n                sheet.axisManager().unhideSelectedRows();\n            } else {\n                sheet.axisManager().unhideSelectedColumns();\n            }\n        }\n    });\n\n    var DeleteCommand = Command.extend({\n        exec: function() {\n            this._expandedRange = this._expand(this.range());\n            this._state = this._expandedRange.getState();\n            this._indexes = this._exec(this._expandedRange.sheet());\n        },\n        undo: function() {\n            var self = this;\n            var range = self._expandedRange;\n            var sheet = range.sheet();\n            sheet.batch(function(){\n                self._indexes.forEach(function(x){\n                    self._undoOne(sheet, x);\n                    sheet._restoreModifiedFormulas(x.formulas);\n                });\n                range.setState(self._state);\n            }, { layout: true, recalc: true, ref: range._ref, isValue: true });\n        }\n    });\n\n    kendo.spreadsheet.DeleteRowCommand = DeleteCommand.extend({\n        _expand: function(range) {\n            return range.resize({ left: -Infinity, right: +Infinity });\n        },\n        _exec: function(sheet) {\n            return sheet.axisManager().deleteSelectedRows();\n        },\n        _undoOne: function(sheet, x) {\n            sheet.insertRow(x.index);\n            sheet.rowHeight(x.index, x.height);\n        }\n    });\n\n    kendo.spreadsheet.DeleteColumnCommand = DeleteCommand.extend({\n        _expand: function(range) {\n            return range.resize({ top: -Infinity, bottom: +Infinity });\n        },\n        _exec: function(sheet) {\n            return sheet.axisManager().deleteSelectedColumns();\n        },\n        _undoOne: function(sheet, x) {\n            sheet.insertColumn(x.index);\n            sheet.columnWidth(x.index, x.width);\n        }\n    });\n\n    var AddCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this._value = options.value;\n        },\n        undo: function() {\n            var self = this;\n            var sheet = self.range().sheet();\n            sheet.batch(function(){\n                for (var i = self._pos.count; --i >= 0;) {\n                    self._undoOne(sheet, self._pos.base);\n                }\n            }, { layout: true, recalc: true });\n        }\n    });\n\n    kendo.spreadsheet.AddColumnCommand = AddCommand.extend({\n        exec: function() {\n            var value = this._value;\n            var sheet = this.range().sheet();\n\n            if (value === \"left\") {\n                this._pos = sheet.axisManager().addColumnLeft();\n            } else {\n                this._pos = sheet.axisManager().addColumnRight();\n            }\n        },\n        _undoOne: function(sheet, index) {\n            sheet.deleteColumn(index);\n        }\n    });\n\n    kendo.spreadsheet.AddRowCommand = AddCommand.extend({\n        exec: function() {\n            var value = this._value;\n            var sheet = this.range().sheet();\n\n            if (value === \"above\") {\n                this._pos = sheet.axisManager().addRowAbove();\n            } else {\n                this._pos = sheet.axisManager().addRowBelow();\n            }\n        },\n        _undoOne: function(sheet, index) {\n            sheet.deleteRow(index);\n        }\n    });\n\n    kendo.spreadsheet.EditValidationCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this._value = options.value;\n        },\n        exec: function() {\n            var self = this, sheet = self.range().sheet();\n            this.getState();\n            if (sheet.trigger(\"changing\", { data: self._value, range: self.range(), changeType: COMMAND_TYPES.VALIDATION })) {\n                return;\n            }\n            try {\n                sheet.withCultureDecimals(function(){\n                    self.range().validation(self._value);\n                });\n            } catch(ex) {\n                if (ex instanceof kendo.spreadsheet.calc.ParseError) {\n                    return {\n                        title : \"Error in formula\",\n                        body  : ex+\"\",\n                        reason: \"error\"\n                    };\n                } else {\n                    throw ex;\n                }\n            }\n        },\n        undo: function() {\n            var editRange = this.range();\n            var state = this._state;\n            if (editRange.sheet().trigger(\"changing\", { data: state.data[0][0].validation, range: editRange, changeType: COMMAND_TYPES.VALIDATION })) {\n                return;\n            }\n            this.setState(this._state);\n        }\n    });\n\n    kendo.spreadsheet.OpenCommand = Command.extend({\n        cannotUndo: true,\n        exec: function() {\n            var file = this.options.file;\n            if (file.name.match(/.xlsx$/i) === null) {\n                return { reason: \"error\", type: \"openUnsupported\" };\n            }\n\n            var workbook = this.options.workbook;\n            workbook.fromFile(this.options.file).then(function(){\n                var errors = workbook.excelImportErrors;\n                if (errors && errors.length) {\n                    workbook._view.openDialog(\"importError\", {\n                        errors: errors\n                    });\n                }\n            });\n        }\n    });\n\n    kendo.spreadsheet.SaveAsCommand = Command.extend({\n        cannotUndo: true,\n        exec: function() {\n            var fileName = this.options.name + this.options.extension;\n            if (this.options.extension === \".xlsx\") {\n                this.options.workbook.saveAsExcel({\n                    fileName: fileName\n                });\n            } else if (this.options.extension === \".pdf\") {\n                this.options.workbook.saveAsPDF($.extend(this.options.pdf, {workbook: this.options.workbook, fileName: fileName}));\n            }\n        }\n    });\n\n    var NameCommand = Command.extend({\n        init: function(options) {\n            Command.fn.init.call(this, options);\n            this._name = options.name;\n            this._value = options.value;\n        },\n        getState: function() {\n            this._state = this._workbook.nameDefinition(this._name);\n        },\n        setState: function() {\n            this._workbook.nameDefinition(this._name, this._state);\n            this._workbook.trigger(\"change\", { recalc: true });\n        }\n    });\n\n    kendo.spreadsheet.DefineNameCommand = NameCommand.extend({\n        exec: function() {\n            this.getState();\n            try {\n                this._workbook.defineName(this._name, this._value);\n                this._workbook.trigger(\"change\", { recalc: true });\n            } catch(ex) {\n                return {\n                    title: \"Error\",\n                    body: ex+\"\",\n                    reason: \"error\"\n                };\n            }\n        }\n    });\n\n    kendo.spreadsheet.DeleteNameCommand = NameCommand.extend({\n        exec: function() {\n            this.getState();\n            this._workbook.undefineName(this._name);\n            this._workbook.trigger(\"change\", { recalc: true });\n        }\n    });\n\n})(kendo);\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/formulabar',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    var $ = kendo.jQuery;\n\n    var classNames = {\n        wrapper: \"k-spreadsheet-formula-bar\"\n    };\n\n    var FormulaBar = kendo.ui.Widget.extend({\n        init: function(element, options) {\n            kendo.ui.Widget.call(this, element, options);\n\n            element = this.element.addClass(FormulaBar.classNames.wrapper);\n\n            $(\"<span class='k-icon k-i-formula-fx' />\").prependTo(element);\n\n            var formulaBarWidth = element.width();\n\n            this.formulaInput = new kendo.spreadsheet.FormulaInput($(\"<div/>\")\n                .appendTo(element), { formulaBarWidth: formulaBarWidth });\n        },\n\n        destroy: function() {\n            if (this.formulaInput) {\n                this.formulaInput.destroy();\n            }\n            this.formulaInput = null;\n        }\n    });\n\n    kendo.spreadsheet.FormulaBar = FormulaBar;\n    $.extend(true, FormulaBar, { classNames: classNames });\n})(window.kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/formulainput',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo, window) {\n\n\n\n\n    var $ = kendo.jQuery;\n    var Widget = kendo.ui.Widget;\n    var ns = \".kendoFormulaInput\";\n    var keys = kendo.keys;\n    var classNames = {\n        wrapper: \"k-spreadsheet-formula-input\",\n        listWrapper: \"k-spreadsheet-formula-list\"\n    };\n    var styles = [\n        \"font-family\",\n        \"font-size\",\n        \"font-stretch\",\n        \"font-style\",\n        \"font-weight\",\n        \"letter-spacing\",\n        \"text-transform\",\n        \"line-height\"\n    ];\n\n    //move to core\n    var KEY_NAMES = {\n        27: 'esc',\n        37: 'left',\n        39: 'right',\n        35: 'end',\n        36: 'home',\n        32: 'spacebar'\n    };\n\n    var PRIVATE_FORMULA_CHECK = /(^_|[^a-z0-9]$)/i;\n\n    var FormulaInput = Widget.extend({\n        init: function(element, options) {\n            Widget.call(this, element, options);\n\n            element = this.element;\n\n            element.addClass(FormulaInput.classNames.wrapper)\n                .attr(\"contenteditable\", true)\n                .attr(\"spellcheck\", false)\n                .css(\"white-space\", \"pre\");\n\n            if (options && options.formulaBarWidth) {\n                element.css(\"max-width\", options.formulaBarWidth - 16 + \"px\");\n            }\n\n            if (this.options.autoScale) {\n                element.on(\"input\", this.scale.bind(this));\n            }\n\n            this._highlightedRefs = [];\n\n            this._formulaSource();\n\n            this._formulaList();\n\n            this._popup();\n\n            this._tooltip();\n\n            element\n                .on(\"keydown\", this._keydown.bind(this))\n                .on(\"keyup\", this._keyup.bind(this))\n                .on(\"blur\", this._blur.bind(this))\n                .on(\"input click\", this._input.bind(this))\n                .on(\"focus\", this._focus.bind(this))\n                .on(\"paste\", this._paste.bind(this));\n        },\n\n        options: {\n            name: \"FormulaInput\",\n            autoScale: false,\n            filterOperator: \"startswith\",\n            scalePadding: 30,\n            minLength: 1,\n            formulaBarWidth: null\n        },\n\n        events: [\n            \"keyup\",\n            \"focus\"\n        ],\n\n        enable: function(enable) {\n            if (enable === undefined) {\n                return this.element.attr(\"contenteditable\") === \"true\";\n            }\n\n            if (enable) {\n                this.element.attr(\"contenteditable\", enable);\n            } else {\n                this.element.removeAttr(\"contenteditable\");\n            }\n\n            this.element.toggleClass(\"k-disabled\", !enable);\n        },\n\n        getPos: function() {\n            var div = this.element[0];\n            var sel = window.getSelection();\n            var a = lookup(sel.focusNode, sel.focusOffset);\n            var b = lookup(sel.anchorNode, sel.anchorOffset);\n            if (a != null && b != null) {\n                if (a > b) {\n                    var tmp = a;\n                    a = b;\n                    b = tmp;\n                }\n                return { begin: a, end: b, collapsed: a == b };\n            }\n            function lookup(lookupNode, pos) {\n                try {\n                    (function loop(node){\n                        if (node === lookupNode) {\n                            throw pos;\n                        } else if (node.nodeType == 1 /* Element */) {\n                            for (var i = node.firstChild; i; i = i.nextSibling) {\n                                loop(i);\n                            }\n                        } else if (node.nodeType == 3 /* Text */) {\n                            pos += node.nodeValue.length;\n                        }\n                    })(div);\n                } catch (index) {\n                    return index;\n                }\n            }\n        },\n\n        setPos: function(begin, end) {\n            var eiv = this.element[0];\n            begin = lookup(eiv, begin);\n            if (end != null) {\n                end = lookup(eiv, end);\n            } else {\n                end = begin;\n            }\n            if (begin && end) {\n                var range = document.createRange();\n                range.setStart(begin.node, begin.pos);\n                range.setEnd(end.node, end.pos);\n                var sel = window.getSelection();\n                var currentRange = sel.getRangeAt(0);\n                if (differ(range, currentRange))  {\n                    sel.removeAllRanges();\n                    sel.addRange(range);\n                }\n            }\n            function differ(a, b) {\n                return (\n                    a.startOffset != b.startOffset ||\n                    a.endOffset != b.endOffset ||\n                    a.startContainer != b.endContainer ||\n                    a.endContainer != b.endContainer\n                );\n            }\n            function lookup(node, pos) {\n                try {\n                    (function loop(node){\n                        if (node.nodeType == 3 /* Text */) {\n                            var len = node.nodeValue.length;\n                            if (len >= pos) {\n                                throw node;\n                            }\n                            pos -= len;\n                        } else if (node.nodeType == 1 /* Element */) {\n                            for (var i = node.firstChild; i; i = i.nextSibling) {\n                                loop(i);\n                            }\n                        }\n                    })(node);\n                } catch (el) {\n                    return { node: el, pos: pos };\n                }\n            }\n        },\n\n        end: function() {\n            this.setPos(this.length());\n        },\n\n        home: function() {\n            this.setPos(0);\n        },\n\n        select: function() {\n            this.setPos(0, this.length());\n        },\n\n        length: function() {\n            return this.value().length;\n        },\n\n        _formulaSource: function() {\n            var result = [];\n            var value;\n\n            for (var key in kendo.spreadsheet.calc.runtime.FUNCS) {\n                if (!PRIVATE_FORMULA_CHECK.test(key)) {\n                    value = key.toUpperCase();\n                    result.push({ value: value, text: value });\n                }\n            }\n\n            this.formulaSource = new kendo.data.DataSource({ data: result });\n        },\n\n        _formulaList: function() {\n            this.list = new kendo.ui.StaticList($('<ul />')\n                .addClass(FormulaInput.classNames.listWrapper)\n                .insertAfter(this.element), {\n                    autoBind: false,\n                    selectable: true,\n                    change: this._formulaListChange.bind(this),\n                    dataSource: this.formulaSource,\n                    dataValueField: \"value\",\n                    template: \"#:data.value#\"\n                });\n\n            this.list.element.on(\"mousedown\", function(e) {\n                e.preventDefault();\n            });\n        },\n\n        _formulaListChange: function() {\n            var tokenCtx = this._tokenContext();\n\n            if (!tokenCtx || this._mute) {\n                return;\n            }\n\n            var activeToken = tokenCtx.token;\n            var completion = this.list.value()[0];\n            var ctx = {\n                replace: true,\n                token: activeToken,\n                end: activeToken.end\n            };\n\n            if (!tokenCtx.nextToken || tokenCtx.nextToken.value != \"(\") {\n                completion += \"(\";\n            }\n\n            this._replaceAt(ctx, completion);\n            this.popup.close();\n        },\n\n        _popup: function() {\n            this.popup = new kendo.ui.Popup(this.list.element, {\n                anchor: this.element\n            });\n        },\n\n        _blur: function() {\n            this.popup.close();\n            clearTimeout(this._focusId);\n            this.trigger(\"blur\");\n        },\n\n        _isFormula: function() {\n            return /^=/.test(this.value());\n        },\n\n        _keydown: function(e) {\n            var key = e.keyCode;\n            var that = this;\n\n            if (KEY_NAMES[key]) {\n                that.popup.close();\n                that._navigated = true;\n            } else if (that._move(key)) {\n                that._navigated = true;\n                e.preventDefault();\n            }\n\n            that._keyDownTimeout = setTimeout(that._syntaxHighlight.bind(that));\n        },\n\n        _keyup: function() {\n            var popup = this.popup;\n            var value;\n\n            if (this._isFormula() && !this._navigated) {\n                value = ((this._tokenContext() || {}).token || {}).value;\n\n                this.filter(value);\n\n                if (!value || !this.formulaSource.view().length) {\n                    popup.close();\n                } else {\n                    popup[popup.visible() ? \"position\" : \"open\"]();\n                    this.list.focusFirst();\n                }\n            }\n\n            this._navigated = false;\n            this._syntaxHighlight();\n\n            this.trigger(\"keyup\");\n        },\n\n        _input: function() {\n            this._syntaxHighlight();\n        },\n\n        _focus: function() {\n            setTimeout(this._sync.bind(this));\n            this._focusTimeout = setTimeout(this._syntaxHighlight.bind(this));\n            this.trigger(\"focus\");\n        },\n\n        _paste: function(ev) {\n            ev.preventDefault();\n            var pos = this.getPos();\n            var text;\n            if (kendo.support.browser.msie) {\n                text = window.clipboardData.getData(\"Text\");\n            } else {\n                text = ev.originalEvent.clipboardData.getData(\"text/plain\");\n            }\n            var val = this.value();\n            val = val.substr(0, pos.begin) + text + val.substr(pos.end);\n            this.value(val);\n            this.setPos(pos.begin + text.length);\n            this.scale();\n        },\n\n        _move: function(key) {\n            var list = this.list;\n            var popup = this.popup;\n            if (popup.visible()) {\n                if (key === keys.DOWN) {\n                    list.focusNext();\n                    if (!list.focus()) {\n                        list.focusFirst();\n                    }\n                    return true;\n                }\n                if (key === keys.UP) {\n                    list.focusPrev();\n                    if (!list.focus()) {\n                        list.focusLast();\n                    }\n                    return true;\n                }\n                if (key === keys.ENTER) {\n                    list.select(list.focus());\n                    popup.close();\n                    return true;\n                }\n                if (key === keys.TAB) {\n                    list.select(list.focus());\n                    popup.close();\n                    return true;\n                }\n                if (key === keys.PAGEUP) {\n                    list.focusFirst();\n                    return true;\n                }\n                if (key === keys.PAGEDOWN) {\n                    list.focusLast();\n                    return true;\n                }\n            }\n            return key === keys.ENTER || key === keys.TAB;\n        },\n\n        _tokenContext: function() {\n            var point = this.getPos();\n            var value = this.value();\n\n            if (!value || !point || !point.collapsed) {\n                return null;\n            }\n\n            var tokens = kendo.spreadsheet.calc.tokenize(value, this.row(), this.col());\n            var tok;\n\n            for (var i = 0; i < tokens.length; ++i) {\n                tok = tokens[i];\n                if (touches(tok, point) && /^(?:str|sym|func)$/.test(tok.type)) {\n                    return { token: tok, nextToken: tokens[i + 1] };\n                }\n            }\n\n            return null;\n        },\n\n        _sync: function() {\n            if (this._editorToSync && this.isActive()) {\n                this._editorToSync.value(this.value());\n            }\n        },\n\n        _textContainer: function() {\n            var computedStyles = kendo.getComputedStyles(this.element[0], styles);\n\n            computedStyles.position = \"absolute\";\n            computedStyles.visibility = \"hidden\";\n            computedStyles.whiteSpace = \"pre\";\n            computedStyles.top = -3333;\n            computedStyles.left = -3333;\n\n            this._span = $(\"<span style='white-space: pre'/>\").css(computedStyles).insertAfter(this.element);\n        },\n\n        _tooltip: function() {\n            this._cellTooltip = $('<div class=\"k-widget k-tooltip\" style=\"position:absolute; display:none\">A1</div>').insertAfter(this.element);\n        },\n\n        tooltip: function(value) {\n            this._cellTooltip.text(value);\n        },\n\n        toggleTooltip: function(show) {\n            this._cellTooltip.toggle(show);\n        },\n\n        isActive: function() {\n            return this.element[0] === kendo._activeElement();\n        },\n\n        filter: function(value) {\n            if (!value || value.length < this.options.minLength) {\n                return;\n            }\n\n            this._mute = true;\n            this.list.select(-1);\n            this._mute = false;\n\n            this.formulaSource.filter({\n                field: this.list.options.dataValueField,\n                operator: this.options.filterOperator,\n                value: value\n            });\n        },\n\n        hide: function() {\n            this.enable(false);\n            this.element.hide();\n            this._cellTooltip.hide();\n        },\n\n        show: function() {\n            this.enable(true);\n            this.element.show();\n        },\n\n        row: function() {\n            if (this.activeCell) {\n                return this.activeCell.row;\n            }\n        },\n\n        col: function() {\n            if (this.activeCell) {\n                return this.activeCell.col;\n            }\n        },\n\n        position: function(rectangle) {\n            if (!rectangle) {\n                return;\n            }\n\n            this.show();\n\n            this.element\n                .css({\n                    \"top\": rectangle.top + 1 + \"px\",\n                    \"left\": rectangle.left + 1 + \"px\"\n                });\n\n            this._cellTooltip.css({\n                \"top\": (rectangle.top - this._cellTooltip.height() - 10) + \"px\",\n                \"left\": rectangle.left\n            });\n        },\n\n        resize: function(rectangle) {\n            if (!rectangle) {\n                return;\n            }\n\n            this.element.css({\n                width: rectangle.width - 1,\n                height: rectangle.height - 1\n            });\n        },\n\n        canInsertRef: function(isKeyboardAction) {\n            return this._canInsertRef(isKeyboardAction);\n        },\n\n        _canInsertRef: function(isKeyboardAction) {\n            if (this.popup.visible()) {\n                return null;\n            }\n            var strictMode = isKeyboardAction;\n            var point = this.getPos();\n            var tokens, tok;\n\n            if (point && this._isFormula()) {\n                if (point.begin === 0) {\n                    return null;\n                }\n\n                tokens = kendo.spreadsheet.calc.tokenize(this.value(), this.row(), this.col());\n\n                for (var i = 0; i < tokens.length; ++i) {\n                    tok = tokens[i];\n                    if (touches(tok, point)) {\n                        return canReplace(tok);\n                    }\n                    if (afterPoint(tok)) {\n                        return canInsertBetween(tokens[i-1], tok);\n                    }\n                }\n                return canInsertBetween(tok, null);\n            }\n\n            return null;\n\n            function afterPoint(tok) {\n                return tok.begin > point.begin;\n            }\n            function canReplace(tok) {\n                if (tok) {\n                    if (/^(?:num|str|bool|sym|ref)$/.test(tok.type)) {\n                        return { replace: true, token: tok, end: tok.end };\n                    }\n                    if (/^(?:op|punc|startexp)$/.test(tok.type)) {\n                        if (tok.end == point.end) {\n                            return canInsertBetween(tok, tokens[i+1]);\n                        }\n                        return canInsertBetween(tokens[i-1], tok);\n                    }\n                }\n            }\n            function canInsertBetween(left, right) {\n                if (left == null) {\n                    return null;\n                }\n                if (right == null) {\n                    if (/^(?:op|startexp)$/.test(left.type) || isOpenParen(left.value)) {\n                        return { token: left, end: point.end };\n                    }\n                    return null;\n                }\n                if (strictMode) {\n                    if (left.type == \"op\" && /^(?:punc|op)$/.test(right.type)) {\n                        return { token: left, end: point.end };\n                    }\n                } else {\n                    if (left.type == \"startexp\") {\n                        return { token: left, end: point.end };\n                    }\n                    if (/^(?:op|punc)$/.test(left.type) && /^[,;({]$/.test(left.value)) {\n                        return { token: left, end: point.end };\n                    }\n                    if (/^(?:ref|sym)/.test(left.type)) {\n                        return { token: left, replace: true, end: left.end };\n                    }\n                    if (/^(?:ref|sym)/.test(right.type)) {\n                        return { token: right, replace: true, end: right.end };\n                    }\n                }\n                return false;\n            }\n        },\n\n        refAtPoint: function(sheet) {\n            var x = this._canInsertRef();\n            if (x) {\n                var ref = sheet.selection()._ref.simplify().clone().relative(0, 0, 3);\n                if (sheet.isMerged(ref)) {\n                    ref = ref.topLeft;\n                }\n                if (sheet !== this.activeSheet) {\n                    ref = ref.setSheet(sheet.name(), true);\n                }\n                this._replaceAt(x, ref.print(0, 0));\n            }\n        },\n\n        _replaceAt: function(ctx, newValue) {\n            var value = this.value();\n            var tok = ctx.token;\n            var rest = value.substr(ctx.end);\n            value = value.substr(0, ctx.replace ? tok.begin : ctx.end) + newValue;\n            var point = value.length;\n            value += rest;\n            this._value(value);\n            this.setPos(point);\n            this.scale();\n            this._syntaxHighlight();\n        },\n\n        syncWith: function(formulaInput) {\n            var self = this;\n\n            // IE does not support \"input\" event on elements with contenteditable\n            // https://developer.mozilla.org/en-US/docs/Web/Events/input#Browser_compatibility\n            var eventName = \"input\" + ns;\n            var handler = self._sync.bind(self), iehandler;\n            if (kendo.support.browser.msie) {\n                eventName = \"keydown\" + ns;\n                iehandler = function() {\n                    setTimeout(handler);\n                };\n            }\n\n            self._editorToSync = formulaInput;\n            self.element.off(eventName).on(eventName, iehandler || handler);\n        },\n\n        scale: function() {\n            var element = this.element;\n            var width, height;\n\n            if (!this._span) {\n                this._textContainer();\n            }\n\n            this._span.html(element.html());\n\n            width = this._span.width() + this.options.scalePadding;\n            height = this._span.height();\n\n            if (width > element.width()) {\n                element.width(width);\n            }\n            if (height > element.height()) {\n                element.height(height);\n            }\n\n            this._sync();\n        },\n\n        _value: function(value) {\n            this.element.text(value);\n        },\n\n        value: function(value) {\n            if (value === undefined) {\n                // jQuery's .text() discards the newlines for some reason\n                var txt = this.element[0].innerText;\n                return txt.replace(/\\n$/, \"\");\n            }\n\n            this._value(value);\n            this._syntaxHighlight();\n        },\n\n        highlightedRefs: function() {\n            return this._highlightedRefs.slice();\n        },\n\n        _syntaxHighlight: function() {\n            var pos = this.getPos();\n            var value = this.value();\n            var refClasses = kendo.spreadsheet.Pane.classNames.series;\n            var highlightedRefs = [];\n            var refIndex = 0;\n            var parens = [];\n            var tokens = [];\n            var activeToken;\n\n            if (pos && !pos.collapsed) {\n                // Backward selection (hold shift, move right to left)\n                // will not work properly if we continuously re-set\n                // the HTML.  If the selection is on, presumably the\n                // text has already been highlighted, so stop here.\n                return;\n            }\n\n            if (!(/^=/.test(value))) {\n                // if an user deleted the initial =, reset the text to\n                // discard any highlighting.  Only do that once.\n                if (this._highlightedRefs.length) {\n                    this._highlightedRefs = [];\n                    this.element.text(value);\n                }\n\n                // also make sure the completion popup goes away\n                if (this.popup) {\n                    this.popup.close();\n                }\n\n                return; // avoid messing with the cursor position below\n            } else {\n                tokens = kendo.spreadsheet.calc.tokenize(value, this.row(), this.col());\n                tokens.forEach(function(tok){\n                    tok.active = false;\n                    tok.cls = [ \"k-syntax-\" + tok.type ];\n\n                    if (tok.type == \"ref\") {\n                        tok.colorClass = refClasses[(refIndex++) % refClasses.length];\n                        tok.cls.push(tok.colorClass);\n                        highlightedRefs.push(tok);\n                    }\n                    if (pos && tok.type == \"punc\") {\n                        if (isOpenParen(tok.value)) {\n                            parens.unshift(tok);\n                        } else if (isCloseParen(tok.value)) {\n                            var open = parens.shift();\n                            if (open) {\n                                if (isMatchingParen(tok.value, open.value)) {\n                                    if (touches(tok, pos) || touches(open, pos)) {\n                                        tok.cls.push(\"k-syntax-paren-match\");\n                                        open.cls.push(\"k-syntax-paren-match\");\n                                    }\n                                } else {\n                                    tok.cls.push(\"k-syntax-error\");\n                                    open.cls.push(\"k-syntax-error\");\n                                }\n                            } else {\n                                tok.cls.push(\"k-syntax-error\");\n                            }\n                        }\n                    }\n                    if (pos && touches(tok, pos)) {\n                        tok.cls.push(\"k-syntax-at-point\");\n                        tok.active = true;\n                        activeToken = tok;\n                    }\n                    if (tok.type == \"func\" && !knownFunction(tok.value) && (!pos || !touches(tok, pos))) {\n                        tok.cls.push(\"k-syntax-error\");\n                    }\n                });\n                tokens.reverse().forEach(function(tok){\n                    var begin = tok.begin, end = tok.end;\n                    var text = kendo.htmlEncode(value.substring(begin, end));\n                    value = value.substr(0, begin) +\n                        \"<span class='\" + tok.cls.join(\" \") + \"'>\" + text + \"</span>\" +\n                        value.substr(end);\n                });\n                this.element.html(value);\n            }\n            if (pos) {\n                this.setPos(pos.begin, pos.end);\n            }\n\n            this._highlightedRefs = highlightedRefs;\n        },\n\n        destroy: function() {\n            this._editorToSync = null;\n\n            this.element.off(ns);\n\n            clearTimeout(this._focusTimeout);\n            clearTimeout(this._keyDownTimeout);\n\n            this._cellTooltip = null;\n            this._span = null;\n\n            this.popup.destroy();\n            this.popup = null;\n\n            Widget.fn.destroy.call(this);\n        },\n\n        insertNewline: function() {\n            var val = this.value();\n            var pos = this.getPos();\n            var eof = pos.end == val.length;\n            val = val.substr(0, pos.begin) + (eof ? \"\\n\\n\" : \"\\n\" + val.substr(pos.end));\n            this.value(val);\n            this.setPos(pos.begin + 1);\n        }\n    });\n\n    function isOpenParen(ch) {\n        return ch == \"(\" || ch == \"[\" || ch == \"{\";\n    }\n\n    function isCloseParen(ch) {\n        return ch == \")\" || ch == \"]\" || ch == \"}\";\n    }\n\n    function isMatchingParen(close, open) {\n        return open == \"(\" ? close == \")\"\n            :  open == \"[\" ? close == \"]\"\n            :  open == \"{\" ? close == \"}\"\n            :  false;\n    }\n\n    function touches(pos, target) {\n        return pos.begin <= target.begin && pos.end >= target.end;\n    }\n\n    function knownFunction(name) {\n        return kendo.spreadsheet.calc.runtime.FUNCS[name.toLowerCase()];\n    }\n\n    kendo.spreadsheet.FormulaInput = FormulaInput;\n    $.extend(true, FormulaInput, { classNames: classNames });\n})(kendo, window);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/eventlistener',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    var $ = kendo.jQuery;\n\n    var KEY_NAMES = {\n        8: 'backspace',\n        9: 'tab',\n        13: 'enter',\n        27: 'esc',\n        37: 'left',\n        38: 'up',\n        39: 'right',\n        40: 'down',\n        35: 'end',\n        36: 'home',\n        32: 'spacebar',\n        33: 'pageup',\n        34: 'pagedown',\n        46: 'delete',\n        113: ':edit'\n    };\n\n    var Mac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;\n\n    var isAlphaNum = function(keyCode) {\n        if ((keyCode > 47 && keyCode < 58)   || // number keys\n            (keyCode > 64 && keyCode < 91)   || // letter keys\n            (keyCode > 95 && keyCode < 112)  || // numpad keys\n            (keyCode > 185 && keyCode < 193) || // ;=,-./` (in order)\n            (keyCode > 218 && keyCode < 223) || // [\\]' (in order)\n            (keyCode === 229)                   // combined key event?\n           ) {\n            return true;\n        }\n\n        return false;\n    };\n\n    var keyName = function(event) {\n        var keyCode = event.keyCode;\n        var name = KEY_NAMES[keyCode];\n\n        if (!name && isAlphaNum(keyCode)) {\n            name = \":alphanum\";\n        }\n\n        // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key\n        //\n        // Fix for https://github.com/telerik/kendo-ui-core/issues/2284\n        // (starting editor with `=` on Firefox)\n        if (!name && event.key && event.key.length == 1) {\n            name = \":alphanum\";\n        }\n\n        return name;\n    };\n\n    var EventListener = kendo.Class.extend({\n        init: function(target, observer, handlers) {\n            this._handlers = {};\n            this.target = target;\n            this._observer = observer || window;\n\n            this.keyDownProxy = this.keyDown.bind(this);\n            this.mouseProxy = this.mouse.bind(this);\n            this.touchProxy = this.touch.bind(this);\n            this.threshold = 5;\n            this._pressLocation = null;\n\n            target.on(\"keydown\", this.keyDownProxy);\n            target.on(\"contextmenu mousedown cut copy paste scroll wheel click dblclick focus\", this.mouseProxy);\n            target.on(\"touchmove touchend\", this.touchProxy);\n\n            $(document.documentElement).on(\"mousemove mouseup\", this.mouseProxy);\n            $(document.documentElement).on(\"touchmove touchend\", this.touchProxy);\n\n            if (handlers) {\n                for (var key in handlers) {\n                    this.on(key, handlers[key]);\n                }\n            }\n        },\n\n        keyDown: function(e) {\n            // Do not handle keys for Toolbar Tab switch shortcuts\n            if (e.altKey && (e.key === \"n\" || e.key === \"h\" || e.key === \"a\")) {\n                return;\n            }\n\n            this.handleEvent(e, keyName(e.originalEvent));\n        },\n\n        touch: function(e) {\n            this.handleEvent(e, e.type);\n        },\n\n        mouse: function(e) {\n            var rightClick;\n\n            if (e.which) {\n                rightClick = (e.which == 3);\n            } else if (e.button) {\n                rightClick = (e.button == 2);\n            }\n\n            var type = e.type;\n\n            if (type === \"mousedown\") {\n                if (rightClick) {\n                   type = \"rightmousedown\";\n                } else {\n                    this._pressLocation = { x: e.pageX, y: e.pageY };\n                }\n            }\n\n            if (type === \"mouseup\") {\n                if (!rightClick) {\n                    this._pressLocation = null;\n                }\n            }\n\n            if (type === \"mousemove\" && this._pressLocation) {\n                var dx = this._pressLocation.x - e.pageX;\n                var dy = this._pressLocation.y - e.pageY;\n                var distance = Math.sqrt(dx*dx + dy*dy);\n\n                if (distance > this.threshold) {\n                    type = \"mousedrag\";\n                }\n            }\n\n            this.handleEvent(e, type);\n        },\n\n        handleEvent: function(e, name) {\n            var eventKey = \"\";\n\n            e.mod = Mac ? e.metaKey : (e.ctrlKey && !e.altKey);\n\n            if (e.altKey) {\n                eventKey += \"alt+\";\n            }\n\n            if (e.shiftKey) {\n                eventKey += \"shift+\";\n            }\n\n            if (e.ctrlKey) {\n                eventKey += \"ctrl+\";\n            }\n\n            eventKey += name;\n\n            var catchAllHandler = this._handlers['*+' + name];\n\n            if (catchAllHandler) {\n                catchAllHandler.call(this._observer, e, eventKey);\n            }\n\n            var handler = this._handlers[eventKey];\n\n            if (handler) {\n                handler.call(this._observer, e, eventKey);\n            }\n        },\n\n        on: function(event, callback) {\n            var handlers = this._handlers;\n\n            if (typeof callback === \"string\") {\n                callback = this._observer[callback];\n            }\n\n            if (typeof event === \"string\") {\n                event = event.split(\",\");\n            }\n\n            event.forEach(function(e) {\n                handlers[e] = callback;\n            });\n        },\n\n        destroy: function() {\n            this.target.off(\"keydown\", this.keyDownProxy);\n            this.target.off(\"keydown\", this.mouseProxy);\n            $(document.documentElement).off(\"mousemove mouseup\", this.mouseProxy);\n        }\n    });\n\n    kendo.spreadsheet.EventListener = EventListener;\n})(window.kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/rangelist',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo) {\n\n\n\n    var RangeTreeNode = kendo.Class.extend({\n        init: function Node(level, value, left, right) {\n            this.level = level;\n            this.value = value;\n            this.left = left;\n            this.right = right;\n        }\n    });\n\n    var NilNode = new (function NIL() { \n        this.left = this;\n        this.right = this;\n        this.level = 0;\n    })();\n\n    function skew(node) {\n        if (node.left.level === node.level) {\n            var temp = node;\n            node = node.left;\n            temp.left = node.right;\n            node.right = temp;\n        }\n\n        return node;\n    }\n\n    function split(node) {\n        if (node.right.right.level === node.level) {\n            var temp = node;\n            node = node.right;\n            temp.right = node.left;\n            node.left = temp;\n            node.level += 1;\n        }\n\n        return node;\n    }\n\n    function insert(node, value) {\n        if (node === NilNode) {\n            return new RangeTreeNode(1, value, NilNode, NilNode);\n        } else if (node.value.start > value.start) {\n            node.left = insert(node.left, value);\n        } else {\n            node.right = insert(node.right, value);\n        }\n\n        return split(skew(node));\n    }\n\n    function remove(node, value) {\n        if (node === NilNode) {\n            return node;\n        }\n\n        var diff = node.value.start - value.start;\n        if (diff === 0) {\n            if (node.left !== NilNode && node.right !== NilNode) {\n                var heir = node.left;\n\n                while (heir.right !== NilNode) {\n                    heir = heir.right;\n                }\n\n                node.value = heir.value;\n                node.left = remove(node.left, node.value);\n            } else if (node.left === NilNode) {\n                node = node.right;\n            } else {\n                node = node.left;\n            }\n        } else if (diff > 0) {\n            node.left = remove(node.left, value);\n        } else {\n            node.right = remove(node.right, value);\n        }\n\n        if (node.left.level < (node.level - 1) || node.right.level < (node.level - 1)) {\n            node.level -= 1;\n            if (node.right.level > node.level) {\n                node.right.level = node.level;\n            }\n\n            node = skew(node);\n            node.right = skew(node.right);\n            node.right.right = skew(node.right.right);\n            node = split(node);\n            node.right = split(node.right);\n        }\n\n        return node;\n    }\n\n    var Range = kendo.Class.extend({\n        init: function ValueRange(start, end, value) {\n            this.start = start;\n            this.end = end;\n            this.value = value;\n        },\n\n        intersects: function(range) {\n            return range.start <= this.end && range.end >= this.start;\n        },\n\n        clone: function() {\n            return new Range(this.start, this.end, this.value);\n        }\n    });\n\n    var RangeTree = kendo.Class.extend({\n        init: function RangeTree() {\n            this.root = NilNode;\n        },\n\n        insert: function(value) {\n            this.root = insert(this.root, value);\n        },\n\n        remove: function(value) {\n            this.root = remove(this.root, value);\n        },\n\n        findrange: function(value) {\n            var node = this.root;\n\n            while (node != NilNode) {\n                if (value < node.value.start) {\n                    node = node.left;\n                } else if (value > node.value.end) {\n                    node = node.right;\n                } else {\n                    return node.value;\n                }\n            }\n\n            return null;\n        },\n\n        values: function() {\n            var result = [];\n            values(this.root, result);\n            return result;\n        },\n\n        intersecting: function(start, end) {\n            var ranges = [];\n            intersecting(this.root, new Range(start, end), ranges);\n            return ranges;\n        },\n\n        map: function(callback) {\n            var tree = new RangeTree();\n            map(tree, this.root, callback);\n            return tree;\n        },\n\n        forEach: function(callback) {\n            forEach(this.root, callback);\n        },\n\n        clone: function() {\n            return this.map(function(value) {\n                return value.clone();\n            });\n        },\n\n        first: function() {\n            var first = this.root;\n            while(first.left != NilNode) {\n                first = first.left;\n            }\n\n            return first;\n        },\n\n        last: function() {\n            var last = this.root;\n            while(last.right != NilNode) {\n                last = last.right;\n            }\n\n            return last;\n        }\n    });\n\n    function values(node, result) {\n        if (node === NilNode) {\n            return;\n        }\n\n        values(node.left, result);\n        result.push(node.value);\n        values(node.right, result);\n    }\n\n    function intersecting(node, range, ranges) {\n        if (node === NilNode) {\n            return;\n        }\n\n        var value = node.value;\n\n        if (range.start < value.start) {\n            intersecting(node.left, range, ranges);\n        }\n\n        if (value.intersects(range)) {\n            ranges.push(value);\n        }\n\n        if (range.end > value.end) {\n            intersecting(node.right, range, ranges);\n        }\n    }\n\n    function map(tree, root, callback) {\n        if (root === NilNode) {\n            return;\n        }\n        map(tree, root.left, callback);\n        tree.insert(callback(root.value));\n        map(tree, root.right, callback);\n    }\n\n    function forEach(root, callback) {\n        if (root === NilNode) {\n            return;\n        }\n        forEach(root.left, callback);\n        callback(root.value);\n        forEach(root.right, callback);\n    }\n\n    var RangeList = kendo.Class.extend({\n        init: function RangeList(start, end, value) {\n            if (end === undefined) {\n                this.tree = start;\n            } else {\n                this.tree = new RangeTree();\n                this.tree.insert(new Range(start, end, value));\n            }\n        },\n\n        values: function() {\n            return this.tree.values();\n        },\n\n        map: function(callback) {\n            return new RangeList(this.tree.map(callback));\n        },\n\n        forEach: function(callback) {\n            this.tree.forEach(callback);\n        },\n\n        intersecting: function(start, end) {\n            return this.tree.intersecting(start, end);\n        },\n\n        first: function() {\n            return this.tree.first().value;\n        },\n\n        last: function() {\n            return this.tree.last().value;\n        },\n\n        insert: function(start, end, value) {\n            return this.tree.insert(new Range(start, end, value));\n        },\n\n        value: function(start, end, value) {\n            if (value === undefined) {\n                if (end === undefined) {\n                    end = start;\n                }\n                return this.intersecting(start, end)[0].value;\n            }\n\n            var ranges = this.tree.intersecting(start - 1, end + 1);\n\n            if (ranges.length) {\n                var firstRange = ranges[0], lastRange = ranges[ranges.length - 1];\n\n                if (firstRange.end < start) {\n                    if (firstRange.value === value) {\n                        start = firstRange.start;\n                    } else {\n                        ranges.shift();\n                    }\n                }\n\n                if (lastRange.start > end) {\n                    if (lastRange.value === value) {\n                        end = lastRange.end;\n                    } else {\n                        ranges.pop();\n                    }\n                }\n\n                for (var i = 0, length = ranges.length; i < length; i++) {\n                    var range = ranges[i];\n                    var rangeValue = range.value;\n                    var rangeStart = range.start;\n                    var rangeEnd = range.end;\n\n                    this.tree.remove(range);\n\n                    if (rangeStart < start) {\n                        if (rangeValue !== value) {\n                            this.insert(rangeStart, start - 1, rangeValue);\n                        } else {\n                            start = rangeStart;\n                        }\n                    }\n\n                    if (rangeEnd > end) {\n                        if (rangeValue !== value) {\n                            this.insert(end + 1, rangeEnd, rangeValue);\n                        } else {\n                            end = rangeEnd;\n                        }\n                    }\n                }\n            }\n\n            this.insert(start, end, value);\n        },\n\n        expandedValues: function(start, end) {\n            var ranges = this.intersecting(start, end);\n            var result = [];\n\n            var rangeIndex = 0;\n\n            for (var i = start; i <= end; i++) {\n                if (ranges[rangeIndex].end < i) {\n                    rangeIndex ++;\n                }\n\n                result.push({ index: i - start, value: ranges[rangeIndex].value });\n            }\n\n            return result;\n        },\n\n        sortedIndices: function(start, end, valueComparer, indices) {\n            var result = this.expandedValues(start, end);\n\n            var comparer = function(a, b) {\n                if (a.value === b.value) {\n                    return a.index - b.index;\n                }\n\n                return valueComparer(a.value, b.value);\n            };\n\n            if (indices) {\n                comparer = function(a, b) {\n                    var x = indices[a.index];\n                    var y = indices[b.index];\n\n                    if (x.value === y.value) {\n                        return valueComparer(a.value, b.value);\n                    }\n\n                    return a.index - b.index;\n                };\n            }\n\n            result.sort(comparer);\n\n            return result;\n        },\n\n        sort: function(start, end, indices) {\n            if (this.intersecting(start, end).length === 1) {\n                return;\n            }\n\n            var values = this.expandedValues(start, end);\n\n            for (var i = 0, len = indices.length; i < len; i++) {\n                this.value(i + start, i + start, values[indices[i].index].value);\n            }\n        },\n\n        copy: function(sourceStart, sourceEnd, targetStart) {\n            var values = this.intersecting(sourceStart, sourceEnd);\n\n            var start = targetStart;\n            var end;\n\n            for (var i = 0, len = values.length; i < len; i++) {\n                var rangeStart = values[i].start;\n\n                if (rangeStart < sourceStart) {\n                    rangeStart = sourceStart;\n                }\n\n                var rangeEnd = values[i].end;\n\n                if (rangeEnd > sourceEnd) {\n                    rangeEnd = sourceEnd;\n                }\n\n                end = start + (rangeEnd - rangeStart);\n\n                this.value(start, end, values[i].value);\n\n                start = ++end;\n            }\n        },\n\n        iterator: function(start, end) {\n            return new Iterator(start, end, this.intersecting(start, end));\n        },\n\n        getState: function() {\n            return this.tree.clone();\n        },\n\n        setState: function(state) {\n            this.tree = state.clone();\n        },\n\n        toJSON: function() {\n            return this.values();\n        },\n\n        fromJSON: function(values) {\n            values.forEach(function(v){\n                this.value(v.start, v.end, v.value);\n            }, this);\n        }\n    });\n\n    var Iterator = kendo.Class.extend({\n        init: function(start, end, ranges) {\n            this.start = start;\n            this.end = end;\n            this.index = 0;\n            this.ranges = ranges;\n        },\n\n        unique: function() {\n            return this.ranges.map(function(range) {\n                return range.value;\n            });\n        },\n\n        at: function(index) {\n            while (this.ranges[this.index] && this.ranges[this.index].end < index) {\n                this.index ++;\n            }\n\n            return this.ranges[this.index] && this.ranges[this.index].value;\n        },\n\n        forEach: function(callback) {\n            for (var i = this.start; i <= this.end; i++) {\n                callback(this.at(i), i);\n            }\n\n            this.index = 0;\n        }\n    });\n\n    var SparseRangeList = RangeList.extend({\n        init: function(start, end, value) {\n            this._defaultValue = value;\n            this.tree = new RangeTree();\n            this.range = new Range(start, end, value);\n        },\n\n        intersecting: function(start, end) {\n            var ranges = this.tree.intersecting(start, end);\n            var result = [];\n            var range;\n\n            if (!ranges.length) {\n                return [this.range];\n            }\n\n            for (var i = 0, len = ranges.length; i < len; i++) {\n                range = ranges[i];\n                if (range.start > start) {\n                    result.push(new Range(start, range.start - 1, this.range.value));\n                }\n\n                result.push(range);\n                start = range.end + 1;\n            }\n\n            if (range.end < end) {\n                result.push(new Range(range.end + 1, end, this.range.value));\n            }\n\n            return result;\n        },\n\n        insert: function(start, end, value) {\n            if (value == null) {\n                value = this._defaultValue;\n            }\n            if (value !== this.range.value) {\n                this.tree.insert(new Range(start, end, value));\n            }\n        },\n\n        lastRangeStart: function() {\n            var node = this.tree.root;\n\n            if (node === NilNode) {\n                return this.range.start;\n            }\n\n            while(node.right !== NilNode) {\n                node = node.right;\n            }\n\n            return node.value.end + 1;\n        }\n    });\n\n\n    kendo.spreadsheet.RangeTree = RangeTree;\n    kendo.spreadsheet.RangeList = RangeList;\n    kendo.spreadsheet.SparseRangeList = SparseRangeList;\n    kendo.spreadsheet.ValueRange = Range;\n})(kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/propertybag',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    var Property = kendo.Class.extend({\n        init: function(list) {\n            this.list = list;\n        },\n\n        get: function(index) {\n            return this.parse(this.list.value(index, index));\n        },\n\n        set: function(start, end, value) {\n            if (value === undefined) {\n                value = end;\n                end = start;\n            }\n\n            this.list.value(start, end, value);\n        },\n\n        parse: function(value) {\n            return value;\n        },\n\n        copy: function(start, end, dst) {\n            this.list.copy(start, end, dst);\n        },\n\n        iterator: function(start, end) {\n            return this.list.iterator(start, end);\n        }\n    });\n\n    var JsonProperty = Property.extend({\n        set: function(start, end, value) {\n            this.list.value(start, end, JSON.stringify(value));\n        },\n\n        parse: function(value) {\n            return JSON.parse(value);\n        }\n    });\n\n    var ValueProperty = Property.extend({\n        init: function(values, formats) {\n            Property.prototype.init.call(this, values);\n            this.formats = formats;\n        },\n\n        set: function(start, end, value) {\n            if (value instanceof Date) {\n                value = kendo.spreadsheet.dateToNumber(value);\n                if (!this.formats.value(start,end)) {\n                    this.formats.value(start, end, toExcelFormat(kendo.culture().calendar.patterns.d));\n                }\n            } else if (typeof value == \"number\") {\n                value = kendo.spreadsheet.calc.runtime.limitPrecision(value);\n            }\n\n            this.list.value(start, end, value);\n        }\n    });\n\n    function toExcelFormat(format) {\n        return format.replace(/M/g, \"m\").replace(/'/g, '\"').replace(/tt/, \"am/pm\");\n    }\n\n    kendo.spreadsheet.PropertyBag = kendo.Class.extend({\n        specs: [\n            { property: Property, name: \"format\", value: null, sortable: true, serializable: true },\n            { property: ValueProperty, name: \"value\", value: null, sortable: true, serializable: true, depends: \"format\" },\n            { property: Property, name: \"formula\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"background\", value: null, sortable: true, serializable: true },\n            { property: JsonProperty, name: \"vBorders\", value: null, sortable: false, serializable: false },\n            { property: JsonProperty, name: \"hBorders\", value: null, sortable: false, serializable: false },\n            { property: Property, name: \"color\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"fontFamily\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"underline\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"fontSize\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"italic\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"bold\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"textAlign\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"indent\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"verticalAlign\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"wrap\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"validation\", value: null, sortable: false, serializable: true },\n            { property: Property, name: \"enable\", value: null, sortable: false, serializable: true },\n            { property: Property, name: \"link\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"editor\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"comment\", value: null, sortable: true, serializable: true },\n            { property: Property, name: \"html\", value: null, sortable: true, serializable: true }\n        ],\n\n        init: function(rowCount, columnCount, defaultValues) {\n            defaultValues = defaultValues || {};\n            var cellCount = rowCount * columnCount - 1;\n\n            this.rowCount = rowCount;\n            this.columnCount = columnCount;\n            this.cellCount = cellCount;\n            this.properties = {};\n            this.lists = {};\n\n            this.specs.forEach(function(spec) {\n                var name = spec.name;\n                var value = defaultValues[name];\n                if (value === undefined) {\n                    value = spec.value;\n                }\n                this.lists[name] = new kendo.spreadsheet.SparseRangeList(0, cellCount, value);\n                var prop = this.properties[name] = new spec.property(this.lists[name], this.lists[spec.depends]);\n                prop.spec = spec;\n            }, this);\n\n            // XXX: this is a hack but I have no better ideas at this\n            // point.  The getState() method in a SparseRangeList\n            // clones the tree (which just copies values over), but\n            // formulas are objects maintaining complex state.\n            // https://github.com/telerik/kendo-ui-core/issues/2816\n            this.lists.formula.tree.clone = cloneFormulaTree;\n            this.lists.validation.tree.clone = cloneFormulaTree;\n        },\n\n        _resize: function(new_rows, new_cols) {\n            var self = this;\n            var old_rows = self.rowCount;\n            var cell_count = new_rows * new_cols - 1;\n            function scaleIndex(index) {\n                var col = index / old_rows | 0;\n                var row = index % old_rows;\n                return col * new_rows + row;\n            }\n            function scaleNode(node) {\n                // node is a ValueRange from rangelist.js\n                // start/end are rowCount * col + row\n                node.start = scaleIndex(node.start);\n                node.end = scaleIndex(node.end);\n            }\n            Object.keys(self.lists).forEach(function(name) {\n                var list = self.lists[name];\n                if (new_rows != old_rows) {\n                    list.forEach(scaleNode);\n                }\n                list.range.end = cell_count;\n            });\n            self.rowCount = new_rows;\n            self.columnCount = new_cols;\n            self.cellCount = cell_count;\n        },\n\n        getState: function() {\n            var state = {};\n\n            this.specs.forEach(function(spec) {\n               state[spec.name] = this.lists[spec.name].getState();\n            }, this);\n\n            return state;\n        },\n\n        setState: function(state) {\n            this.specs.forEach(function(spec) {\n                this.lists[spec.name].setState(state[spec.name]);\n            }, this);\n        },\n\n        get: function(name, index) {\n            if (index === undefined) {\n                return this.lists[name];\n            }\n\n            switch (name) {\n              case \"borderRight\":\n                index += this.rowCount;\n                /* falls through */\n              case \"borderLeft\":\n                name = \"vBorders\";\n                break;\n\n              case \"borderBottom\":\n                index++;\n                /* falls through */\n              case \"borderTop\":\n                name = \"hBorders\";\n                break;\n            }\n            return index > this.cellCount ? null : this.properties[name].get(index);\n        },\n\n        set: function(name, start, end, value) {\n            switch (name) {\n              case \"borderRight\":\n                start += this.rowCount;\n                end += this.rowCount;\n                /* falls through */\n              case \"borderLeft\":\n                name = \"vBorders\";\n                break;\n\n              case \"borderBottom\":\n                start++;\n                end++;\n                /* falls through */\n              case \"borderTop\":\n                name = \"hBorders\";\n                break;\n            }\n            if (start <= end && end <= this.cellCount) {\n                this.properties[name].set(start, end, value);\n            }\n        },\n\n        fromJSON: function(index, value) {\n            for (var si = 0; si < this.specs.length; si++) {\n                var spec = this.specs[si];\n\n                if (spec.serializable) {\n                    if (value[spec.name] !== undefined) {\n                        this.set(spec.name, index, index, value[spec.name], false);\n                    }\n                }\n            }\n\n            [ \"borderLeft\", \"borderRight\", \"borderTop\", \"borderBottom\" ].forEach(function(b){\n                if (value[b] !== undefined) {\n                    this.set(b, index, index, value[b]);\n                }\n            }, this);\n        },\n\n        copy: function(sourceStart, sourceEnd, targetStart) {\n            this.specs.forEach(function(spec) {\n                this.properties[spec.name].copy(sourceStart, sourceEnd, targetStart);\n            }, this);\n        },\n\n        iterator: function(name, start, end) {\n            var prop = this.properties[name];\n            var iter = prop.iterator(start, end), at = iter.at;\n            var cellCount = this.cellCount;\n            iter.at = function(index) {\n                return index > cellCount ? null : prop.parse(at.call(iter, index));\n            };\n            iter.name = name;\n            iter.value = prop.spec.value;\n            return iter;\n        },\n\n        sortable: function() {\n            return this.specs.filter(function(spec) { return spec.sortable; })\n                .map(function(spec) {\n                    return this.lists[spec.name];\n                }, this);\n        },\n\n        iterators: function(start, end) {\n            return this.specs.reduce(function(ret, spec) {\n                if (spec.serializable) {\n                    ret.push(this.iterator(spec.name, start, end));\n                }\n                return ret;\n            }.bind(this), []);\n        },\n\n        forEach: function(start, end, callback) {\n            var iterators = this.iterators(start, end);\n            var hBorders = this.iterator(\"hBorders\", start, end + 1);\n            var leftBorders = this.iterator(\"vBorders\", start, end);\n            var rightBorders = this.iterator(\"vBorders\", start + this.rowCount, end + this.rowCount);\n            var values, index;\n\n            function addBorder(name, iterator, index) {\n                var val = iterator.at(index);\n                if (val !== iterator.value) {\n                    values[name] = val;\n                }\n            }\n\n            for (index = start; index <= end; index++) {\n                values = {};\n\n                for (var i = 0; i < iterators.length; i++) {\n                    var iterator = iterators[i];\n                    var value = iterator.at(index);\n\n                    if (value !== iterator.value) {\n                        values[iterator.name] = value;\n                    }\n                }\n\n                addBorder(\"borderLeft\", leftBorders, index);\n                addBorder(\"borderRight\", rightBorders, index + this.rowCount);\n                addBorder(\"borderTop\", hBorders, index);\n                if ((index + 1) % this.rowCount) {\n                    addBorder(\"borderBottom\", hBorders, index + 1);\n                }\n\n                callback(values);\n            }\n        },\n\n        forEachProperty: function(callback) {\n            for (var name in this.properties) {\n                callback(this.properties[name]);\n            }\n        }\n    });\n\n    function cloneFormulaValue(x) {\n        x = x.clone();\n        x.value = x.value.deepClone(); // x.value is Formula or Validation\n        return x;\n    }\n\n    function cloneFormulaTree() {\n        var tree = this.map(cloneFormulaValue);\n        tree.clone = cloneFormulaTree; // because it's a new RangeTree now\n        return tree;\n    }\n\n    kendo.spreadsheet.ALL_PROPERTIES = kendo.spreadsheet.PropertyBag.prototype.specs.reduce(function(a, spec) {\n        if (spec.serializable) {\n            a.push(spec.name);\n        }\n        return a;\n    }, [ \"borderTop\", \"borderRight\", \"borderBottom\", \"borderLeft\" ]);\n\n})(window.kendo);\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n// -*- fill-column: 100 -*-\n\n(function(f, define){\n    define('spreadsheet/references',[\"kendo.core\"], f);\n})(function(){\n    // WARNING: removing the following jshint declaration and turning\n    // == into === to make JSHint happy will break functionality.\n\n\n    \"use strict\";\n\n    var spreadsheet = kendo.spreadsheet;\n    var Class = kendo.Class;\n\n    function columnName(colIndex) {\n        var letter = Math.floor(colIndex / 26) - 1;\n        return (letter >= 0 ? columnName(letter) : \"\") + String.fromCharCode(65 + (colIndex % 26));\n    }\n\n    function displaySheet(sheet) {\n        if (/^[a-z_][a-z0-9_]*$/i.test(sheet)) {\n            return sheet;\n        }\n        return \"'\" + sheet.replace(/\\x27/g, \"\\\\'\") + \"'\";\n    }\n\n    function displayRef(sheet, row, col, rel) {\n        var aa = \"\";\n\n        ++row;\n\n        if (!isFinite(row)) {\n            row = \"\";\n        }\n        else if (rel != null && !(rel & 2)) {\n            row = \"$\" + row;\n        }\n\n        if (!isFinite(col)) {\n            col = \"\";\n        }\n        else {\n            aa = columnName(col);\n            if (rel != null && !(rel & 1)) {\n                aa = \"$\" + aa;\n            }\n        }\n\n        if (sheet) {\n            return displaySheet(sheet) + \"!\" + aa + row;\n        } else {\n            return aa + row;\n        }\n    }\n\n    /* -----[ References ]----- */\n\n    var Ref = Class.extend({\n        type: \"ref\",\n        sheet: \"\",\n        clone: function() {\n            return this;\n        },\n        hasSheet: function() {\n            return this._hasSheet;\n        },\n        simplify: function() {\n            return this;\n        },\n        setSheet: function(sheet, hasSheet) {\n            this.sheet = sheet;\n            if (hasSheet != null) {\n                this._hasSheet = hasSheet;\n            }\n            return this;\n        },\n        absolute: function(){\n            return this;\n        },\n        relative: function(){\n            return this;\n        },\n        adjust: function(){\n            return this;\n        },\n        toString: function() {\n            return this.relative(0, 0, 3, 3).print(0, 0);\n        },\n        forEach: function(callback, obj) {\n            callback.call(obj, this);\n        },\n        map: function(callback, obj) {\n            return callback.call(obj, this);\n        },\n        intersects: function(ref) {\n            return this.intersect(ref) !== NULL;\n        },\n        isCell: function() {\n            return false;\n        },\n        toRow: function() {\n            return this;\n        },\n        toColumn: function() {\n            return this;\n        },\n\n        // UnionRef overrides these, to access its subranges.\n        first: function() {\n            return this;\n        },\n        lastRange: function() {\n            return this;\n        },\n        size: function() {\n            return 1;\n        },\n        rangeAt: function() {\n            return this;\n        },\n        nextRangeIndex: function() {\n            return 0;\n        },\n        previousRangeIndex: function() {\n            return 0;\n        },\n        eq: function(reference) {\n            var r1 = this;\n            var r2 = reference;\n\n            if (r1 === NULL || r2 === NULL) {\n                return r1 === r2;\n            }\n\n            // make positions consistent\n            if ((r2 instanceof CellRef) || (r2 instanceof RangeRef && !(r1 instanceof CellRef))) {\n               r1 = reference;\n               r2 = this;\n            }\n\n            if (r1 instanceof CellRef) { // cell eq *\n                r2 = r2.simplify();\n                return r2 instanceof CellRef && r1.row == r2.row && r1.col == r2.col && r1.sheet == r2.sheet;\n            }\n            else if (r1 instanceof RangeRef) { // range eq range/union\n                if (r2 instanceof RangeRef) {\n                    return r2.topLeft.eq(r1.topLeft) && r2.bottomRight.eq(r1.bottomRight);\n                }\n                if (r2 instanceof UnionRef) {\n                    return r2.single() && r1.eq(r2.refs[0]);\n                }\n            }\n            else if (r1 instanceof UnionRef && r2 instanceof UnionRef) { // union eq union\n                var refs1 = r1.refs;\n                var refs2 = r2.refs;\n                if (refs1.length != refs2.length) {\n                   return false;\n                }\n\n                for (var i = 0, len = refs1.length; i < len; i++) {\n                    if (!refs1[i].eq(refs2[i])) {\n                        return false;\n                    }\n                }\n\n                return true;\n            }\n\n            return r1 === r2;   // XXX: possibly NameRef when we'll support it.\n        },\n\n        concat: function(ref) {\n            return new UnionRef([this, ref]);\n        },\n\n        replaceAt: function(index, ref) {\n            return ref;\n        },\n\n        forEachColumnIndex: function(callback) {\n            this.forEachAxisIndex('col', callback);\n        },\n\n        forEachRowIndex: function(callback) {\n            this.forEachAxisIndex('row', callback);\n        },\n\n        forEachAxisIndex: function(axis, callback) {\n            var sorted = [];\n\n            var method = axis === 'row' ? 'forEachRow' : 'forEachColumn';\n\n            this[method](function(ref) {\n                var index = ref.first()[axis];\n                if (sorted.indexOf(index) === -1) {\n                    sorted.push(index);\n                }\n            });\n\n            sorted.sort(function(a,b) {\n                return a > b ? 1 : (a < b ? -1 : 0);\n            }).forEach(callback);\n        },\n\n        valid: function() {\n            return false;\n        },\n\n        renameSheet: function(oldSheetName, newSheetName) {\n            if (this.sheet && this.sheet.toLowerCase() == oldSheetName.toLowerCase()) {\n                this.sheet = newSheetName;\n                return true;\n            }\n        }\n    });\n\n    Ref.display = displayRef;\n\n    /* -----[ Null reference ]----- */\n\n    var NULL = new (Ref.extend({\n        init: function NullRef(){},\n        print: function() {\n            return \"#NULL!\";\n        },\n        eq: function(ref) {\n            return ref === this;\n        },\n        forEach: function() {}\n    }))();\n\n    /* -----[ Name reference ]----- */\n\n    var NameRef = Ref.extend({\n        ref: \"name\",\n        init: function NameRef(name){\n            this.name = name;\n        },\n        clone: function() {\n            return new NameRef(this.name)\n                .setSheet(this.sheet, this.hasSheet());\n        },\n        print: function() {\n            var ret = displaySheet(this.name);\n            if (this.hasSheet()) {\n                ret = displaySheet(this.sheet) + \"!\" + ret;\n            }\n            return ret;\n        }\n    });\n\n    /* -----[ Cell reference ]----- */\n\n    var CellRef = Ref.extend({\n        ref: \"cell\",\n        init: function CellRef(row, col, rel) {\n            this.row = row;\n            this.col = col;\n            this.rel = rel || 0;\n        },\n        clone: function() {\n            return new CellRef(this.row, this.col, this.rel)\n                .setSheet(this.sheet, this.hasSheet());\n        },\n        intersect: function(ref) {\n            if (ref instanceof CellRef) {\n                if (this.eq(ref)) {\n                    return this;\n                } else {\n                    return NULL;\n                }\n            }\n            return ref.intersect(this);\n        },\n        print: function(trow, tcol, mod) {\n            var col = this.col, row = this.row, rel = this.rel, abs;\n            if (trow == null && rel) {\n                var sheet = this.hasSheet() ? displaySheet(this.sheet) + \"!\" : \"\";\n                if (isFinite(col)) {\n                    col = rel & 1 ? (\"C[\" + col + \"]\") : (\"C\" + (col + 1));\n                } else {\n                    col = \"\";\n                }\n                if (isFinite(row)) {\n                    row = rel & 2 ? (\"R[\" + row + \"]\") : (\"R\" + (row + 1));\n                } else {\n                    row = \"\";\n                }\n                return sheet + row + col;\n            } else {\n                abs = this.absolute(trow, tcol);\n                if (mod) {\n                    // Hacks: see the big comment below in `absolute()`\n                    row = abs.row % 0x100000;\n                    col = abs.col % 0x4000;\n                    if (row < 0) {\n                        row += 0x100000;\n                    }\n                    if (col < 0) {\n                        col += 0x4000;\n                    }\n                    return displayRef(this._hasSheet && this.sheet, row, col, rel);\n                }\n                return abs.valid() ? displayRef(this._hasSheet && this.sheet, abs.row, abs.col, rel) : \"#REF!\";\n            }\n        },\n        absolute: function(arow, acol) {\n            var ret = this.clone();\n            if (ret.rel & 3 === 0) {\n                return ret;    // already absolute\n            }\n\n            // Hacks: we make coordinates modulo 0x4000 (max col) and 0x100000 (max row).  This\n            // fixes importing relative references in definedName-s from Excel.  Example in\n            // Excel: select cell E3, open the Name Manager (in Formula tab) and define name\n            // TEST with value Sheet1!A1:C3.  The serialization of this name in XLSX is:\n            //\n            //     <definedName name=\"TEST\">Sheet1!XFA1048575:XFC1</definedName>\n            //\n            // This is insane, of course, but oh well.  Excel.  If you type in E3 =SUM(TEST) it\n            // works (it actually sums the cells), but if you type =SUM(Sheet1!XFA1048575:XFC1)\n            // you get back zero.  Let's see why SUM(TEST) works:\n            //\n            //     XFA1048575:XFC1                   E3\n            //     (zero-based indexes below)\n            //\n            //     R[1048574]C[16380]:R[0]C[16382] + R2C4 = R1048576C16384:R2C16386\n            //                                            % (0x100000, 0x4000)\n            //                                            = R0C0:R2C2 (== A1:C3)\n            //\n            // So XFA1048575:XFC1 is relocated to E3 at evaluation time, and because we take\n            // rows modulo 0x100000 and cols modulo 0x4000, we get back the correct range.\n            //\n            // IMO Excel should disallow A1-style relative references in name definitions\n            // (simply because the meaning of the A1:C3 you type in Name Manager depends on the\n            // active cell) and only allow R1C1 notation  that's unambiguous.  But it doesn't.\n            // Moreover, R1C1-style refs in XLSX are explicitly forbidden by the spec, and the\n            // hacks above are not documented  how else could we have fun implementing a XLSX\n            // reader?\n            if (ret.rel & 1) {\n                // relative col, add anchor\n                ret.col = (ret.col + acol) % 0x4000;\n            }\n            if (ret.rel & 2) {\n                // relative row, add anchor\n                ret.row = (ret.row + arow) % 0x100000;\n            }\n\n            ret.rel = 0;\n            return ret;\n        },\n        toRangeRef: function() {\n            return new RangeRef(this, this);\n        },\n        relative: function(arow, acol, rel) {\n            if (rel == null) {\n                rel = this.rel;\n            }\n            var row = rel & 2 ? this.row - arow : this.row;\n            var col = rel & 1 ? this.col - acol : this.col;\n            return new CellRef(row, col, rel)\n                .setSheet(this.sheet, this.hasSheet());\n        },\n        height: function() {\n            return 1;\n        },\n        width: function() {\n            return 1;\n        },\n        toString: function() {\n            return displayRef(null, this.row, this.col, 3);\n        },\n        isCell: function() {\n            return true;\n        },\n        leftColumn: function() {\n            return this;\n        },\n        rightColumn: function() {\n            return this;\n        },\n        topRow: function() {\n            return this;\n        },\n        bottomRow: function() {\n            return this;\n        },\n        forEachRow: function(callback) {\n            callback(this.toRangeRef());\n        },\n        forEachColumn: function(callback) {\n            callback(this.toRangeRef());\n        },\n        adjust: function(row, col, trow, tcol, forRow, start, delta) {\n            var ref = this.absolute(row, col);\n            if (forRow) {\n                if (ref.row >= start) {\n                    if (delta < 0 && ref.row < start - delta) {\n                        return NULL;\n                    }\n                    ref.row += delta;\n                }\n            } else {\n                if (ref.col >= start) {\n                    if (delta < 0 && ref.col < start - delta) {\n                        return NULL;\n                    }\n                    ref.col += delta;\n                }\n            }\n            if (trow != null && tcol != null) {\n                ref = ref.relative(trow, tcol, this.rel);\n            }\n            return ref;\n        },\n        valid: function() {\n            if (this.rel) {\n                throw new Error(\"valid() called on relative reference\");\n            }\n            var col = this.col, row = this.row;\n            return !((isFinite(col) && col < 0) || (isFinite(row) && row < 0));\n        }\n    });\n\n    /* -----[ Range reference ]----- */\n\n    var RangeRef = Ref.extend({\n        ref: \"range\",\n        init: function RangeRef(tl, br) {\n            if (tl._hasSheet && br._hasSheet && tl.sheet.toLowerCase() != br.sheet.toLowerCase()) {\n                // \"3D\" reference\n                this.endSheet = br.sheet;\n            }\n            // we want to drop any sheet information from the cells here.\n            this.topLeft = new CellRef(tl.row, tl.col, tl.rel);\n            this.bottomRight = new CellRef(br.row, br.col, br.rel);\n            this.normalize();\n        },\n        clone: function() {\n            return new RangeRef(this.topLeft.clone(), this.bottomRight.clone()).setSheet(this.sheet, this.hasSheet());\n        },\n        _containsRange: function(range) {\n            return this._containsCell(range.topLeft)\n                && this._containsCell(range.bottomRight);\n        },\n        _containsCell: function(cell) {\n            return cell.sheet == this.sheet\n                && cell.row >= this.topLeft.row\n                && cell.col >= this.topLeft.col\n                && cell.row <= this.bottomRight.row\n                && cell.col <= this.bottomRight.col;\n        },\n        contains: function(ref) {\n            if (ref instanceof Array) {\n                var that = this;\n\n                return ref.some(function(_ref) { return that.contains(_ref); });\n            }\n            if (ref instanceof CellRef) {\n                return this._containsCell(ref);\n            }\n            if (ref instanceof RangeRef) {\n                return this._containsRange(ref);\n            }\n            return false;\n        },\n        _intersectRange: function(ref) {\n            if (this.sheet != ref.sheet) {\n                return NULL;\n            }\n            var a_left    = this.topLeft.col;\n            var a_top     = this.topLeft.row;\n            var a_right   = this.bottomRight.col;\n            var a_bottom  = this.bottomRight.row;\n            var b_left    = ref.topLeft.col;\n            var b_top     = ref.topLeft.row;\n            var b_right   = ref.bottomRight.col;\n            var b_bottom  = ref.bottomRight.row;\n            if (a_left <= b_right &&\n                b_left <= a_right &&\n                a_top <= b_bottom &&\n                b_top <= a_bottom)\n            {\n                return new RangeRef(\n                    // topLeft\n                    new CellRef(Math.max(a_top, b_top),\n                                Math.max(a_left, b_left)),\n                    // bottomRight\n                    new CellRef(Math.min(a_bottom, b_bottom),\n                                Math.min(a_right, b_right))\n                ).setSheet(this.sheet, this.hasSheet());\n            } else {\n                return NULL;\n            }\n        },\n        intersect: function(ref) {\n            if (ref instanceof CellRef) {\n                return this._containsCell(ref) ? ref : NULL;\n            }\n            if (ref instanceof RangeRef) {\n                return this._intersectRange(ref).simplify();\n            }\n            if (ref instanceof UnionRef) {\n                return ref.intersect(this);\n            }\n            return NULL;        // can't handle NameRef-s here.\n        },\n        simplify: function() {\n            if (this.isCell()) {\n                return new CellRef(\n                    this.topLeft.row,\n                    this.topLeft.col,\n                    this.topLeft.rel\n                ).setSheet(this.sheet, this.hasSheet());\n            }\n            return this;\n        },\n        normalize: function() {\n            var a = this.topLeft, b = this.bottomRight;\n            var r1 = a.row, c1 = a.col, r2 = b.row, c2 = b.col;\n            var rr1 = a.rel & 2, rc1 = a.rel & 1;\n            var rr2 = b.rel & 2, rc2 = b.rel & 1;\n            var tmp, changes = false;\n            // do not attempt to normalize unless relativeness of rows and cols are the same.\n            // https://github.com/telerik/kendo-ui-core/issues/4278\n            if (rr1 === rr2 && rc1 === rc2) {\n                if (r1 > r2) {\n                    changes = true;\n                    tmp = r1; r1 = r2; r2 = tmp;\n                    tmp = rr1; rr1 = rr2; rr2 = tmp;\n                }\n                if (c1 > c2) {\n                    changes = true;\n                    tmp = c1; c1 = c2; c2 = tmp;\n                    tmp = rc1; rc1 = rc2; rc2 = tmp;\n                }\n                if (changes) {\n                    this.topLeft = new CellRef(r1, c1, rc1 | rr1);\n                    this.bottomRight = new CellRef(r2, c2, rc2 | rr2);\n                }\n            }\n            return this;\n        },\n        print: function(trow, tcol, mod) {\n            if (mod || this.absolute(trow, tcol).valid()) {\n                var ret = this.topLeft.print(trow, tcol, mod)\n                    + \":\"\n                    + this.bottomRight.print(trow, tcol, mod);\n                if (this.hasSheet()) {\n                    ret = displaySheet(this.sheet)\n                        + (this.endSheet ? \":\" + displaySheet(this.endSheet) : \"\")\n                        + \"!\" + ret;\n                }\n                return ret;\n            }\n            return \"#REF!\";\n        },\n        absolute: function(arow, acol) {\n            return new RangeRef(\n                this.topLeft.absolute(arow, acol),\n                this.bottomRight.absolute(arow, acol)\n            ).setSheet(this.sheet, this.hasSheet());\n        },\n        relative: function(arow, acol, relTL, relBR) {\n            if (relBR == null) {\n                relBR = relTL;\n            }\n            return new RangeRef(\n                this.topLeft.relative(arow, acol, relTL),\n                this.bottomRight.relative(arow, acol, relBR)\n            ).setSheet(this.sheet, this.hasSheet());\n        },\n        height: function() {\n            if (this.topLeft.rel != this.bottomRight.rel) {\n                throw new Error(\"Mixed relative/absolute references\");\n            }\n            return this.bottomRight.row - this.topLeft.row + 1;\n        },\n        width: function() {\n            if (this.topLeft.rel != this.bottomRight.rel) {\n                throw new Error(\"Mixed relative/absolute references\");\n            }\n            return this.bottomRight.col - this.topLeft.col + 1;\n        },\n        collapse: function() {\n            return this.topLeft.toRangeRef();\n        },\n        leftColumn: function() {\n            return new RangeRef(this.topLeft, new CellRef(this.bottomRight.row, this.topLeft.col));\n        },\n        rightColumn: function() {\n            return new RangeRef(new CellRef(this.topLeft.row, this.bottomRight.col), this.bottomRight);\n        },\n        topRow: function() {\n            return new RangeRef(this.topLeft, new CellRef(this.topLeft.row, this.bottomRight.col));\n        },\n        bottomRow: function() {\n            return new RangeRef(new CellRef(this.bottomRight.row, this.topLeft.col), this.bottomRight);\n        },\n        toRangeRef: function() {\n            return this;\n        },\n        toRow: function(row) {\n            row += Math.max(0, this.topLeft.row);\n            return new RangeRef(\n                new CellRef(row, this.topLeft.col),\n                new CellRef(row, this.bottomRight.col)\n            ).setSheet(this.sheet, this.hasSheet());\n        },\n        toColumn: function(col) {\n            col += Math.max(0, this.topLeft.col);\n            return new RangeRef(\n                new CellRef(this.topLeft.row, col),\n                new CellRef(this.bottomRight.row, col)\n            ).setSheet(this.sheet, this.hasSheet());\n        },\n        toCell: function(row, col) {\n            row += Math.max(0, this.topLeft.row);\n            col += Math.max(0, this.topLeft.col);\n            return new CellRef(row, col, 0)\n                .setSheet(this.sheet, this.hasSheet());\n        },\n        forEachRow: function(callback) {\n            var startRow = this.topLeft.row;\n            var endRow = this.bottomRight.row;\n            var startCol = this.topLeft.col;\n            var endCol = this.bottomRight.col;\n\n            for (var i = startRow; i <= endRow; i++) {\n                callback(new RangeRef(\n                    new CellRef(i, startCol),\n                    new CellRef(i, endCol)\n                ));\n            }\n        },\n        forEachColumn: function(callback) {\n            var startRow = this.topLeft.row;\n            var endRow = this.bottomRight.row;\n            var startCol = this.topLeft.col;\n            var endCol = this.bottomRight.col;\n\n            for (var i = startCol; i <= endCol; i++) {\n                callback(new RangeRef(\n                    new CellRef(startRow, i),\n                    new CellRef(endRow, i)\n                ));\n            }\n        },\n        intersecting: function(refs) {\n            return refs.filter(function(ref) {\n                return ref.toRangeRef().intersects(this);\n            }, this);\n        },\n\n        union: function(refs, callback) {\n            var intersecting = this.intersecting(refs);\n\n            var topLeftRow = this.topLeft.row;\n            var topLeftCol = this.topLeft.col;\n            var bottomRightRow = this.bottomRight.row;\n            var bottomRightCol = this.bottomRight.col;\n\n            var modified = false;\n\n            intersecting.forEach(function(ref) {\n                ref = ref.toRangeRef();\n                if (ref.topLeft.row < topLeftRow) {\n                    modified = true;\n                    topLeftRow = ref.topLeft.row;\n                }\n\n                if (ref.topLeft.col < topLeftCol) {\n                    modified = true;\n                    topLeftCol = ref.topLeft.col;\n                }\n\n                if (ref.bottomRight.row > bottomRightRow) {\n                    modified = true;\n                    bottomRightRow = ref.bottomRight.row;\n                }\n\n                if (ref.bottomRight.col > bottomRightCol) {\n                    modified = true;\n                    bottomRightCol = ref.bottomRight.col;\n                }\n\n                if (callback) {\n                    callback(ref);\n                }\n            });\n\n            var result = new RangeRef(\n                new CellRef(topLeftRow, topLeftCol),\n                new CellRef(bottomRightRow, bottomRightCol)\n            );\n\n            if (modified) {\n                return result.union(refs, callback);\n            } else {\n                return result;\n            }\n        },\n        resize: function(options) {\n            var limit = Math.max.bind(Math, 0);\n            function num(value) { return value || 0; }\n\n            var top = this.topLeft.row + num(options.top);\n            var left = this.topLeft.col + num(options.left);\n            var bottom = this.bottomRight.row + num(options.bottom);\n            var right = this.bottomRight.col + num(options.right);\n\n            if (left < 0 && right < 0 || top < 0 && bottom < 0) {\n                return NULL;\n            } else if (top <= bottom && left <= right) {\n                return new RangeRef(new CellRef(limit(top), limit(left)),\n                                    new CellRef(limit(bottom), limit(right)));\n            } else {\n                return NULL;\n            }\n        },\n        move: function(rows, cols) {\n            return new RangeRef(\n                new CellRef(this.topLeft.row + rows,\n                            this.topLeft.col + cols),\n                new CellRef(this.bottomRight.row + rows,\n                            this.bottomRight.col + cols)\n            );\n        },\n        first: function() {\n            return this.topLeft.clone().setSheet(this.sheet, this.hasSheet());\n        },\n        isCell: function() {\n            return !this.endSheet && this.topLeft.eq(this.bottomRight);\n        },\n        toString: function() {\n            return this.topLeft + \":\" + this.bottomRight;\n        },\n        adjust: function(row, col, trow, tcol, forRow, start, delta) {\n            var tl = this.topLeft.adjust(row, col, trow, tcol, forRow, start, delta);\n            var tr = this.bottomRight.adjust(row, col, trow, tcol, forRow, start, delta);\n            if (tl === NULL && tr === NULL) {\n                return NULL;\n            }\n            if (tl === NULL) {\n                tl = this.topLeft.absolute(row, col);\n                if (forRow) {\n                    tl.row = start;\n                } else {\n                    tl.col = start;\n                }\n                if (trow != null && tcol != null) {\n                    tl = tl.relative(trow, tcol, this.topLeft.rel);\n                }\n            }\n            else if (tr === NULL) {\n                tr = this.bottomRight.absolute(row, col);\n                if (forRow) {\n                    tr.row = start - 1;\n                } else {\n                    tr.col = start - 1;\n                }\n                if (trow != null && tcol != null) {\n                    tr = tr.relative(trow, tcol, this.bottomRight.rel);\n                }\n            }\n            return new RangeRef(tl, tr)\n                .setSheet(this.sheet, this.hasSheet())\n                .simplify();\n        },\n        valid: function() {\n            return this.topLeft.valid() && this.bottomRight.valid();\n        }\n    });\n\n    /* -----[ Union reference ]----- */\n\n    var UnionRef = Ref.extend({\n        init: function UnionRef(refs){\n            this.refs = refs;\n            this.length = refs.length;\n        },\n        clone: function() {\n            return new UnionRef(this.refs.slice());\n        },\n        intersect: function(ref) {\n            var a = [];\n            for (var i = 0; i < this.length; ++i) {\n                var x = ref.intersect(this.refs[i]);\n                if (x !== NULL) {\n                    a.push(x);\n                }\n            }\n            if (a.length > 0) {\n                return new UnionRef(a).simplify();\n            }\n            return NULL;\n        },\n        simplify: function() {\n            var u = new UnionRef(this.refs.reduce(function(a, ref){\n                ref = ref.simplify();\n                if (ref !== NULL) {\n                    a.push(ref);\n                }\n                return a;\n            }, []));\n            if (u.empty()) {\n                return NULL;\n            }\n            if (u.single()) {\n                return u.refs[0];\n            }\n            return u;\n        },\n        absolute: function(arow, acol) {\n            return new UnionRef(this.refs.map(function(ref){\n                return ref.absolute(arow, acol);\n            }));\n        },\n        forEach: function(callback, obj) {\n            this.refs.forEach(function(ref){\n                if (ref instanceof UnionRef) {\n                    ref.forEach(callback, obj);\n                } else {\n                    callback.call(obj, ref);\n                }\n            }, obj);\n        },\n        toRangeRef: function() {\n            return this.refs[0].toRangeRef();\n        },\n        contains: function(theRef) {\n            return this.refs.some(function(ref) { return ref.contains(theRef); });\n        },\n        map: function(callback, obj) {\n            var refs = [];\n            this.forEach(function(ref){\n                refs.push(callback.call(obj, ref));\n            });\n            return new UnionRef(refs);\n        },\n        first: function() {\n            return this.refs[0].first();\n        },\n        lastRange: function() {\n            return this.refs[this.length - 1];\n        },\n        size: function() {\n            return this.length;\n        },\n        single: function() {\n            return this.length == 1;\n        },\n        empty: function() {\n            return this.length === 0;\n        },\n        isCell: function() {\n            return this.single() && this.refs[0].isCell();\n        },\n        rangeAt: function(index) {\n            return this.refs[index];\n        },\n        nextRangeIndex: function(index) {\n            if (index === this.length - 1) {\n                return 0;\n            } else {\n                return index + 1;\n            }\n        },\n        previousRangeIndex: function(index) {\n            if (index === 0) {\n                return this.length - 1;\n            } else {\n                return index - 1;\n            }\n        },\n        concat: function(ref) {\n            return new UnionRef(this.refs.concat([ref]));\n        },\n        print: function(row, col, mod) {\n            return this.refs.map(function(ref) { return ref.print(row, col, mod); }).join(\",\");\n        },\n\n        replaceAt: function(index, ref) {\n            var newRefs = this.refs.slice();\n            newRefs.splice(index, 1, ref);\n            return new UnionRef(newRefs);\n        },\n\n        leftColumn: function() {\n            return this.map(function(ref) {\n                return ref.leftColumn();\n            });\n        },\n        rightColumn: function() {\n            return this.map(function(ref) {\n                return ref.rightColumn();\n            });\n        },\n        topRow: function() {\n            return this.map(function(ref) {\n                return ref.topRow();\n            });\n        },\n        bottomRow: function() {\n            return this.map(function(ref) {\n                return ref.bottomRow();\n            });\n        },\n        forEachRow: function(callback) {\n            this.forEach(function(ref) {\n                ref.forEachRow(callback);\n            });\n        },\n        forEachColumn: function(callback) {\n            this.forEach(function(ref) {\n                ref.forEachColumn(callback);\n            });\n        },\n        adjust: function(row, col, trow, tcol, forRow, start, delta) {\n            return this.map(function(ref){\n                return ref.adjust(row, col, trow, tcol, forRow, start, delta);\n            }).simplify();\n        },\n        toString: function() {\n            return this.refs.map(function(ref){\n                return ref.toString();\n            }).join(\", \");\n        },\n        valid: function() {\n            for (var i = this.refs.length; --i >= 0;) {\n                if (this.refs[i].valid()) {\n                    return false;\n                }\n            }\n            return true;\n        },\n        renameSheet: function(oldSheetName, newSheetName) {\n            this.refs.forEach(function(ref){\n                ref.renameSheet(oldSheetName, newSheetName);\n            });\n        }\n    });\n\n    /* -----[ exports ]----- */\n\n    spreadsheet.NULLREF = NULL;\n    spreadsheet.SHEETREF = new RangeRef(new CellRef(0, 0), new CellRef(Infinity, Infinity));\n    spreadsheet.FIRSTREF = new CellRef(0, 0);\n    spreadsheet.Ref = Ref;\n    spreadsheet.NameRef = NameRef;\n    spreadsheet.CellRef = CellRef;\n    spreadsheet.RangeRef = RangeRef;\n    spreadsheet.UnionRef = UnionRef;\n\n    spreadsheet.SHEETREF.print = function() {\n        return \"#SHEET\";\n    };\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/autofillcalculator',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    var RangeRef = kendo.spreadsheet.RangeRef;\n    var CellRef = kendo.spreadsheet.CellRef;\n\n    var AutoFillCalculator = kendo.Class.extend({\n        init: function(grid) {\n            this._grid = grid;\n        },\n\n        rectIsVertical: function(start, end, x, y) {\n            var startRect = this._grid.rectangle(start.toRangeRef());\n            var endRect = this._grid.rectangle(end.toRangeRef());\n            return Math.abs(endRect[y] - startRect[y]) > Math.abs(startRect[x] - endRect[x]);\n        },\n\n        autoFillDest: function(selection, cursor) {\n            var topLeft = selection.topLeft;\n            var bottomRight = selection.bottomRight;\n\n            var quadrant;\n            var lower = cursor.row >= topLeft.row;\n            var further = cursor.col >= topLeft.col;\n\n            if (lower) {\n                quadrant = further ? 4 : 3;\n            } else {\n                quadrant = further ? 2 : 1;\n            }\n\n            var pivot, opposite, cornerResult, expanding;\n\n            if (quadrant === 4) {\n                pivot = topLeft;\n                opposite = bottomRight;\n\n                expanding = cursor.row > opposite.row || cursor.col > opposite.col;\n\n                if (expanding) {\n                    cursor = new CellRef(Math.max(cursor.row, opposite.row), Math.max(cursor.col, opposite.col));\n                }\n\n                if (this.rectIsVertical(opposite, cursor, 'right', 'bottom')) { // vertical\n                    cornerResult = new CellRef(cursor.row, opposite.col);\n                } else {\n                    cornerResult = new CellRef(opposite.row, cursor.col);\n                }\n            } else if (quadrant === 3) {\n                var bottomLeft = new CellRef(topLeft.col, bottomRight.row);\n\n                if (cursor.row > bottomRight.row && this.rectIsVertical(bottomLeft, cursor, 'left', 'bottom')) { // vertical\n                    pivot = topLeft;\n                    cornerResult = new CellRef(cursor.row, bottomRight.col);\n                } else {\n                    pivot = bottomRight;\n                    cornerResult = new CellRef(topLeft.row, cursor.col);\n                }\n            } else if (quadrant === 2){\n                var topRight = new CellRef(topLeft.row, bottomRight.col);\n\n                if (cursor.col > bottomRight.col && !this.rectIsVertical(topRight, cursor, 'right', 'top')) { // horizontal\n                    pivot = topLeft;\n                    cornerResult = new CellRef(bottomRight.row, cursor.col);\n                } else {\n                    pivot = bottomRight;\n                    cornerResult = new CellRef(cursor.row, topLeft.col);\n                }\n            } else {\n                pivot = bottomRight;\n                if (this.rectIsVertical(topLeft, cursor, 'left', 'top')) { // horizontal\n                    cornerResult = new CellRef(cursor.row, topLeft.col);\n                } else {\n                    cornerResult = new CellRef(topLeft.row, cursor.col);\n                }\n            }\n\n            return this._grid.normalize(new RangeRef(pivot, cornerResult));\n        }\n    });\n\n    kendo.spreadsheet.AutoFillCalculator = AutoFillCalculator;\n})(kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/navigator',[ \"kendo.core\",  \"./autofillcalculator\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    var RangeRef = kendo.spreadsheet.RangeRef;\n    var CellRef = kendo.spreadsheet.CellRef;\n\n    var EdgeNavigator = kendo.Class.extend({\n        init: function(field, axis, rangeGetter, union) {\n            this.rangeGetter = rangeGetter;\n\n            this.prevLeft = function(index) {\n                var current = union(this.range(index));\n                var range = this.range(axis.prevVisible(current.topLeft[field]));\n                return union(range).topLeft[field];\n            };\n\n            this.nextRight = function(index) {\n                var current = union(this.range(index));\n                var range = this.range(axis.nextVisible(current.bottomRight[field]));\n                return union(range).bottomRight[field];\n            };\n\n            // these two don't look like the other ones, as they \"shrink\"\n            this.nextLeft = function(index) {\n                var range = union(this.range(index));\n                return axis.nextVisible(range.bottomRight[field]);\n            };\n\n            this.prevRight = function(index) {\n                var range = union(this.range(index));\n                return axis.prevVisible(range.topLeft[field]);\n            };\n        },\n\n        boundary: function(top, bottom) {\n            this.top = top;\n            this.bottom = bottom;\n        },\n\n        range: function(index) {\n            return this.rangeGetter(index, this.top, this.bottom);\n        }\n    });\n\n    var SheetNavigator = kendo.Class.extend({\n        init: function(sheet) {\n            this._sheet = sheet;\n            this.autoFillCalculator = new kendo.spreadsheet.AutoFillCalculator(sheet._grid);\n\n            this.colEdge = new EdgeNavigator(\"col\", this._sheet._grid._columns, this.columnRange.bind(this), this.union.bind(this));\n            this.rowEdge = new EdgeNavigator(\"row\", this._sheet._grid._rows, this.rowRange.bind(this), this.union.bind(this));\n        },\n\n        height: function(height) {\n            this._viewPortHeight = height;\n        },\n\n        union: function(ref) {\n            return this._sheet.unionWithMerged(ref);\n        },\n\n        columnRange: function(col, topRow, bottomRow) {\n            return this._sheet._ref(topRow, col, bottomRow - topRow, 1);\n        },\n\n        rowRange: function(row, leftCol, rightCol) {\n            return this._sheet._ref(row, leftCol, 1, rightCol - leftCol);\n        },\n\n        selectionIncludesMergedCells: function() {\n            return this._sheet.select().contains(this._sheet._mergedCells);\n        },\n\n        setSelectionValue: function(value) {\n            var selection = this._sheet.selection();\n\n            setTimeout(function() {\n                selection.value(value());\n            });\n        },\n\n        selectAll: function() {\n            this._sheet.select(this._sheet._sheetRef);\n        },\n\n        select: function(ref, mode, addToExisting) {\n            ref = this.refForMode(ref, mode);\n\n            if (addToExisting) {\n                ref = this._sheet.select().concat(ref);\n            }\n\n            this._sheet.select(ref);\n        },\n\n        refForMode: function(ref, mode) {\n            var grid = this._sheet._grid;\n\n            switch(mode) {\n                case \"range\":\n                    ref = grid.normalize(ref);\n                    break;\n                case \"row\":\n                    ref = grid.rowRef(ref.row);\n                    break;\n                case \"column\":\n                    ref = grid.colRef(ref.col);\n                    break;\n                case \"sheet\":\n                    ref = this._sheet._sheetRef;\n                    break;\n            }\n\n            return ref;\n        },\n\n        startSelection: function(ref, mode, addToExisting, shiftKey, view) {\n            if (mode == \"autofill\") {\n                this._sheet.startAutoFill();\n            } else if (shiftKey && mode == \"range\") {\n                var range = new RangeRef(this._sheet.activeCell().first(), ref);\n                this._sheet.select(range, false, false);\n                this._sheet.startSelection(view);\n            } else {\n                this._sheet.startSelection(view);\n                this.select(ref, mode, addToExisting);\n            }\n        },\n\n        completeSelection: function() {\n            this._sheet.completeSelection();\n        },\n\n        selectForContextMenu: function(ref, mode) {\n            var sheet = this._sheet;\n            sheet._activeDrawing = null;\n            if (!sheet.select().contains(this.refForMode(ref, mode))) {\n                this.select(ref, mode);\n            }\n        },\n\n        selectDrawingForContextMenu: function(drawing) {\n            var sheet = this._sheet;\n            sheet._activeDrawing = drawing;\n            sheet.triggerChange({ selection: true });\n        },\n\n        modifySelection: function(action) {\n            var direction = this.determineDirection(action);\n\n            var sheet = this._sheet;\n            var viewPortHeight = this._viewPortHeight;\n            var rows = sheet._grid._rows;\n            var columns = sheet._grid._columns;\n\n            var originalSelection = sheet.currentOriginalSelectionRange();\n            var selection = sheet.select().toRangeRef();\n            var activeCell = sheet.activeCell();\n\n            var topLeft = originalSelection.topLeft.clone();\n            var bottomRight = originalSelection.bottomRight.clone();\n            var bottomLeft = new CellRef(bottomRight.row, topLeft.col);\n\n            var scrollInto;\n\n            this.colEdge.boundary(selection.topLeft.row, selection.bottomRight.row);\n            this.rowEdge.boundary(selection.topLeft.col, selection.bottomRight.col);\n\n            switch (direction) {\n              case \"expand-left\": // <| |\n                topLeft.col = this.colEdge.prevLeft(topLeft.col);\n                scrollInto = topLeft;\n                break;\n              case \"shrink-right\": // |>|\n                topLeft.col = this.colEdge.nextLeft(topLeft.col);\n                scrollInto = topLeft;\n                break;\n              case \"expand-right\": // | |>\n                bottomRight.col = this.colEdge.nextRight(bottomRight.col);\n                scrollInto = bottomRight;\n                break;\n              case \"shrink-left\": // |<|\n                bottomRight.col = this.colEdge.prevRight(bottomRight.col);\n                scrollInto = bottomRight;\n                break;\n\n                // four actions below mirror the upper ones, on the vertical axis\n              case \"expand-up\":\n                topLeft.row = this.rowEdge.prevLeft(topLeft.row);\n                scrollInto = topLeft;\n                break;\n              case \"shrink-down\":\n                topLeft.row = this.rowEdge.nextLeft(topLeft.row);\n                scrollInto = topLeft;\n                break;\n              case \"expand-down\":\n                bottomRight.row = this.rowEdge.nextRight(bottomRight.row);\n                scrollInto = bottomRight;\n                break;\n              case \"shrink-up\":\n                bottomRight.row = this.rowEdge.prevRight(bottomRight.row);\n                scrollInto = bottomRight;\n                break;\n\n                // pageup/down - may need improvement\n              case \"expand-page-up\":\n                topLeft.row = rows.prevPage(topLeft.row, viewPortHeight);\n                break;\n              case \"shrink-page-up\":\n                bottomRight.row = rows.prevPage(bottomRight.row, viewPortHeight);\n                break;\n              case \"expand-page-down\":\n                bottomRight.row = rows.nextPage(bottomRight.row, viewPortHeight);\n                break;\n              case \"shrink-page-down\":\n                topLeft.row = rows.nextPage(topLeft.row, viewPortHeight);\n                break;\n\n              case \"first-col\":\n                topLeft.col = columns.firstVisible();\n                bottomRight.col = activeCell.bottomRight.col;\n                scrollInto = topLeft;\n                break;\n              case \"last-col\":\n                bottomRight.col = columns.lastVisible();\n                topLeft.col = activeCell.topLeft.col;\n                scrollInto = bottomRight;\n                break;\n              case \"first-row\":\n                topLeft.row = rows.firstVisible();\n                bottomRight.row = activeCell.bottomRight.row;\n                scrollInto = topLeft;\n                break;\n              case \"last-row\":\n                bottomRight.row = rows.lastVisible();\n                topLeft.row = activeCell.topLeft.row;\n                scrollInto = bottomRight;\n                break;\n              case \"last\":\n                bottomRight.row = rows.lastVisible();\n                bottomRight.col = columns.lastVisible();\n                topLeft = activeCell.topLeft;\n                scrollInto = bottomRight;\n                break;\n              case \"first\":\n                topLeft.row = rows.firstVisible();\n                topLeft.col = columns.firstVisible();\n                bottomRight = activeCell.bottomRight;\n                scrollInto = topLeft;\n                break;\n\n              case \"expand-word-right\":\n                bottomRight.col = columns.nextUntil(bottomRight.col, makeWordMovement(sheet, bottomRight, true));\n                scrollInto = bottomRight;\n                break;\n              case \"shrink-word-right\":\n                topLeft.col = columns.nextUntil(bottomLeft.col, makeWordMovement(sheet, bottomLeft, true));\n                scrollInto = topLeft;\n                break;\n              case \"expand-word-left\":\n                topLeft.col = columns.prevUntil(bottomLeft.col, makeWordMovement(sheet, bottomLeft, true));\n                scrollInto = topLeft;\n                break;\n              case \"shrink-word-left\":\n                bottomRight.col = columns.prevUntil(bottomRight.col, makeWordMovement(sheet, bottomRight, true));\n                scrollInto = bottomRight;\n                break;\n              case \"expand-word-up\":\n                topLeft.row = rows.prevUntil(topLeft.row, makeWordMovement(sheet, topLeft, false));\n                scrollInto = topLeft;\n                break;\n              case \"shrink-word-up\":\n                bottomRight.row = rows.prevUntil(bottomRight.row, makeWordMovement(sheet, bottomRight, false));\n                scrollInto = bottomRight;\n                break;\n              case \"expand-word-down\":\n                bottomRight.row = rows.nextUntil(bottomRight.row, makeWordMovement(sheet, bottomRight, false));\n                scrollInto = bottomRight;\n                break;\n              case \"shrink-word-down\":\n                topLeft.row = rows.nextUntil(topLeft.row, makeWordMovement(sheet, topLeft, false));\n                scrollInto = topLeft;\n                break;\n            }\n\n            var newSelection = new RangeRef(topLeft, bottomRight);\n\n            if (!this.union(newSelection).intersects(activeCell)) {\n                // throw new Error(newSelection.print() + \" does not contain \" + activeCell.print());\n                this.modifySelection(direction.replace(\"shrink\", \"expand\"));\n                return;\n            }\n\n            if (scrollInto) {\n                sheet.focus(scrollInto);\n            }\n\n            this.updateCurrentSelectionRange(newSelection);\n        },\n\n        moveActiveCell: function(direction) {\n            var sheet = this._sheet;\n            var activeCell = sheet.activeCell();\n            var topLeft = activeCell.topLeft;\n            var bottomRight = activeCell.bottomRight;\n\n            var cell = sheet.originalActiveCell();\n            var rows = sheet._grid._rows;\n            var columns = sheet._grid._columns;\n\n            var row = cell.row;\n            var column = cell.col;\n\n            switch (direction) {\n              case \"left\":\n                column = columns.prevVisible(topLeft.col);\n                break;\n              case \"up\":\n                row = rows.prevVisible(topLeft.row);\n                break;\n              case \"right\":\n                column = columns.nextVisible(bottomRight.col);\n                break;\n              case \"down\":\n                row = rows.nextVisible(bottomRight.row);\n                break;\n              case \"first-col\":\n                column = columns.firstVisible();\n                break;\n              case \"last-col\":\n                column = columns.lastVisible();\n                break;\n              case \"first-row\":\n                row = rows.firstVisible();\n                break;\n              case \"last-row\":\n                row = rows.lastVisible();\n                break;\n              case \"last\":\n                row = rows.lastVisible();\n                column = columns.lastVisible();\n                break;\n              case \"first\":\n                row = rows.firstVisible();\n                column = columns.firstVisible();\n                break;\n              case \"next-page\":\n                row = rows.nextPage(bottomRight.row, this._viewPortHeight);\n                break;\n              case \"prev-page\":\n                row = rows.prevPage(bottomRight.row, this._viewPortHeight);\n                break;\n\n              case \"word-right\":\n                column = columns.nextUntil(column, makeWordMovement(sheet, bottomRight, true));\n                break;\n              case \"word-left\":\n                column = columns.prevUntil(column, makeWordMovement(sheet, bottomRight, true));\n                break;\n              case \"word-up\":\n                row = rows.prevUntil(row, makeWordMovement(sheet, bottomRight, false));\n                break;\n              case \"word-down\":\n                row = rows.nextUntil(row, makeWordMovement(sheet, bottomRight, false));\n                break;\n            }\n\n            sheet.select(new CellRef(row, column));\n        },\n\n        navigateInSelection: function(direction) {\n            var sheet = this._sheet;\n            var activeCell = sheet.activeCell();\n            var topLeft = activeCell.topLeft;\n\n            var cell = sheet.originalActiveCell();\n            var rows = sheet._grid._rows;\n            var columns = sheet._grid._columns;\n\n            var row = cell.row;\n            var column = cell.col;\n\n            var isFirstCell = false;\n            var isLastCell = false;\n\n            var selTopLeft, selBottomRight;\n\n            var topLeftCol = topLeft.col;\n            var topLeftRow = topLeft.row;\n            var tmp;\n\n            function setSelection(sel) {\n                selTopLeft = sel.topLeft;\n                selBottomRight = sel.bottomRight;\n            }\n\n            setSelection(sheet.currentNavigationRange());\n\n            var done = false;\n            var navigatedAway = false;\n\n            while (!done && !navigatedAway) {\n                var current = new CellRef(row, column);\n                var isSingleCellSelected = sheet.singleCellSelection();\n\n                if(isSingleCellSelected) {\n                    isFirstCell = selTopLeft.eq(current) && sheet._sheetRef.topLeft.eq(current);\n                    isLastCell = selBottomRight.eq(current) && sheet._sheetRef.bottomRight.eq(current);\n\n                    if(!isFirstCell) {\n                        isFirstCell = columns.firstVisible() === column && rows.firstVisible() === row;\n                    }\n\n                    if(!isLastCell) {\n                        isLastCell = columns.lastVisible() === column && rows.lastVisible() === row;\n                    }\n                }\n\n                switch (direction) {\n                    case \"next\":\n                        if(isLastCell) {\n                            navigatedAway = true;\n                            kendo.focusNextElement();\n                        } else if (selBottomRight.eq(current)) {\n                            setSelection(sheet.nextNavigationRange());\n                            row = selTopLeft.row;\n                            column = selTopLeft.col;\n                        } else {\n                            column = columns.nextVisible(topLeftCol);\n                            if (column == topLeftCol || column > selBottomRight.col) {\n                                column = selTopLeft.col;\n                                tmp = rows.nextVisible(row);\n                                if (tmp == row || tmp > selBottomRight.row) {\n                                    row = selTopLeft.row;\n                                } else {\n                                    row = tmp;\n                                }\n                            }\n                        }\n                        break;\n                    case \"previous\":\n                        if(isFirstCell) {\n                            navigatedAway = true;\n                            this._sheet._workbook._view.element.find('.k-spreadsheet-name-editor .k-input-inner').trigger(\"focus\");\n                        } else if (selTopLeft.eq(current)) {\n                            setSelection(sheet.previousNavigationRange());\n                            row = selBottomRight.row;\n                            column = selBottomRight.col;\n                        } else {\n                            column = columns.prevVisible(topLeftCol);\n                            if (column == topLeftCol || column < selTopLeft.col) {\n                                column = selBottomRight.col;\n                                tmp = rows.prevVisible(row);\n                                if (tmp == row || tmp < selTopLeft.row) {\n                                    row = selBottomRight.row;\n                                } else {\n                                    row = tmp;\n                                }\n                            }\n                        }\n                        break;\n                    case \"lower\":\n                        if (selBottomRight.eq(current)) {\n                            setSelection(sheet.nextNavigationRange());\n                            row = selTopLeft.row;\n                            column = selTopLeft.col;\n                        } else {\n                            row = rows.nextVisible(topLeftRow);\n                            if (row == topLeftRow || row > selBottomRight.row) {\n                                row = selTopLeft.row;\n                                tmp = columns.nextVisible(column);\n                                if (tmp == column || tmp > selBottomRight.col) {\n                                    column = selTopLeft.col;\n                                } else {\n                                    column = tmp;\n                                }\n                            }\n                        }\n                        break;\n                    case \"upper\":\n                        if (selTopLeft.eq(current)) {\n                            setSelection(sheet.previousNavigationRange());\n                            row = selBottomRight.row;\n                            column = selBottomRight.col;\n                        } else {\n                            row = rows.prevVisible(topLeftRow);\n                            if (row == topLeftRow || row < selTopLeft.row) {\n                                row = selBottomRight.row;\n                                tmp = columns.prevVisible(column);\n                                if (tmp == column || tmp < selTopLeft.col) {\n                                    column = selBottomRight.col;\n                                } else {\n                                    column = tmp;\n                                }\n                            }\n                        }\n                        break;\n                    default:\n                        throw new Error(\"Unknown entry navigation: \" + direction);\n                }\n\n                done = !this.shouldSkip(row, column);\n                // if (!done) { console.log(\"skipping\", row, column); }\n                topLeftCol = column;\n                topLeftRow = row;\n            }\n\n            if(done) {\n                if (sheet.singleCellSelection()) {\n                    sheet.select(new CellRef(row, column));\n                } else {\n                    sheet.activeCell(new CellRef(row, column));\n                }\n            }\n        },\n\n        extendSelection: function(ref, mode) {\n            var sheet = this._sheet;\n            var grid = sheet._grid;\n\n            if (mode === \"autofill\") {\n               this.resizeAutoFill(ref);\n               return;\n            }\n            if (mode === \"range\") {\n                ref = grid.normalize(ref);\n            }\n            else if (mode === \"row\") {\n                ref = grid.rowRef(ref.row).bottomRight;\n            } else if (mode === \"column\") {\n                ref = grid.colRef(ref.col).bottomRight;\n            }\n\n            var activeCell = sheet.originalActiveCell().toRangeRef();\n\n            this.updateCurrentSelectionRange(new RangeRef(activeCell.topLeft, ref));\n        },\n\n        shouldSkip: function(row, col) {\n            if (this._sheet.isHiddenRow(row) || this._sheet.isHiddenColumn(col)) {\n                return true;\n            }\n            var ref = new CellRef(row, col);\n            var isMerged = false;\n            this._sheet.forEachMergedCell(function(merged) {\n                if (merged.intersects(ref) && !merged.collapse().eq(ref)) {\n                    isMerged = true;\n                }\n            });\n\n            return isMerged;\n        },\n\n        resizeAutoFill: function(ref) {\n            var sheet = this._sheet;\n            var selection = sheet.select();\n            var origin = sheet._autoFillOrigin;\n            var dest = this.autoFillCalculator.autoFillDest(selection, ref);\n\n            var punch = this.punch(selection, dest);\n            var hint, direction;\n\n            if (!punch) {\n                var preview = sheet.range(dest)._previewFillFrom(sheet.range(origin));\n                if (preview) {\n                    direction = preview.direction;\n                    hint = preview.hint;\n                }\n            }\n\n            sheet.updateAutoFill(dest, punch, hint, direction);\n        },\n\n        determineDirection: function(action) {\n            var selection = this._sheet.currentSelectionRange();\n            var activeCell = this._sheet.activeCell();\n\n            // There may be a third, indeterminate state, caused by a merged cell.\n            // In this state, all key movements are treated as shrinks.\n            // The navigator will reverse them if it detects this it will cause the selection to exclude the active cell.\n            var leftMode = activeCell.topLeft.col == selection.topLeft.col;\n            var rightMode = activeCell.bottomRight.col == selection.bottomRight.col;\n            var topMode = activeCell.topLeft.row == selection.topLeft.row;\n            var bottomMode = activeCell.bottomRight.row == selection.bottomRight.row;\n\n            switch (action) {\n              case \"left\":\n                action = rightMode ? \"expand-left\" : \"shrink-left\";\n                break;\n              case \"right\":\n                action = leftMode ? \"expand-right\" : \"shrink-right\";\n                break;\n              case \"up\":\n                action = bottomMode ? \"expand-up\" : \"shrink-up\";\n                break;\n              case \"down\":\n                action = topMode ? \"expand-down\" : \"shrink-down\";\n                break;\n              case \"prev-page\":\n                action = bottomMode ? \"expand-page-up\" : \"shrink-page-up\";\n                break;\n              case \"next-page\":\n                action = topMode ? \"expand-page-down\" : \"shrink-page-down\";\n                break;\n              case \"word-left\":\n                action = rightMode ? \"expand-word-left\" : \"shrink-word-left\";\n                break;\n              case \"word-right\":\n                action = leftMode ? \"expand-word-right\" : \"shrink-word-right\";\n                break;\n              case \"word-up\":\n                action = bottomMode ? \"expand-word-up\" : \"shrink-word-up\";\n                break;\n              case \"word-down\":\n                action = topMode ? \"expand-word-down\" : \"shrink-word-down\";\n                break;\n            }\n\n            return action;\n        },\n\n        updateCurrentSelectionRange: function(ref) {\n            var sheet = this._sheet;\n            sheet.select(sheet.originalSelect().replaceAt(sheet.selectionRangeIndex(), ref), false);\n        },\n\n        punch: function(selection, subset) {\n            var punch;\n            if (subset.topLeft.eq(selection.topLeft)) {\n                if (subset.bottomRight.row < selection.bottomRight.row) {\n                    var bottomRow = this.rowEdge.nextRight(subset.bottomRight.row);\n\n                    punch = new RangeRef(\n                        new CellRef(bottomRow, selection.topLeft.col),\n                        selection.bottomRight\n                    );\n                } else if (subset.bottomRight.col < selection.bottomRight.col) {\n                    var bottomCol = this.colEdge.nextRight(subset.bottomRight.col);\n\n                    punch = new RangeRef(\n                        new CellRef(selection.topLeft.row, bottomCol),\n                        selection.bottomRight\n                    );\n                }\n            }\n\n            return punch;\n        }\n    });\n\n    function makeWordMovement(sheet, pivot, isCol) {\n        // the general idea is:\n        //\n        // - if we start on a non-empty cell, we should select the\n        //   range of non-empty cells that follow it.  If, however,\n        //   the second cell is empty, then we don't stop there; we\n        //   should skip all the empty cells and stop at the first\n        //   non-empty cell (and select it).\n        //\n        // - if we start on an empty cell, then skip all empty cells\n        //   and select the first non-empty one.\n\n        var firstVal = sheet.range(pivot).value();\n        return function(pos, advanced, hidden) {\n            if (hidden) { return true; }   // skip hidden cells\n            var val = ( isCol ?\n                        sheet.range(pivot.row, pos) :\n                        sheet.range(pos, pivot.col) ).value();\n            if (firstVal === null) {\n                return val === null ? false : pos;\n            } else if (!advanced && val === null) {\n                firstVal = null; // switch to the other mode\n                return false;\n            } else {\n                return val === null;\n            }\n        };\n    }\n\n    kendo.spreadsheet.SheetNavigator = SheetNavigator;\n})(kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n\n(function(f, define){\n    define('spreadsheet/axismanager',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    var AxisManager = kendo.Class.extend({\n        init: function(sheet) {\n            this._sheet = sheet;\n        },\n\n        forEachSelectedColumn: function(callback) {\n            var sheet = this._sheet;\n\n            sheet.batch(function() {\n                sheet.select().forEachColumnIndex(function(index, i) {\n                    callback(sheet, index, i);\n                });\n            }, { layout: true, recalc: true });\n        },\n\n        forEachSelectedRow: function(callback) {\n            var sheet = this._sheet;\n\n            sheet.batch(function() {\n                sheet.select().forEachRowIndex(function(index, i) {\n                    callback(sheet, index, i);\n                });\n            }, { layout: true, recalc: true });\n        },\n\n        includesHiddenColumns: function(ref) {\n            return this._sheet._grid._columns.includesHidden(ref.topLeft.col, ref.bottomRight.col);\n        },\n\n        includesHiddenRows: function(ref) {\n            return this._sheet._grid._rows.includesHidden(ref.topLeft.row, ref.bottomRight.row);\n        },\n\n        selectionIncludesHiddenColumns: function() {\n            return this.includesHiddenColumns(this._sheet.select());\n        },\n\n        selectionIncludesHiddenRows: function() {\n            return this.includesHiddenRows(this._sheet.select());\n        },\n\n        deleteSelectedColumns: function() {\n            var indexes = [], delta = 0;\n            this.forEachSelectedColumn(function(sheet, index) {\n                index -= delta;\n                if (sheet.isHiddenColumn(index)) {\n                    return;\n                }\n                delta++;\n                var formulas = [];\n                indexes.unshift({\n                    index    : index,\n                    formulas : formulas,\n                    width    : sheet.columnWidth(index)\n                });\n                sheet._saveModifiedFormulas(formulas, function(){\n                    sheet.deleteColumn(index);\n                });\n            });\n            return indexes;\n        },\n\n        deleteSelectedRows: function() {\n            var indexes = [], delta = 0;\n            this.forEachSelectedRow(function(sheet, index) {\n                index -= delta;\n                if (sheet.isHiddenRow(index)) {\n                    return;\n                }\n                delta++;\n                var formulas = [];\n                indexes.unshift({\n                    index    : index,\n                    formulas : formulas,\n                    height   : sheet.rowHeight(index)\n                });\n                sheet._saveModifiedFormulas(formulas, function(){\n                    sheet.deleteRow(index);\n                });\n            });\n            return indexes;\n        },\n\n        hideSelectedColumns: function() {\n            this.forEachSelectedColumn(function(sheet, index) {\n                sheet.hideColumn(index);\n            });\n            var sheet = this._sheet;\n            var ref = sheet.select().toRangeRef();\n            var left = ref.topLeft.col;\n            var right = ref.bottomRight.col;\n            var sel = null;\n            while (true) {\n                var hasRight = right < sheet._columns._count;\n                var hasLeft = left >= 0;\n                if (!hasLeft && !hasRight) {\n                    break;\n                }\n                if (hasRight && !sheet.isHiddenColumn(right)) {\n                    sel = right;\n                    break;\n                }\n                if (hasLeft && !sheet.isHiddenColumn(left)) {\n                    sel = left;\n                    break;\n                }\n                left--;\n                right++;\n            }\n            if (sel !== null) {\n                ref = new kendo.spreadsheet.RangeRef(\n                    new kendo.spreadsheet.CellRef(0, sel),\n                    new kendo.spreadsheet.CellRef(sheet._rows._count - 1, sel)\n                );\n                sheet.range(ref).select();\n            }\n        },\n\n        hideSelectedRows: function() {\n            this.forEachSelectedRow(function(sheet, index) {\n                sheet.hideRow(index);\n            });\n            var sheet = this._sheet;\n            var ref = sheet.select().toRangeRef();\n            var top = ref.topLeft.row;\n            var bottom = ref.bottomRight.row;\n            var sel = null;\n            while (true) {\n                var hasBottom = bottom < sheet._rows._count;\n                var hasTop = top >= 0;\n                if (!hasTop && !hasBottom) {\n                    break;\n                }\n                if (hasBottom && !sheet.isHiddenRow(bottom)) {\n                    sel = bottom;\n                    break;\n                }\n                if (hasTop && !sheet.isHiddenRow(top)) {\n                    sel = top;\n                    break;\n                }\n                top--;\n                bottom++;\n            }\n            if (sel !== null) {\n                ref = new kendo.spreadsheet.RangeRef(\n                    new kendo.spreadsheet.CellRef(sel, 0),\n                    new kendo.spreadsheet.CellRef(sel, sheet._columns._count - 1)\n                );\n                sheet.range(ref).select();\n            }\n        },\n\n        unhideSelectedColumns: function() {\n            this.forEachSelectedColumn(function(sheet, index) {\n                sheet.unhideColumn(index);\n            });\n        },\n\n        unhideSelectedRows: function() {\n            this.forEachSelectedRow(function(sheet, index) {\n                sheet.unhideRow(index);\n            });\n        },\n\n        addColumnLeft: function() {\n            var sheet = this._sheet;\n            var base, count = 0;\n            sheet.batch(function(){\n                sheet.select().forEachColumnIndex(function(index) {\n                    if (!base) {\n                        base = index;\n                    }\n                    sheet.insertColumn(base);\n                    ++count;\n                });\n            }, { recalc: true, layout: true });\n            return { base: base, count: count };\n        },\n\n        addColumnRight: function() {\n            var sheet = this._sheet;\n            var base, count = 0;\n            sheet.batch(function(){\n                sheet.select().forEachColumnIndex(function(index) {\n                    base = index + 1;\n                    ++count;\n                });\n                for (var i = 0; i < count; ++i) {\n                    sheet.insertColumn(base);\n                }\n            }, { recalc: true, layout: true });\n            return { base: base, count: count };\n        },\n\n        addRowAbove: function() {\n            var sheet = this._sheet;\n            var base, count = 0;\n            var selectedRows = sheet.select();\n\n            sheet.batch(function(){\n                selectedRows.forEachRowIndex(function(index) {\n                    if (!base) {\n                        base = index;\n                    }\n                    sheet.insertRow(base);\n                    ++count;\n                });\n            }, { recalc: true, layout: true });\n\n            return { base: base, count: count };\n        },\n\n        addRowBelow: function() {\n            var sheet = this._sheet;\n            var base, count = 0;\n\n            sheet.batch(function(){\n                sheet.select().forEachRowIndex(function(index) {\n                    base = index + 1;\n                    ++count;\n                });\n                for (var i = 0; i < count; ++i) {\n                    sheet.insertRow(base);\n                }\n            }, { recalc: true, layout: true });\n\n            return { base: base, count: count };\n        }\n    });\n\n    kendo.spreadsheet.AxisManager = AxisManager;\n})(kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/clipboard',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    var $ = kendo.jQuery;\n    var CellRef = kendo.spreadsheet.CellRef;\n\n    var Clipboard = kendo.Class.extend({\n        init: function(workbook) {\n            this._content = {};\n            this._externalContent = {};\n            this._internalContent = {};\n            this.workbook = workbook;\n            this.origin = kendo.spreadsheet.NULLREF;\n            this.iframe = document.createElement(\"iframe\");\n            this.iframe.className = \"k-spreadsheet-clipboard-paste\";\n            this.iframe.setAttribute(\"title\", \"Spreadsheet clipboard iframe\");\n            this.menuInvoked = false;\n            this._uid = kendo.guid();\n            document.body.appendChild(this.iframe);\n        },\n\n        destroy: function() {\n            $(this.iframe).remove();\n        },\n\n        canCopy: function() {\n            var status = {canCopy: true};\n            var selection = this.workbook.activeSheet().select();\n            if (selection === kendo.spreadsheet.NULLREF) {\n                status.canCopy = false;\n            }\n            if (selection instanceof kendo.spreadsheet.UnionRef) {\n                status.canCopy = false;\n                status.multiSelection = true;\n            }\n            if (this.menuInvoked) {\n                status.canCopy = false;\n                status.menuInvoked = true;\n            }\n            return status;\n        },\n\n        canPaste: function() {\n            var sheet = this.workbook.activeSheet();\n            var ref = this.pasteRef();\n            var range = sheet.range(ref);\n            var status = { canPaste: true, pasteOnMerged: false, pasteOnDisabled: false };\n\n            if (!range.enable()) {\n                status.canPaste =  false;\n                status.pasteOnDisabled = true;\n            }\n            if (!ref.eq(sheet.unionWithMerged(ref))) {\n                status.canPaste = false;\n                status.pasteOnMerged = true;\n            }\n            if (this.menuInvoked) {\n                status.canPaste = false;\n                status.menuInvoked = true;\n            }\n            return status;\n        },\n\n        intersectsMerged: function() {\n            var sheet = this.workbook.activeSheet();\n            this.parse();\n            this.origin = this._content.origRef;\n            var ref = this.pasteRef();\n            return !ref.eq(sheet.unionWithMerged(ref));\n        },\n\n        copy: function() {\n            var sheet = this.workbook.activeSheet();\n            this.origin = sheet.select();\n            this._internalContent = sheet.selection().getState();\n            delete this._externalContent.html;\n            delete this._externalContent.plain;\n        },\n\n        cut: function() {\n            var sheet = this.workbook.activeSheet();\n            this.copy();\n            sheet.range(sheet.select()).clear();\n        },\n\n        pasteRef: function() {\n            var sheet = this.workbook.activeSheet();\n\n            // When pasting from an external source, origin will be\n            // NULLREF.  Just return the destination range.\n            // https://github.com/telerik/kendo-ui-core/issues/3486\n            if (this.origin === kendo.spreadsheet.NULLREF) {\n                return sheet.select();\n            }\n\n            var destination = sheet.activeCell().first();\n            var originActiveCell = this.origin.first();\n            var rowDelta = originActiveCell.row - destination.row;\n            var colDelta = originActiveCell.col - destination.col;\n\n            return this.origin.relative(rowDelta, colDelta, 3);\n        },\n\n        paste: function() {\n            var sheet = this.workbook.activeSheet();\n            var pasteRef = this.pasteRef();\n            if (pasteRef.bottomRight.row >= sheet._rows._count || pasteRef.bottomRight.col >= sheet._columns._count) {\n                sheet.resize(\n                    Math.max(pasteRef.bottomRight.row + 1, sheet._rows._count),\n                    Math.max(pasteRef.bottomRight.col + 1, sheet._columns._count)\n                );\n            }\n            sheet.range(pasteRef).setState(this._content, this);\n            sheet.triggerChange({ recalc: true, ref: pasteRef });\n        },\n\n        external: function(data) {\n            if (data && (data.html || data.plain)) {\n                this._externalContent = data;\n            } else {\n                return this._externalContent;\n            }\n        },\n\n        isExternal: function() {\n            return !this._isInternal();\n        },\n\n        parse: function() {\n            var state = newState();\n\n            if (this._isInternal()) {\n                state = this._internalContent;\n            } else {\n                var data = this._externalContent;\n                if (data.html) {\n                    var doc = this.iframe.contentWindow.document;\n                    doc.open();\n                    doc.write(data.html);\n                    doc.close();\n                    var table = doc.querySelector(\"table\");\n                    if (table) {\n                        state = parseHTML(table);\n                    } else {\n                        state = parseTSV(data.plain);\n                    }\n                } else {\n                    state = parseTSV(data.plain);\n                }\n                this.origin = state.origRef;\n            }\n\n            this._content = state;\n        },\n\n        _isInternal: function() {\n            if (this._externalContent.html === undefined) {\n                return true;\n            }\n            var internalHTML = $(\"<div/>\").html(this._externalContent.html).find(\"table.kendo-clipboard-\"+ this._uid).length ? true : false;\n            var internalPlain = $(\"<div/>\").html(this._externalContent.plain).find(\"table.kendo-clipboard-\"+ this._uid).length ? true : false;\n            return (internalHTML || internalPlain);\n        }\n    });\n    kendo.spreadsheet.Clipboard = Clipboard;\n\n    function newState() {\n        var ref = new CellRef(0, 0, 0);\n        return {\n            ref         : ref,\n            mergedCells : [],\n            data        : [],\n            foreign     : true,\n            origRef     : ref.toRangeRef()\n        };\n    }\n\n    function setStateData(state, row, col, value) {\n        var data = state.data || (state.data = []);\n        if (!data[row]) {\n            data[row] = [];\n        }\n        data[row][col] = value;\n        var br = state.origRef.bottomRight;\n        br.row = Math.max(br.row, row);\n        br.col = Math.max(br.col, col);\n    }\n\n    function stripStyle(style) {\n        return style.replace(/^-(?:ms|moz|webkit)-/, \"\");\n    }\n\n    function borderObject(styles) {\n        var obj = {};\n        [\n            \"borderBottom\",\n            \"borderRight\",\n            \"borderLeft\",\n            \"borderTop\"\n        ].forEach(function(key) {\n            obj[key] = styles[key + \"Style\"] == \"none\" ? null : {\n                size: 1,\n                color: styles[key + \"Color\"]\n            };\n        });\n        return obj;\n    }\n\n    function cellState(row, col, element, hBorders, vBorders) {\n        var styles = window.getComputedStyle(element);\n\n        // note: Chrome 70 appends a \\t to a cell's text, which is actually mandated by the standard\n        // ([1] item 6).  We remove it below.  In [2] it's suggested they might switch back to\n        // previous behavior, but removing an eventual last TAB won't hurt anyway.\n        //\n        // [1] https://www.w3.org/TR/html53/dom.html#dom-htmlelement-innertext\n        // [2] https://bugs.chromium.org/p/chromium/issues/detail?id=897373\n        var text = element.innerText.replace(/\\t$/, \"\");\n\n        var borders = borderObject(styles);\n        var state = {\n            value: text === \"\" ? null : text,\n\n            borderTop    : borders.borderTop    || hBorders.get(row, col)     || null,\n            borderBottom : borders.borderBottom || hBorders.get(row + 1, col) || null,\n            borderLeft   : borders.borderLeft   || vBorders.get(row, col)     || null,\n            borderRight  : borders.borderRight  || vBorders.get(row, col + 1) || null,\n\n            fontSize : parseInt(styles[\"font-size\"], 10)\n        };\n\n        hBorders.set(row, col, state.borderTop);\n        hBorders.set(row + 1, col, state.borderBottom);\n        vBorders.set(row, col, state.borderLeft);\n        vBorders.set(row, col + 1, state.borderRight);\n\n        if (styles[\"background-color\"] !== \"rgb(0, 0, 0)\" && styles[\"background-color\"] !== \"rgba(0, 0, 0, 0)\") {\n            state.background = styles[\"background-color\"];\n        }\n        if (styles.color !== \"rgb(0, 0, 0)\" && styles.color !== \"rgba(0, 0, 0, 0)\") {\n            state.color = styles.color;\n        }\n        if (styles[\"text-decoration\"] == \"underline\") {\n            state.underline = true;\n        }\n        if (styles[\"font-style\"] == \"italic\") {\n            state.italic = true;\n        }\n        if (styles[\"font-weight\"] == \"bold\") {\n            state.bold = true;\n        }\n        if (stripStyle(styles[\"text-align\"]) !== \"right\") {\n            state.textAlign = stripStyle(styles[\"text-align\"]);\n        }\n        if (styles[\"vertical-align\"] !== \"middle\") {\n            state.verticalAlign = styles[\"vertical-align\"];\n        }\n        if (styles[\"word-wrap\"] !== \"normal\" ) {\n            state.wrap = true;\n        }\n\n        return state;\n    }\n\n    function parseHTML(table) {\n        var state = newState();\n\n        var done = [], row = 0, col = 0;\n        for (var i = 0; i < table.rows.length; ++i) {\n            done.push([]);\n        }\n        var hBorders = new kendo.spreadsheet.calc.runtime.Matrix();\n        var vBorders = new kendo.spreadsheet.calc.runtime.Matrix();\n\n        for (var ri = 0; ri < table.rows.length; ++ri, ++row) {\n            var tr = table.rows[ri];\n            col = 0;\n            for (var ci = 0; ci < tr.cells.length; ++ci) {\n                var td = tr.cells[ci];\n                var rowSpan = td.rowSpan;\n                var colSpan = td.colSpan;\n                while (done[row][col]) {\n                    col++;\n                }\n\n                // A cell containing a long text overflowing the next (empty) cell will weirdly be\n                // reported as merged by Excel (has colspan=2).  Then, Excel informatively suggests\n                // us to ignore the colSpan by passing mso-ignore:colspan in the style.  Much thanks!\n                // https://github.com/telerik/kendo-ui-core/issues/3760\n                var style = td.getAttribute(\"style\");\n                var ignoreColspan = /mso-ignore:colspan/.test(style);\n\n                setStateData(state, row, col, cellState(row, col, td, hBorders, vBorders));\n                if (rowSpan > 1 || (colSpan > 1 && !ignoreColspan)) {\n                    state.mergedCells.push(\n                        new kendo.spreadsheet.RangeRef(\n                            new CellRef(row, col),\n                            new CellRef(row + rowSpan - 1, col + colSpan - 1)\n                        ).toString());\n                }\n                for (var dr = row + rowSpan; --dr >= row;) {\n                    for (var dc = col + colSpan; --dc >= col;) {\n                        if (dr < done.length) {\n                            done[dr][dc] = true;\n                            if (!(dr == row && dc == col)) {\n                                setStateData(state, dr, dc, {});\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        return state;\n    }\n\n    function parseTSV(data) {\n        var state = newState();\n        if (data.indexOf(\"\\t\") === -1 && data.indexOf(\"\\n\") == -1) {\n            setStateData(state, 0, 0, { value: data });\n        } else {\n            var rows = data.split(\"\\n\");\n            for (var ri = 0; ri < rows.length; ri++) {\n                var cols = rows[ri].split(\"\\t\");\n                for (var ci = 0; ci < cols.length; ci++) {\n                    setStateData(state, ri, ci, { value: cols[ci] });\n                }\n            }\n        }\n        return state;\n    }\n\n})(kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/range',[ \"kendo.core\", \"../util/text-metrics\", \"../util/main\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    var $ = kendo.jQuery;\n\n    var UnionRef = kendo.spreadsheet.UnionRef;\n    var CellRef = kendo.spreadsheet.CellRef;\n    var RangeRef = kendo.spreadsheet.RangeRef;\n\n    var PROPERTIES = [\n        \"color\", \"fontFamily\", \"underline\",\n        \"italic\", \"bold\", \"textAlign\", \"indent\",\n        \"verticalAlign\", \"background\", \"format\", \"link\", \"editor\",\n        \"borderTop\", \"borderRight\", \"borderBottom\", \"borderLeft\",\n        \"comment\", \"html\"\n    ];\n\n    var Range = kendo.Class.extend({\n        init: function(ref, sheet) {\n            this._sheet = sheet;\n            this._ref = ref;\n        },\n\n        clone: function() {\n            return new Range(this._ref.clone(), this._sheet);\n        },\n\n        skipHiddenCells: function() {\n            var refs = [];\n            var self = this, sheet = self._sheet;\n            var skipHiddenRows = sheet.isHiddenRow.bind(sheet);\n            var skipHiddenCols = sheet.isHiddenColumn.bind(sheet);\n            self._ref.forEach(function(ref){\n                ref = self._normalize(ref.toRangeRef());\n                var tl = ref.topLeft, br = ref.bottomRight;\n                var rows = partition(tl.row, br.row, skipHiddenRows);\n                var cols = partition(tl.col, br.col, skipHiddenCols);\n                for (var i = 0; i < rows.length; ++i) {\n                    for (var j = 0; j < cols.length; ++j) {\n                        refs.push(new RangeRef(\n                            new CellRef(rows[i].begin, cols[j].begin),\n                            new CellRef(rows[i].end, cols[j].end)\n                        ));\n                    }\n                }\n            });\n            return sheet.range(refs.length > 1 ? new UnionRef(refs) : refs[0]);\n        },\n\n        _normalize: function(ref) {\n            return this._sheet._grid.normalize(ref);\n        },\n\n        _set: function(name, value, noTrigger) {\n            var self = this;\n            var sheet = self._sheet;\n            self._ref.forEach(function(ref) {\n                var result = ref;\n                var valueProp = name === \"value\" || name === \"formula\" || name === \"link\";\n\n                // Set values/formulas/links only to the topLeft cell when merged\n                if(valueProp && ref.topLeft) {\n                    var topLeftRef = new CellRef(ref.topLeft.row, ref.topLeft.col);\n\n                    sheet.forEachMergedCell(function(f){\n                        if(f.intersects(topLeftRef)) {\n                            result = topLeftRef;\n                        }\n                    });\n                }\n\n                sheet._set(result.toRangeRef(), name, value);\n            });\n            if (!noTrigger) {\n                sheet.triggerChange({\n                    recalc  : name == \"formula\" || name == \"value\" || name == \"validation\",\n                    value   : value,\n                    range   : self,\n                    ref     : self._ref,\n                    isValue : name == \"value\"\n                });\n            }\n            return self;\n        },\n\n        _get: function(name) {\n            return this._sheet._get(this._ref.toRangeRef(), name);\n        },\n\n        _property: function(name, value) {\n            if (value === undefined) {\n                return this._get(name);\n            } else {\n                return this._set(name, value);\n            }\n        },\n\n        value: function(value) {\n            if (value !== undefined) {\n                // When value is set through the public API we must clear the\n                // formula.  Don't trigger change (third parameter), it'll be\n                // done when setting the value below\n                this._set(\"formula\", null, true);\n            }\n            return this._property(\"value\", value);\n        },\n\n        html: function(value) {\n            return this._property(\"html\", value);\n        },\n\n        resize: function(direction) {\n            var ref = this._resizedRef(direction);\n            return new Range(ref, this._sheet);\n        },\n\n        _resizedRef: function(direction) {\n            return this._ref.map(function(ref) {\n                return ref.toRangeRef().resize(direction);\n            });\n        },\n\n        input: function(value, options) {\n            options = $.extend({\n                arrayFormula: false\n            }, options);\n            var existingFormat = this._get(\"format\"), x;\n            if (value !== undefined) {\n                var tl = this._ref.toRangeRef().topLeft;\n                x = kendo.spreadsheet.calc.parse(this._sheet.name(), tl.row, tl.col, value, existingFormat);\n                this._sheet.batch(function() {\n                    var formula = null;\n                    if (x.type == \"exp\") {\n                        formula = kendo.spreadsheet.calc.compile(x);\n                    } else if (existingFormat != \"@\") {\n                        var existingFormatType = existingFormat &&\n                            kendo.spreadsheet.formatting.type(x.value, existingFormat);\n                        if (x.type == \"date\" && existingFormatType != \"date\") {\n                            this.format(x.format || toExcelFormat(kendo.culture().calendar.patterns.d));\n                        } else if (x.type == \"percent\" && existingFormatType != \"percent\") {\n                            this.format(x.value*100 == (x.value*100|0) ? \"0%\" : \"0.00%\");\n                        } else if (x.format) {\n                            if (!existingFormat || x.currency ||\n                                (existingFormatType == \"number\" && x.type == \"number\" &&\n                                 x.format.length > existingFormat.length)) {\n                                this.format(x.format);\n                            }\n                        }\n                    } else if (x.type != \"string\") {\n                        x.value = value;\n                    }\n                    this.formula(formula, options.arrayFormula);\n                    if (!formula) {\n                        // value() will clear the formula.  Lucky for us,\n                        // x.value is undefined so it actually won't, but let's\n                        // be explicit and only set value if formula is not\n                        // present.\n                        this.value(x.value);\n                    }\n                }.bind(this), {\n                    recalc       : true,\n                    value        : value,\n                    ref          : this._ref,\n                    editorChange : this._sheet.isInEditMode(),\n                    isValue      : true\n                });\n\n                return this;\n            } else {\n                value = this._get(\"value\");\n                var formula = this._get(\"formula\");\n                var type = existingFormat && !formula && kendo.spreadsheet.formatting.type(value, existingFormat);\n\n                if (formula) {\n                    // it's a Formula object which stringifies to the\n                    // formula as text (without the starting `=`).\n                    value = \"=\" + formula;\n                } else OUT: { \n                    if (existingFormat && type == \"date\") {\n                        // check if we could parse back the displayed value.\n                        // https://github.com/telerik/kendo/issues/5335\n                        var t1 = kendo.spreadsheet.formatting.text(value, existingFormat);\n                        x = kendo.spreadsheet.calc.parse(null, null, null, t1, existingFormat); // it's not a formula so we don't need sheet/row/col\n                        var t2 = kendo.spreadsheet.formatting.text(x.value, existingFormat);\n                        if (t1 == t2) {\n                            value = t1;\n                            break OUT; \n                        }\n                    }\n                    if (type === \"date\") {\n                        value = kendo.toString(kendo.spreadsheet.numberToDate(value), kendo.culture().calendar.patterns.d);\n                    } else if (type === \"percent\") {\n                        value = kendo.spreadsheet.calc.runtime.limitPrecision(value * 100) + \"%\";\n                    } else if (typeof value == \"string\" &&\n                               (/^[=']/.test(value) ||\n                                (/^(?:true|false)$/i).test(value) ||\n                                looksLikeANumber(value))) {\n                        value = \"'\" + value;\n                    } else if (this._sheet._useCultureDecimals() &&\n                               typeof value == \"number\" &&\n                               value != Math.floor(value)) {\n                        value = String(value).replace(\".\", kendo.culture().numberFormat[\".\"]);\n                    }\n                }\n\n                return value;\n            }\n        },\n\n        enable: function(value) {\n            if (value === undefined) {\n                return !kendo.util.withExit(function(exit){\n                    this._sheet.forEach(this._ref, function(_, __, data) {\n                        if (data.enable === false) {\n                            exit(true);\n                        }\n                    });\n                }, this);\n            }\n\n            return this._property(\"enable\", value);\n        },\n\n        formula: function(value, arrayFormula) {\n            var self = this;\n            if (value === undefined) {\n                var f = self._get(\"formula\");\n                return f ? \"\" + f : null; // stringify if present\n            }\n            if (arrayFormula) {\n                // when setting an array formula, we want to set it on\n                // the first cell only, as it will fill the whole\n                // range.\n                var ref = this._ref.toRangeRef();\n                value = self._sheet.range(ref.topLeft)\n                    ._set(\"formula\", value)\n                    ._get(\"formula\"); // make sure we get the compiled Formula, not a string\n\n                if (value) {    // could be null.\n                    // this will be used in FormulaContext -- it's the\n                    // range that the formula must populate.\n                    value.setArrayFormulaRange(ref);\n                }\n            } else {\n                self._set(\"formula\", value);\n            }\n            return self;\n        },\n\n        intersectingArrayFormula: function() {\n            var ref = this._ref.clone().simplify().setSheet(this._sheet.name());\n            return kendo.util.withExit(function(exit){\n                this._sheet._forFormulas(function(f){\n                    var r = f.arrayFormulaRange;\n                    if (r && (r = ref.intersect(r)) !== kendo.spreadsheet.NULLREF) {\n                        exit({ formula: f, intersection: r });\n                    }\n                });\n            }, this);\n        },\n\n        canEditArrayFormula: function() {\n            var x = this.intersectingArrayFormula();\n            if (x) {\n                // we want to allow editing only when the new range is\n                // at least as big as the original range (i.e. no\n                // cells removed)\n                return x.formula.arrayFormulaRange.eq(x.intersection);\n            }\n            return true;\n        },\n\n        validation: function(value) {\n            //TODO: Accept objects only?\n\n            if (value === undefined) {\n                var f = this._get(\"validation\");\n\n                return f ? f.toJSON() : null; // stringify if present\n            }\n            return this._property(\"validation\", value);\n        },\n\n        _getValidationState: function() {\n            var ref = this._ref.toRangeRef();\n            var topLeftRow = ref.topLeft.row;\n            var topLeftCol = ref.topLeft.col;\n            var bottomRightRow = ref.bottomRight.row;\n            var bottomRightCol = ref.bottomRight.col;\n            var ci, ri;\n\n            for (ci = topLeftCol; ci <= bottomRightCol; ci ++) {\n                for (ri = topLeftRow; ri <= bottomRightRow; ri ++) {\n                    var validation = this._sheet._validation(ri, ci);\n\n                    if (validation && validation.type === \"reject\" && validation.value === false) {\n                        return validation;\n                    }\n                }\n            }\n\n            return false;\n        },\n\n        merge: function() {\n            this._ref = this._sheet._merge(this._ref);\n            return this;\n        },\n\n        unmerge: function() {\n            var mergedCells = this._sheet._mergedCells;\n\n            this._ref.forEach(function(ref) {\n                ref.toRangeRef().intersecting(mergedCells).forEach(function(mergedRef) {\n                    mergedCells.splice(mergedCells.indexOf(mergedRef), 1);\n                });\n            });\n\n            this._sheet.triggerChange({});\n\n            return this;\n        },\n\n        select: function() {\n            this._sheet.select(this._ref);\n\n            return this;\n        },\n\n        values: function(values) {\n            if (this._ref instanceof UnionRef) {\n                throw new Error(\"Unsupported for multiple ranges.\");\n            }\n\n            if (this._ref === kendo.spreadsheet.NULLREF) {\n                if (values !== undefined) {\n                    throw new Error(\"Unsupported for NULLREF.\");\n                } else {\n                    return [];\n                }\n            }\n\n            var ref = this._ref.toRangeRef();\n            var topLeftRow = ref.topLeft.row;\n            var topLeftCol = ref.topLeft.col;\n            var bottomRightRow = ref.bottomRight.row;\n            var bottomRightCol = ref.bottomRight.col;\n            var ci, ri;\n\n            if (values === undefined) {\n                values = new Array(ref.height());\n\n                for (var vi = 0; vi < values.length; vi++) {\n                    values[vi] = new Array(ref.width());\n                }\n\n                for (ci = topLeftCol; ci <= bottomRightCol; ci ++) {\n                    for (ri = topLeftRow; ri <= bottomRightRow; ri ++) {\n                        values[ri - topLeftRow][ci - topLeftCol] = this._sheet._value(ri, ci);\n                    }\n                }\n\n                return values;\n            } else {\n                this._sheet._set(ref, \"formula\", null);\n\n                for (ci = topLeftCol; ci <= bottomRightCol; ci ++) {\n                    for (ri = topLeftRow; ri <= bottomRightRow; ri ++) {\n                        var row = values[ri - topLeftRow];\n\n                        if (row) {\n                            var value = row[ci - topLeftCol];\n\n                            if (value !== undefined) {\n                                this._sheet._value(ri, ci, value);\n                            }\n                        }\n                    }\n                }\n\n                this._sheet.triggerChange({ recalc: true, ref: ref });\n\n                return this;\n            }\n        },\n\n        _properties: function(props, isAutofill) {\n            if (this._ref instanceof UnionRef) {\n                throw new Error(\"Unsupported for multiple ranges.\");\n            }\n\n            if (this._ref === kendo.spreadsheet.NULLREF) {\n                if (props !== undefined) {\n                    throw new Error(\"Unsupported for NULLREF.\");\n                } else {\n                    return [];\n                }\n            }\n\n            var ref = this._ref.toRangeRef();\n            var topLeftRow = ref.topLeft.row;\n            var topLeftCol = ref.topLeft.col;\n            var bottomRightRow = ref.bottomRight.row;\n            var bottomRightCol = ref.bottomRight.col;\n            var ci, ri;\n            var sheet = this._sheet;\n\n            if (props === undefined) {\n                props = new Array(ref.height());\n                sheet.forEach(ref, function(row, col, data){\n                    row -= topLeftRow;\n                    col -= topLeftCol;\n                    var line = props[row] || (props[row] = []);\n                    line[col] = data;\n                });\n                return props;\n            }\n            else {\n                var data;\n                ref = ref.clone();\n                var setProp = function(propName) {\n                    var propValue = data[propName];\n                    ref.topLeft.row = ref.bottomRight.row = ri;\n                    ref.topLeft.col = ref.bottomRight.col = ci;\n\n                    if (propName == \"value\") {\n                        sheet._set(ref, \"formula\", null);\n                    }\n\n                    sheet._set(ref, propName, propValue);\n                };\n\n                for (ci = topLeftCol; ci <= bottomRightCol; ci ++) {\n                    if (!isAutofill && sheet.isHiddenColumn(ci)) {\n                        continue;\n                    }\n                    for (ri = topLeftRow; ri <= bottomRightRow; ri ++) {\n                        if (!isAutofill && sheet.isHiddenRow(ri)) {\n                            continue;\n                        }\n                        if (isAutofill && sheet.isFilteredRow(ri)) {\n                            continue;\n                        }\n                        var row = props[ri - topLeftRow];\n                        if (row) {\n                            data = row[ci - topLeftCol];\n                            if (data) {\n                                Object.keys(data).forEach(setProp);\n                            }\n                        }\n                    }\n                }\n                sheet.triggerChange({ recalc: true, ref: this._ref });\n                return this;\n            }\n        },\n\n        clear: function(options) {\n            options = options || {};\n            var clearAll = options.clearAll || !Object.keys(options).length;\n\n            var sheet = this._sheet;\n\n            var reason = {\n                recalc: clearAll || options.contentsOnly,\n                ref: this._ref\n            };\n\n            sheet.batch(function() {\n\n                if (reason.recalc) {\n                    this.formula(null);\n                }\n\n                if (clearAll) {\n                    this.validation(null);\n                }\n\n                if (clearAll || options.formatOnly) {\n                    PROPERTIES.forEach(function(x) {\n                        if (!(options.keepBorders && /^border/i.test(x))) {\n                            this[x](null);\n                        }\n                    }.bind(this));\n                    this.fontSize(null);\n                    this.wrap(null);\n                    this.unmerge();\n                }\n\n            }.bind(this), reason);\n\n            return this;\n        },\n\n        clearContent: function() {\n            return this.clear({ contentsOnly: true });\n        },\n\n        clearFormat: function() {\n            return this.clear({ formatOnly: true });\n        },\n\n        isSortable: function() {\n            return !this.cantSort();\n        },\n\n        cantSort: function() {\n            if (this._ref instanceof UnionRef) {\n                return { code: \"cantSortMultipleSelection\",\n                         message: \"Unsupported for multiple ranges.\" };\n            }\n            if (this._ref === kendo.spreadsheet.NULLREF) {\n                return { code: \"cantSortNullRef\",\n                         message: \"Unsupported for NULLREF.\" };\n            }\n            var mc = this._sheet._getMergedCells(this._ref.toRangeRef());\n            var primary = mc.primary;\n            var secondary = mc.secondary;\n            var width = null, height = null;\n            var cant = {};\n            try {\n                this._sheet.forEach(this, function(row, col){\n                    var id = new CellRef(row, col).print();\n                    var merged = primary[id];\n                    if (merged) {\n                        if (width === null) {\n                            width = merged.width();\n                            height = merged.height();\n                        } else if (!(width == merged.width() && height == merged.height())) {\n                            throw cant;\n                        }\n                    }\n                    else if (!secondary[id] && mc.hasMerged) {\n                        throw cant;\n                    }\n                });\n            } catch(ex) {\n                if (ex !== cant) {\n                    throw ex;\n                }\n                return {\n                    code: \"cantSortMixedCells\",\n                    message: \"Unsupported for range containing cells of different shapes.\"\n                };\n            }\n            return false;\n        },\n\n        sort: function(spec) {\n            var reason = this.cantSort();\n            if (reason) {\n                throw new Error(reason.message);\n            }\n\n            if (spec === undefined) {\n                spec = { column: 0 };\n            }\n\n            spec = spec instanceof Array ? spec : [spec];\n\n            this._sheet._sortBy(this._ref.toRangeRef(), spec.map(function(spec, index) {\n                if (typeof spec === \"number\") {\n                    spec = { column: spec };\n                }\n\n                return {\n                    index: spec.column === undefined ? index : spec.column,\n                    ascending: spec.ascending === undefined ? true : spec.ascending\n                };\n            }));\n\n            return this;\n        },\n\n        isFilterable: function() {\n            return !(this._ref instanceof UnionRef);\n        },\n\n        filter: function(spec) {\n            if (this._ref instanceof UnionRef) {\n                throw new Error(\"Unsupported for multiple ranges.\");\n            }\n\n            if (spec === false) {\n                this.clearFilters();\n            } else {\n                spec = spec === true ? [] : spec instanceof Array ? spec : [spec];\n\n                this._sheet._filterBy(this._ref.toRangeRef(), spec.map(function(spec, index) {\n                    return {\n                        index: spec.column === undefined ? spec.index === undefined ? index : spec.index : spec.column,\n                        filter: spec.filter\n                    };\n                }));\n            }\n\n            return this;\n        },\n\n        clearFilter: function(spec) {\n            this._sheet.clearFilter(spec);\n        },\n\n        clearFilters: function() {\n            var filter = this._sheet.filter();\n            var spec = [];\n\n            if (filter) {\n                for (var i = 0; i < filter.columns.length; i++) {\n                    spec.push(filter.columns[i].index);\n                }\n\n                this._sheet.batch(function() {\n                    this.clearFilter(spec);\n                    this._filter = null;\n                }, { layout: true, filter: true });\n            }\n        },\n\n        hasFilter: function() {\n            var filter = this._sheet.filter();\n            return !!filter;\n        },\n\n        leftColumn: function() {\n            return new Range(this._ref.leftColumn(), this._sheet);\n        },\n\n        rightColumn: function() {\n            return new Range(this._ref.rightColumn(), this._sheet);\n        },\n\n        topRow: function() {\n            return new Range(this._ref.topRow(), this._sheet);\n        },\n\n        bottomRow: function() {\n            return new Range(this._ref.bottomRow(), this._sheet);\n        },\n\n        column: function(column) {\n            return new Range(this._ref.toColumn(column), this._sheet);\n        },\n\n        row: function(row) {\n            return new Range(this._ref.toRow(row), this._sheet);\n        },\n\n        forEachRow: function(callback) {\n            this._ref.forEachRow(function(ref) {\n                callback(new Range(ref, this._sheet));\n            }.bind(this));\n        },\n\n        forEachColumn: function(callback) {\n            this._ref.forEachColumn(function(ref) {\n                callback(new Range(ref, this._sheet));\n            }.bind(this));\n        },\n\n        sheet: function() {\n            return this._sheet;\n        },\n\n        topLeft: function() {\n            return this._ref.toRangeRef().topLeft;\n        },\n\n        intersectingMerged: function() {\n            var sheet = this._sheet;\n            var mergedCells = [];\n\n            sheet._mergedCells.forEach(function(ref) {\n                if (ref.intersects(this._ref)) {\n                    mergedCells.push(ref.toString());\n                }\n            }.bind(this));\n\n            return mergedCells;\n        },\n\n        getState: function(propertyName) {\n            var topLeft = this._ref.first();\n            var state = {\n                ref     : topLeft,\n                data    : [],\n                origRef : this._ref,\n\n                // save row heights\n                rows    : this._sheet._rows.getState()\n            };\n            var properties;\n            if (!propertyName) {\n                properties = kendo.spreadsheet.ALL_PROPERTIES;\n                state.mergedCells = this.intersectingMerged();\n            } else if (propertyName === \"input\") {\n                properties = [\"value\", \"formula\"];\n            } else if (propertyName === \"border\") {\n                properties = [\"borderLeft\", \"borderTop\", \"borderRight\", \"borderBottom\"];\n            } else {\n                properties = [propertyName];\n            }\n\n            var data = state.data;\n            this.forEachCell(function(row, col, cell) {\n                var cellState = {};\n                var dr = row - topLeft.row;\n                var dc = col - topLeft.col;\n                if (!data[dr]) {\n                    data[dr] = [];\n                }\n                data[dr][dc] = cellState;\n\n                properties.forEach(function(property) {\n                    var value = typeof cell[property] == \"undefined\" ? null : cell[property];\n                    if (value instanceof kendo.spreadsheet.calc.runtime.Formula ||\n                        value instanceof kendo.spreadsheet.validation.Validation)\n                    {\n                        value = value.deepClone();\n                    }\n                    cellState[property] = value;\n                });\n            });\n\n            return state;\n        },\n\n        setState: function(state, clipboard) {\n            var sheet = this._sheet;\n            var origin = this._ref.first();\n            var rowDelta = state.ref.row - origin.row;\n            var colDelta = state.ref.col - origin.col;\n            var internalClipboard = clipboard && !clipboard.isExternal();\n            var externalClipboard = clipboard && !internalClipboard;\n\n            sheet.batch(function() {\n                if (state.mergedCells) {\n                    this.unmerge();\n                }\n\n                if (!clipboard) {\n                    // restore row heights.  they won't be available\n                    // when this function is called from the clipboard\n                    // code.\n                    this._sheet._rows.setState(state.rows);\n                }\n\n                var row = origin.row;\n                var hasFilter = this.hasFilter();\n                state.data.forEach(function(data, dr){\n                    if (hasFilter && internalClipboard && sheet.isHiddenRow(state.ref.row + dr)) {\n                        return;\n                    }\n                    var col = origin.col;\n                    data.forEach(function(cellState, dc){\n                        if (hasFilter && internalClipboard && sheet.isHiddenColumn(state.ref.col + dc)) {\n                            return;\n                        }\n                        var range = clipboard ? sheet.range(row, col)\n                            : sheet.range(origin.row + dr, origin.col + dc);\n                        if (range.enable()) {\n                            for (var property in cellState) {\n                                if (property != \"value\") {\n                                    // make sure value comes last (after the loop),\n                                    // because if we set value here and get get to\n                                    // formula later and cellState.formula is null,\n                                    // it'll clear the value.\n\n                                    // when pasting, do not copy \"disabled\" state\n                                    if (!(clipboard && property == \"enable\")) {\n                                        range._set(property, cellState[property]);\n                                    }\n                                }\n                            }\n                            if (!cellState.formula) {\n                                // only need to set the value if we don't have a\n                                // formula.  Go through the lower level setter rather\n                                // than range.value(...), because range.value will clear\n                                // the formula!  chicken and egg issues.\n                                if (externalClipboard) {\n                                    // https://github.com/telerik/kendo-ui-core/issues/1688\n                                    // if we have a paste from external source, we should parse the\n                                    // value as if it were inputted.  This allows to treat numbers\n                                    // as numbers, or `=sum(a1:b2)` as formula (Google Sheets does\n                                    // the same).  A difference though is that we can't store an\n                                    // invalid Formula and display #ERROR, like G.S. does, so in\n                                    // case of a parse error we'll just set the value as string.\n                                    try {\n                                        if (cellState.value == null) { \n                                            range._set(\"value\", null);\n                                        } else {\n                                            range.input(cellState.value);\n                                        }\n                                    } catch(ex) {\n                                        range._set(\"value\", cellState.value);\n                                    }\n                                } else {\n                                    range._set(\"value\", cellState.value);\n                                }\n                            }\n                        }\n                        col++;\n                    });\n                    row++;\n                });\n\n                if (state.mergedCells) {\n                    state.mergedCells.forEach(function(merged) {\n                        merged = sheet._ref(merged).relative(rowDelta, colDelta, 3);\n                        sheet.range(merged).merge();\n                    }, this);\n                }\n            }.bind(this), { recalc: true, ref: this._ref });\n        },\n\n        _adjustRowHeight: function() {\n            var that = this;\n            var sheet = that._sheet;\n            var mc = sheet._getMergedCells(that._ref.toRangeRef());\n            var primary = mc.primary;\n            var secondary = mc.secondary;\n\n            sheet.batch(function() {\n                that.forEachRow(function(rowRange){\n                    var row = rowRange._ref.topLeft.row;\n                    var height = sheet.rowHeight(row);\n                    if (!height) {\n                        // do not adjust if hidden.\n                        // https://github.com/telerik/kendo-ui-core/issues/6272\n                        // (case 2)\n                        return;\n                    }\n                    rowRange.forEachCell(function(row, col, cell){\n                        var id = new CellRef(row, col).print();\n                        if (secondary[id]) {\n                            return;\n                        }\n                        var merged = primary[id];\n                        var width;\n                        if (merged) {\n                            width = sheet._columns.sum(merged.topLeft.col,\n                                                       merged.bottomRight.col);\n                        } else {\n                            width = sheet.columnWidth(col);\n                        }\n                        var data = cell.value;\n                        if (cell.format && data != null) { \n                            data = kendo.spreadsheet.formatting.format(data, cell.format);\n                        }\n                        var textHeight = kendo.spreadsheet.util.getTextHeight(\n                            data, width, cell.fontFamily, cell.fontSize, cell.wrap);\n                        height = Math.max(height, textHeight);\n                    });\n                    sheet.rowHeight(row, height);\n                });\n            }, { layout: true });\n        },\n\n        forEachCell: function(callback) {\n            this._ref.forEach(function(ref) {\n                this._sheet.forEach(ref.toRangeRef(), callback.bind(this));\n            }.bind(this));\n        },\n\n        hasValue: function() {\n            var defStyle = this._sheet._defaultCellStyle;\n            return kendo.util.withExit(function(exit){\n                this.forEachCell(function(row, col, cell) {\n                    // we must not consider cells that only have same values\n                    // as defaultCellStyle, or otherwise we will forbid\n                    // inserting rows/cols in an empty sheet.\n                    for (var key in cell) {\n                        var val = cell[key];\n                        if (val !== undefined && val !== null && val !== defStyle[key]) {\n                            exit(true);\n                        }\n                    }\n                });\n            }, this);\n        },\n\n        wrap: function(flag) {\n            if (flag === undefined) {\n                return !!this._property(\"wrap\");\n            }\n            this._property(\"wrap\", flag);\n            if (flag !== null) {\n                this._adjustRowHeight();\n            }\n            return this;\n        },\n\n        fontSize: function(size) {\n            if (size === undefined) {\n                return this._property(\"fontSize\");\n            }\n            this._property(\"fontSize\", size);\n            if (size !== null) {\n                this._adjustRowHeight();\n            }\n            return this;\n        },\n\n        draw: function(options, callback) {\n            this._sheet.draw(this, options, callback);\n        },\n\n        insideBorders: function(value) {\n            return this.insideVerticalBorders(value).insideHorizontalBorders(value);\n        },\n\n        insideVerticalBorders: function(value) {\n            this._ref.forEach(function(ref){\n                if (ref instanceof RangeRef && ref.width() > 1) {\n                    ref = ref.clone();\n                    ref.topLeft.col++;\n                    this._sheet.range(ref)._set(\"vBorders\", value);\n                }\n            }, this);\n            return this;\n        },\n\n        insideHorizontalBorders: function(value) {\n            this._ref.forEach(function(ref){\n                if (ref instanceof RangeRef && ref.height() > 1) {\n                    ref = ref.clone();\n                    ref.topLeft.row++;\n                    this._sheet.range(ref)._set(\"hBorders\", value);\n                }\n            }, this);\n            return this;\n        }\n    });\n\n    function partition(begin, end, predicate) {\n        while (begin <= end && predicate(begin)) {\n            begin++;\n        }\n        if (begin > end) {\n            return [];\n        }\n        for (var i = begin + 1; i <= end; ++i) {\n            if (predicate(i)) {\n                return [\n                    { begin: begin, end: i - 1 }\n                ].concat(partition(i + 1, end, predicate));\n            }\n        }\n        return [{ begin: begin, end: end }];\n    }\n\n    // use $.each instead of forEach to work in oldIE\n    $.each(PROPERTIES, function(i, property) {\n        Range.prototype[property] = function(value) {\n            return this._property(property, value);\n        };\n    });\n\n    function toExcelFormat(format) {\n        return format.replace(/M/g, \"m\").replace(/'/g, '\"').replace(/tt/, \"am/pm\");\n    }\n\n    function looksLikeANumber(str) {\n        // XXX: could do with just a regexp instead of calling parse.\n        return !(/^=/.test(str)) && (/number|percent/).test(kendo.spreadsheet.calc.parse(null, 0, 0, str).type);\n    }\n\n    var measureBox = $('<div style=\"position: absolute !important; top: -4000px !important; height: auto !important;' +\n                        'padding: 1px 3px !important; box-sizing: border-box; margin: 0 !important; border: 1px solid black !important;' +\n                        'line-height: normal !important; visibility: hidden !important;' +\n                        'white-space: pre-wrap;\"></div>'\n                      )[0];\n\n    function getTextHeight(text, width, fontFamily, fontSize, wrap) {\n        var styles = {\n            \"baselineMarkerSize\" : 0,\n            \"width\" : (wrap === true) ? width + \"px\" : \"auto\",\n            \"font-size\" : (fontSize || 12) + \"px\",\n            \"font-family\" : fontFamily || \"Arial\",\n            \"white-space\" : (wrap === true) ? \"pre-wrap\" : \"pre\",\n            \"overflow-wrap\" : (wrap === true) ? \"break-word\" : \"normal\",\n            \"word-wrap\" : (wrap === true) ? \"break-word\" : \"normal\"\n        };\n\n        return kendo.util.measureText(text, styles, { box: measureBox, normalizeText: false }).height;\n    }\n\n    kendo.spreadsheet.util = { getTextHeight: getTextHeight };\n    kendo.spreadsheet.Range = Range;\n})(window.kendo);\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n// -*- fill-column: 100 -*-\n\n(function(f, define){\n    define('spreadsheet/runtime',[ \"./references\" ], f);\n})(function(){\n    \"use strict\";\n\n    // WARNING: removing the following jshint declaration and turning\n    // == into === to make JSHint happy will break functionality.\n\n    /* global console */\n\n\n    var calc = {};\n    var spreadsheet = kendo.spreadsheet;\n    spreadsheet.calc = calc;\n    var exports = calc.runtime = {};\n    var Class = kendo.Class;\n\n    var Ref = spreadsheet.Ref;\n    var CellRef = spreadsheet.CellRef;\n    var RangeRef = spreadsheet.RangeRef;\n    var UnionRef = spreadsheet.UnionRef;\n    var NULL = spreadsheet.NULLREF;\n\n    /* -----[ Errors ]----- */\n\n    function CalcError(code) {\n        if (code instanceof CalcError) {\n            return code;\n        }\n        this.code = code;\n    }\n\n    CalcError.prototype.toString = function() {\n        return \"#\" + this.code + (this.code == \"NAME\" ? \"?\" : \"!\");\n    };\n\n    /* -----[ Context ]----- */\n\n    var Context = Class.extend({\n        init: function Context(callback, formula, ss, parent) {\n            this.callback = callback;\n            this.formula = formula;\n            this.ss = ss;\n            this.parent = parent;\n        },\n\n        resolve: function(val) {\n            var self = this;\n            if (val instanceof Ref) {\n                self.resolveCells([ val ], function(){\n                    self._resolve(val);\n                });\n            } else {\n                self._resolve(val);\n            }\n        },\n\n        error: function(val) {\n            return new CalcError(val);\n        },\n\n        _resolve: function(val) {\n            if (val === undefined) {\n                val = null;\n            } else if (Array.isArray(val)) {\n                val = this.asMatrix(val);\n            } else {\n                val = maybeRoundFloatErrors(val);\n            }\n            var f = this.formula;\n            if (f.arrayFormulaRange) {\n                // when this is an array formula, make sure we return a Matrix.  The value already\n                // *should* be a Matrix, so this won't incur speed penalty in normal cases.\n                val = this.asMatrix(val) || this.asMatrix([[ val ]]);\n            } else if (val instanceof RangeRef) {\n                val = this._arrayArg(val);\n            }\n            f.value = val;\n            if (this.ss.onFormula(f) && this.callback) {\n                this.callback.call(f, val);\n            }\n        },\n\n        resolveCells: function(a, f) {\n            var context = this, formulas = [];\n\n            (function loop(a){\n                for (var i = 0; i < a.length; ++i) {\n                    var x = a[i];\n                    if (x instanceof Ref) {\n                        add(context.getRefCells(x));\n                    }\n                    if (Array.isArray(x)) {\n                        // make sure we resolve cells in literal matrices\n                        loop(x);\n                    }\n                }\n            })(a);\n\n            if (!formulas.length) {\n                return f.call(context);\n            }\n\n            for (var pending = formulas.length, i = 0; i < formulas.length; ++i) {\n                fetch(formulas[i]);\n            }\n            function fetch(formula) { \n                formula.exec(context.ss, function(){\n                    if (!--pending) {\n                        f.call(context);\n                    }\n                }, context);\n            }\n            function add(a) {\n                for (var i = 0; i < a.length; ++i) {\n                    var cell = a[i];\n                    if (cell.formula) {\n                        formulas.push(cell.formula);\n                    }\n                }\n                return true;\n            }\n        },\n\n        cellValues: function(a, wantNulls) {\n            var ret = [];\n            for (var i = 0; i < a.length; ++i) {\n                var val = a[i];\n                if (val instanceof Ref) {\n                    val = this.getRefData(val, wantNulls);\n                    ret = ret.concat(val);\n                } else if (Array.isArray(val)) {\n                    ret = ret.concat(this.cellValues(val, wantNulls));\n                } else if (val instanceof Matrix) {\n                    ret = ret.concat(this.cellValues(val.data, wantNulls));\n                } else {\n                    ret.push(val);\n                }\n            }\n            return ret;\n        },\n\n        fetchName: function(ref, callback) {\n            var f = this.formula;\n            var val = this.ss.nameValue(ref, f.sheet, f.row, f.col);\n            if (val instanceof Formula) {\n                // clone and relocate to calling formula, so that relative references in a named\n                // formula would work as expected.\n                val = val.clone(f.sheet, f.row, f.col, true);\n\n                // XXX: I don't like this dependency here; basically we only need ss.onFormula to\n                // return true and do nothing else.\n                var ss = new spreadsheet.ValidationFormulaContext(this.ss.workbook);\n\n                val.exec(ss, callback, this);\n            } else {\n                if (val instanceof Ref) {\n                    // relocate for relative refs\n                    val = val.absolute(f.row, f.col);\n                    if (val instanceof RangeRef && this.ss.isMerged(val)) {\n                        val = val.topLeft;\n                    }\n                    if (!val.sheet) {\n                        val.sheet = f.sheet;\n                    }\n                }\n                callback(val == null ? new CalcError(\"NAME\") : val);\n            }\n        },\n\n        force: function(val) {\n            if (val instanceof Ref) {\n                return this.getRefData(val);\n            }\n            return val;\n        },\n\n        func: function(fname, callback, args) {\n            fname = fname.toLowerCase();\n            var f = FUNCS[fname];\n            if (f) {\n                return f.call(this, callback, args);\n            }\n            callback(new CalcError(\"NAME\"));\n        },\n\n        bool: function(val) {\n            if (val instanceof Ref) {\n                val = this.getRefData(val);\n            }\n            if (typeof val == \"string\") {\n                return val.toLowerCase() == \"true\";\n            }\n            if (typeof val == \"number\") {\n                return val !== 0;\n            }\n            if (typeof val == \"boolean\") {\n                return val;\n            }\n            return val != null;\n        },\n\n        _arrayArg: function(ref) { // not necessarily a reference though\n            var f = this.formula;\n            if (!f.arrayFormulaRange && ref instanceof RangeRef) {\n                // if formula wasn't saved with Ctrl-Shift-Enter but a range is passed, Excel does\n                // something special:\n                //\n                // - if range is Wx1 (horizontal array) and current formula resides within the\n                //   horizontal bounds of the range, the appropriate cell is selected.  Example:\n                //   A1..D1 contain 1, 2, 3, 4 and we have in B2: =A1:D1, then B2 will get 2 (the\n                //   value in A2).  If the same formula is typed outside the horizontal span of the\n                //   range, say in E2: =A1:D1, then #VALUE! is returned.\n                //\n                // - similarly, if the range is 1xH (vertical array), the formula must reside within\n                //   the vertical bounds of the range and it gets the corresponding cell; otherwise,\n                //   #VALUE!.\n                if (ref.height() == 1 && f.col >= ref.topLeft.col && f.col <= ref.bottomRight.col) {\n                    return this.getRefData(new CellRef(ref.topLeft.row, f.col).setSheet(ref.sheet));\n                }\n                if (ref.width() == 1 && f.row >= ref.topLeft.row && f.row <= ref.bottomRight.row) {\n                    return this.getRefData(new CellRef(f.row, ref.topLeft.col).setSheet(ref.sheet));\n                }\n                return new CalcError(\"VALUE\");\n            } else {\n                return this.asMatrix(ref);\n            }\n        },\n\n        asMatrix: function(range) {\n            if (range instanceof Matrix) {\n                return range;\n            }\n            var self = this;\n            if (range instanceof RangeRef) {\n                var tl = range.topLeft;\n                var top = tl.row, left = tl.col;\n                var cells = self.getRefCells(range);\n                var m = new Matrix(self);\n                if (isFinite(range.width())) {\n                    m.width = range.width();\n                }\n                if (isFinite(range.height())) {\n                    m.height = range.height();\n                }\n                if (!isFinite(top)) {\n                    top = 0;\n                }\n                if (!isFinite(left)) {\n                    left = 0;\n                }\n                cells.forEach(function(cell){\n                    m.set(cell.row - top,\n                          cell.col - left,\n                          cell.value);\n                });\n                return m;\n            }\n            if (Array.isArray(range) && range.length > 0) {\n                var m = new Matrix(self), row = 0;\n                range.forEach(function(line){\n                    var col = 0;\n                    var h = 1;\n                    line.forEach(function(el){\n                        var isRange = el instanceof RangeRef;\n                        if (el instanceof Ref && !isRange) {\n                            el = self.getRefData(el);\n                        }\n                        if (isRange || Array.isArray(el)) {\n                            el = self.asMatrix(el);\n                        }\n                        if (el instanceof Matrix) {\n                            el.each(function(el, r, c){\n                                m.set(row + r, col + c, el);\n                            });\n                            h = Math.max(h, el.height);\n                            col += el.width;\n                        } else {\n                            if(typeof el === \"string\" && el.length && !isNaN(el)) {\n                                el = Number(el);\n                            }\n\n                            m.set(row, col++, el);\n                        }\n                    });\n                    row += h;\n                });\n                return m;\n            }\n        },\n\n        getRefCells: function(refs, hiddenInfo, wantNulls) {\n            var f = this.formula;\n            return this.ss.getRefCells(refs, hiddenInfo, f.sheet, f.row, f.col, wantNulls);\n        },\n\n        getRefData: function(ref, wantNulls) {\n            var f = this.formula;\n            return this.ss.getData(ref, f.sheet, f.row, f.col, wantNulls);\n        },\n\n        workbook: function() {\n            return this.ss.workbook;\n        }\n    });\n\n    var Matrix = Class.extend({\n        init: function Matrix(context) {\n            this.context = context;\n            this.height = 0;\n            this.width = 0;\n            this.data = [];\n        },\n        clone: function() {\n            var m = new Matrix(this.context);\n            m.height = this.height;\n            m.width = this.width;\n            m.data = this.data.map(function(row){ return row.slice(); });\n            return m;\n        },\n        get: function(row, col) {\n            var line = this.data[row];\n            var val = line ? line[col] : null;\n            return val instanceof Ref ? this.context.getRefData(val) : val;\n        },\n        getNA: function(row, col) {\n            if (row < this.height && col < this.width) {\n                return this.get(row, col);\n            }\n            return new CalcError(\"N/A\");\n        },\n        set: function(row, col, data) {\n            var line = this.data[row];\n            if (line == null) {\n                line = this.data[row] = [];\n            }\n            line[col] = data;\n            if (row >= this.height) {\n                this.height = row + 1;\n            }\n            if (col >= this.width) {\n                this.width = col + 1;\n            }\n        },\n        each: function(f, includeEmpty) {\n            for (var row = 0; row < this.height; ++row) {\n                for (var col = 0; col < this.width; ++col) {\n                    var val = this.get(row, col);\n                    if (includeEmpty || val != null) {\n                        val = f.call(this.context, val, row, col);\n                        if (val !== undefined) {\n                            return val;\n                        }\n                    }\n                }\n            }\n        },\n        map: function(f, includeEmpty) {\n            var m = new Matrix(this.context);\n            this.each(function(el, row, col){\n                // here `this` is actually the context\n                m.set(row, col, f.call(this, el, row, col));\n            }, includeEmpty);\n            return m;\n        },\n        eachRow: function(f) {\n            for (var row = 0; row < this.height; ++row) {\n                var val = f.call(this.context, row);\n                if (val !== undefined) {\n                    return val;\n                }\n            }\n        },\n        eachCol: function(f) {\n            for (var col = 0; col < this.width; ++col) {\n                var val = f.call(this.context, col);\n                if (val !== undefined) {\n                    return val;\n                }\n            }\n        },\n        mapRow: function(f) {\n            var m = new Matrix(this.context);\n            this.eachRow(function(row){\n                m.set(row, 0, f.call(this.context, row));\n            });\n            return m;\n        },\n        mapCol: function(f) {\n            var m = new Matrix(this.context);\n            this.eachCol(function(col){\n                m.set(0, col, f.call(this.context, col));\n            });\n            return m;\n        },\n        toString: function() {\n            return JSON.stringify(this.data);\n        },\n        transpose: function() {\n            var m = new Matrix(this.context);\n            this.each(function(el, row, col){\n                m.set(col, row, el);\n            });\n            return m;\n        },\n        unit: function(n) {\n            this.width = this.height = n;\n            var a = this.data = new Array(n);\n            for (var i = n; --i >= 0;) {\n                var row = a[i] = new Array(n);\n                for (var j = n; --j >= 0;) {\n                    row[j] = i == j ? 1 : 0;\n                }\n            }\n            return this;\n        },\n        multiply: function(b) {\n            var a = this, m = new Matrix(a.context);\n            for (var row = 0; row < a.height; ++row) {\n                for (var col = 0; col < b.width; ++col) {\n                    var s = 0;\n                    for (var i = 0; i < a.width; ++i) {\n                        var va = a.get(row, i);\n                        var vb = b.get(i, col);\n                        if (typeof va != \"number\" || typeof vb != \"number\") {\n                            throw new CalcError(\"VALUE\");\n                        }\n                        s += va * vb;\n                    }\n                    m.set(row, col, s);\n                }\n            }\n            return m;\n        },\n        adds: function(b, s) {\n            var a = this, m = new Matrix(a.context);\n            var sign = s ? -1 : 1;\n            for (var row = 0; row < a.height; ++row) {\n                for (var col = 0; col < a.width; ++col) {\n                    var x = a.get(row, col),\n                        y = b.get(row, col);\n                    m.set(row, col, x + sign * y);\n                }\n            }\n            return m;\n        },\n        determinant: function() {\n            var a = this.clone().data;\n            var n = a.length;\n            var d = 1, C, L, i, k;\n            for (C = 0; C < n; C++) {\n                for (L = C; (L < n) && (!a[L][C]); L++) {}\n                if (L == n) {\n                    return 0;\n                }\n                if (L != C) {\n                    d = -d;\n                    for (k = C; k < n; k++) {\n                        var t = a[C][k];\n                        a[C][k] = a[L][k];\n                        a[L][k] = t;\n                    }\n                }\n                for (i = C+1; i < n; i++) {\n                    for (k = C+1; k < n; k++) {\n                        a[i][k] -= a[C][k] * a[i][C] / a[C][C];\n                    }\n                }\n                d *= a[C][C];\n            }\n            return d;\n        },\n        inverse: function() {\n            var n = this.width;\n            var m = this.augment(new Matrix(this.context).unit(n));\n            var a = m.data;\n            var tmp;\n\n            // Gaussian elimination\n            // https://en.wikipedia.org/wiki/Gaussian_elimination#Finding_the_inverse_of_a_matrix\n\n            // 1. Get zeros below main diagonal\n            for (var k = 0; k < n; ++k) {\n                var imax = argmax(k, n, function(i){ return a[i][k]; });\n                if (!a[imax][k]) {\n                    return null; // singular matrix\n                }\n                if (k != imax) {\n                    tmp = a[k];\n                    a[k] = a[imax];\n                    a[imax] = tmp;\n                }\n                for (var i = k+1; i < n; ++i) {\n                    for (var j = k+1; j < 2*n; ++j) {\n                        a[i][j] -= a[k][j] * a[i][k] / a[k][k];\n                    }\n                    a[i][k] = 0;\n                }\n            }\n\n            // 2. Get 1-s on main diagonal, dividing by pivot\n            for (var i = 0; i < n; ++i) {\n                for (var f = a[i][i], j = 0; j < 2*n; ++j) {\n                    a[i][j] /= f;\n                }\n            }\n\n            // 3. Get zeros above main diagonal.  Actually, we only care to compute the right side\n            // here (that will be the inverse), so in the inner loop below we go while j >= n,\n            // instead of j >= k.\n            for (var k = n; --k >= 0;) {\n                for (var i = k; --i >= 0;) {\n                    if (a[i][k]) {\n                        for (var j = 2*n; --j >= n;) {\n                            a[i][j] -= a[k][j] * a[i][k];\n                        }\n                    }\n                }\n            }\n\n            return m.slice(0, n, n, n);\n        },\n        augment: function(m) {\n            var ret = this.clone(), n = ret.width;\n            m.each(function(val, row, col){\n                ret.set(row, col + n, val);\n            });\n            return ret;\n        },\n        slice: function(row, col, height, width) {\n            var m = new Matrix(this.context);\n            for (var i = 0; i < height; ++i) {\n                for (var j = 0; j < width; ++j) {\n                    m.set(i, j, this.get(row + i, col + j));\n                }\n            }\n            return m;\n        }\n\n        // XXX: debug\n        // dump: function() {\n        //     this.data.forEach(function(row){\n        //         console.log(row.map(function(val){\n        //             var str = val.toFixed(3).replace(/\\.?0*$/, function(s){\n        //                 return [ \"\", \" \", \"  \", \"   \", \"    \" ][s.length];\n        //             });\n        //             if (val >= 0) { str = \" \" + str; }\n        //             return str;\n        //         }).join(\"  \"));\n        //     });\n        // }\n    });\n\n    function argmax(i, end, f) {\n        var max = f(i), pos = i;\n        while (++i < end) {\n            var v = f(i);\n            if (v > max) {\n                max = v;\n                pos = i;\n            }\n        }\n        return pos;\n    }\n\n    /* -----[ Formula ]----- */\n\n    var Formula = Class.extend({\n        init: function Formula(refs, handler, printer, sheet, row, col, arrayFormulaRange){\n            this.refs = refs;\n            this.handler = handler;\n            this.print = printer;\n            this.absrefs = null;\n            this.sheet = sheet;\n            this.row = row;\n            this.col = col;\n            this.onReady = [];\n            this.pending = false;\n            this.arrayFormulaRange = arrayFormulaRange;\n        },\n        setArrayFormulaRange: function(ref) {\n            this.arrayFormulaRange = ref.clone().setSheet(this.sheet);\n        },\n        clone: function(sheet, row, col, forceRefs) {\n            var lcsheet = sheet.toLowerCase();\n            var refs = this.refs;\n            var range = this.arrayFormulaRange;\n            if (forceRefs || lcsheet != this.sheet.toLowerCase()) {\n                refs = refs.map(function(ref){\n                    if (!ref.hasSheet() && (!ref.sheet || ref.sheet.toLowerCase() != lcsheet)) {\n                        ref = ref.clone().setSheet(sheet);\n                    }\n                    return ref;\n                });\n                if (range) {\n                    range = range.clone().setSheet(sheet);\n                }\n            }\n            return new Formula(refs, this.handler, this.print, sheet, row, col, range);\n        },\n        deepClone: function() {\n            var refs = this.refs.map(function(ref){ return ref.clone(); });\n            return new Formula(refs, this.handler, this.print, this.sheet, this.row, this.col, this.arrayFormulaRange);\n        },\n        resolve: function(val) {\n            this.pending = false;\n            this.onReady.forEach(function(callback){\n                callback(val);\n            });\n        },\n        exec: function(ss, callback, parentContext) {\n            if (\"value\" in this) {\n                if (callback) {\n                    callback(this.value);\n                }\n            } else {\n                if (callback) {\n                    this.onReady.push(callback);\n                }\n\n                var ctx = new Context(this.resolve, this, ss, parentContext);\n                var level = 0;\n                // if the call chain leads back to this same formula, we have a circular dependency.\n                while (parentContext) {\n                    if (parentContext.formula === this) {\n                        this.pending = false;\n                        ctx.resolve(new CalcError(\"CIRCULAR\"));\n                        return;\n                    }\n                    parentContext = parentContext.parent;\n                    ++level;\n                }\n\n                // pending is still useful for ASYNC formulas\n                if (this.pending) {\n                    return;\n                }\n                this.pending = true;\n\n                var next = function() {\n                    // compute and cache the absolute references\n                    if (!this.absrefs) {\n                        this.absrefs = this.refs.map(function(ref){\n                            return ref.absolute(this.row, this.col);\n                        }, this);\n                    }\n\n                    // finally invoke the handler given to us by the compiler in calc.js\n                    this.handler.call(ctx);\n                }.bind(this);\n\n                if (level < 20) {\n                    next();\n                } else {\n                    setTimeout(next, 0);\n                }\n            }\n        },\n        reset: function() {\n            this.onReady = [];\n            this.pending = false;\n            delete this.value;\n        },\n        renameSheet: function(oldSheetName, newSheetName) {\n            oldSheetName = oldSheetName.toLowerCase();\n            this.absrefs = null;\n            if (this.sheet.toLowerCase() == oldSheetName) {\n                this.sheet = newSheetName;\n            }\n            this.refs.forEach(function(ref){\n                ref.renameSheet(oldSheetName, newSheetName);\n            });\n        },\n        adjust: function(affectedSheet, operation, start, delta) {\n            affectedSheet = affectedSheet.toLowerCase();\n            var formulaRow = this.row;\n            var formulaCol = this.col;\n            var formulaSheet = this.sheet.toLowerCase();\n            var formulaMoves = false;\n            if (formulaSheet == affectedSheet) {\n                // move formula if it's after the change point\n                if (operation == \"row\" && formulaRow >= start) {\n                    this.row += delta;\n                    formulaMoves = true;\n                }\n                if (operation == \"col\" && formulaCol >= start) {\n                    this.col += delta;\n                    formulaMoves = true;\n                }\n            }\n            var newFormulaRow = this.row;\n            var newFormulaCol = this.col;\n            this.absrefs = null;\n            var prevRefs = this.refs;\n            var modified = formulaMoves;\n            this.refs = prevRefs.map(function(ref){\n                var newRef = adjust(ref);\n                if (!modified && !sameRef(newRef, ref)) {\n                    modified = true;\n                }\n                return newRef;\n            });\n\n            var prevRange = this.arrayFormulaRange;\n            if (prevRange) {\n                this.arrayFormulaRange = adjust(prevRange);\n                if (!modified && !sameRef(prevRange, this.arrayFormulaRange)) {\n                    modified = true;\n                }\n            }\n\n            if (modified) {\n                // return a clone of the original formula.  needed to undo operations like\n                // deleteRow, which can transform a reference into NULL.\n                return new Formula(prevRefs, this.handler, this.print, this.sheet, formulaRow, formulaCol, prevRange);\n            }\n\n            function adjust(ref){\n                if (ref === NULL) {\n                    return ref;\n                }\n                if (ref.sheet.toLowerCase() != affectedSheet) {\n                    if (formulaMoves) {\n                        // a reference to another sheet should still point to the same location\n                        // after adjustment; thus if row/col was removed before formula, relative\n                        // references must be adjusted by delta.\n                        if (operation == \"row\" && formulaRow >= start) {\n                            ref = ref.relative(delta, 0);\n                        }\n                        if (operation == \"col\" && formulaCol >= start) {\n                            ref = ref.relative(0, delta);\n                        }\n                    }\n                    return ref;\n                }\n                return ref.adjust(\n                    formulaRow, formulaCol,\n                    newFormulaRow, newFormulaCol,\n                    operation == \"row\",\n                    start, delta\n                );\n            }\n        },\n        toString: function() {\n            return this.print(this.row, this.col);\n        }\n    });\n\n    function sameRef(r1, r2) {\n        // note: r1.eq(r2) will not do, because it returns true for A1 and A1:A1 (CellRef\n        // vs. RangeRef).  To properly undo we need to assert that the references are exactly the\n        // same (including type).\n        if (r1.constructor !== r2.constructor) {\n            return false;\n        }\n        if (r1 instanceof CellRef) {\n            return r1.sheet == r2.sheet\n                && r1.row == r2.row\n                && r1.col == r2.col\n                && r1.rel == r2.rel;\n        }\n        if (r1 instanceof RangeRef) {\n            return sameRef(r1.topLeft     , r2.topLeft)\n                && sameRef(r1.bottomRight , r2.bottomRight)\n                && r1.endSheet == r2.endSheet;\n        }\n        if (r1 instanceof UnionRef) {\n            var i = r1.refs.length;\n            if (i != r2.refs.length) {\n                return false;\n            }\n            while (--i >= 0) {\n                if (!sameRef(r1.refs[i], r2.refs[i])) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    }\n\n    // spreadsheet functions --------\n    var FUNCS = Object.create(null);\n\n    FUNCS[\"if\"] = function(callback, args) {\n        var self = this;\n        var co = args[0], th = args[1], el = args[2];\n        // XXX: I don't like this resolveCells here.  We should try to declare IF with\n        // defineFunction.\n        this.resolveCells([ co ], function(){\n            var comatrix = self.asMatrix(co);\n            if (comatrix) {\n                // XXX: calling both branches in this case, since we'll typically need values from\n                // both.  We could optimize and call them only when first needed, but oh well.\n                th(function(th){\n                    el(function(el){\n                        var thmatrix = self.asMatrix(th);\n                        var elmatrix = self.asMatrix(el);\n                        callback(comatrix.map(function(val, row, col){\n                            if (val instanceof CalcError) {\n                                return val;\n                            } else if (self.bool(val)) {\n                                return thmatrix ? thmatrix.get(row, col) : th;\n                            } else {\n                                return elmatrix ? elmatrix.get(row, col) : el;\n                            }\n                        }));\n                    });\n                });\n            } else {\n                co = this.force(co);\n                if (co instanceof CalcError) {\n                    callback(co);\n                } else if (self.bool(co)) {\n                    th(callback);\n                } else {\n                    el(callback);\n                }\n            }\n        });\n    };\n\n    FUNCS[\"\"] = function(callback) {\n        callback((1+Math.sqrt(5))/2);\n    };\n\n    // Lasciate ogni speranza, voi ch'entrate.\n    //\n    // XXX: document this function.\n    function compileArgumentChecks(functionName, args) {\n        var arrayArgs = \"function arrayArgs(args) { var xargs = [], width = 0, height = 0, arrays = [], i = 0; \";\n        var resolve = \"function resolve(args, callback) { var toResolve = [], i = 0; \";\n        var name, forced, main = \"'use strict'; function check(args) { var stack = [], tmp, xargs = [], i = 0, m, err = 'VALUE'; \", haveForced = false;\n        var canBeArrayArg = false, hasArrayArgs = false;\n        main += args.map(comp).join(\"\");\n        main += \"if (i < args.length) return new CalcError('N/A'); \";\n        main += \"return xargs; } \";\n        arrayArgs += \"return { args: xargs, width: width, height: height, arrays: arrays }; } \";\n\n        var f;\n        if (haveForced) {\n            resolve += \"this.resolveCells(toResolve, callback); } \";\n            f = new Function(\"CalcError\", \"round\", main + resolve + arrayArgs + \" return { resolve: resolve, check: check, arrayArgs: arrayArgs };\");\n        } else {\n            f = new Function(\"CalcError\", \"round\", main + \" return { check: check };\");\n        }\n        f = f(CalcError, limitPrecision);\n        if (!hasArrayArgs) {\n            delete f.arrayArgs;\n        }\n        return f;\n\n        function comp(x) {\n            name = x[0];\n            var code = \"{ \";\n            if (Array.isArray(name)) {\n                arrayArgs += \"while (i < args.length) { \";\n                resolve += \"while (i < args.length) { \";\n                code += \"xargs.push(tmp = []); stack.push(xargs); xargs = tmp; \";\n                code += \"while (i < args.length) { \";\n                code += x.map(comp).join(\"\");\n                code += \"} \";\n                code += \"xargs = stack.pop(); \";\n                resolve += \"} \";\n                arrayArgs += \"} \";\n            } else if (name == \"+\") {\n                arrayArgs += \"while (i < args.length) { \";\n                resolve += \"while (i < args.length) { \";\n                code += \"if (i >= args.length) return new CalcError('N/A'); \";\n                code += \"xargs.push(tmp = []); stack.push(xargs); xargs = tmp; \";\n                code += \"do { \";\n                code += x.slice(1).map(comp).join(\"\");\n                code += \"} while (i < args.length); \";\n                code += \"xargs = stack.pop(); \";\n                resolve += \"} \";\n                arrayArgs += \"} \";\n            } else if (name == \"?\") {\n                // standalone assertion without a new argument\n                code += \"if (!(\" + cond(x[1]) + \")) return new CalcError(err); \";\n            } else {\n                var type = x[1];\n                if (Array.isArray(type) && /^#?collect/.test(type[0])) {\n                    var wantNulls = /!$/.test(type[0]);\n                    var n = type[2];\n                    force();\n                    code += \"try {\"\n                        + \"var $\" + name + \" = this.cellValues(args.slice(i\";\n                    if (n) {\n                        code += \", i + \" + n;\n                    }\n                    code += \")\" + (wantNulls ? \",true\" : \"\") + \").reduce(function(ret, $\"+name+\"){ \";\n                    if (type[0].charAt(0) != \"#\") {\n                        code += \"if ($\"+name+\" instanceof CalcError) throw $\"+name+\"; \";\n                    }\n                    code += \"if (\" + cond(type[1]) + \") ret.push($\"+name+\"); \";\n                    code += \"return ret; \";\n                    code += \"}.bind(this), []); \";\n                    if (n) {\n                        code += \"i += \" + n + \"; \";\n                    } else {\n                        code += \"i = args.length; \";\n                    }\n                    code += \"xargs.push($\"+name+\")\"\n                        + \"} catch(ex) { if (ex instanceof CalcError) return ex; throw ex; } \";\n                    resolve += \"toResolve.push(args.slice(i)); \";\n                } else if (type == \"rest\") {\n                    code += \"xargs.push(args.slice(i)); i = args.length; \";\n                } else {\n                    if ((canBeArrayArg = /^\\*/.test(name))) {\n                        hasArrayArgs = true;\n                        name = name.substr(1);\n                    }\n                    code += \"var $\" + name + \" = args[i++]; \";\n                    var allowError = false;\n                    if (/!$/.test(type)) {\n                        type = type.substr(0, type.length - 1);\n                        allowError = true;\n                    } else {\n                        code += \"if ($\"+name+\" instanceof CalcError) return $\"+name+\"; \";\n                    }\n                    code += typeCheck(type, allowError) + \"xargs.push($\"+name+\"); \";\n                }\n            }\n            code += \"} \";\n            return code;\n        }\n\n        function force() {\n            if (forced) {\n                return \"$\"+name+\"\";\n            }\n            haveForced = true;\n            forced = true;\n            resolve += \"toResolve.push(args[i++]); \";\n            return \"($\"+name+\" = this.force($\"+name+\"))\";\n        }\n\n        function forceNum(round) {\n            return \"(\"\n                +     (round\n                       ? (\"(typeof \" + force() + \" == 'number' ? ($\"+name+\" = round($\"+name+\"), true) : false) || \")\n                       : (\"(typeof \" + force() + \" == 'number') || \"))\n                +     \"(typeof $\"+name+\" == 'boolean' ? ($\"+name+\" = +$\" + name + \", true) : false) || \"\n                +     \"(typeof $\"+name+\" == 'string' && !/^(?:=|true|false)/i.test($\"+name+\") ? (\"\n                +       \"tmp = kendo.spreadsheet.calc.parse(0, 0, 0, $\"+name+\"), \"\n                +       \"/^date|number|percent$/.test(tmp.type) ? ($\"+name+\" = +tmp.value, true) : false\"\n                +     \") : false)\"\n                +  \")\";\n        }\n\n        function typeCheck(type, allowError) {\n            forced = false;\n            var ret = \"if (!(\" + cond(type) + \")) { \";\n            if (forced && !allowError) {\n                ret += \" if ($\" + name + \" instanceof CalcError) return $\" + name + \"; \";\n            }\n            ret += \"return new CalcError(err); } \";\n            if (!forced) {\n                resolve += \"i++; \";\n            }\n            if (canBeArrayArg) {\n                arrayArgs += \"var $\" + name + \" = this._arrayArg(args[i]); \"\n                    + \"if ($\" + name + \") { \"\n                    + \"xargs.push($\" + name + \"); \"\n                    + \"width = Math.max(width, $\" + name + \".width); \"\n                    + \"height = Math.max(height, $\" + name + \".height); \"\n                    + \"arrays.push(true) } else { \"\n                    + \"xargs.push(args[i]); \"\n                    + \"arrays.push(false); } i++; \";\n            } else {\n                arrayArgs += \"xargs.push(args[i++]); arrays.push(false); \";\n            }\n            return ret;\n        }\n\n        function cond(type) {\n            if (Array.isArray(type)) {\n                if (type[0] == \"or\") {\n                    return \"(\" + type.slice(1).map(cond).join(\") || (\") + \")\";\n                }\n                if (type[0] == \"and\") {\n                    return \"(\" + type.slice(1).map(cond).join(\") && (\") + \")\";\n                }\n                if (type[0] == \"values\") {\n                    return \"(\" + type.slice(1).map(function(val){\n                        return force() + \" === \" + val;\n                    }).join(\") || (\") + \")\";\n                }\n                if (type[0] == \"null\") {\n                    return \"(\" + cond(\"null\") + \" ? (($\"+name+\" = \" + type[1] + \"), true) : false)\";\n                }\n                if (type[0] == \"between\" || type[0] == \"[between]\") {\n                    return \"(\" + force() + \" >= \" + type[1] + \" && \" + \"$\"+name+\" <= \" + type[2] + \" ? true : ((err = 'NUM'), false))\";\n                }\n                if (type[0] == \"(between)\") {\n                    return \"(\" + force() + \" > \" + type[1] + \" && \" + \"$\"+name+\" < \" + type[2] + \" ? true : ((err = 'NUM'), false))\";\n                }\n                if (type[0] == \"(between]\") {\n                    return \"(\" + force() + \" > \" + type[1] + \" && \" + \"$\"+name+\" <= \" + type[2] + \" ? true : ((err = 'NUM'), false))\";\n                }\n                if (type[0] == \"[between)\") {\n                    return \"(\" + force() + \" >= \" + type[1] + \" && \" + \"$\"+name+\" < \" + type[2] + \" ? true : ((err = 'NUM'), false))\";\n                }\n                if (type[0] == \"assert\") {\n                    var err = type[2] || \"N/A\";\n                    return \"((\" + type[1] + \") ? true : (err = \" + JSON.stringify(err) + \", false))\";\n                }\n                if (type[0] == \"not\") {\n                    return \"!(\" + cond(type[1]) + \")\";\n                }\n                throw new Error(\"Unknown array type condition: \" + type[0]);\n            }\n            if (type == \"number\" || type == \"datetime\") {\n                return forceNum(true);\n            }\n            if (type == \"number!\") {\n                return \"(typeof \" + force() + \" == 'number' ? ($\"+name+\" = round($\"+name+\"), true) : false)\";\n            }\n            if (type == \"integer\" || type == \"date\") {\n                return \"(\" + forceNum() + \" && (($\"+name+\" |= 0), true))\";\n            }\n            if (type == \"divisor\") {\n                return \"(\" + forceNum(true) + \" && ($\"+name+\" == 0 ? ((err = 'DIV/0'), false) : true))\";\n            }\n            if (type == \"number+\") {\n                return \"(\" + forceNum(true) + \" && ($\"+name+\" >= 0 ? true : ((err = 'NUM'), false)))\";\n            }\n            if (type == \"integer+\") {\n                return \"(\" + forceNum() + \" && (($\"+name+\" |= 0) >= 0 ? true : ((err = 'NUM'), false)))\";\n            }\n            if (type == \"number++\") {\n                return \"(\" + forceNum(true) + \" && ($\"+name+\" > 0 ? true : ((err = 'NUM'), false)))\";\n            }\n            if (type == \"integer++\") {\n                return \"(\" + forceNum() + \" && (($\"+name+\" |= 0) > 0 ? true : ((err = 'NUM'), false)))\";\n            }\n            if (type == \"string\") {\n                return \"((typeof \" + force() + \" == 'string' || typeof $\"+name+\" == 'boolean' || typeof $\"+name+\" == 'number') ? ($\"+name+\" += '', true) : ($\"+name+\" === undefined ? (($\"+name+\" = ''), true) : false))\";\n            }\n            if (type == \"boolean\") {\n                return \"(typeof \" + force() + \" == 'boolean')\";\n            }\n            if (type == \"logical\") {\n                return \"(typeof \" + force() + \" == 'boolean' || (typeof $\"+name+\" == 'number' ? ($\"+name+\" = !!$\"+name+\", true) : false))\";\n            }\n            if (type == \"matrix\") {\n                force();\n                return \"((m = this.asMatrix($\"+name+\")) ? ($\"+name+\" = m) : false)\";\n            }\n            if (type == \"#matrix\") {\n                return \"((m = this.asMatrix($\"+name+\")) ? ($\"+name+\" = m) : false)\";\n            }\n            if (type == \"ref\") {\n                return \"($\"+name+\" instanceof kendo.spreadsheet.Ref)\";\n            }\n            if (type == \"area\") {\n                return \"($\"+name+\" instanceof kendo.spreadsheet.CellRef || $\"+name+\" instanceof kendo.spreadsheet.RangeRef)\";\n            }\n            if (type == \"cell\") {\n                return \"($\"+name+\" instanceof kendo.spreadsheet.CellRef)\";\n            }\n            if (type == \"null\") {\n                return \"(\" + force() + \" == null)\";\n            }\n            if (type == \"anyvalue\") {\n                return \"(\" + force() + \" != null && i <= args.length)\";\n            }\n            if (type == \"forced\") {\n                return \"(\" + force() + \", i <= args.length)\";\n            }\n            if (type == \"anything\") {\n                return \"(i <= args.length)\";\n            }\n            if (type == \"blank\") {\n                return \"(\" + force() + \" == null || $\"+name+\" === '')\";\n            }\n            throw new Error(\"Can't check for type: \" + type);\n        }\n    }\n\n    function limitPrecision(num) {\n        return num === parseInt(num, 10) ? num : +num.toPrecision(14);\n    }\n\n    function maybeRoundFloatErrors(num) {\n        if (typeof num == \"number\") {\n            return limitPrecision(num);\n        } else {\n            return num;\n        }\n    }\n\n    function withErrorHandling(obj, f, args) {\n        if (args instanceof CalcError) {\n            return args;\n        }\n        try {\n            return f.apply(obj, args);\n        } catch(ex) {\n            if (ex instanceof CalcError) {\n                return ex;\n            } else {\n                throw ex;\n            }\n        }\n    }\n\n    function makeSyncFunction(handler, resolve, check, arrayArgs) {\n        return function(callback, args) {\n            function doit() {\n                if (arrayArgs) {\n                    var x = arrayArgs.call(this, args);\n                    args = x.args;\n                    if (x.width > 0 && x.height > 0) {\n                        var result = new Matrix(this);\n                        for (var row = 0; row < x.height; ++row) {\n                            for (var col = 0; col < x.width; ++col) {\n                                var xargs = [];\n                                for (var i = 0; i < args.length; ++i) {\n                                    if (x.arrays[i]) {\n                                        xargs[i] = args[i].getNA(row, col);\n                                    } else {\n                                        xargs[i] = args[i];\n                                    }\n                                }\n                                xargs = check.call(this, xargs);\n                                result.set(row, col, withErrorHandling(this, handler, xargs));\n                            }\n                        }\n                        return callback(result);\n                    }\n                }\n                var xargs = check.call(this, args);\n                callback(withErrorHandling(this, handler, xargs));\n            }\n            if (resolve) {\n                resolve.call(this, args, doit);\n            } else {\n                doit.call(this);\n            }\n        };\n    }\n\n    function makeAsyncFunction(handler, resolve, check, arrayArgs) {\n        return function(callback, args) {\n            function doit() {\n                if (arrayArgs) {\n                    var x = arrayArgs.call(this, args);\n                    args = x.args;\n                    if (x.width > 0 && x.height > 0) {\n                        var result = new Matrix(this);\n                        var count = x.width * x.height;\n                        var makeCallback = function(row, col) {\n                            return function(value) {\n                                result.set(row, col, value);\n                                --count;\n                                if (count === 0) {\n                                    return callback(result);\n                                }\n                            };\n                        };\n                        for (var row = 0; row < x.height && count > 0; ++row) {\n                            for (var col = 0; col < x.width && count > 0; ++col) {\n                                var xargs = [];\n                                for (var i = 0; i < args.length; ++i) {\n                                    if (x.arrays[i]) {\n                                        xargs[i] = args[i].getNA(row, col);\n                                    } else {\n                                        xargs[i] = args[i];\n                                    }\n                                }\n                                xargs = check.call(this, xargs);\n                                if (xargs instanceof CalcError) {\n                                    result.set(row, col, xargs);\n                                    --count;\n                                    if (count === 0) {\n                                        return callback(result);\n                                    }\n                                } else {\n                                    xargs.unshift(makeCallback(row, col));\n                                    handler.apply(this, xargs);\n                                }\n                            }\n                        }\n                        return;\n                    }\n                }\n                var x = check.call(this, args);\n                if (x instanceof CalcError) {\n                    callback(x);\n                } else {\n                    x.unshift(callback);\n                    handler.apply(this, x);\n                }\n            }\n            if (resolve) {\n                resolve.call(this, args, doit);\n            } else {\n                doit.call(this);\n            }\n        };\n    }\n\n    function defineFunction(name, func) {\n        name = name.toLowerCase();\n        FUNCS[name] = func;\n        return {\n            args: function(args, log) {\n                var code = compileArgumentChecks(name, args);\n                // XXX: DEBUG\n                if (log) {\n                    if (code.arrayArgs) {console.log(code.arrayArgs.toString());}\n                    if (code.resolve) {console.log(code.resolve.toString());}\n                    if (code.check) {console.log(code.check.toString());}\n                }\n                var f = FUNCS[name] = makeSyncFunction(func, code.resolve, code.check, code.arrayArgs);\n                f.kendoSpreadsheetArgs = args;\n                return this;\n            },\n            argsAsync: function(args, log) {\n                var code = compileArgumentChecks(name, args);\n                // XXX: DEBUG\n                if (log) {\n                    if (code.arrayArgs) {console.log(code.arrayArgs.toString());}\n                    if (code.resolve) {console.log(code.resolve.toString());}\n                    if (code.check) {console.log(code.check.toString());}\n                }\n                var f = FUNCS[name] = makeAsyncFunction(func, code.resolve, code.check, code.arrayArgs);\n                f.kendoSpreadsheetArgs = args;\n                return this;\n            }\n        };\n    }\n\n    /* -----[ date calculations ]----- */\n\n    // Julian days algorithms from http://www.hermetic.ch/cal_stud/jdn.htm#comp\n\n    function dateToJulianDays(y, m, d) {\n        m++;\n        return ((1461 * (y + 4800 + ((m - 14) / 12 | 0))) / 4 | 0) +\n            ((367 * (m - 2 - 12 * ((m - 14) / 12 | 0))) / 12 | 0) -\n            ((3 * (((y + 4900 + ((m - 14) / 12 | 0)) / 100 | 0))) / 4 | 0) +\n            d - 32075;\n    }\n\n    function julianDaysToDate(jd) {\n        var l, n, j, i, m, d, y;\n        l = jd + 68569;\n        n = (4 * l) / 146097 | 0;\n        l = l - ((146097 * n + 3) / 4 | 0);\n        i = (4000 * (l + 1) / 1461001) | 0;\n        l = l - ((1461 * i) / 4 | 0) + 31;\n        j = (80 * l) / 2447 | 0;\n        d = l - ((2447 * j) / 80 | 0);\n        l = j / 11 | 0;\n        m = j + 2 - (12 * l);\n        y = 100 * (n - 49) + i + l;\n        m--;\n        return {\n            year  : y,\n            month : m,\n            date  : d,\n            day   : (jd + 1) % 7,\n            ord   : ORDINAL_ADD_DAYS[isLeapYear(y)][m] + d\n        };\n    }\n\n    // This uses the Google Spreadsheet approach: treat 1899-12-31 as day 1, allowing to avoid\n    // implementing the \"Leap Year Bug\" yet still be Excel compatible for dates starting 1900-03-01.\n    var BASE_DATE = dateToJulianDays(1900, 0, -1);\n\n    var DAYS_IN_MONTH = [ 31, 28, 31,\n                          30, 31, 30,\n                          31, 31, 30,\n                          31, 30, 31 ];\n\n    var ORDINAL_ADD_DAYS = [\n        [ 0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334 ], // non-leap year\n        [ 0, 31, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335 ]  // leap year\n    ];\n\n    function isLeapYear(yr) {\n        if (yr % 4) {\n            return 0;\n        }\n        if (yr % 100) {\n            return 1;\n        }\n        if (yr % 400) {\n            return 0;\n        }\n        return 1;\n    }\n\n    function daysInYear(yr) {\n        return isLeapYear(yr) ? 366 : 365;\n    }\n\n    function daysInMonth(yr, mo) {\n        return (isLeapYear(yr) && mo == 1) ? 29 : DAYS_IN_MONTH[mo];\n    }\n\n    function validDate(yr, mo, da) {\n        return mo >= 1 && mo <= 12 && da >= 1 && da <= daysInMonth(yr, mo - 1);\n    }\n\n    function unpackDate(serial) {\n        return julianDaysToDate((serial | 0) + BASE_DATE);\n    }\n\n    function packDate(year, month, date) {\n        return dateToJulianDays(year, month, date) - BASE_DATE;\n    }\n\n    var MS_IN_MIN = 60 * 1000;\n    var MS_IN_HOUR = 60 * MS_IN_MIN;\n    var MS_IN_DAY = 24 * MS_IN_HOUR;\n\n    function unpackTime(serial) {\n        var frac = serial - (serial|0);\n        if (frac < 0) {\n            frac++;\n        }\n        var ms = Math.round(MS_IN_DAY * frac);\n        var hours = Math.floor(ms / MS_IN_HOUR);\n        ms -= hours * MS_IN_HOUR;\n        var minutes = Math.floor(ms / MS_IN_MIN);\n        ms -= minutes * MS_IN_MIN;\n        var seconds = Math.floor(ms / 1000);\n        ms -= seconds * 1000;\n        return {\n            hours: hours,\n            minutes: minutes,\n            seconds: seconds,\n            milliseconds: ms\n        };\n    }\n\n    function serialToDate(serial) {\n        var d = unpackDate(serial), t = unpackTime(serial);\n        return new Date(d.year, d.month, d.date,\n                        t.hours, t.minutes, t.seconds, t.milliseconds);\n    }\n\n    function packTime(hh, mm, ss, ms) {\n        return (hh+(mm+(ss+ms/1000)/60)/60)/24;\n    }\n\n    function dateToSerial(date) {\n        var time = packTime(date.getHours(),\n                            date.getMinutes(),\n                            date.getSeconds(),\n                            date.getMilliseconds());\n        date = packDate(date.getFullYear(),\n                        date.getMonth(),\n                        date.getDate());\n        if (date < 0) {\n            return date - 1 + time;\n        } else {\n            return date + time;\n        }\n    }\n\n    function parseDate(str, format) {\n        if (format) {\n            format = kendo.spreadsheet.formatting.makeDateFormat(format);\n        }\n        return kendo.parseExactDate(str, format)\n            || kendo.parseExactDate(str)\n            || kendo.parseExactDate(str, [\n                \"MMMM dd yyyy\",\n                \"MMMM dd yy\",\n                \"MMM dd yyyy\",\n                \"MMM dd yy\",\n                \"dd MMMM yyyy\",\n                \"dd MMMM yy\",\n                \"dd MMM yyyy\",\n                \"dd MMM yy\",\n                \"MMMM dd, yyyy\",\n                \"MMMM dd, yy\",\n                \"MMM dd, yyyy\",\n                \"MMM dd, yy\",\n                \"MMMM dd\",\n                \"MMM dd\",\n                \"MMMM yyyy\",\n                \"MMM yyyy\",\n                \"dd MMMM\",\n                \"dd MMM\"\n            ]);\n    }\n\n    /* -----[ exports ]----- */\n\n    exports.CalcError = CalcError;\n    exports.Formula = Formula;\n    exports.Matrix = Matrix;\n\n    exports.packDate = packDate;\n    exports.unpackDate = unpackDate;\n    exports.packTime = packTime;\n    exports.unpackTime = unpackTime;\n    exports.serialToDate = serialToDate;\n    exports.dateToSerial = dateToSerial;\n    exports.daysInMonth = daysInMonth;\n    exports.validDate = validDate;\n    exports.isLeapYear = isLeapYear;\n    exports.daysInYear = daysInYear;\n    exports.parseDate = parseDate;\n    exports.limitPrecision = limitPrecision;\n\n    spreadsheet.dateToNumber = dateToSerial;\n    spreadsheet.numberToDate = serialToDate;\n    spreadsheet.defineFunction = defineFunction;\n    spreadsheet.CalcError = CalcError;\n\n    exports.defineFunction = defineFunction;\n    exports.defineAlias = function(alias, name) {\n        var orig = FUNCS[name];\n        if (!orig) {\n            throw new Error(\"Function \" + name + \" is not yet defined\");\n        }\n        if (!orig.kendoSpreadsheetAliases) {\n            orig.kendoSpreadsheetAliases = [ name ];\n        }\n        orig.kendoSpreadsheetAliases.push(alias);\n        FUNCS[alias] = orig;\n    };\n    exports.FUNCS = FUNCS;\n\n    /* -----[ Excel operators ]----- */\n\n    var NUMBER_OR_ZERO = [ \"or\", \"number\", [ \"null\", 0 ] ];\n\n    var ARGS_NUMERIC = [\n        [ \"*a\", NUMBER_OR_ZERO ],\n        [ \"*b\", NUMBER_OR_ZERO ]\n    ];\n\n    var ARGS_ANYVALUE = [\n        [ \"*a\", \"forced\" ],\n        [ \"*b\", \"forced\" ]\n    ];\n\n    defineFunction(\"binary+\", function(a, b){\n        return a + b;\n    }).args(ARGS_NUMERIC);\n\n    defineFunction(\"binary-\", function(a, b){\n        return a - b;\n    }).args(ARGS_NUMERIC);\n\n    defineFunction(\"binary*\", function(a, b){\n        return a * b;\n    }).args(ARGS_NUMERIC);\n\n    defineFunction(\"binary/\", function(a, b){\n        return a / b;\n    }).args([\n        [ \"*a\", NUMBER_OR_ZERO ],\n        [ \"*b\", \"divisor\" ]\n    ]);\n\n    defineFunction(\"binary^\", function(a, b){\n        return Math.pow(a, b);\n    }).args(ARGS_NUMERIC);\n\n    defineFunction(\"binary&\", function(a, b){\n        if (a == null) { a = \"\"; }\n        if (b == null) { b = \"\"; }\n        return \"\" + a + b;\n    }).args([\n        [ \"*a\", [ \"or\", \"number\", \"string\", \"boolean\", \"null\" ] ],\n        [ \"*b\", [ \"or\", \"number\", \"string\", \"boolean\", \"null\" ] ]\n    ]);\n\n    function equals(a, b){\n        a = typeof(a) === \"string\" ? a.toLowerCase() : a;\n        b = typeof(b) === \"string\" ? b.toLowerCase() : b;\n\n        // special cases\n        if (a === false && b == null) { return true; }\n        if (b === false && a == null) { return true; }\n        if (a === 0     && b == null) { return true; }\n        if (b === 0     && a == null) { return true; }\n        if (a === \"\"    && b == null) { return true; }\n        if (b === \"\"    && a == null) { return true; }\n\n        return a === b;\n    }\n\n    defineFunction(\"binary=\", equals).args(ARGS_ANYVALUE);\n\n    defineFunction(\"binary<>\", function(a, b){\n        return !equals(a, b);\n    }).args(ARGS_ANYVALUE);\n\n    defineFunction(\"binary<\", binaryCompare(function(a, b){\n        return a < b;\n    })).args(ARGS_ANYVALUE);\n\n    defineFunction(\"binary<=\", binaryCompare(function(a, b){\n        return a <= b;\n    })).args(ARGS_ANYVALUE);\n\n    defineFunction(\"binary>\", binaryCompare(function(a, b){\n        return a > b;\n    })).args(ARGS_ANYVALUE);\n\n    defineFunction(\"binary>=\", binaryCompare(function(a, b){\n        return a >= b;\n    })).args(ARGS_ANYVALUE);\n\n    defineFunction(\"unary+\", function(a){\n        return a;\n    }).args([\n        [ \"*a\", NUMBER_OR_ZERO ]\n    ]);\n\n    defineFunction(\"unary-\", function(a){\n        return -a;\n    }).args([\n        [ \"*a\", NUMBER_OR_ZERO ]\n    ]);\n\n    defineFunction(\"unary%\", function(a){\n        return a / 100;\n    }).args([\n        [ \"*a\", NUMBER_OR_ZERO ]\n    ]);\n\n    // range operator\n    defineFunction(\"binary:\", function(a, b){\n        return new RangeRef(a, b)\n            .setSheet(a.sheet || this.formula.sheet, a.hasSheet());\n    }).args([\n        [ \"a\", \"cell\" ],\n        [ \"b\", \"cell\" ]\n    ]);\n\n    // union operator\n    defineFunction(\"binary,\", function(a, b){\n        return new UnionRef([ a, b ]);\n    }).args([\n        [ \"a\", \"ref\" ],\n        [ \"b\", \"ref\" ]\n    ]);\n\n    // intersection operator\n    defineFunction(\"binary \", function(a, b){\n        return a.intersect(b);\n    }).args([\n        [ \"a\", \"ref\" ],\n        [ \"b\", \"ref\" ]\n    ]);\n\n    /* -----[ conditionals ]----- */\n\n    defineFunction(\"not\", function(a){\n        return !this.bool(a);\n    }).args([\n        [ \"*a\", [ \"or\", \"anyvalue\", [ \"null\", 0 ] ] ]\n    ]);\n\n    /* -----[ the IS* functions ]----- */\n\n    defineFunction(\"isblank\", function(val){\n        if (val instanceof CellRef) {\n            val = this.getRefData(val);\n            return val == null;\n        }\n        return false;\n    }).args([\n        [ \"*value\", \"anything!\" ]\n    ]);\n\n    defineFunction(\"iserror\", function(val){\n        return val instanceof CalcError;\n    }).args([\n        [ \"*value\", \"forced!\" ]\n    ]);\n\n    defineFunction(\"iserr\", function(val){\n        return val instanceof CalcError && val.code != \"N/A\";\n    }).args([\n        [ \"*value\", \"forced!\" ]\n    ]);\n\n    defineFunction(\"isna\", function(val){\n        return val instanceof CalcError && val.code == \"N/A\";\n    }).args([\n        [ \"*value\", \"forced!\" ]\n    ]);\n\n    defineFunction(\"islogical\", function(val){\n        return typeof val == \"boolean\";\n    }).args([\n        [ \"*value\", \"forced!\" ]\n    ]);\n\n    defineFunction(\"isnontext\", function(val){\n        return typeof val != \"string\";\n    }).args([\n        [ \"*value\", \"forced!\" ]\n    ]);\n\n    defineFunction(\"istext\", function(val){\n        return typeof val == \"string\";\n    }).args([\n        [ \"*value\", \"forced!\" ]\n    ]);\n\n    defineFunction(\"isnumber\", function(val){\n        return typeof val == \"number\";\n    }).args([\n        [ \"*value\", \"forced!\" ]\n    ]);\n\n    defineFunction(\"isref\", function(val){\n        // apparently should return true only for cell and range\n        return val instanceof CellRef || val instanceof RangeRef;\n    }).args([\n        [ \"*value\", \"anything!\" ]\n    ]);\n\n    /* -----[ resolve NameRef-s ]----- */\n\n    FUNCS[\",getname\"] = function(callback, args) {\n        this.fetchName(args[0], callback);\n    };\n\n    /// utils\n\n    function binaryCompare(func) {\n        return function(left, right){\n            if (typeof left == \"string\" && typeof right != \"string\") {\n                right = right == null ? \"\" : right + \"\";\n            }\n            if (typeof left != \"string\" && typeof right == \"string\") {\n                left = left == null ? \"\" : left + \"\";\n            }\n            if (typeof left == \"number\" && right == null) {\n                right = 0;\n            }\n            if (typeof right == \"number\" && left == null) {\n                left = 0;\n            }\n            if (typeof left == \"string\" && typeof right == \"string\") {\n                // string comparison is case insensitive\n                left = left.toLowerCase();\n                right = right.toLowerCase();\n            }\n            if (typeof right == typeof left) {\n                return func(left, right);\n            } else {\n                return new CalcError(\"VALUE\");\n            }\n        };\n    }\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/validation',[ \"./runtime\" ], f);\n})(function(){\n    \"use strict\";\n\n    var $ = kendo.jQuery;\n\n    var spreadsheet = kendo.spreadsheet;\n\n    var exports = {};\n    spreadsheet.validation = exports;\n    var calc = spreadsheet.calc;\n    var Class = kendo.Class;\n    var TRANSPOSE_FORMAT = \"_matrix({0})\";\n    var DATE_FORMAT = 'DATEVALUE(\"{0}\")';\n\n    calc.runtime.defineFunction(\"_matrix\", function(m){\n        if (typeof m == \"string\") {\n            // for constant list validation, Excel includes a string\n            // with comma-separated values  make a Matrix from it.\n            m = this.asMatrix([ m.split(/\\s*,\\s*/) ]);\n        }\n        return m;\n    }).args([\n        [ \"m\", [ \"or\", \"matrix\", \"string\" ] ]\n    ]);\n\n    function compileValidation(sheet, row, col, validation) {\n        var validationHandler;\n        var comparer;\n        var parsedFromDate;\n        var parsedToDate;\n\n        if (typeof validation === \"string\") {\n            validation = JSON.parse(validation);\n        }\n\n        if (validation.from) {\n            if (validation.dataType === \"list\" && !validation.fromIsListValue) {\n                // We need to convert the {...} validation.from value to a string, so that it would work when exported to XLSX\n                if(validation.from.indexOf(\"{\") > -1) {\n                    validation.from = validation.from.replace(/\\\"/g,\"\").replace(\"{\",\"\\\"\").replace(\"}\", \"\\\"\");\n                }\n                validation.from = kendo.format(TRANSPOSE_FORMAT, validation.from);\n                validation.fromIsListValue = true;\n            }\n\n            if (validation.dataType === \"date\") {\n                parsedFromDate = calc.runtime.parseDate(validation.from);\n                if (parsedFromDate) {\n                    validation.from = kendo.format(DATE_FORMAT, validation.from);\n                    validation.fromIsDateValue = true;\n                }\n            }\n\n            validation.from = calc.compile(calc.parseFormula(sheet, row, col, validation.from));\n        }\n\n        if (validation.to) {\n            if (validation.dataType === \"date\") {\n                parsedToDate = calc.runtime.parseDate(validation.to);\n                if (parsedToDate) {\n                    validation.to = kendo.format(DATE_FORMAT, validation.to);\n                    validation.toIsDateValue = true;\n                }\n            }\n\n            validation.to = calc.compile(calc.parseFormula(sheet, row, col, validation.to));\n        }\n\n        if (validation.dataType == \"custom\") {\n            comparer = exports.validationComparers.custom;\n        } else if (validation.dataType == \"list\") {\n            comparer = exports.validationComparers.list;\n        } else {\n            comparer = exports.validationComparers[validation.comparerType];\n        }\n\n        if (!comparer) {\n            throw kendo.format(\"'{0}' comparer is not implemented.\", validation.comparerType);\n        }\n\n        validationHandler = function (valueToCompare) { //add 'valueFormat' arg when add isDate comparer\n            var toValue = this.to && (this.to_value || this.to_value === 0) ? this.to_value : undefined;\n\n            if (valueToCompare === null || valueToCompare === \"\") {\n                if (this.allowNulls) {\n                    this.value = true;\n                } else {\n                    this.value = false;\n                }\n            } else if (this.dataType == \"custom\") {\n                this.value = comparer(valueToCompare, this.from_value,  toValue);\n            } else if (this.dataType == \"list\") {\n                var data = this._getListData();\n\n                this.value = comparer(valueToCompare, data, toValue);\n            } else {\n                //TODO: TYPE CHECK IS REQUIRED ONLY FOR DATE TYPE WHEN SPECIAL COMPARER (ISDATE) IS USED\n                this.value = comparer(valueToCompare, this.from_value,  toValue);\n            }\n\n            return this.value;\n        };\n\n        return new kendo.spreadsheet.validation.Validation($.extend(validation, {\n            handler: validationHandler,\n            sheet: sheet,\n            row: row,\n            col: col\n        }));\n    }\n\n    var Validation = Class.extend({\n        init: function Validation(options){\n            this.handler = options.handler;\n            this.from = options.from;\n            this.to = options.to;\n            this.dataType = options.dataType; //date, time etc\n            this.comparerType =  options.comparerType; //greaterThan, EqaulTo etc\n            this.type = options.type ? options.type : \"warning\"; //info, warning, reject\n            this.allowNulls = options.allowNulls ? true : false;\n            this.fromIsDateValue = options.fromIsDateValue ? true : false;\n            this.toIsDateValue = options.toIsDateValue ? true : false;\n            this.showButton = options.showButton;\n            this.fromIsListValue = options.fromIsListValue ? true : false;\n\n            //TODO: address to be range / cell ref, and adjust it based on it\n            this.sheet = options.sheet;\n            this.row = options.row;\n            this.col = options.col;\n\n            if (options.tooltipMessageTemplate) {\n                this.tooltipMessageTemplate = options.tooltipMessageTemplate;\n            }\n\n            if (options.tooltipTitleTemplate) {\n                this.tooltipTitleTemplate = options.tooltipTitleTemplate;\n            }\n\n            if (options.messageTemplate) {\n                this.messageTemplate = options.messageTemplate;\n            }\n\n            if (options.titleTemplate) {\n                this.titleTemplate = options.titleTemplate;\n            }\n        },\n\n        _formatMessages: function(format) {\n            var from = this.from ? this.from_value : \"\";\n            var to = this.to ? this.to_value : \"\";\n\n            var fromFormula = this.from ? this.from.toString() : \"\";\n            var toFormula = this.to ? this.to.toString() : \"\";\n            var dataType = this.dataType;\n            var type = this.type;\n            var comparerType = this.comparerType;\n\n            return kendo.format(format, from, to, fromFormula, toFormula, dataType, type, comparerType);\n        },\n\n        _setMessages: function() {\n            this.title = \"\";\n            this.message = \"\";\n\n            if (this.tooltipTitleTemplate) {\n                this.tooltipTitle = this._formatMessages(this.tooltipTitleTemplate);\n            }\n\n            if (this.tooltipMessageTemplate) {\n                this.tooltipMessage = this._formatMessages(this.tooltipMessageTemplate);\n            }\n\n            if (this.titleTemplate) {\n                this.title = this._formatMessages(this.titleTemplate);\n            }\n\n            if (this.messageTemplate) {\n                this.message = this._formatMessages(this.messageTemplate);\n            }\n        },\n\n        _getListData: function() {\n            if (!this.from_value || !this.from_value.data) {\n                return [];\n            }\n\n            var cube = this.from_value.data;\n            var i;\n            var y;\n            var data = [];\n\n            for (i = 0; i < cube.length; i++ ) {\n                var array = cube[i];\n\n                if (array) {\n                    for (y = 0; y < array.length; y++ ) {\n                        data.push(array[y]);\n                    }\n                }\n            }\n\n            return data;\n        },\n\n        clone: function(sheet, row, col) {\n            var options = this._getOptions();\n\n            if (options.from) {\n                options.from = options.from.clone(sheet, row, col);\n            }\n\n            if (options.to) {\n                options.to = options.to.clone(sheet, row, col);\n            }\n\n            return new Validation($.extend(options,\n                { handler: this.handler },\n                { sheet: sheet, row: row, col: col }\n            ));\n        },\n\n        deepClone: function() {\n            var v = new Validation(this);\n            v.from = v.from.deepClone();\n            if (v.to) {\n                v.to = v.to.deepClone();\n            }\n            return v;\n        },\n\n        exec: function(ss, compareValue, compareFormat, callback) {\n            var self = this;\n\n            function getValue(val) {\n                if (val instanceof kendo.spreadsheet.Ref) {\n                    val = ss.getData(val);\n                    if (Array.isArray(val)) {\n                        val = val[0];\n                    }\n                }\n                return val;\n            }\n\n            var calculateFromCallBack = function(val) {\n                self.from_value = getValue(val);\n                self.value = self.handler.call(self, compareValue, compareFormat);\n                self._setMessages();\n                if (callback) {\n                    callback(self.value);\n                }\n            };\n\n            if (self.to) {\n                self.to.exec(ss, function(val) {\n                    self.to_value = getValue(val);\n                    self.from.exec(ss, calculateFromCallBack);\n                });\n            } else {\n                self.from.exec(ss, calculateFromCallBack);\n            }\n        },\n\n        reset: function() {\n            if (this.from) {\n                this.from.reset();\n            }\n            if (this.to) {\n                this.to.reset();\n            }\n            delete this.value;\n        },\n\n        adjust: function(affectedSheet, operation, start, delta) {\n            var prevFrom, prevTo, modified;\n            var formulaRow = this.row;\n            var formulaCol = this.col;\n            if (this.from) {\n                prevFrom = this.from.adjust(affectedSheet, operation, start, delta);\n            }\n            if (this.to) {\n                prevTo = this.to.adjust(affectedSheet, operation, start, delta);\n            }\n            if (this.sheet.toLowerCase() == affectedSheet.toLowerCase()) {\n                switch (operation) {\n                  case \"row\":\n                    if (formulaRow >= start) {\n                        modified = true;\n                        this.row += delta;\n                    }\n                    break;\n                  case \"col\":\n                    if (formulaCol >= start) {\n                        modified = true;\n                        this.col += delta;\n                    }\n                    break;\n                }\n            }\n            if (modified || prevFrom || prevTo) {\n                var v = new Validation(this);\n                v.from = prevFrom;\n                v.to = prevTo;\n                v.row = formulaRow;\n                v.col = formulaCol;\n                return v;\n            }\n        },\n\n        toJSON: function() {\n            var options = this._getOptions();\n\n            if (options.from) {\n                options.from = options.from.toString();\n\n                if (options.dataType === \"list\") {\n                    options.from = options.from.replace(/^_matrix\\((.*)\\)$/i, \"$1\");\n                    delete options.fromIsListValue;\n                }\n\n                if (options.dataType === \"date\") {\n                    if (this.fromIsDateValue) {\n                        options.from = options.from.replace(/^DATEVALUE\\(\"(.*)\"\\)$/i, \"$1\");\n                        delete options.fromIsDateValue;\n                    }\n                }\n            }\n\n            if (options.to) {\n                options.to = options.to.toString();\n\n                if (options.dataType === \"date\") {\n                    if (this.toIsDateValue) {\n                        options.to = options.to.replace(/^DATEVALUE\\(\"(.*)\"\\)$/i, \"$1\");\n                        delete options.toIsDateValue;\n                    }\n                }\n            }\n\n            return options;\n        },\n\n        _getOptions: function () {\n            return {\n                from: this.from,\n                to: this.to,\n                dataType: this.dataType,\n                type: this.type,\n                comparerType: this.comparerType,\n                row: this.row,\n                col: this.col,\n                sheet: this.sheet,\n                allowNulls: this.allowNulls,\n                fromIsListValue: this.fromIsListValue,\n                fromIsDateValue: this.fromIsDateValue,\n                toIsDateValue: this.toIsDateValue,\n                tooltipMessageTemplate: this.tooltipMessageTemplate,\n                tooltipTitleTemplate: this.tooltipTitleTemplate,\n                //TODO: export generated messages instead?\n                messageTemplate: this.messageTemplate,\n                titleTemplate: this.titleTemplate,\n                showButton: this.showButton\n            };\n        }\n    });\n    exports.compile = compileValidation;\n    exports.validationComparers = {\n        greaterThan: function (valueToCompare, from) {\n            return valueToCompare > from;\n        },\n\n        lessThan: function (valueToCompare, from) {\n            return valueToCompare < from;\n        },\n\n        between: function (valueToCompare, from, to) {\n            return valueToCompare >= from && valueToCompare <= to;\n        },\n\n        equalTo: function (valueToCompare, from) {\n            return valueToCompare == from;\n        },\n\n        notEqualTo: function (valueToCompare, from) {\n            return valueToCompare != from;\n        },\n\n        greaterThanOrEqualTo: function (valueToCompare, from) {\n            return valueToCompare >= from;\n        },\n\n        lessThanOrEqualTo: function (valueToCompare, from) {\n            return valueToCompare <= from;\n        },\n\n        notBetween: function (valueToCompare, from, to) {\n            return valueToCompare < from || valueToCompare > to;\n        },\n\n        custom: function (valueToCompare, from) {\n            return from;\n        },\n\n        list: function (valueToCompare, data) {\n            return data.indexOf(valueToCompare) > -1;\n        }\n    };\n\n    exports.Validation = Validation;\n\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/sheet',[ \"kendo.core\", \"kendo.color\", \"./runtime\", \"./validation\", \"./references\" ], f);\n})(function(){\n\n(function(kendo) {\n\n\n\n    var RangeRef = kendo.spreadsheet.RangeRef;\n    var UnionRef = kendo.spreadsheet.UnionRef;\n    var CellRef = kendo.spreadsheet.CellRef;\n    var Range = kendo.spreadsheet.Range;\n\n    // This is a dynamic variable (see Greenspun's 10th rule).  It's\n    // bound to an array via sheet._saveModifiedFormulas (which see)\n    // while the callback runs.  The goal is to enable external code\n    // to get a list of formulas or validations that have been\n    // adjusted as an effect of an insert/delete row/column operation,\n    // to be able to undo it.\n    //\n    // The reason why simply saving the state via sheet.getState() or\n    // range.getState() won't suffice is that an insert or delete\n    // operation can have far-reaching effects, like adjusting\n    // formulas from another sheet.\n    var MODIFIED_FORMULAS;\n\n    var Selection = kendo.Class.extend({\n        init: function(sheet) {\n            this._sheet = sheet;\n            this.selection = kendo.spreadsheet.FIRSTREF.toRangeRef();\n            this.originalSelection = kendo.spreadsheet.FIRSTREF.toRangeRef();\n            this._activeCell = kendo.spreadsheet.FIRSTREF.toRangeRef();\n            this.originalActiveCell = kendo.spreadsheet.FIRSTREF;\n        },\n\n        currentSelectionRange: function() {\n            return this.selection.rangeAt(this.selectionRangeIndex).toRangeRef();\n        },\n\n        currentOriginalNavigationRange: function() {\n            return this.originalSelection.rangeAt(this.selectionRangeIndex).toRangeRef();\n        },\n\n        currentNavigationRange: function() {\n            if (this.singleCellSelection()) {\n                return this._sheet._sheetRef;\n            } else {\n                return this.selection.rangeAt(this.selectionRangeIndex).toRangeRef();\n            }\n        },\n\n        nextNavigationRange: function() {\n            if (!this.singleCellSelection()) {\n                this.selectionRangeIndex = this.selection.nextRangeIndex(this.selectionRangeIndex);\n            }\n\n            return this.currentNavigationRange();\n        },\n\n        previousNavigationRange: function() {\n            if (!this.singleCellSelection()) {\n                this.selectionRangeIndex = this.selection.previousRangeIndex(this.selectionRangeIndex);\n            }\n\n            return this.currentNavigationRange();\n        },\n\n        activeCell: function(ref) {\n            if (ref) {\n                this.originalActiveCell = ref.first();\n                this._activeCell = this._sheet.unionWithMerged(ref.toRangeRef());\n                this._sheet.focus(ref);\n                this._sheet.triggerChange({ activeCell: true, selection: true });\n            }\n\n            return this._activeCell;\n        },\n\n        select: function(ref, expanded, changeActiveCell, view) {\n            if (ref) {\n                if (ref.eq(this.originalSelection)) {\n                    return;\n                }\n\n                this._sheet.triggerSelect(new Range(ref, this._sheet));\n\n                this.originalSelection = ref;\n\n                this.selection = expanded;\n\n                if (changeActiveCell !== false) {\n                    if (ref.isCell()) {\n                        // when selecting part of a merged cell, i.e. A1:B2 is merged and select(B2)\n                        // is requested, mark A1 as the actually active cell.\n                        // https://github.com/telerik/kendo/issues/7698\n                        this._sheet.forEachMergedCell(ref, function(merged){\n                            ref = merged.topLeft;\n                        });\n                        this.activeCell(ref);\n                    } else {\n                        ref = this.selection.lastRange();\n                        if (view && view._sheet === this._sheet && view.panes[0]) {\n                            // we should intersect this ref with the range that's currently on\n                            // screen, so that the view doesn't scroll (that is, keep the activeCell\n                            // visible) - https://github.com/telerik/kendo-ui-core/issues/5182 \n                            // XXX: fiddling with View internals here is probably bad practice, but\n                            // this whole thing is a mess already, so it can be forgiven. :-/\n                            var panes = view.panes;\n                            var i, pane, rows, cols, visible, newRef;\n\n                            for (i = 0; i < panes.length; i++) {\n                                pane = panes[i];\n                                if (!pane._currentView) {\n                                    continue;\n                                }\n                                rows = pane._currentView.rows.values;\n                                cols = pane._currentView.columns.values;\n\n                                visible = new RangeRef(\n                                    new CellRef(rows.start, cols.start),\n                                    new CellRef(rows.end, cols.end)\n                                );\n\n                                newRef = ref.intersect(visible);\n\n                                if (newRef !== kendo.spreadsheet.NULLREF) {\n                                    break;\n                                }\n                            }\n\n                            if (newRef && newRef !== kendo.spreadsheet.NULLREF) {\n                                ref = newRef;\n                            }\n                        }\n                        this.activeCell(ref.first());\n                    }\n\n                    this.selectionRangeIndex = this.selection.size() - 1;\n                } else {\n                    this._sheet.triggerChange({ selection: true });\n                }\n            }\n\n            return this.selection;\n        },\n\n        singleCellSelection: function() {\n            return this._activeCell.eq(this.selection);\n        }\n    });\n\n    var Sheet = kendo.Observable.extend({\n        init: function() {\n            kendo.Observable.prototype.init.call(this);\n            this._reinit.apply(this, arguments);\n        },\n\n\n        events: [\n            \"changing\",\n            \"commandRequest\",\n            \"afterInsertRow\",\n            \"afterDeleteRow\",\n            \"insertRow\",\n            \"insertColumn\",\n            \"deleteRow\",\n            \"deleteColumn\",\n            \"hideRow\",\n            \"hideColumn\",\n            \"unhideRow\",\n            \"unhideColumn\",\n            \"select\",\n            \"dataBinding\",\n            \"dataBound\",\n            \"progress\"\n        ],\n\n        _reinit: function(rowCount, columnCount, rowHeight, columnWidth, headerHeight, headerWidth, defaultCellStyle) {\n            defaultCellStyle = defaultCellStyle || {};\n\n            this._defaultCellStyle = {\n                background: defaultCellStyle.background,\n                color: defaultCellStyle.color,\n                fontFamily: defaultCellStyle.fontFamily,\n                fontSize: defaultCellStyle.fontSize,\n                italic: defaultCellStyle.italic,\n                bold: defaultCellStyle.bold,\n                underline: defaultCellStyle.underline,\n                wrap: defaultCellStyle.wrap,\n                verticalAlign: defaultCellStyle.verticalAlign,\n                textAlign: defaultCellStyle.textAlign\n            };\n\n            this._rows = new kendo.spreadsheet.Axis(rowCount, rowHeight);\n            this._columns = new kendo.spreadsheet.Axis(columnCount, columnWidth);\n            this._filteredRows = new kendo.spreadsheet.RangeList(0, rowCount - 1, false);\n            this._mergedCells = [];\n            this._frozenRows = 0;\n            this._frozenColumns = 0;\n            this._suspendChanges = false;\n            this._filter = null;\n            this._showGridLines = true;\n            this._gridLinesColor = null;\n            this._grid = new kendo.spreadsheet.Grid(this._rows, this._columns, rowCount, columnCount, headerHeight, headerWidth);\n            this._sheetRef = this._grid.normalize(kendo.spreadsheet.SHEETREF);\n            this._properties = new kendo.spreadsheet.PropertyBag(rowCount, columnCount, this._defaultCellStyle);\n            this._sorter = new kendo.spreadsheet.Sorter(this._grid, this._properties.sortable());\n\n            this._viewSelection = new Selection(this);\n\n            this._editSelection = new Selection(this);\n\n            this._formulaSelections = [];\n            this._drawings = [];\n        },\n\n        resize: function(newRows, newCols) {\n            newRows = Math.max(newRows, 1);\n            newCols = Math.max(newCols, 1);\n            var oldRows = this._rows._count;\n            var oldCols = this._columns._count;\n            if (newRows < oldRows) {\n                this.range(newRows, 0, oldRows - newRows, oldCols).clear();\n            }\n            if (newCols < oldCols) {\n                this.range(0, newCols, oldRows, oldCols - newCols).clear();\n            }\n            this._rows._resize(newRows);\n            this._columns._resize(newCols);\n            this._grid._resize(newRows, newCols);\n            this._properties._resize(newRows, newCols);\n            this._sheetRef = this._grid.normalize(kendo.spreadsheet.SHEETREF);\n            if (newRows > oldRows) {\n                this.range(oldRows, 0, newRows - oldRows, newCols).clear();\n                this._filteredRows.value(oldRows, newRows - 1, false);\n            }\n            if (newCols > oldCols) {\n                this.range(0, oldCols, newRows, newCols - oldCols).clear();\n            }\n            this.triggerChange({ layout: true });\n        },\n\n        _resizeAddRow: function(count) {\n            this.resize(this._rows._count + (count || 1), this._columns._count);\n        },\n\n        _resizeAddColumn: function(count) {\n            this.resize(this._rows._count, this._columns._count + (count || 1));\n        },\n\n        _resizeDeleteRow: function(count) {\n            this._resizeAddRow(-(count || 1));\n        },\n\n        _resizeDeleteColumn: function(count) {\n            this._resizeAddColumn(-(count || 1));\n        },\n\n        _resizeForJSON: function(rows) {\n            var rowCount = rows.length, colCount = 0;\n            for (var ri = 0; ri < rows.length; ++ri) {\n                var row = rows[ri];\n                if (row.index != null) {\n                    rowCount = Math.max(rowCount, row.index + 1);\n                }\n                if (row.cells) {\n                    colCount = Math.max(colCount, row.cells.length);\n                    for (var ci = 0; ci < row.cells.length; ++ci) {\n                        var cell = row.cells[ci];\n                        if (cell.index != null) {\n                            colCount = Math.max(colCount, cell.index + 1);\n                        }\n                    }\n                }\n            }\n            this.resize(Math.max(rowCount, this._rows._count),\n                        Math.max(colCount, this._columns._count));\n        },\n\n        _selectionState: function() {\n            return this._inEdit ? this._editSelection : this._viewSelection;\n        },\n\n        navigator: function() {\n            if(!this._navigator) {\n                 this._navigator = new kendo.spreadsheet.SheetNavigator(this);\n            }\n            return this._navigator;\n        },\n\n        axisManager: function() {\n            if(!this._axisManager) {\n                 this._axisManager = new kendo.spreadsheet.AxisManager(this);\n            }\n\n            return this._axisManager;\n        },\n\n        _name: function(value) {\n            if (!value) {\n                return this._sheetName;\n            }\n\n            this._sheetName = value;\n\n            return this;\n        },\n\n        name: function() {\n            return this._name();\n        },\n\n        _property: function(accessor, value, reason) {\n            if (value === undefined) {\n                return accessor();\n            } else {\n                accessor(value);\n\n                return this.triggerChange(reason);\n            }\n        },\n\n        _field: function(name, value, reason) {\n            if (value === undefined) {\n                return this[name];\n            } else {\n                this[name] = value;\n\n                return this.triggerChange(reason);\n            }\n        },\n\n        suspendChanges: function(value) {\n            if (value === undefined) {\n                return this._suspendChanges;\n            }\n\n            this._suspendChanges = value;\n\n            return this;\n        },\n\n        triggerChange: function(reason) {\n            if (!this._suspendChanges) {\n                this.trigger(\"change\", reason);\n            } else if (reason && reason.isValue) {\n                this._valueChanged = true;\n            }\n            return this;\n        },\n\n        triggerSelect: function(range) {\n            this.trigger(\"select\", { range: range });\n        },\n\n        setDataSource: function(dataSource, columns) {\n            if (this.dataSourceBinder) {\n                this.dataSourceBinder.destroy();\n            }\n\n            this.dataSourceBinder = new kendo.spreadsheet.SheetDataSourceBinder({\n                dataSource: dataSource,\n                sheet: this,\n                columns: columns\n            });\n\n            this.dataSource = this.dataSourceBinder.dataSource;\n        },\n\n        hideColumn: function(columnIndex) {\n            if (this.trigger(\"hideColumn\", { index: columnIndex })) {\n                return;\n            }\n\n            return this._property(this._columns.hide.bind(this._columns), columnIndex, { layout: true });\n        },\n\n        unhideColumn: function(columnIndex) {\n            if (this.trigger(\"unhideColumn\", { index: columnIndex })) {\n                return;\n            }\n\n            return this._property(this._columns.unhide.bind(this._columns), columnIndex, { layout: true });\n        },\n\n        isHiddenColumn: function(columnIndex) {\n            return this._grid._columns.hidden(columnIndex);\n        },\n\n        _copyRange: function(sourceRangeRef, targetRef) {\n            var grid = this._grid;\n            var rowCount = grid.rowCount;\n\n            var nextRefTopLeft = grid.normalize(sourceRangeRef.topLeft);\n            var nextRefBottomRight = grid.normalize(sourceRangeRef.bottomRight);\n\n            var nextIndex = nextRefTopLeft.col * rowCount + nextRefTopLeft.row;\n            var nextBottomIndex = nextRefBottomRight.col * rowCount + nextRefBottomRight.row;\n\n            var targetIndex = targetRef.col * rowCount + targetRef.row;\n\n            this._properties.copy(nextIndex, nextBottomIndex, targetIndex);\n        },\n\n        _saveModifiedFormulas: function(array, callback) {\n            var save = MODIFIED_FORMULAS;\n            MODIFIED_FORMULAS = array;\n            var ret = callback();\n            MODIFIED_FORMULAS = save;\n            return ret;\n        },\n\n        _restoreModifiedFormulas: function(array) {\n            var wb = this._workbook;\n            array.forEach(function(f){\n                var sheet = wb.sheetByName(f.sheet), index;\n                if (f instanceof kendo.spreadsheet.calc.runtime.Formula) {\n                    index = sheet._grid.cellRefIndex(f); // f has row, col\n                    sheet._properties.set(\"formula\", index, index, f);\n                }\n                if (f instanceof kendo.spreadsheet.validation.Validation) {\n                    index = sheet._grid.cellRefIndex(f); // f has row, col\n                    sheet._properties.set(\"validation\", index, index, f);\n                }\n            });\n        },\n\n        _adjustReferences: function(operation, start, delta, mergedCells) {\n            this._mergedCells = mergedCells.reduce(function(a, ref){\n                ref = ref.adjust(null, null, null, null, operation == \"row\", start, delta);\n                if (ref instanceof RangeRef) {\n                    a.push(ref);\n                }\n                return a;\n            }, []);\n            if (this._workbook) {\n                var affectedSheet = this._name();\n                this._workbook._sheets.forEach(function(sheet){\n                    sheet._forFormulas(function(formula){\n                        var prev = formula.adjust(affectedSheet, operation, start, delta);\n                        if (prev && MODIFIED_FORMULAS) {\n                            // if formula.adjust returns non-null,\n                            // that means the formula was indeed\n                            // modified and the returned value is a\n                            // copy of the previous Formula, which we\n                            // can use for undoing the operation.\n                            MODIFIED_FORMULAS.push(prev);\n                        }\n                    });\n\n                    sheet._forValidations(function(validation){\n                        var prev = validation.adjust(affectedSheet, operation, start, delta);\n                        if (prev && MODIFIED_FORMULAS) {\n                            MODIFIED_FORMULAS.push(prev);\n                        }\n                    });\n                });\n                this._workbook.adjustNames(affectedSheet, operation == \"row\", start, delta);\n            }\n            var selection = this.select();\n            selection = selection.adjust(null, null, null, null, operation == \"row\", start, delta);\n            if (selection !== kendo.spreadsheet.NULLREF) {\n                this.select(selection);\n            }\n            // adjust column widths or row heights and hidden attribute\n            var axis = operation == \"col\" ? this._columns : this._rows;\n            axis.adjust(start, delta);\n\n            if (operation == \"row\") {\n                if (delta < 0) {\n                    this._filteredRows.copy(start - delta, this._rows._count - 1, start);\n                } else {\n                    this._filteredRows.copy(start, this._rows._count, start + delta);\n                    this._filteredRows.value(start, start + delta - 1, false);\n                }\n            }\n\n            // adjust drawing anchor cells\n            this._drawings.forEach(function(drawing){\n                if (drawing.topLeftCell) {\n                    drawing.topLeftCell = drawing.topLeftCell.adjust(null, null, null, null,\n                                                                     operation == \"row\", start, delta);\n                }\n            });\n        },\n\n        _forFormulas: function(callback) {\n            var props = this._properties;\n            var formulas = props.get(\"formula\").values();\n            var n = formulas.length;\n            formulas.forEach(function(f, i){\n                callback.call(this, f.value, i, n);\n            }, this);\n        },\n\n        _forValidations: function(callback) {\n            var props = this._properties;\n            props.get(\"validation\").values().forEach(function(v){\n                callback.call(this, v.value);\n            }, this);\n        },\n\n        insertRow: function(rowIndex, skipDataSourceInsert) {\n            if (this.trigger(\"insertRow\", { index: rowIndex })) {\n                return;\n            }\n\n            this.batch(function() {\n                this._resizeAddRow();\n\n                var grid = this._grid;\n                var columnCount = grid.columnCount;\n                var rowCount = grid.rowCount;\n\n                if (rowIndex + 1 == rowCount) {\n                    // we just inserted after the last one, no need to shift data\n                    return;\n                }\n\n                var frozenRows = this.frozenRows();\n\n                if (rowIndex < frozenRows) {\n                    this.frozenRows(frozenRows + 1);\n                }\n\n                var mergedCells = this._mergedCells.slice();\n\n                for (var ci = 0; ci < columnCount; ci++) {\n                    var ref = new RangeRef(new CellRef(rowIndex, ci), new CellRef(rowIndex, ci));\n\n                    var topLeft = grid.normalize(ref.topLeft);\n                    var bottomRight = grid.normalize(ref.bottomRight);\n\n                    var nextRef = new RangeRef(\n                        new CellRef(topLeft.row, topLeft.col),\n                        new CellRef(rowCount - 2, bottomRight.col)\n                    );\n\n                    this._copyRange(nextRef, new CellRef(topLeft.row + 1, topLeft.col));\n\n                    new Range(ref, this).clear({ clearAll: true, keepBorders: true });\n                }\n\n                this._adjustReferences(\"row\", rowIndex, 1, mergedCells);\n            }, {\n                recalc: true,\n                layout: true,\n                insertRow: { index: rowIndex },\n                ref: new RangeRef(new CellRef(rowIndex, 0), new CellRef(Infinity, Infinity))\n            });\n\n            if (!skipDataSourceInsert) {\n                this.trigger(\"afterInsertRow\", { index: rowIndex });\n            }\n\n            return this;\n        },\n\n        isEnabledRow: function(rowIndex) {\n            var ref = new RangeRef(new CellRef(rowIndex, 0), new CellRef(rowIndex, this._grid.columnCount));\n            return new Range(ref, this).enable();\n        },\n\n        deleteRow: function(rowIndex, skipDataSourceDelete) {\n            if (!this.isEnabledRow(rowIndex)) {\n                return this;\n            }\n\n            if (this.trigger(\"deleteRow\", { index: rowIndex })) {\n                return;\n            }\n\n            this.batch(function() {\n                var grid = this._grid;\n                var columnCount = grid.columnCount;\n\n                var frozenRows = this.frozenRows();\n                if (rowIndex < frozenRows) {\n                    this.frozenRows(frozenRows - 1);\n                }\n\n                var mergedCells = this._mergedCells.slice();\n\n                for (var ci = 0; ci < columnCount; ci++) {\n                    var ref = new RangeRef(new CellRef(rowIndex, ci), new CellRef(rowIndex, ci));\n\n                    new Range(ref, this).clear({ clearAll: true, keepBorders: true });\n\n                    var topLeft = grid.normalize(ref.topLeft);\n                    var bottomRight = grid.normalize(ref.bottomRight);\n\n                    var nextRef = new RangeRef(\n                        new CellRef(topLeft.row + 1, topLeft.col),\n                        new CellRef(Infinity, bottomRight.col)\n                    );\n\n                    this._copyRange(nextRef, topLeft);\n\n                    var nextRefBottomRight = grid.normalize(nextRef.bottomRight);\n\n                    new Range(new RangeRef(nextRefBottomRight, nextRefBottomRight), this).clear();\n                }\n\n                this._adjustReferences(\"row\", rowIndex, -1, mergedCells);\n\n                this._resizeDeleteRow();\n            }, {\n                recalc: true,\n                layout: true,\n                deleteRow: { index: rowIndex },\n                ref: new RangeRef(new CellRef(rowIndex, 0), new CellRef(Infinity, Infinity))\n            });\n\n            if (!skipDataSourceDelete) {\n                this.trigger(\"afterDeleteRow\", { index: rowIndex });\n            }\n\n            return this;\n        },\n\n        insertColumn: function(columnIndex) {\n            if (this.trigger(\"insertColumn\", { index: columnIndex })) {\n                return;\n            }\n\n            this.batch(function() {\n                this._resizeAddColumn();\n\n                var grid = this._grid;\n                var columnCount = grid.columnCount;\n\n                if (columnIndex + 1 == columnCount) {\n                    // we just inserted after the last one, no need to shift data\n                    return;\n                }\n\n                var frozenColumns = this.frozenColumns();\n\n                if (columnIndex < frozenColumns) {\n                    this.frozenColumns(frozenColumns + 1);\n                }\n\n                var mergedCells = this._mergedCells.slice();\n\n                for (var ci = columnCount; ci >= columnIndex; ci--) {\n                    var ref = new RangeRef(new CellRef(0, ci), new CellRef(Infinity, ci));\n\n                    new Range(ref, this).clear({ clearAll: true, keepBorders: true });\n\n                    if (ci == columnIndex) {\n                        break;\n                    }\n\n                    var topLeft = grid.normalize(ref.topLeft);\n                    var bottomRight = grid.normalize(ref.bottomRight);\n\n                    var nextRef = new RangeRef(\n                        new CellRef(topLeft.row, topLeft.col - 1),\n                        new CellRef(bottomRight.row, bottomRight.col - 1)\n                    );\n\n                    this._copyRange(nextRef, topLeft);\n                }\n\n                this._adjustReferences(\"col\", columnIndex, 1, mergedCells);\n            }, {\n                recalc: true,\n                layout: true,\n                insertColumn: { index: columnIndex },\n                ref: new RangeRef(new CellRef(0, columnIndex), new CellRef(Infinity, Infinity))\n            });\n\n            return this;\n        },\n\n        isEnabledColumn: function(columnIndex) {\n            var ref = new RangeRef(new CellRef(0, columnIndex), new CellRef(Infinity, columnIndex));\n            return new Range(ref, this).enable();\n        },\n\n        deleteColumn: function(columnIndex) {\n            if (!this.isEnabledColumn(columnIndex)) {\n                return this;\n            }\n\n            if (this.trigger(\"deleteColumn\", { index: columnIndex })) {\n                return;\n            }\n\n            this.batch(function() {\n                var grid = this._grid;\n                var columnCount = grid.columnCount;\n\n                var frozenColumns = this.frozenColumns();\n\n                if (columnIndex < frozenColumns) {\n                    this.frozenColumns(frozenColumns - 1);\n                }\n\n                var mergedCells = this._mergedCells.slice();\n\n                for (var ci = columnIndex; ci < columnCount; ci++) {\n                    var ref = new RangeRef(new CellRef(0, ci), new CellRef(Infinity, ci));\n\n                    new Range(ref, this).clear({ clearAll: true, keepBorders: true });\n\n                    if (ci == columnCount - 1) {\n                        break;\n                    }\n\n                    var topLeft = grid.normalize(ref.topLeft);\n                    var bottomRight = grid.normalize(ref.bottomRight);\n\n                    var nextRef = new RangeRef(\n                        new CellRef(topLeft.row, topLeft.col + 1),\n                        new CellRef(bottomRight.row, bottomRight.col + 1)\n                    );\n\n                    this._copyRange(nextRef, topLeft);\n                }\n\n                this._adjustReferences(\"col\", columnIndex, -1, mergedCells);\n\n                this._resizeDeleteColumn();\n            }, {\n                recalc: true,\n                layout: true,\n                deleteColumn: { index: columnIndex },\n                ref: new RangeRef(new CellRef(0, columnIndex), new CellRef(Infinity, Infinity))\n            });\n\n            return this;\n        },\n\n        _filterRow: function(rowIndex) {\n            this._rows.hide(rowIndex);\n            this._filteredRows.value(rowIndex, rowIndex, true);\n            this.triggerChange({ layout: true });\n        },\n\n        hideRow: function(rowIndex) {\n            if (this.trigger(\"hideRow\", { index: rowIndex })) {\n                return;\n            }\n            return this._property(this._rows.hide.bind(this._rows), rowIndex, { layout: true });\n        },\n\n        unhideRow: function(rowIndex) {\n            if (this.trigger(\"unhideRow\", { index: rowIndex })) {\n                return;\n            }\n            return this._property(this._rows.unhide.bind(this._rows), rowIndex, { layout: true });\n        },\n\n        isHiddenRow: function(rowIndex) {\n            return this._grid._rows.hidden(rowIndex);\n        },\n\n        isFilteredRow: function(rowIndex) {\n            return this._filteredRows.value(rowIndex);\n        },\n\n        columnWidth: function(columnIndex, width) {\n            return this._property(this._columns.value.bind(this._columns, columnIndex, columnIndex), width, { layout: true });\n        },\n\n        rowHeight: function(rowIndex, height) {\n            return this._property(this._rows.value.bind(this._rows, rowIndex, rowIndex), height, { layout: true });\n        },\n\n        frozenRows: function(value) {\n            return this._field(\"_frozenRows\", value, { layout: true });\n        },\n\n        frozenColumns: function(value) {\n            return this._field(\"_frozenColumns\", value, { layout: true });\n        },\n\n        showGridLines: function(value) {\n            return this._field(\"_showGridLines\", value, { layout: true });\n        },\n\n        gridLinesColor: function(value) {\n            return this._field(\"_gridLinesColor\", value, { layout: true });\n        },\n\n        _ref: function(row, column, numRows, numColumns) {\n            var ref = null;\n\n            if (row instanceof kendo.spreadsheet.Ref) {\n                return row;\n            }\n\n            if (row instanceof kendo.spreadsheet.Range) {\n                return row._ref.toRangeRef();\n            }\n\n            if (typeof row === \"string\") {\n                ref = kendo.spreadsheet.calc.parseReference(row);\n            } else {\n                if (!numRows) {\n                    numRows = 1;\n                }\n\n                if (!numColumns) {\n                    numColumns = 1;\n                }\n                ref = new RangeRef(new CellRef(row, column), new CellRef(row + numRows - 1, column + numColumns - 1));\n            }\n\n            return ref;\n        },\n\n        range: function(row, column, numRows, numColumns) {\n            return new Range(this._ref(row, column, numRows, numColumns), this);\n        },\n\n        _getMergedCells: function(range) {\n            var grid = this._grid;\n            var primary = {};\n            var secondary = {};\n            var hasMerged = false;\n\n            this.forEachMergedCell(range, function(ref) {\n                var topLeft = ref.topLeft;\n                grid.forEach(ref, function(cellRef) {\n                    if (topLeft.eq(cellRef)) {\n                        primary[cellRef.print()] = ref;\n                        hasMerged = true;\n                    } else if (range.contains(cellRef)) {\n                        secondary[cellRef.print()] = topLeft;\n                        hasMerged = true;\n                    }\n                });\n            });\n\n            return { primary: primary, secondary: secondary, hasMerged: hasMerged };\n        },\n\n        forEachMergedCell: function(ref, callback) {\n            var selectAll = false;\n\n            if (typeof callback === \"undefined\") {\n                callback = ref;\n                selectAll = true;\n            }\n\n            this._mergedCells.forEach(function(merged) {\n                if (selectAll || merged.intersects(ref)) {\n                    callback(merged);\n                }\n            });\n        },\n\n        forEachFilterHeader: function(ref, callback) {\n            var selectAll = false;\n\n            if (typeof callback === \"undefined\") {\n                callback = ref;\n                selectAll = true;\n            }\n\n            if (this._filter) {\n                var refs = [];\n\n                // get refs of all columns\n                this._filter.ref.forEachColumn(function(columnRef) {\n                    if (selectAll || columnRef.intersects(ref)) {\n                        refs.push(columnRef.topLeft);\n                    }\n                });\n\n                // filter out merged references\n                this._mergedCells.forEach(function(merged) {\n                    refs = refs.map(function(ref) {\n                        if (merged.intersects(ref)) {\n                            return merged;\n                        }\n\n                        return ref;\n                    });\n                });\n\n                // use only unique refs\n                refs.reduce(function unique(result, element) {\n                    if (result.indexOf(element) < 0) {\n                        result.push(element);\n                    }\n\n                    return result;\n                }, []).forEach(callback);\n            }\n        },\n\n        forEach: function(ref, callback) {\n            var self = this;\n            function forEachRange(ref) {\n                if (!(ref instanceof RangeRef)) {\n                    ref = ref.toRangeRef();\n                }\n                var topLeft = self._grid.normalize(ref.topLeft);\n                var bottomRight = self._grid.normalize(ref.bottomRight);\n                var ci, ri;\n\n                function doIt(value) {\n                    callback(ri++, ci, value);\n                }\n\n                for (ci = topLeft.col; ci <= bottomRight.col; ci++) {\n                    ri = topLeft.row;\n                    var startCellIndex = self._grid.index(ri, ci);\n                    var endCellIndex = self._grid.index(bottomRight.row, ci);\n                    self._properties.forEach(startCellIndex, endCellIndex, doIt);\n                }\n            }\n\n            if (!(ref instanceof RangeRef)) {\n                ref = self._ref(ref);\n            }\n\n            if (ref instanceof UnionRef) {\n                // _ref() might still return a UnionRef, for instance, if\n                // `ref` happens to be one.  Probably an oversight, but it\n                // turns out to be useful.\n                ref.forEach(forEachRange);\n            } else {\n                forEachRange(ref);\n            }\n        },\n\n        startResizing: function(initialPosition) {\n            this._initialPosition = initialPosition;\n            this._resizeInProgress = true;\n        },\n\n        startAutoFill: function() {\n            this._autoFillInProgress = true;\n            var selection = this.select();\n            this._autoFillOrigin = selection;\n            this._autoFillDest = selection;\n            this.triggerChange({ selection: true });\n        },\n\n        updateAutoFill: function(dest, punch, hint, direction) {\n            this._autoFillDest = dest;\n            this._autoFillPunch = punch;\n            this._autoFillHint = hint;\n            this._autoFillDirection = direction;\n            this.triggerChange({ selection: true });\n        },\n\n        autoFillRef: function() {\n            return this._autoFillDest;\n        },\n\n        autoFillPunch: function() {\n            return this._autoFillPunch;\n        },\n\n        autoFillInProgress: function() {\n            return this._autoFillInProgress;\n        },\n\n        resizingInProgress: function() {\n            return this._resizeInProgress;\n        },\n\n        draggingInProgress: function() {\n            return this._draggingInProgress;\n        },\n\n        completeResizing: function() {\n            if (this._resizeInProgress) {\n                this._resizeInProgress = false;\n                var hintPosition = this.resizeHintPosition();\n\n                if (this._initialPosition && hintPosition) {\n                    var handlePosition = this.resizeHandlePosition();\n                    if (handlePosition.col !== -Infinity) {\n                        this.trigger(\"commandRequest\", {\n                            command: \"ColumnWidthCommand\",\n                            options: {\n                                target: handlePosition.col,\n                                value: this.columnWidth(handlePosition.col) - (this._initialPosition.x - hintPosition.x)\n                            }\n                        });\n                    } else {\n                        this.trigger(\"commandRequest\", {\n                            command: \"RowHeightCommand\",\n                            options: {\n                                target: handlePosition.row,\n                                value: this.rowHeight(handlePosition.row) - (this._initialPosition.y - hintPosition.y)\n                            }\n                        });\n                    }\n                } else {\n                    this.trigger(\"change\", { resize: true });\n                }\n            }\n        },\n\n        _visualRange: function(ref) {\n            var merged = this._mergedCells;\n            for (var i = merged.length; --i >= 0;) {\n                if (merged[i].intersects(ref)) {\n                    return this.range(merged[i]);\n                }\n            }\n            return this.range(ref);\n        },\n\n        _renderComment: function(ref) {\n            var comment = null;\n            if (ref) {\n                var range = this._visualRange(ref);\n                comment = range.comment();\n                ref = range._ref.toRangeRef().topLeft;\n            }\n            if (comment) {\n                if (!this._commentRef || !ref.eq(this._commentRef)) {\n                    this._commentRef = ref;\n                    this.trigger(\"change\", { comment: true });\n                }\n            } else {\n                if (this._commentRef) {\n                    this._commentRef = null;\n                    this.trigger(\"change\", { comment: true });\n                }\n            }\n        },\n\n        resizeHandlePosition: function() {\n            return this._resizeHandlePosition;\n        },\n\n        resizeHintPosition: function(location) {\n            if (location !== undefined) {\n                this._resizeHintPosition = location;\n                this.trigger(\"change\", { resize: true });\n            }\n            return this._resizeHintPosition;\n        },\n\n        removeResizeHandle: function() {\n            if (this._resizeHandlePosition) {\n                this._resizeHintPosition = undefined;\n                this._resizeHandlePosition = undefined;\n                this._initialPosition = undefined;\n                this.trigger(\"change\", { resize: true });\n            }\n        },\n\n        positionResizeHandle: function(ref) {\n            this._resizeHandlePosition = ref;\n            this.trigger(\"change\", { resize: true });\n        },\n\n        startDragging: function(data) {\n            this._draggingInProgress = data;\n        },\n\n        completeDragging: function() {\n            var drag = this._draggingInProgress;\n            if (drag) {\n                this._draggingInProgress = null;\n                var drawing = drag.drawing;\n                if (drawing.eq(drag.copy)) {\n                    return;\n                }\n                if (drawing.topLeftCell) {\n                    // adjust reference - in case the top-left corner\n                    // was moving, select the cell beneath it.\n                    var box = this.drawingBoundingBox(drawing);\n                    var row = this._rows.indexVisible(box.top);\n                    var col = this._columns.indexVisible(box.left);\n                    var ref = new CellRef(row, col);\n                    var refBox = this.refBoundingBox(ref);\n                    drawing.offsetX = box.left - refBox.left;\n                    drawing.offsetY = box.top - refBox.top;\n                    drawing.topLeftCell = ref;\n                    this.triggerChange({ dragging: true });\n                }\n                this.trigger(\"commandRequest\", {\n                    command: \"DrawingUpdateCommand\",\n                    options: {\n                        sheet    : this,\n                        drawing  : drawing,\n                        previous : drag.copy\n                    }\n                });\n            }\n        },\n\n        startSelection: function(view) {\n            if (this.frozenRows() || this.frozenColumns()) {\n                this._currentView = null;\n            } else if (view && view._sheet === this) {\n                this._currentView = view;\n            }\n            this._selectionInProgress = true;\n        },\n\n        completeSelection: function() {\n            if (this._selectionInProgress) {\n                this._selectionInProgress = false;\n                this._resizeHintPosition = undefined;\n                this.trigger(\"change\", { selection: true });\n            }\n            if (this._autoFillInProgress) {\n                this._autoFillInProgress = false;\n                var dest = this._autoFillDest;\n                var origin = this._autoFillOrigin;\n\n                if (this._autoFillPunch) { // we just clear data here\n                    this.trigger(\"commandRequest\", {\n                        command: \"ClearContentCommand\", options: { operatingRange: this.range(this._autoFillPunch) }\n                    });\n                } else {\n                    if (!dest.eq(origin)) {\n                        this.trigger(\"commandRequest\", {\n                            command: \"AutoFillCommand\", options: { operatingRange: this.range(dest), origin: this.range(origin) }\n                        });\n                    } else {\n                        this.triggerChange({ selection: true });\n                    }\n                }\n\n                this._autoFillDest = null;\n                this._autoFillPunch = null;\n                this._autoFillOrigin = null;\n\n                this.select(dest);\n            }\n        },\n\n        selectionInProgress: function() {\n            return this._selectionInProgress;\n        },\n\n        select: function(ref, changeActiveCell) {\n            var selectionState = this._selectionState();\n\n            var expandedRef;\n\n            if (ref) {\n                ref = this._ref(ref);\n                ref = this._grid.normalize(ref);\n                expandedRef = this._grid.isAxis(ref) ? ref : this.unionWithMerged(ref);\n            }\n\n            return selectionState.select(ref, expandedRef, changeActiveCell, this._currentView);\n        },\n\n        originalSelect: function() {\n            return this._selectionState().originalSelection;\n        },\n\n        currentSelectionRange: function() {\n            return this._selectionState().currentSelectionRange();\n        },\n\n        currentOriginalSelectionRange: function() {\n            return this._selectionState().currentOriginalNavigationRange();\n        },\n\n        currentNavigationRange: function() {\n            return this._selectionState().currentNavigationRange();\n        },\n\n        nextNavigationRange: function() {\n            return this._selectionState().nextNavigationRange();\n        },\n\n        previousNavigationRange: function() {\n            return this._selectionState().previousNavigationRange();\n        },\n\n        selectionRangeIndex: function() {\n            return this._selectionState().selectionRangeIndex;\n        },\n\n        activeCell: function(ref) {\n            return this._selectionState().activeCell(ref);\n        },\n\n        originalActiveCell: function() {\n            return this._selectionState().originalActiveCell;\n        },\n\n        singleCellSelection: function() {\n            return this._selectionState().singleCellSelection();\n        },\n\n        unionWithMerged: function(ref) {\n            var mergedCells = this._mergedCells;\n\n            return ref.map(function(ref) {\n                return ref.toRangeRef().union(mergedCells);\n            });\n        },\n\n        trim: function(ref) {\n            var trims = [];\n            var grid = this._grid;\n            this._properties.forEachProperty(function(property) {\n                trims.push(grid.trim(ref, property.list));\n            });\n            return this.unionWithMerged(ref.topLeft.toRangeRef().union(trims));\n        },\n\n        focus: function(ref) {\n            if (ref) {\n                this._focus = ref.toRangeRef();\n            } else {\n                var focus = this._focus;\n                this._focus = null;\n                return focus;\n            }\n        },\n\n        activeCellSelection: function() {\n            return new Range(this._grid.normalize(this.activeCell()), this);\n        },\n\n        selection: function() {\n            return new Range(this._grid.normalize(this._selectionState().selection), this);\n        },\n\n        selectedHeaders: function() {\n            var selection = this.select();\n\n            var rows = {};\n            var cols = {};\n            var allCols = false;\n            var allRows = false;\n            var maxRow = this._grid.rowCount - 1;\n            var maxCol = this._grid.columnCount - 1;\n\n            selection.forEach(function(ref) {\n                var i;\n                var rowState = \"partial\";\n                var colState = \"partial\";\n                ref = ref.toRangeRef();\n\n                var bottomRight = ref.bottomRight;\n                var topLeft = ref.topLeft;\n\n                var rowSelection = topLeft.col <= 0 && bottomRight.col >= maxCol;\n                var colSelection = topLeft.row <= 0 && bottomRight.row >= maxRow;\n\n                if (colSelection) { //column selection\n                    allRows = true;\n                    colState = \"full\";\n                }\n\n                if (rowSelection) { //row selection\n                    allCols = true;\n                    rowState = \"full\";\n                }\n\n                if (!colSelection) { //column selection\n                    for (i = topLeft.row; i <= bottomRight.row; i++) {\n                        if (rows[i] !== \"full\") {\n                            rows[i] = rowState;\n                        }\n                    }\n                }\n\n                if (!rowSelection) {\n                    for (i = topLeft.col; i <= bottomRight.col; i++) {\n                        if (cols[i] !== \"full\") {\n                            cols[i] = colState;\n                        }\n                    }\n                }\n            });\n\n            return {\n                rows: rows,\n                cols: cols,\n                allRows: allRows,\n                allCols: allCols,\n                all: allRows && allCols\n            };\n        },\n\n        isInEditMode: function(isInEdit) {\n            if (isInEdit === undefined) {\n                return this._inEdit;\n            }\n\n            this._inEdit = isInEdit;\n\n            if (isInEdit) {\n                this._editSelection.selection = this._viewSelection.selection.clone();\n                this._editSelection.originalSelection = this._viewSelection.originalSelection.clone();\n                this._editSelection._activeCell = this._viewSelection._activeCell.clone();\n                this._editSelection.originalActiveCell = this._viewSelection.originalActiveCell.clone();\n            }\n        },\n\n        _setFormulaSelections: function(selection) {\n            this._formulaSelections = (selection || []).slice();\n            this.triggerChange({ selection: true });\n        },\n\n        _viewActiveCell: function() {\n            return this._viewSelection._activeCell.toRangeRef();\n        },\n\n        toJSON: function() {\n            var positions = {};\n\n            var rows = this._rows.toJSON(\"height\", positions);\n            var columns = this._columns.toJSON(\"width\", {});\n            var viewSelection = this._viewSelection;\n            var hyperlinks = [];\n            var defaultCellStyle = this._defaultCellStyle || {};\n\n            function clearDefaultStyle(cell) {\n                Object.keys(defaultCellStyle).forEach(function(key){\n                    if (cell[key] === defaultCellStyle[key]) {\n                        delete cell[key];\n                    }\n                });\n            }\n\n            this.forEach(kendo.spreadsheet.SHEETREF, function(row, col, cell) {\n                clearDefaultStyle(cell);\n\n                if (Object.keys(cell).length === 0) {\n                    return;\n                }\n\n                if (cell.link) {\n                    hyperlinks.push({\n                        ref    : kendo.spreadsheet.Ref.display(null, row, col),\n                        target : cell.link\n                    });\n                }\n\n                var position = positions[row];\n\n                if (position === undefined) {\n                    position = rows.length;\n                    rows.push({ index: row });\n                    positions[row] = position;\n                }\n\n                row = rows[position];\n\n                cell.index = col;\n\n                if (row.cells === undefined) {\n                    row.cells = [];\n                }\n\n                if (cell.formula) {\n                    // stringify Formula object.\n                    if (cell.formula.arrayFormulaRange) {\n                        cell.formula = {\n                            src: cell.formula.toString(),\n                            ref: cell.formula.arrayFormulaRange.toString()\n                        };\n                    } else {\n                        cell.formula = cell.formula.toString();\n                    }\n                }\n\n                if (cell.validation) {\n                    cell.validation = cell.validation.toJSON();\n                }\n\n                if (cell.color) {\n                    cell.color = kendo.parseColor(cell.color).toCss();\n                }\n\n                if (cell.background) {\n                    cell.background = kendo.parseColor(cell.background).toCss();\n                }\n\n                if (cell.borderTop && cell.borderTop.color) {\n                    cell.borderTop.color = kendo.parseColor(cell.borderTop.color).toCss();\n                }\n\n                if (cell.borderBottom && cell.borderBottom.color) {\n                    cell.borderBottom.color = kendo.parseColor(cell.borderBottom.color).toCss();\n                }\n\n                if (cell.borderRight && cell.borderRight.color) {\n                    cell.borderRight.color = kendo.parseColor(cell.borderRight.color).toCss();\n                }\n\n                if (cell.borderLeft && cell.borderLeft.color) {\n                    cell.borderLeft.color = kendo.parseColor(cell.borderLeft.color).toCss();\n                }\n\n                row.cells.push(cell);\n            });\n\n            var json = {\n                name: this._name(),\n                rows: rows,\n                columns: columns,\n                selection: viewSelection.selection.toString(),\n                activeCell: viewSelection.activeCell().toString(),\n                frozenRows: this.frozenRows(),\n                frozenColumns: this.frozenColumns(),\n                showGridLines: this.showGridLines(),\n                gridLinesColor: this.gridLinesColor(),\n                mergedCells: this._mergedCells.map(function(ref) {\n                    return ref.toString();\n                }),\n                hyperlinks: hyperlinks,\n                defaultCellStyle: defaultCellStyle,\n                drawings: this._drawings.map(function(dr){\n                    return dr.toJSON();\n                })\n            };\n\n            if (this._sort) {\n               json.sort = {\n                   ref: this._sort.ref.toString(),\n                   columns: this._sort.columns.map(function(column) {\n                       return {\n                           index: column.index,\n                           ascending: column.ascending\n                       };\n                   })\n               };\n            }\n\n            if (this._filter) {\n               json.filter = {\n                   ref: this._filter.ref.toString(),\n                   columns: this._filter.columns.map(function(column) {\n                        var filter = column.filter.toJSON();\n                        filter.index = column.index;\n                        return filter;\n                   })\n               };\n            }\n\n            return json;\n        },\n\n        fromJSON: function(json) {\n            this.batch(function() {\n                if (json.name !== undefined) {\n                    this._name(json.name);\n                }\n\n                if (json.frozenColumns !== undefined) {\n                    this.frozenColumns(json.frozenColumns);\n                }\n\n                if (json.frozenRows !== undefined) {\n                    this.frozenRows(json.frozenRows);\n                }\n\n                if (json.columns !== undefined) {\n                    this._columns.fromJSON(\"width\", json.columns);\n                }\n\n                if (json.rows !== undefined) {\n                    this._resizeForJSON(json.rows);\n                    this._rows.fromJSON(\"height\", json.rows);\n\n                    for (var ri = 0; ri < json.rows.length; ri++) {\n                        var row = json.rows[ri];\n                        var rowIndex = row.index;\n\n                        if (rowIndex === undefined) {\n                            rowIndex = ri;\n                        }\n\n                        if (row.cells) {\n                            for (var ci = 0; ci < row.cells.length; ci++) {\n                                var cell = row.cells[ci];\n                                var columnIndex = cell.index;\n\n                                if (columnIndex === undefined) {\n                                    columnIndex = ci;\n                                }\n\n                                if (cell.formula) {\n                                    var isArray = typeof cell.formula != \"string\";\n                                    var src = isArray ? cell.formula.src : cell.formula;\n                                    var formula = this._compileFormula(rowIndex, columnIndex, src);\n                                    if (isArray) {\n                                        formula.setArrayFormulaRange(\n                                            kendo.spreadsheet.calc.parseReference(cell.formula.ref));\n                                    }\n                                    cell.formula = formula;\n                                }\n\n                                if (cell.validation) {\n                                    cell.validation = this._compileValidation(rowIndex, columnIndex, cell.validation);\n                                }\n\n                                this._properties.fromJSON(this._grid.index(rowIndex, columnIndex), cell);\n                            }\n                        }\n                    }\n                }\n\n                if (json.drawings) {\n                    this._drawings = json.drawings.map(Drawing.fromJSON);\n                }\n\n                if (json.selection) {\n                    this._viewSelection.selection =\n                        this._viewSelection.originalSelection = this._ref(json.selection);\n                }\n\n                if (json.activeCell) {\n                    var activeCellRef = this._ref(json.activeCell);\n\n                    this._viewSelection._activeCell = activeCellRef.toRangeRef();\n                    this._viewSelection.originalActiveCell = activeCellRef.first();\n                }\n\n\n                if (json.mergedCells) {\n                    json.mergedCells.forEach(function(ref) {\n                       this.range(ref).merge();\n                    }, this);\n                }\n\n                if (json.sort) {\n                    this._sort = {\n                        ref: this._ref(json.sort.ref),\n                        columns: json.sort.columns.slice(0)\n                    };\n                }\n\n                if (json.filter) {\n                    var ref = json.filter.ref;\n                    var columns = json.filter.columns  === undefined ? [] : json.filter.columns;\n\n                    if (!ref) {\n                        kendo.logToConsole(\"Dropping filter for sheet '\" + json.name + \"' due to missing ref\");\n                    } else {\n                        this._filter = {\n                            ref: this._ref(ref),\n                            columns: columns.map(function(column) {\n                                return {\n                                    index: column.index,\n                                    filter: kendo.spreadsheet.Filter.create(column)\n                                };\n                            })\n                        };\n\n                        this._refreshFilter();\n                    }\n                }\n\n                if (json.showGridLines !== undefined) {\n                    this._showGridLines = json.showGridLines;\n                }\n\n                this._gridLinesColor = json.gridLinesColor;\n            });\n\n            this._rows._refresh();\n            this._columns._refresh();\n        },\n\n        formula: function(ref) {\n            return this._properties.get(\"formula\", this._grid.cellRefIndex(ref));\n        },\n\n        validation: function(ref) {\n            return this._properties.get(\"validation\", this._grid.cellRefIndex(ref));\n        },\n\n        // NOTE: resetFormulas should be called first.  We don't do it in this\n        // function because it should be done from the Workbook object for all\n        // sheets.\n        resetFormulas: function() {\n            this._forFormulas(function(formula){\n                formula.reset();\n            });\n        },\n\n        resetValidations: function() {\n            this._forValidations(function(validation){\n                validation.reset();\n            });\n        },\n\n        recalc: function(context, callback) {\n            var formulas = this._properties.get(\"formula\").values();\n            var count = formulas.length, pending = 0, i = 0;\n            if (!count && callback) {\n                return callback();\n            }\n            function next() {\n                pending--;\n                if (i == count && !pending) {\n                    callback();\n                }\n            }\n            while (i < count) {\n                pending++;\n                formulas[i++].value.exec(context, callback ? next : null);\n            }\n        },\n\n        revalidate: function(context) {\n            var self = this;\n            this._forValidations(function(validation){\n                var cellRef = new CellRef(validation.row, validation.col);\n                var ref =  new RangeRef(cellRef, cellRef);\n                validation.exec(context, self._get(ref, \"value\"), self._get(ref, \"format\"));\n            });\n        },\n\n        _value: function(row, col, value) {\n            var index = this._grid.index(row, col);\n\n            if (value !== undefined) {\n                this._properties.set(\"value\", index, index, value);\n            } else {\n                return this._properties.get(\"value\", index);\n            }\n        },\n\n        _validation: function(row, col) {\n            var index = this._grid.index(row, col);\n\n            return this._properties.get(\"validation\", index);\n        },\n\n        _compileValidation: function(row, col, validation) {\n            if (validation instanceof kendo.spreadsheet.validation.Validation) {\n                // do not alter an existing object.\n                return validation.clone(this._name(), row, col);\n            }\n\n            if (validation.from != null) {\n                validation.from = (validation.from + \"\").replace(/^=/, \"\");\n            }\n\n            if (validation.to != null) {\n                validation.to = (validation.to + \"\").replace(/^=/, \"\");\n            }\n\n            return kendo.spreadsheet.validation.compile(this._name(), row, col, validation);\n        },\n\n        _compileFormula: function(row, col, f) {\n            f = f.replace(/^=/, \"\");\n            f = kendo.spreadsheet.calc.parseFormula(this._name(), row, col, f);\n            return kendo.spreadsheet.calc.compile(f);\n        },\n\n        _copyValuesInRange: function (topLeft, bottomRight, value, property) {\n            var ci, start, end;\n\n            for (ci = topLeft.col; ci <= bottomRight.col; ci++) {\n                start = this._grid.index(topLeft.row, ci);\n                end = this._grid.index(bottomRight.row, ci);\n                for (var index = start, row = topLeft.row; index <= end; ++index, ++row) {\n                    // Even if it's the same formula in multiple cells, we\n                    // need to have different Formula objects, hence cloning\n                    // it.  Don't worry, clone() is fast.\n                    value = value.clone(this._name(), row, ci);\n                    this._properties.set(property, index, index, value);\n                }\n            }\n            return value;\n        },\n\n        _set: function(ref, name, value) {\n            var topLeft = this._grid.normalize(ref.topLeft);\n            var bottomRight = this._grid.normalize(ref.bottomRight);\n            var ci, start, end;\n\n            if (typeof value == \"number\") {\n                // Apparently, Excel (and LibreOffice and Google\n                // Sheets) will limit precision to 14 digits; type:\n                // -4.2524999999999995 and you get -4.2525.  The\n                // formula engine already does something similar for\n                // intermediate formula results, but we must do it\n                // here as well for original input values.\n                value = kendo.spreadsheet.calc.runtime.limitPrecision(value);\n            }\n\n            if (value && name == \"formula\") {\n                if (typeof value == \"string\") {\n                    // get Formula object.  we don't care about handling errors\n                    // here since it won't be called interactively.\n                    value = this._compileFormula(topLeft.row, topLeft.col, value);\n                }\n\n                value = this._copyValuesInRange(topLeft, bottomRight, value, \"formula\");\n\n            } else if (value && name == \"validation\") {\n                value = this._compileValidation(topLeft.row, topLeft.col, value);\n                value = this._copyValuesInRange(topLeft, bottomRight, value, \"validation\");\n\n            } else {\n                for (ci = topLeft.col; ci <= bottomRight.col; ci++) {\n                    start = this._grid.index(topLeft.row, ci);\n                    end = this._grid.index(bottomRight.row, ci);\n                    this._properties.set(name, start, end, value);\n                    if (name == \"formula\") {\n                        // removing a formula, must clear value.\n                        this._properties.set(\"value\", start, end, null);\n                    }\n                }\n            }\n        },\n\n        _get: function(ref, name) {\n            var topLeft = this._grid.normalize(ref.topLeft);\n\n            var index = this._grid.index(topLeft.row, topLeft.col);\n\n            return this._properties.get(name, index);\n        },\n\n        batch: function(callback, reason) {\n            var suspended = this.suspendChanges();\n\n            this.suspendChanges(true);\n            this._valueChanged = false;\n\n            callback.call(this);\n\n            if (!reason) {\n                reason = { recalc: true };\n            }\n            if (this._valueChanged) {\n                reason.isValue = true;\n            }\n\n            return this.suspendChanges(suspended).triggerChange(reason);\n        },\n\n        _sortBy: function(ref, columns) {\n            var indices = null;\n\n            columns.forEach(function(column) {\n                indices = this._sorter.sortBy(ref, column.index, this._properties.get(\"value\"), column.ascending, indices);\n            }, this);\n\n            this._sort = {\n                ref: ref,\n                columns: columns\n            };\n\n            this._refreshFilter();\n\n            this.forEach(ref, function(row, col, props) {\n                var formula = props.formula;\n                if (formula) {\n                    var diff = row - formula.row;\n                    if (diff !== 0) {\n                        var start = diff > 0 ? formula.row : formula.row + diff;\n                        formula.adjust(this.name(), \"row\", start, diff);\n                    }\n                }\n            }.bind(this));\n\n            this.triggerChange({ recalc: true });\n        },\n\n        _refreshFilter: function() {\n            if (this._filter) {\n                this._filterBy(this._filter.ref, this._filter.columns);\n            }\n        },\n\n        _filterBy: function(ref, columns) {\n            this.batch(function() {\n                for (var ri = ref.topLeft.row; ri <= ref.bottomRight.row; ri++) {\n                    if (this.isFilteredRow(ri)) {\n                        this._filteredRows.value(ri, ri, false);\n                        this._rows.unhide(ri);\n                    }\n                }\n\n                columns.forEach(function(column) {\n                    // do not filter header row\n                    var columnRef = ref.resize({ top: 1 }).toColumn(column.index);\n\n                    var cells = [];\n\n                    if (columnRef === kendo.spreadsheet.NULLREF) {\n                        return;\n                    }\n\n                    this.forEach(columnRef, function(row, col, cell) {\n                        cell.row = row;\n                        cells.push(cell);\n                    });\n\n                    column.filter.prepare(cells);\n\n                    for (var ci = 0; ci < cells.length; ci++) {\n                        var cell = cells[ci];\n                        var value = column.filter.value(cell);\n\n                        if (column.filter.matches(value) === false) {\n                            this._filterRow(cell.row);\n                        }\n                    }\n                }, this);\n\n                this._filter = {\n                    ref: ref,\n                    columns: columns\n                };\n            }, { recalc: true, layout: true, filter: true });\n        },\n\n        filterColumn: function(ref) {\n            var filterRef = this.filter().ref;\n            return ref.toRangeRef().topLeft.col - filterRef.topLeft.col;\n        },\n\n        filter: function() {\n            return this._filter;\n        },\n\n        clearFilter: function(spec) {\n            this._clearFilter(spec instanceof Array ? spec : [spec]);\n        },\n\n        _clearFilter: function(indices) {\n            if (this._filter) {\n                this.batch(function() {\n                    this._filter.columns = this._filter.columns.filter(function(column) {\n                        return indices.indexOf(column.index) < 0;\n                    });\n\n                    this._refreshFilter();\n                }, { recalc: true, layout: true, filter: true });\n            }\n        },\n\n        getAxisState: function() {\n            return {\n                rows: this._rows.getState(),\n                columns: this._columns.getState()\n            };\n        },\n\n        setAxisState: function(state) {\n            this._rows.setState(state.rows);\n            this._columns.setState(state.columns);\n            this.triggerChange({ layout: true });\n        },\n\n        getState: function() {\n            return {\n                rows: this._rows.getState(),\n                columns: this._columns.getState(),\n                mergedCells: this._mergedCells.map(function(cell) { return cell.clone(); }),\n                properties: this._properties.getState()\n            };\n        },\n\n        setState: function(state) {\n            this._rows.setState(state.rows);\n            this._columns.setState(state.columns);\n            this._mergedCells = state.mergedCells;\n            this._properties.setState(state.properties);\n            this.triggerChange(kendo.spreadsheet.ALL_REASONS);\n        },\n\n        _merge: function(ref) {\n            var mergedCells = this._mergedCells;\n\n            var sheet = this;\n            var mergedRef;\n            this.batch(function() {\n                mergedRef = ref.map(function(ref) {\n                    if (ref instanceof kendo.spreadsheet.CellRef) {\n                        return ref;\n                    }\n\n                    var currentRef = ref.toRangeRef().union(mergedCells, function(ref) {\n                        mergedCells.splice(mergedCells.indexOf(ref), 1);\n                    });\n\n                    var range = new Range(currentRef, sheet);\n                    var formula = range._get(\"formula\");\n                    var value = range.value();\n                    var format = range.format();\n                    var background = range.background();\n\n                    range.value(null);\n                    range.format(null);\n                    range.background(null);\n\n                    var topLeft = new Range(currentRef.collapse(), sheet);\n\n                    if (formula) {\n                        topLeft._set(\"formula\", formula);\n                    } else {\n                        topLeft.value(value);\n                    }\n                    topLeft.format(format);\n                    topLeft.background(background);\n\n                    mergedCells.push(currentRef);\n                    return currentRef;\n                });\n\n                var viewSelection = sheet._viewSelection;\n\n                viewSelection.selection = sheet.unionWithMerged(viewSelection.originalSelection);\n                viewSelection._activeCell = sheet.unionWithMerged(viewSelection.originalActiveCell);\n            }, { activeCell: true, selection: true });\n\n            return mergedRef;\n        },\n\n        _useCultureDecimals: function() {\n            return this._workbook && this._workbook.options.useCultureDecimals;\n        },\n\n        withCultureDecimals: function(f) {\n            var dot = \".\";\n            if (this._useCultureDecimals()) {\n                dot = kendo.culture().numberFormat[\".\"];\n            }\n            return kendo.spreadsheet.calc.withDecimalSeparator(dot, f);\n        },\n\n        drawingBoundingBox: function(drawing) {\n            var left = drawing.offsetX;\n            var top = drawing.offsetY;\n            if (drawing.topLeftCell) {\n                // offsets are relative to cell\n                left += this._columns.sum(0, drawing.topLeftCell.col - 1);\n                top += this._rows.sum(0, drawing.topLeftCell.row - 1);\n            }\n            return new kendo.spreadsheet.Rectangle(left, top, drawing.width, drawing.height);\n        },\n\n        refBoundingBox: function(ref) {\n            return this._grid.rectangle(ref.toRangeRef());\n        },\n\n        addDrawing: function(drw, activate) {\n            if (!(drw instanceof Drawing)) {\n                drw = new Drawing(drw);\n            }\n            this._drawings.push(drw);\n            if (activate) {\n                this._activeDrawing = drw;\n            }\n            this.triggerChange({ layout: true });\n            return drw;\n        },\n\n        removeDrawing: function(drawing) {\n            var pos = this._drawings.indexOf(drawing);\n            if (pos >= 0) {\n                this._drawings.splice(pos, 1);\n                this.triggerChange({ layout: true });\n            }\n        },\n\n        usesImage: function(img) {\n            for (var i = this._drawings.length; --i >= 0;) {\n                if (this._drawings[i].image === img) {\n                    return true;\n                }\n            }\n            return false;\n        },\n\n        isMerged: function(ref) {\n            var merged = this._mergedCells;\n            for (var i = merged.length; --i >= 0;) {\n                if (merged[i].eq(ref)) {\n                    return true;\n                }\n            }\n            return false;\n        }\n    });\n\n    var Drawing = kendo.Class.extend({\n        init: function Drawing(args) {\n            this.reset(args);\n        },\n\n        toJSON: function() {\n            return {\n                topLeftCell: this.topLeftCell.toString(),\n                offsetX: this.offsetX,\n                offsetY: this.offsetY,\n                width: this.width,\n                height: this.height,\n                image: this.image,\n                opacity: this.opacity\n            };\n        },\n\n        clone: function() {\n            return new Drawing(this);\n        },\n\n        reset: function(dr) {\n            var anchor = dr.topLeftCell;\n            if (typeof anchor == \"string\") {\n                anchor = kendo.spreadsheet.calc.parseReference(anchor);\n            }\n            this.topLeftCell = anchor;\n            this.offsetX = dr.offsetX || 0;\n            this.offsetY = dr.offsetY || 0;\n            this.width = dr.width;\n            this.height = dr.height;\n            this.image = dr.image;\n            this.opacity = dr.opacity != null ? dr.opacity : 1;\n        },\n\n        eq: function(dr) {\n            return ((!this.topLeftCell && !dr.topLeftCell)\n                    || (this.topLeftCell && dr.topLeftCell\n                        && this.topLeftCell.eq(dr.topLeftCell)))\n                && this.offsetX === dr.offsetX\n                && this.offsetY === dr.offsetY\n                && this.width === dr.width\n                && this.height === dr.height\n                && this.image === dr.image\n                && this.opacity === dr.opacity;\n        }\n    });\n\n    Drawing.fromJSON = function(args) {\n        return new Drawing(args);\n    };\n\n    kendo.spreadsheet.Sheet = Sheet;\n    kendo.spreadsheet.Drawing = Drawing;\n})(kendo);\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/sheetsbar',[ \"kendo.core\", \"kendo.sortable\" ], f);\n})(function(){\n\n    (function(kendo) {\n\n        var $ = kendo.jQuery;\n        var outerWidth = kendo._outerWidth;\n        var DOT = \".\";\n        var EMPTYCHAR = \" \";\n        var sheetsBarClassNames = {\n            sheetsBarWrapper: \"k-widget k-header\",\n            sheetsBarSheetsWrapper: \"k-tabstrip k-floatwrap k-tabstrip-bottom\",\n            sheetsBarActive: \"k-spreadsheet-sheets-bar-active\",\n            sheetsBarInactive: \"k-spreadsheet-sheets-bar-inactive\",\n            sheetsBarAdd: \"k-spreadsheet-sheets-bar-add\",\n            sheetsBarRemove: \"k-spreadsheet-sheets-remove\",\n            sheetsBarItems: \"k-spreadsheet-sheets-items\",\n            sheetsBarEditor: \"k-spreadsheet-sheets-editor\",\n            sheetsBarScrollable: \"k-tabstrip-scrollable\",\n            sheetsBarNext: \"k-tabstrip-next\",\n            sheetsBarPrev: \"k-tabstrip-prev\",\n            sheetsBarKItem: \"k-item k-tabstrip-item\",\n            sheetsBarKActive: \"k-active k-state-tab-on-top\",\n            sheetsBarKTextbox: \"k-textbox\",\n            sheetsBarKLink: \"k-link\",\n            sheetsBarKIcon: \"k-icon\",\n            sheetsBarKFontIcon: \"k-icon\",\n            sheetsBarKButton: \"k-button k-icon-button\",\n            sheetsBarKButtonDefaults: \"k-button-md k-rounded-md k-button-solid k-button-solid-base\",\n            sheetsBarKButtonBare: \"k-button-md k-rounded-md k-button-flat k-button-flat-base\",\n            sheetsBarKArrowW: \"k-i-arrow-60-left\",\n            sheetsBarKArrowE: \"k-i-arrow-60-right\",\n            sheetsBarKReset: \"k-reset k-tabstrip-items\",\n            sheetsBarKIconX: \"k-i-close\",\n            sheetsBarKSprite: \"k-sprite\",\n            sheetsBarKIconPlus: \"k-i-plus\",\n            sheetsBarHintWrapper: \"k-widget k-tabstrip k-tabstrip-bottom k-spreadsheet-sheets-items-hint\",\n            sheetsBarKResetItems: \"k-reset k-tabstrip-items\"\n        };\n\n        var SheetsBar = kendo.ui.Widget.extend({\n            init: function(element, options) {\n                var classNames = SheetsBar.classNames;\n\n                kendo.ui.Widget.call(this, element, options);\n\n                element = this.element;\n\n                element.addClass(classNames.sheetsBarWrapper);\n\n                this._openDialog = options.openDialog;\n\n                this._tree = new kendo.dom.Tree(element[0]);\n\n                this._tree.render([this._addButton(), this._createSheetsWrapper([])]);\n\n                this._toggleScrollEvents(true);\n\n                this._createSortable();\n\n                this._sortable.bind(\"start\", this._onSheetReorderStart.bind(this));\n\n                this._sortable.bind(\"end\", this._onSheetReorderEnd.bind(this));\n\n                element.on(\"click\", DOT + classNames.sheetsBarRemove, this._onSheetRemove.bind(this));\n\n                element.on(\"click\", \"li\", this._onSheetSelect.bind(this));\n\n                element.on(\"dblclick\", \"li\" + DOT + classNames.sheetsBarActive, this._createEditor.bind(this));\n\n                element.on(\"click\", DOT + classNames.sheetsBarAdd, this._onAddSelect.bind(this));\n            },\n\n            options: {\n                name: \"SheetsBar\",\n                scrollable: {\n                    distance: 200\n                }\n            },\n\n            events: [\n                \"select\",\n                \"reorder\",\n                \"rename\"\n            ],\n\n            _createEditor: function () {\n                if (this._editor) {\n                    return;\n                }\n\n                this._renderSheets(this._sheets, this._selectedIndex, true);\n                this._editor = this.element\n                    .find(kendo.format(\"input{0}{1}\",DOT,SheetsBar.classNames.sheetsBarEditor))\n                    .trigger(\"focus\")\n                    .on(\"keydown\", this._onEditorKeydown.bind(this))\n                    .on(\"blur\", this._onEditorBlur.bind(this));\n            },\n\n            _destroyEditor: function(canceled) {\n                var newSheetName = canceled ? null : this._editor.val();\n                this._editor.off();\n                this._editor = null;\n                this._renderSheets(this._sheets, this._selectedIndex, false);\n                this._onSheetRename(newSheetName);\n            },\n\n            renderSheets: function(sheets, selectedIndex) {\n                if (!sheets || selectedIndex < 0) {\n                    return;\n                }\n\n                this._renderSheets(sheets, selectedIndex, false);\n            },\n\n            _renderSheets: function(sheets, selectedIndex, isInEditMode) {\n                var that = this;\n                var classNames = SheetsBar.classNames;\n\n                that._isRtl = kendo.support.isRtl(that.element);\n                that._sheets = sheets;\n                that._selectedIndex = selectedIndex;\n\n                that._renderHtml(isInEditMode, true);\n\n                if (!that._scrollableAllowed()) {\n                    return;\n                }\n\n                var sheetsWrapper = that._sheetsWrapper();\n\n                sheetsWrapper.addClass(classNames.sheetsBarScrollable + EMPTYCHAR + classNames.sheetsBarSheetsWrapper);\n\n                that._toggleScrollButtons();\n            },\n\n            _toggleScrollButtons: function (toggle) {\n                var that = this;\n                var ul = that._sheetsGroup();\n                var wrapper = that._sheetsWrapper();\n                var scrollLeft = kendo.scrollLeft(ul);\n                var prev = wrapper.find(DOT + SheetsBar.classNames.sheetsBarPrev);\n                var next = wrapper.find(DOT + SheetsBar.classNames.sheetsBarNext);\n\n                if (toggle === false) {\n                    prev.addClass( 'k-disabled' );\n                    next.addClass( 'k-disabled' );\n                } else {\n                    prev.toggleClass( 'k-disabled', !(that._isRtl ? scrollLeft < ul[0].scrollWidth - ul[0].offsetWidth - 1 : scrollLeft !== 0) );\n                    next.toggleClass( 'k-disabled', !(that._isRtl ? scrollLeft !== 0 : scrollLeft < ul[0].scrollWidth - ul[0].offsetWidth - 1) );\n                }\n\n            },\n\n            _toggleScrollEvents: function(toggle) {\n                var that = this;\n                var classNames = SheetsBar.classNames;\n                var options = that.options;\n                var scrollPrevButton;\n                var scrollNextButton;\n                var sheetsWrapper = that._sheetsWrapper();\n                scrollPrevButton = sheetsWrapper.find(DOT + classNames.sheetsBarPrev);\n                scrollNextButton = sheetsWrapper.find(DOT + classNames.sheetsBarNext);\n\n                if (toggle) {\n                    scrollPrevButton.on(\"mousedown\", function (event) {\n                        event.preventDefault();\n                        event.stopPropagation();\n                        that._nowScrollingSheets = true;\n                        that._scrollSheetsByDelta(options.scrollable.distance * (that._isRtl ? 1 : -1));\n                    });\n\n                    scrollNextButton.on(\"mousedown\", function (event) {\n                        event.preventDefault();\n                        event.stopPropagation();\n                        that._nowScrollingSheets = true;\n                        that._scrollSheetsByDelta(options.scrollable.distance * (that._isRtl ? -1 : 1));\n                    });\n\n                    scrollPrevButton.add(scrollNextButton).on(\"mouseup\", function () {\n                        that._nowScrollingSheets = false;\n                    });\n                } else {\n                    scrollPrevButton.off();\n                    scrollNextButton.off();\n                }\n            },\n\n            _renderHtml: function(isInEditMode, renderScrollButtons) {\n                var idx;\n                var sheetElements = [];\n                var dom = kendo.dom;\n                var element = dom.element;\n                var sheets = this._sheets;\n                var selectedIndex = this._selectedIndex;\n                var classNames = SheetsBar.classNames;\n\n                for (idx = 0; idx < sheets.length; idx++) {\n                    var sheet = sheets[idx];\n                    var isSelectedSheet = (idx === selectedIndex);\n                    var attr = { className: classNames.sheetsBarKItem + EMPTYCHAR };\n                    var elementContent = [];\n\n                    if (isSelectedSheet) {\n                        attr.className += classNames.sheetsBarKActive + EMPTYCHAR + classNames.sheetsBarActive;\n                    } else {\n                        attr.className += classNames.sheetsBarInactive;\n                    }\n\n                    if (isSelectedSheet && isInEditMode) {\n                        elementContent.push(element(\"input\", {\n                            type: \"text\",\n                            value: sheet.name(),\n                            className: classNames.sheetsBarKTextbox + EMPTYCHAR + classNames.sheetsBarEditor,\n                            maxlength: 50\n                        }, []));\n                    } else {\n                        elementContent.push(element(\"span\", {\n                            className: classNames.sheetsBarKLink,\n                            title: sheet.name()\n                        }, [dom.text(sheet.name())]));\n\n                        if (sheets.length > 1) {\n                            var deleteIcon = element(\"span\", {\n                                className: classNames.sheetsBarKIcon + EMPTYCHAR + classNames.sheetsBarKFontIcon + EMPTYCHAR + classNames.sheetsBarKIconX\n                            }, []);\n\n                            elementContent.push(element(\"span\", {\n                                className: classNames.sheetsBarKLink + EMPTYCHAR + classNames.sheetsBarRemove,\n                                'data-type': 'remove'\n                            }, [deleteIcon]));\n                        }\n                    }\n\n                    sheetElements.push(element(\"li\", attr, elementContent));\n                }\n\n                this._tree.render([this._addButton(),  this._createSheetsWrapper(sheetElements, renderScrollButtons)]);\n            },\n\n            _createSheetsWrapper: function(sheetElements, renderScrollButtons) {\n                var element = kendo.dom.element;\n                var classNames = SheetsBar.classNames;\n                var itemsWrapper = element('div', { className: 'k-tabstrip-items-wrapper k-hstack' } );\n                var childrenElements = [null, element(\"ul\", {\n                    className: classNames.sheetsBarKReset\n                }, sheetElements), null ];\n\n                renderScrollButtons = true;\n\n                if (renderScrollButtons) {\n                    var baseButtonClass = classNames.sheetsBarKButton + EMPTYCHAR + classNames.sheetsBarKButtonBare + EMPTYCHAR;\n\n                    childrenElements[0] = (element(\"span\", {className: baseButtonClass + classNames.sheetsBarPrev }, [\n                        element(\"span\", {className: \"k-button-icon\" + EMPTYCHAR + classNames.sheetsBarKIcon + EMPTYCHAR + classNames.sheetsBarKArrowW}, [])\n                    ]));\n\n                    childrenElements[2] = (element(\"span\", {className: baseButtonClass + classNames.sheetsBarNext }, [\n                        element(\"span\", {className: \"k-button-icon\" + EMPTYCHAR + classNames.sheetsBarKIcon + EMPTYCHAR + classNames.sheetsBarKArrowE}, [])\n                    ]));\n                }\n\n                itemsWrapper.children = childrenElements;\n\n                return element(\"div\", { className: classNames.sheetsBarItems }, [ itemsWrapper ]);\n            },\n\n            _createSortable: function() {\n                var classNames = SheetsBar.classNames;\n                this._sortable = new kendo.ui.Sortable(this.element, {\n                    filter: kendo.format(\"ul li.{0},ul li.{1}\", classNames.sheetsBarActive, classNames.sheetsBarInactive),\n                    container: DOT + classNames.sheetsBarItems,\n                    axis: \"x\",\n                    animation: false,\n                    ignore: \"input\",\n                    end: function () {\n                        if (this.draggable.hint) {\n                            this.draggable.hint.remove();\n                        }\n                    },\n                    hint: function (element) {\n                        var hint = $(element).clone();\n                        return hint.wrap(\"<div class='\" + classNames.sheetsBarHintWrapper + \"'><ul class='\" + classNames.sheetsBarKResetItems + \"'></ul></div>\").closest(\"div\");\n                    }\n                });\n            },\n\n            _onEditorKeydown: function(e) {\n                if (this._editor) {\n                    if (e.which === 13) {\n                        this._destroyEditor();\n                    }\n\n                    if (e.which === 27) {\n                        this._destroyEditor(true);\n                    }\n                }\n            },\n\n            _onEditorBlur: function() {\n                if (this._editor) {\n                    this._destroyEditor();\n                }\n            },\n\n            _onSheetReorderEnd: function(e) {\n                e.preventDefault();\n                this.trigger(\"reorder\", {oldIndex: e.oldIndex, newIndex: e.newIndex});\n            },\n\n            _onSheetReorderStart: function(e) {\n                if (this._editor) {\n                    e.preventDefault();\n                }\n            },\n\n            _onSheetRemove: function(e) {\n                var removedSheetName = $(e.target).closest(\"li\").text();\n\n                if (this._editor) {\n                    this._destroyEditor();\n                }\n\n                var closeCallback = function(e) {\n                    var dlg = e.sender;\n\n                    if (dlg.isConfirmed()) {\n                        this.trigger(\"remove\", { name: removedSheetName, confirmation: true });\n                    }\n                }.bind(this);\n\n                this._openDialog(\"confirmation\", {\n                    close: closeCallback\n                });\n            },\n\n            _onSheetSelect: function(e) {\n                var selectedSheetText = $(e.target).text();\n\n                if ($(e.target).is(DOT + SheetsBar.classNames.sheetsBarEditor) || !selectedSheetText) {\n                    e.preventDefault();\n                    return;\n                }\n\n                if (this._editor) {\n                    this._destroyEditor();\n                }\n\n                this._scrollSheetsToItem($(e.target).closest(\"li\"));\n\n                this.trigger(\"select\", {name: selectedSheetText, isAddButton: false});\n            },\n\n            _onSheetRename: function(newSheetName) {\n                if (this._sheets[this._selectedIndex].name() === newSheetName || newSheetName === null) {\n                    return;\n                }\n\n                this.trigger(\"rename\", {name: newSheetName, sheetIndex: this._selectedIndex });\n            },\n\n            _onAddSelect: function() {\n                this.trigger(\"select\", {isAddButton: true});\n            },\n\n            _addButton: function() {\n                var element = kendo.dom.element;\n                var classNames = SheetsBar.classNames;\n                return element(\"a\", {\n                    className: classNames.sheetsBarAdd + EMPTYCHAR + classNames.sheetsBarKButton + EMPTYCHAR + classNames.sheetsBarKButtonDefaults\n                }, [element(\"span\", {className: \"k-button-icon\" + EMPTYCHAR + classNames.sheetsBarKIcon + EMPTYCHAR + classNames.sheetsBarKFontIcon + EMPTYCHAR + classNames.sheetsBarKIconPlus}, [])]);\n            },\n\n            destroy: function() {\n                this._sortable.destroy();\n            },\n\n            _scrollableAllowed: function() {\n                var options = this.options;\n                return options.scrollable && !isNaN(options.scrollable.distance);\n            },\n\n            _scrollSheetsToItem: function (item) {\n                var that = this;\n                var sheetsGroup = that._sheetsGroup();\n                var currentScrollOffset = kendo.scrollLeft(sheetsGroup);\n                var itemWidth = outerWidth(item);\n                var itemOffset = that._isRtl ? item.position().left : item.position().left - sheetsGroup.children().first().position().left;\n                var sheetsGroupWidth = sheetsGroup[0].offsetWidth;\n                var itemPosition;\n\n                if (that._isRtl) {\n                    if (itemOffset < 0) {\n                        itemPosition = currentScrollOffset + itemOffset - (sheetsGroupWidth - currentScrollOffset);\n                    } else if (itemOffset + itemWidth > sheetsGroupWidth) {\n                        itemPosition = currentScrollOffset + itemOffset - itemWidth;\n                    }\n                } else {\n                    if (currentScrollOffset + sheetsGroupWidth < itemOffset + itemWidth) {\n                        itemPosition = itemOffset + itemWidth - sheetsGroupWidth;\n                    } else if (currentScrollOffset > itemOffset) {\n                        itemPosition = itemOffset;\n                    }\n                }\n\n                sheetsGroup.finish().animate({ \"scrollLeft\": itemPosition }, \"fast\", \"linear\", function () {\n                    that._toggleScrollButtons();\n                });\n            },\n\n            _sheetsGroup: function() {\n                return this._sheetsWrapper().find(\"ul\");\n            },\n\n            _sheetsWrapper: function() {\n                return this.element.find(DOT + SheetsBar.classNames.sheetsBarItems);\n            },\n\n            _scrollSheetsByDelta: function (delta) {\n                var that = this;\n                var sheetsGroup = that._sheetsGroup();\n                var scrLeft = kendo.scrollLeft(sheetsGroup);\n\n                sheetsGroup.finish().animate({ \"scrollLeft\": scrLeft + delta }, \"fast\", \"linear\", function () {\n                    if (that._nowScrollingSheets) {\n                        that._scrollSheetsByDelta(delta);\n                    } else {\n                        that._toggleScrollButtons();\n                    }\n                });\n            }\n        });\n\n        kendo.spreadsheet.SheetsBar = SheetsBar;\n        $.extend(true, SheetsBar, { classNames: sheetsBarClassNames });\n    })(window.kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n// -*- fill-column: 100 -*-\n\n(function(f, define){\n    define('spreadsheet/calc',[ \"./runtime\" ], f);\n})(function(){\n    \"use strict\";\n\n    // WARNING: removing the following jshint declaration and turning\n    // == into === to make JSHint happy will break functionality.\n\n    var util = kendo.util;\n    var spreadsheet = kendo.spreadsheet;\n    var Ref = spreadsheet.Ref;\n    var RangeRef = spreadsheet.RangeRef;\n    var CellRef = spreadsheet.CellRef;\n    var NameRef = spreadsheet.NameRef;\n    var exports = spreadsheet.calc;\n    var runtime = exports.runtime;\n\n    // Excel formula parser and compiler to JS.\n    // some code adapted from http://lisperator.net/pltut/\n\n    // these two will hold the same operators, except that when the comma is used as decimal\n    // separator, the union operator must be the semicolon (;) instead of comma.\n    var OPERATORS_STANDARD = Object.create(null);\n    var OPERATORS_COMMA = Object.create(null);\n\n    (function(ops){\n        ops.forEach(function(cls, i){\n            cls.forEach(function(op){\n                OPERATORS_STANDARD[op] = ops.length - i;\n                OPERATORS_COMMA[op == \",\" ? \";\" : op] = ops.length - i;\n            });\n        });\n    })([\n        [ \":\" ],\n        [ \" \" ],\n        [ \",\" ],\n        [ \"%\" ],\n        [ \"^\" ],\n        [ \"*\", \"/\" ],\n        [ \"+\", \"-\" ],\n        [ \"&\" ],\n        [ \"=\", \"<\", \">\", \"<=\", \">=\", \"<>\" ]\n    ]);\n\n    var OPERATORS = OPERATORS_STANDARD;\n\n    var SEPARATORS = {\n        DEC: \".\",\n        ARG: \",\",\n        COL: \",\"\n    };\n\n    function setDecimalSeparator(sep) {\n        SEPARATORS.DEC = sep;\n        SEPARATORS.ARG = sep == \",\" ? \";\" : \",\";\n        SEPARATORS.COL = sep == \",\" ? \"\\\\\" : \",\";\n        OPERATORS = sep == \",\" ? OPERATORS_COMMA : OPERATORS_STANDARD;\n    }\n\n    exports.withDecimalSeparator = function(sep, f) {\n        if (SEPARATORS.DEC == sep) {\n            return f();\n        }\n        var save = SEPARATORS.DEC;\n        setDecimalSeparator(sep);\n        try {\n            return f();\n        } finally {\n            setDecimalSeparator(save);\n        }\n    };\n\n    exports._separators = SEPARATORS;\n\n    var ParseError = kendo.Class.extend({\n        init: function ParseError(message, pos) {\n            this.message = message;\n            this.pos = pos;\n        },\n        toString: function() {\n            return this.message;\n        }\n    });\n\n    var TRUE = { type: \"bool\", value: true };\n    var FALSE = { type: \"bool\", value: false };\n\n    function getcol(str) {\n        str = str.toUpperCase();\n        for (var col = 0, i = 0; i < str.length; ++i) {\n            col = col * 26 + str.charCodeAt(i) - 64;\n        }\n        return col - 1;\n    }\n\n    function getrow(str) {\n        return parseInt(str, 10) - 1;\n    }\n\n    function parseReference(name, noThrow) {\n        if (name.toLowerCase() == \"#sheet\") {\n            return spreadsheet.SHEETREF;\n        }\n        OUT: {\n            // this is redundant, but let's keep it fast for the most\n            // common case  A1.  If this fails, we'll try to employ the\n            // whole tokenizer.\n            var m;\n            if ((m = /^(\\$)?([a-z]+)(\\$)?(\\d+)$/i.exec(name))) {\n                var row = getrow(m[4]), col = getcol(m[2]);\n                if (row < 0x100000 && col < 0x4000) {\n                    return new CellRef(getrow(m[4]), getcol(m[2]));\n                }\n                // no NameRef-s from this function\n                break OUT;\n            }\n            var stream = TokenStream(name, {});\n            var a = [];\n            while (true) {\n                var ref = stream.next();\n                if (ref instanceof CellRef) {\n                    // this function always makes absolute references\n                    ref.rel = 0;\n                } else if (ref instanceof RangeRef) {\n                    ref.topLeft.rel = 0;\n                    ref.bottomRight.rel = 0;\n                } else {\n                    break OUT;\n                }\n                a.push(ref);\n                if (stream.eof()) {\n                    break;\n                }\n                if (!stream.is(\"op\", SEPARATORS.ARG)) {\n                    break OUT;\n                }\n                stream.next();\n            }\n            return a.length == 1 ? a[0] : new spreadsheet.UnionRef(a);\n        }\n        if (!noThrow) {\n            throw new Error(\"Cannot parse reference: \" + name);\n        }\n    }\n\n    function parseFormula(sheet, row, col, input) {\n        var refs = [];\n        input = TokenStream(input, { row: row, col: col });\n        var is = input.is;\n\n        return {\n            type: \"exp\",\n            ast: parseExpression(true),\n            refs: refs,\n            sheet: sheet,\n            row: row,\n            col: col\n        };\n\n        function addReference(ref) {\n            ref.index = refs.length;\n            refs.push(ref);\n            return ref;\n        }\n\n        function skip(type, value, allowEOF) {\n            if (is(type, value)) {\n                return input.next();\n            } else {\n                var tok = input.peek();\n                if (tok) {\n                    input.croak(\"Expected \" + type + \" \" + value + \" but found \" + tok.type + \" \" + tok.value + \"\");\n                } else if (!allowEOF) {\n                    input.croak(\"Expected \" + type + \" \" + value + \"\");\n                }\n            }\n        }\n\n        function parseExpression(commas) {\n            return maybeBinary(maybeIntersect(parseAtom()), 0, commas);\n        }\n\n        function parseSymbol(tok) {\n            if (tok.upper == \"TRUE\" || tok.upper == \"FALSE\") {\n                return tok.upper == \"TRUE\" ? TRUE : FALSE;\n            }\n            return addReference(new NameRef(tok.value));\n        }\n\n        function parseFuncall() {\n            var fname = input.next();\n            fname = fname.value;\n            skip(\"punc\", \"(\");\n            var args = [];\n            while (1) {\n                if (is(\"punc\", \")\")) {\n                    break;\n                }\n                if (is(\"op\", SEPARATORS.ARG)) {\n                    args.push({ type: \"null\" });\n                    input.next();\n                    continue;\n                }\n                args.push(parseExpression(false));\n                if (input.eof() || is(\"punc\", \")\")) {\n                    break;\n                }\n                skip(\"op\", SEPARATORS.ARG);\n            }\n            skip(\"punc\", \")\", true);\n            return {\n                type: \"func\",\n                func: fname,\n                args: args\n            };\n        }\n\n        function fixReference(ref) {\n            if (!ref.hasSheet()) {\n                ref.setSheet(sheet);\n            }\n            return addReference(ref);\n        }\n\n        function parseAtom() {\n            var exp;\n            if (is(\"ref\")) {\n                exp = fixReference(input.next());\n            }\n            else if (is(\"func\")) {\n                exp = parseFuncall();\n            }\n            else if (is(\"punc\", \"(\")) {\n                input.next();\n                exp = parseExpression(true);\n                skip(\"punc\", \")\", true);\n            }\n            else if (is(\"punc\", \"{\")) {\n                input.next();\n                exp = parseArray();\n                skip(\"punc\", \"}\", true);\n            }\n            else if (is(\"num\") || is(\"str\") || is(\"error\")) {\n                exp = input.next();\n            }\n            else if (is(\"sym\")) {\n                exp = parseSymbol(input.next());\n            }\n            else if (is(\"op\", \"+\") || is(\"op\", \"-\")) {\n                exp = {\n                    type: \"prefix\",\n                    op: input.next().value,\n                    exp: parseAtom()\n                };\n            }\n            else if (!input.peek()) {\n                input.croak(\"Incomplete expression\");\n            }\n            else if (is(\"punc\", \"[\")) {\n                input.croak(\"External reference not supported\");\n            }\n            else {\n                input.croak(\"Parse error\");\n            }\n            return maybePercent(exp);\n        }\n\n        function parseArray() {\n            var row = [], value = [ row ], first = true;\n            while (!input.eof() && !is(\"punc\", \"}\")) {\n                if (first) {\n                    first = false;\n                } else if (is(null, \";\")) {\n                    value.push(row = []);\n                    input.next();\n                } else {\n                    skip(null, SEPARATORS.COL);\n                }\n                row.push(parseExpression(false));\n            }\n            return {\n                type: \"matrix\",\n                value: value\n            };\n        }\n\n        function maybeIntersect(exp) {\n            if (is(\"punc\", \"(\") || is(\"ref\") || is(\"num\") || is(\"func\")) {\n                return {\n                    type: \"binary\",\n                    op: \" \",\n                    left: exp,\n                    right: parseExpression(false)\n                };\n            } else {\n                return exp;\n            }\n        }\n\n        function maybePercent(exp) {\n            if (is(\"op\", \"%\")) {\n                input.next();\n                return maybePercent({\n                    type: \"postfix\",\n                    op: \"%\",\n                    exp: exp\n                });\n            } else {\n                return exp;\n            }\n        }\n\n        function maybeBinary(left, my_prec, commas) {\n            var tok = is(\"op\");\n            if (tok && (commas || tok.value != SEPARATORS.ARG)) {\n                var his_prec = OPERATORS[tok.value];\n                if (his_prec > my_prec) {\n                    input.next();\n                    var right = maybeBinary(parseAtom(), his_prec, commas);\n                    return maybeBinary({\n                        type: \"binary\",\n                        op: tok.value == \";\" ? \",\" : tok.value, // translate union back to comma\n                        left: left,\n                        right: right\n                    }, my_prec, commas);\n                }\n            }\n            return left;\n        }\n    }\n\n    function parseNameDefinition(name, def) {\n        var nameRef = parseFormula(null, 0, 0, name);\n        if (!(nameRef.ast instanceof NameRef)) {\n            throw new ParseError(\"Invalid name: \" + name);\n        }\n        nameRef = nameRef.ast;\n\n        if (!(def instanceof Ref)) {\n            var defAST = parseFormula(nameRef.sheet, 0, 0, def);\n            if (defAST.ast instanceof Ref) {\n                def = defAST.ast;   // single reference\n            } else if (/^(?:str|num|bool|error)$/.test(defAST.ast.type)) {\n                def = defAST.ast.value; // constant\n            } else {\n                def = makeFormula(defAST); // formula\n            }\n        }\n\n        return {\n            name: nameRef,\n            value: def\n        };\n    }\n\n    var makeClosure = (function(cache){\n        return function(code) {\n            var f = cache[code];\n            if (!f) {\n                f = cache[code] = new Function(\"'use strict';return(\" + code + \")\")();\n            }\n            return f;\n        };\n    })(Object.create(null));\n\n    function makePrinter(exp) {\n        return makeClosure(\"function(row, col, mod){return(\" + print(exp.ast, exp, 0) + \")}\");\n        function print(node, parent, prec) {\n            switch (node.type) {\n              case \"num\":\n                return \"(kendo.spreadsheet.calc._separators.DEC == '.' ? \"\n                    +  JSON.stringify(JSON.stringify(node.value)) + \" : \"\n                    +  JSON.stringify(JSON.stringify(node.value))\n                    +  \".replace('.' , kendo.spreadsheet.calc._separators.DEC))\";\n              case \"bool\":\n                return JSON.stringify(node.value);\n              case \"error\":\n                return JSON.stringify(\"#\" + node.value);\n              case \"str\":\n                return JSON.stringify(JSON.stringify(node.value));\n              case \"ref\":\n                return \"this.refs[\" + node.index + \"].print(row, col, mod)\";\n              case \"prefix\":\n                return withParens(function(){\n                    return JSON.stringify(node.op) + \" + \" + print(node.exp, node, OPERATORS[node.op]);\n                });\n              case \"postfix\":\n                return withParens(function(){\n                    return print(node.exp, node, OPERATORS[node.op]) + \" + \" + JSON.stringify(node.op);\n                });\n              case \"binary\":\n                return withParens(function(){\n                    var left = parenthesize(\n                        print(node.left, node, OPERATORS[node.op]),\n                        node.left instanceof NameRef && node.op == \":\"\n                    );\n                    var right = parenthesize(\n                        print(node.right, node, OPERATORS[node.op]),\n                        node.right instanceof NameRef && node.op == \":\"\n                    );\n                    if (/^[,;]/.test(node.op)) {\n                        return left + \" + kendo.spreadsheet.calc._separators.ARG + \" + right;\n                    } else {\n                        return left + \" + \" + JSON.stringify(node.op) + \" + \" + right;\n                    }\n                });\n              case \"func\":\n                return JSON.stringify(node.func + \"(\") + \" + \"\n                    + (node.args.length > 0\n                       ? node.args.map(function(arg){\n                           return print(arg, node, 0);\n                       }).join(\" + kendo.spreadsheet.calc._separators.ARG + ' ' + \")\n                       : \"''\")\n                    + \" + ')'\";\n              case \"matrix\":\n                return \"'{ ' + \" + node.value.map(function(el){\n                    return el.map(function(el){\n                        return print(el, node, 0);\n                    }).join(\" + kendo.spreadsheet.calc._separators.COL + ' ' + \");\n                }).join(\" + '; ' + \") + \"+ ' }'\";\n              case \"null\":\n                return \"''\";\n            }\n            throw new Error(\"Cannot make printer for node \" + node.type);\n\n            function withParens(f) {\n                var op = node.op;\n                var needParens = (OPERATORS[op] < prec\n                                  || (!prec && op == \",\")\n                                  || (parent.type == \"prefix\" && prec == OPERATORS[op] && parent.op == \"-\")\n                                  || (parent.type == \"binary\" && prec == OPERATORS[op] && node === parent.right));\n                return parenthesize(f(), needParens);\n            }\n        }\n        function parenthesize(code, cond) {\n            return cond ? \"'(' + \" + code + \" + ')'\" : code;\n        }\n    }\n\n    function toCPS(ast, k) {\n        var GENSYM = 0;\n        return cps(ast, k);\n\n        function cps(node, k){\n            switch (node.type) {\n              case \"ref\"     : return cpsRef(node, k);\n              case \"num\"     :\n              case \"str\"     :\n              case \"null\"    :\n              case \"error\"   :\n              case \"bool\"    : return cpsAtom(node, k);\n              case \"prefix\"  :\n              case \"postfix\" : return cpsUnary(node, k);\n              case \"binary\"  : return cpsBinary(node, k);\n              case \"func\"    : return cpsFunc(node, k);\n              case \"lambda\"  : return cpsLambda(node, k);\n              case \"matrix\"  : return cpsMatrix(node.value, k, true);\n            }\n            throw new Error(\"Cannot CPS \" + node.type);\n        }\n\n        function cpsRef(node, k) {\n            return node.ref == \"name\" ? cpsNameRef(node, k) : cpsAtom(node, k);\n        }\n\n        function cpsAtom(node, k) {\n            return k(node);\n        }\n\n        function cpsNameRef(node, k) {\n            return {\n                type: \"func\",\n                func: \",getname\",\n                args: [ makeContinuation(k), node ]\n            };\n        }\n\n        function cpsUnary(node, k) {\n            return cps({\n                type: \"func\",\n                func: \"unary\" + node.op,\n                args: [ node.exp ]\n            }, k);\n        }\n\n        function cpsBinary(node, k) {\n            return cps({\n                type: \"func\",\n                func: \"binary\" + node.op,\n                args: [ node.left, node.right ]\n            }, k);\n        }\n\n        function cpsIf(co, th, el, k) {\n            return cps(co, function(co){\n                // compile THEN and ELSE into a lambda which takes a callback to invoke with the\n                // result of the branches, and the IF itself will become a call the internal \"if\"\n                // function.\n                var rest = makeContinuation(k);\n                var thenK = gensym(\"T\");\n                var elseK = gensym(\"E\");\n                return {\n                    type: \"func\",\n                    func: \"if\",\n                    args: [\n                        rest,\n                        co, // condition\n                        { // then\n                            type: \"lambda\",\n                            vars: [ thenK ],\n                            body: cps(th || TRUE, function(th){\n                                return {\n                                    type: \"call\",\n                                    func: { type: \"var\", name: thenK },\n                                    args: [ th ]\n                                };\n                            })\n                        },\n                        { // else\n                            type: \"lambda\",\n                            vars: [ elseK ],\n                            body: cps(el || FALSE, function(el){\n                                return {\n                                    type: \"call\",\n                                    func: { type: \"var\", name: elseK },\n                                    args: [ el ]\n                                };\n                            })\n                        }\n                    ]\n                };\n            });\n        }\n\n        function cpsAnd(args, k) {\n            if (args.length === 0) {\n                return cpsAtom(TRUE, k);\n            }\n            return cps({\n                type: \"func\",\n                func: \"IF\",\n                args: [\n                    // first item\n                    args[0],\n                    // if true, apply AND for the rest\n                    {\n                        type: \"func\",\n                        func: \"AND\",\n                        args: args.slice(1)\n                    },\n                    // otherwise return false\n                    FALSE\n                ]\n            }, k);\n        }\n\n        function cpsOr(args, k) {\n            if (args.length === 0) {\n                return cpsAtom(FALSE, k);\n            }\n            return cps({\n                type: \"func\",\n                func: \"IF\",\n                args: [\n                    // first item\n                    args[0],\n                    // if true, return true\n                    TRUE,\n                    // otherwise apply OR for the rest\n                    {\n                        type: \"func\",\n                        func: \"OR\",\n                        args: args.slice(1)\n                    }\n                ]\n            }, k);\n        }\n\n        function cpsFunc(node, k) {\n            switch (node.func.toLowerCase()) {\n              case \"if\":\n                return cpsIf(node.args[0], node.args[1], node.args[2], k);\n              case \"and\":\n                return cpsAnd(node.args, k);\n              case \"or\":\n                return cpsOr(node.args, k);\n              case \"true\":\n                return k(TRUE);\n              case \"false\":\n                return k(FALSE);\n            }\n            // actual function\n            return (function loop(args, i){\n                if (i == node.args.length) {\n                    return {\n                        type : \"func\",\n                        func : node.func,\n                        args : args\n                    };\n                }\n                else {\n                    return cps(node.args[i], function(value){\n                        return loop(args.concat([ value ]), i + 1);\n                    });\n                }\n            })([ makeContinuation(k) ], 0);\n        }\n\n        function cpsLambda(node, k) {\n            var cont = gensym(\"K\");\n            var body = cps(node.body, function(body){\n                return { type: \"call\",\n                         func: { type: \"var\", value: cont },\n                         args: [ body ] };\n            });\n            return k({ type: \"lambda\",\n                       vars: [ cont ].concat(node.vars),\n                       body: body });\n        }\n\n        function cpsMatrix(elements, k, isMatrix) {\n            var a = [];\n            return (function loop(i){\n                if (i == elements.length) {\n                    return k({\n                        type: \"matrix\",\n                        value: a\n                    });\n                } else {\n                    return (isMatrix ? cpsMatrix : cps)(elements[i], function(val){\n                        a[i] = val;\n                        return loop(i + 1);\n                    });\n                }\n            })(0);\n        }\n\n        function makeContinuation(k) {\n            var cont = gensym(\"R\");\n            return {\n                type : \"lambda\",\n                vars : [ cont ],\n                body : k({ type: \"var\", name: cont })\n            };\n        }\n\n        function gensym(name) {\n            if (!name) {\n                name = \"\";\n            }\n            name = \"_\" + name;\n            return name + (++GENSYM);\n        }\n    }\n\n    var FORMULA_CACHE = Object.create(null);\n\n    function makeFormula(exp) {\n        var printer = makePrinter(exp);\n        var hash = printer.call(exp); // needs .refs\n        var formula = FORMULA_CACHE[hash];\n        if (formula) {\n            // we need to clone because formulas cache the result; even if the formula is the same,\n            // its value will depend on its location, hence we need different objects.  Still, using\n            // this cache is a good idea because we'll reuse the same refs array, handler and\n            // printer instead of allocating new ones (and we skip compiling it).\n            return formula.clone(exp.sheet, exp.row, exp.col);\n        }\n        var code = js(toCPS(exp.ast, function(ret){\n            return {\n                type: \"return\",\n                value: ret\n            };\n        }));\n\n        code = [\n            \"function(){\",\n            \"var context = this, refs = context.formula.absrefs\",\n            code,\n            \"}\"\n        ].join(\";\\n\");\n\n        formula = new runtime.Formula(exp.refs, makeClosure(code), printer, exp.sheet, exp.row, exp.col);\n        FORMULA_CACHE[hash] = formula.clone(exp.sheet, exp.row, exp.col);\n        return formula;\n\n        function js(node){\n            var type = node.type;\n            if (type == \"num\") {\n                return node.value + \"\";\n            }\n            else if (type == \"str\") {\n                return JSON.stringify(node.value);\n            }\n            else if (type == \"error\") {\n                return \"context.error(\" + JSON.stringify(node.value) + \")\";\n            }\n            else if (type == \"return\") {\n                return \"context.resolve(\" + js(node.value) + \")\";\n            }\n            else if (type == \"func\") {\n                return \"context.func(\" + JSON.stringify(node.func) + \", \"\n                    + js(node.args[0]) + \", \" // the callback\n                    + jsArray(node.args.slice(1)) // the arguments\n                    + \")\";\n            }\n            else if (type == \"call\") {\n                return js(node.func) + \"(\" + node.args.map(js).join(\", \") + \")\";\n            }\n            else if (type == \"ref\") {\n                return \"refs[\" + node.index + \"]\";\n            }\n            else if (type == \"bool\") {\n                return \"\" + node.value;\n            }\n            else if (type == \"if\") {\n                return \"(context.bool(\" + js(node.co) + \") ? \" + js(node.th) + \" : \" + js(node.el) + \")\";\n            }\n            else if (type == \"lambda\") {\n                return \"(function(\"\n                    + node.vars.join(\", \")\n                    + \"){ return(\" + js(node.body) + \") })\";\n            }\n            else if (type == \"var\") {\n                return node.name;\n            }\n            else if (type == \"matrix\") {\n                return jsArray(node.value);\n            }\n            else if (type == \"null\") {\n                return \"null\";\n            }\n            else {\n                throw new Error(\"Cannot compile expression \" + type);\n            }\n        }\n\n        function jsArray(a) {\n            return \"[ \" + a.map(js).join(\", \") + \" ]\";\n        }\n    }\n\n    function identity(x) {\n        return x;\n    }\n\n    function TokenStream(input, options) {\n        input = RawTokenStream(InputStream(input), options);\n        var ahead = input.ahead;\n        var skip = input.skip;\n        var token = null;\n        var fixCell = options.row != null && options.col != null\n            ? function(cell) {\n                if (cell.rel & 1) {\n                    cell.col -= options.col;\n                }\n                if (cell.rel & 2) {\n                    cell.row -= options.row;\n                }\n                return cell;\n            }\n            : identity;\n\n        var addPos = options.forEditor\n            ? function(thing, startToken, endToken) {\n                thing.begin = startToken.begin;\n                thing.end = endToken.end;\n                return thing;\n            }\n            : identity;\n\n        return {\n            peek  : peek,\n            next  : next,\n            croak : input.croak,\n            eof   : input.eof,\n            is    : is\n        };\n\n        function is(type, value) {\n            var tok = peek();\n            return tok != null\n                && (type == null || tok.type === type)\n                && (value == null || tok.value === value)\n                ? tok : null;\n        }\n\n        function peek() {\n            if (token == null) {\n                token = readNext();\n            }\n            return token;\n        }\n\n        function next() {\n            if (token != null) {\n                var tmp = token;\n                token = null;\n                return tmp;\n            }\n            return readNext();\n        }\n\n        function readNext() {\n            var ret;\n            var t = input.peek();\n            if (t) {\n                if (t.type == \"sym\" || t.type == \"rc\" || t.type == \"num\") {\n                    ret =  ahead(8, refRange3D)\n                        || ahead(6, refCell3D)\n                        || ahead(6, refSheetRange)\n                        || ahead(4, refSheetCell)\n                        || ahead(4, refRange)\n                        || ahead(2, refCell)\n                        || ahead(2, funcall);\n                }\n                if (!ret) {\n                    ret = input.next();\n                }\n            }\n            return ret;\n        }\n\n        function toCell(tok, isFirst) {\n            if (tok.type == \"rc\") {\n                // RC notation is read properly without knowing where\n                // we are, so no need to fixCell on this one.\n                // However, if only absolute refs were asked for (from\n                // i.e. parseReference) I feel it's alright to yell\n                // about it here.\n                if (tok.rel && !options.forEditor && (options.row == null || options.col == null)) {\n                    input.croak(\"Cannot read relative cell in RC notation\");\n                }\n                return new CellRef(tok.row, tok.col, tok.rel);\n            }\n            if (tok.type == \"num\") {\n                if (tok.value <= 1048577) {\n                    // whole row\n                    return fixCell(new CellRef(\n                        getrow(tok.value),\n                        isFirst ? -Infinity : +Infinity,\n                        2\n                    ));\n                } else {\n                    return null;\n                }\n            }\n            // otherwise it's \"sym\".  The OOXML spec (SpreadsheetML\n            // 18.2.5) defines the maximum value to be interpreted as\n            // a cell reference to be XFD1048576.\n            var name = tok.value;\n            var m = /^(\\$)?([a-z]+)(\\$)?(\\d+)$/i.exec(name);\n            if (m) {\n                var row = getrow(m[4]), col = getcol(m[2]);\n                if (row <= 1048576 && col <= 16383) {\n                    return fixCell(new CellRef(\n                        getrow(m[4]),\n                        getcol(m[2]),\n                        (m[1] ? 0 : 1) | (m[3] ? 0 : 2)\n                    ));\n                } else {\n                    return null;\n                }\n            }\n            var abs = name.charAt(0) == \"$\";\n            if (abs) {\n                name = name.substr(1);\n            }\n            if (/^\\d+$/.test(name)) {\n                var row = getrow(name);\n                if (row <= 1048576) {\n                    return fixCell(new CellRef(\n                        getrow(name),\n                        isFirst ? -Infinity : +Infinity,\n                        (abs ? 0 : 2)\n                    ));\n                }\n            } else {\n                var col = getcol(name);\n                if (col <= 16383) {\n                    return fixCell(new CellRef(\n                        isFirst ? -Infinity : +Infinity,\n                        getcol(name),\n                        (abs ? 0 : 1)\n                    ));\n                }\n            }\n        }\n\n        // Sheet1(a) :(b) Sheet2(c) !(d) A1(e) :(f) C3(g) not followed by paren (h)\n        function refRange3D(a, b, c, d, e, f, g, h) {\n            if (a.type == \"sym\" &&\n                b.type == \"op\" && b.value == \":\" &&\n                c.type == \"sym\" &&\n                d.type == \"punc\" && d.value == \"!\" &&\n                (e.type == \"sym\" || e.type == \"rc\" || (e.type == \"num\" && e.value == e.value|0)) &&\n                f.type == \"op\" && f.value == \":\" &&\n                (g.type == \"sym\" || g.type == \"rc\" || (g.type == \"num\" && g.value == g.value|0)) &&\n                g.type == e.type &&\n                !(h.type == \"punc\" && h.value == \"(\" && !g.space))\n            {\n                var tl = toCell(e, true), br = toCell(g, false);\n                if (tl && br) {\n                    // skip them except the last one, we only wanted to\n                    // ensure it's not paren.\n                    skip(7);\n                    return addPos(new RangeRef(\n                        tl.setSheet(a.value, true),\n                        br.setSheet(c.value, true)\n                    ).setSheet(a.value, true), a, g);\n                }\n            }\n        }\n\n        // Sheet1(a) :(b) Sheet2(c) !(d) A1(e) not followed by paren (f)\n        function refCell3D(a, b, c, d, e, f) {\n            if (a.type == \"sym\" &&\n                b.type == \"op\" && b.value == \":\" &&\n                c.type == \"sym\" &&\n                d.type == \"punc\" && d.value == \"!\" &&\n                (e.type == \"sym\" || e.type == \"rc\" || (e.type == \"num\" && e.value == e.value|0)) &&\n                !(f.type == \"punc\" && f.value == \"(\" && !e.space))\n            {\n                var tl = toCell(e);\n                if (tl) {\n                    skip(5);\n                    var br = tl.clone();\n                    return addPos(new RangeRef(\n                        tl.setSheet(a.value, true),\n                        br.setSheet(c.value, true)\n                    ).setSheet(a.value, true), a, e);\n                }\n            }\n        }\n\n        // Sheet1(a) !(b) A1(c) :(d) C3(e) not followed by paren (f)\n        function refSheetRange(a, b, c, d, e, f) {\n            if (a.type == \"sym\" &&\n                b.type == \"punc\" && b.value == \"!\" &&\n                (c.type == \"sym\" || c.type == \"rc\" || (c.type == \"num\" && c.value == c.value|0)) &&\n                d.type == \"op\" && d.value == \":\" &&\n                (e.type == \"sym\" || e.type == \"rc\" || (e.type == \"num\" && e.value == e.value|0)) &&\n                !(f.type == \"punc\" && f.value == \"(\" && !e.space))\n            {\n                var tl = toCell(c, true), br = toCell(e, false);\n                if (tl && br) {\n                    skip(5);\n                    return addPos(new RangeRef(tl, br).setSheet(a.value, true), a, e);\n                }\n            }\n        }\n\n        // Sheet1(a) !(b) A1(c) not followed by paren (d)\n        function refSheetCell(a, b, c, d) {\n            if (a.type == \"sym\" &&\n                b.type == \"punc\" && b.value == \"!\" &&\n                (c.type == \"sym\" || c.type == \"rc\" || (c.type == \"num\" && c.value == c.value|0)) &&\n                !(d.type == \"punc\" && d.value == \"(\" && !c.space))\n            {\n                skip(3);\n                var x = toCell(c);\n                if (!x || !isFinite(x.row)) {\n                    x = new NameRef(c.value);\n                }\n                return addPos(x.setSheet(a.value, true), a, c);\n            }\n        }\n\n        // A1(a) :(b) C3(c) not followed by paren (d)\n        function refRange(a, b, c, d) {\n            if ((a.type == \"sym\" || a.type == \"rc\" || (a.type == \"num\" && a.value == a.value|0)) &&\n                (b.type == \"op\" && b.value == \":\") &&\n                (c.type == \"sym\" || c.type == \"rc\" || (c.type == \"num\" && c.value == c.value|0)) &&\n                !(d.type == \"punc\" && d.value == \"(\" && !c.space))\n            {\n                var tl = toCell(a, true), br = toCell(c, false);\n                if (tl && br) {\n                    skip(3);\n                    return addPos(new RangeRef(tl, br), a, c);\n                }\n            }\n        }\n\n        // A1(a) not followed by paren (b)\n        function refCell(a, b) {\n            if ((a.type == \"sym\" || a.type == \"rc\") && !(b.type == \"punc\" && b.value == \"(\" && !a.space)) {\n                var x = toCell(a);\n                if (x && isFinite(x.row) && isFinite(x.col)) {\n                    skip(1);\n                    return addPos(x, a, a);\n                }\n            }\n        }\n\n        function funcall(a, b) {\n            if (a.type == \"sym\" && b.type == \"punc\" && b.value == \"(\" && !a.space) {\n                a.type = \"func\";\n                skip(1);\n                return a;       // already has position\n            }\n        }\n    }\n\n    function isWhitespace(ch) {\n        return \" \\t\\r\\n\\xa0\\u200b\".indexOf(ch) >= 0;\n    }\n\n    var EOF = { type: \"eof\" };\n\n    function RawTokenStream(input, options) {\n        var tokens = [], index = 0;\n        var readWhile = input.readWhile;\n\n        return {\n            next  : next,\n            peek  : peek,\n            eof   : eof,\n            croak : input.croak,\n            ahead : ahead,\n            skip  : skip\n        };\n\n        function isDigit(ch) {\n            return (/[0-9]/i.test(ch));\n        }\n\n        function isIdStart(ch) {\n            return (/[a-z$_]/i.test(ch) || util.isUnicodeLetter(ch));\n        }\n\n        function isId(ch) {\n            return isIdStart(ch) || isDigit(ch) || ch == \".\";\n        }\n\n        function isOpChar(ch) {\n            return ch in OPERATORS;\n        }\n\n        function isPunc(ch) {\n            return \"\\\\!;(){}[]\".indexOf(ch) >= 0;\n        }\n\n        function readNumber() {\n            // XXX: TODO: exponential notation\n            var has_dot = false;\n            var number = readWhile(function(ch){\n                if (ch == SEPARATORS.DEC) {\n                    if (has_dot) {\n                        return false;\n                    }\n                    has_dot = true;\n                    return true;\n                }\n                return isDigit(ch);\n            });\n            if (number == SEPARATORS.DEC) {\n                return { type: \"punc\", value: SEPARATORS.DEC };\n            } else {\n                return { type: \"num\", value: parseFloat(number.replace(SEPARATORS.DEC, \".\")) };\n            }\n        }\n\n        function symbol(id, quote) {\n            return {\n                type  : \"sym\",\n                value : id,\n                upper : id.toUpperCase(),\n                space : isWhitespace(input.peek()),\n                quote : quote\n            };\n        }\n\n        function getRC(a, b, c) {\n            if (!a && !b && !c) {\n                return null;\n            }\n            if ((!a && !c) || (a && c)) {\n                var num = b ? parseInt(b, 10) : 0;\n                return a ? num : num - 1;\n            }\n        }\n\n        function readSymbol() {\n            var m = input.lookingAt(/^R(\\[)?(-?[0-9]+)?(\\])?C(\\[)?(-?[0-9]+)?(\\])?/i);\n            if (m) {\n                var row = getRC(m[1], m[2], m[3]);\n                var col = getRC(m[4], m[5], m[6]);\n                if (row != null && col != null) {\n                    input.skip(m);\n                    return {\n                        type: \"rc\",\n                        row: row,\n                        col: col,\n                        rel: ((m[4] || !(m[4] || m[5] || m[6]) ? 1 : 0) // col\n                              |\n                              (m[1] || !(m[1] || m[2] || m[3]) ? 2 : 0) // row\n                             )\n                    };\n                }\n            }\n            return symbol(readWhile(isId));\n        }\n\n        function readString() {\n            input.next();\n            return { type: \"str\", value: input.readEscaped('\"') };\n        }\n\n        function readSheetName() {\n            input.next();\n            return symbol(input.readEscaped(\"'\"), true);\n        }\n\n        function readOperator() {\n            return {\n                type  : \"op\",\n                value : readWhile(function(ch, op){\n                    return (op + ch) in OPERATORS;\n                })\n            };\n        }\n\n        function readPunc() {\n            return {\n                type  : \"punc\",\n                value : input.next()\n            };\n        }\n\n        function readNext() {\n            if (input.eof()) {\n                return null;\n            }\n            var ch = input.peek(), m;\n            if (ch == '\"') {\n                return readString();\n            }\n            if (ch == \"'\") {\n                return readSheetName();\n            }\n            if (isDigit(ch) || ch == SEPARATORS.DEC) {\n                return readNumber();\n            }\n            if (isIdStart(ch)) {\n                return readSymbol();\n            }\n            if (isOpChar(ch)) {\n                return readOperator();\n            }\n            if (isPunc(ch)) {\n                return readPunc();\n            }\n            if ((m = input.lookingAt(/^#([a-z\\/]+)[?!]?/i))) {\n                input.skip(m);\n                return { type: \"error\", value: m[1] };\n            }\n            if (!options.forEditor) {\n                input.croak(\"Can't handle character with code: \" + ch.charCodeAt(0));\n            }\n            return { type: \"error\", value: input.next() };\n        }\n\n        function peek() {\n            while (tokens.length <= index) {\n                readWhile(isWhitespace);\n                var begin = input.pos();\n                var tok = readNext();\n                if (options.forEditor && tok) {\n                    tok.begin = begin;\n                    tok.end = input.pos();\n                }\n                tokens.push(tok);\n            }\n            return tokens[index];\n        }\n\n        function next() {\n            var tok = peek();\n            if (tok) {\n                index++;\n            }\n            return tok;\n        }\n\n        function ahead(n, f) {\n            var pos = index, a = [];\n            while (n-- > 0) {\n                a.push(next() || EOF);\n            }\n            index = pos;\n            return f.apply(a, a);\n        }\n\n        function skip(n) {\n            index += n;\n        }\n\n        function eof() {\n            return peek() == null;\n        }\n    }\n\n    function InputStream(input) {\n        var pos = 0, line = 1, col = 0;\n        return {\n            next        : next,\n            peek        : peek,\n            eof         : eof,\n            croak       : croak,\n            readWhile   : readWhile,\n            readEscaped : readEscaped,\n            lookingAt   : lookingAt,\n            skip        : skip,\n            forward     : forward,\n            pos         : location\n        };\n        function location() {\n            return pos;\n        }\n        function next() {\n            var ch = input.charAt(pos++);\n            if (ch == \"\\n\") {\n                line++;\n                col = 0;\n            } else {\n                col++;\n            }\n            return ch;\n        }\n        function peek() {\n            return input.charAt(pos);\n        }\n        function eof() {\n            return peek() === \"\";\n        }\n        function croak(msg) {\n            throw new ParseError(msg + \" (input: \" + input + \")\", pos);\n        }\n        function skip(ch) {\n            if (typeof ch == \"string\") {\n                if (input.substr(pos, ch.length) != ch) {\n                    croak(\"Expected \" + ch);\n                }\n                forward(ch.length);\n            } else if (ch instanceof RegExp) {\n                var m = ch.exec(input.substr(pos));\n                if (m) {\n                    forward(m[0].length);\n                    return m;\n                }\n            } else {\n                // assuming RegExp match data\n                forward(ch[0].length);\n            }\n        }\n        function forward(n) {\n            while (n-- > 0) {\n                next();\n            }\n        }\n        function readEscaped(end) {\n            var escaped = false, str = \"\";\n            while (!eof()) {\n                var ch = next();\n                if (escaped) {\n                    str += ch;\n                    escaped = false;\n                } else if (ch == \"\\\\\") {\n                    escaped = true;\n                } else if (ch == end) {\n                    break;\n                } else {\n                    str += ch;\n                }\n            }\n            return str;\n        }\n        function readWhile(predicate) {\n            var str = \"\";\n            while (!eof() && predicate(peek(), str)) {\n                str += next();\n            }\n            return str;\n        }\n        function lookingAt(rx) {\n            return rx.exec(input.substr(pos));\n        }\n    }\n\n    //// exports\n\n    var FORMAT_PARSERS = [];\n\n    var registerFormatParser = exports.registerFormatParser = function(p) {\n        FORMAT_PARSERS.push(p);\n    };\n\n    exports.parse = function(sheet, row, col, input, format) {\n        if (input instanceof Date) {\n            return { type: \"date\", value: runtime.dateToSerial(input) };\n        }\n        if (typeof input == \"number\") {\n            return { type: \"number\", value: input };\n        }\n        if (typeof input == \"boolean\") {\n            return { type: \"boolean\", value: input };\n        }\n        input += \"\";\n        if (/^'/.test(input)) {\n            return {\n                type: \"string\",\n                value: input.substr(1)\n            };\n        }\n        // trivial (integer) percent values; more complex formats are handled below via\n        // registerFormatParser; this case could be dropped completely.\n        if (/^-?[0-9]+%$/.test(input)) {\n            var str = input.substr(0, input.length - 1);\n            var num = parseFloat(str);\n            if (!isNaN(num) && num == str) {\n                return {\n                    type: \"percent\",\n                    value: num / 100\n                };\n            }\n        }\n        if (/^=/.test(input)) {\n            input = input.substr(1);\n            if (/\\S/.test(input)) {\n                return parseFormula(sheet, row, col, input);\n            } else {\n                return {\n                    type: \"string\",\n                    value: \"=\" + input\n                };\n            }\n        }\n        for (var i = 0; i < FORMAT_PARSERS.length; ++i) {\n            var result = FORMAT_PARSERS[i](input);\n            if (result) {\n                return result;\n            }\n        }\n        if (input.toLowerCase() == \"true\") {\n            return { type: \"boolean\", value: true };\n        }\n        if (input.toLowerCase() == \"false\") {\n            return { type: \"boolean\", value: false };\n        }\n        var date = runtime.parseDate(input, format);\n        if (date) {\n            return { type: \"date\", value: runtime.dateToSerial(date) };\n        }\n        var num = parseFloat(input);\n        if (!isNaN(num) && input.length > 0 && num == input) {\n            format = null;\n            if (num != Math.floor(num)) {\n                format = \"0.\" + String(num).split(\".\")[1].replace(/\\d/g, \"0\");\n            }\n            return {\n                type: \"number\",\n                value: num,\n                format: format\n            };\n        }\n        return {\n            type: \"string\",\n            value: input\n        };\n    };\n\n    function tokenize(input, row, col) {\n        var tokens = [];\n        input = TokenStream(input, { forEditor: true, row: row, col: col });\n        while (!input.eof()) {\n            tokens.push(next());\n        }\n        var tok = tokens[0];\n        if (tok.type == \"op\" && tok.value == \"=\") {\n            tok.type = \"startexp\";\n        }\n        return tokens;\n\n        function next() {\n            var tok = input.next();\n            if (tok.type == \"sym\") {\n                if (tok.upper == \"TRUE\") {\n                    tok.type = \"bool\";\n                    tok.value = true;\n                } else if (tok.upper == \"FALSE\") {\n                    tok.type = \"bool\";\n                    tok.value = false;\n                }\n            } else if (tok.type == \"ref\") {\n                tok = {\n                    type  : \"ref\",\n                    ref   : (row != null && col != null ? tok.absolute(row, col) : tok),\n                    begin : tok.begin,\n                    end   : tok.end\n                };\n            }\n            return tok;\n        }\n    }\n\n    // The `sqref` attribute in dataValidation (XLSX) will contain a space-separated list of\n    // references.  This helper is called from excel-reader.js to parse them.\n    function parseSqref(input, row, col) {\n        row = row || 0;\n        col = col || 0;\n        input = TokenStream(input, { row: row, col: col });\n        var refs = [];\n        while (!input.eof()) {\n            var ref = input.next();\n            if (ref.type != \"ref\") {\n                throw new ParseError(\"Expecting a reference but got: \" + JSON.stringify(ref));\n            }\n            refs.push(ref.absolute(row, col));\n        }\n        return refs;\n    }\n\n    exports.parseNameDefinition = parseNameDefinition;\n    exports.parseFormula = parseFormula;\n    exports.parseReference = parseReference;\n    exports.compile = makeFormula;\n    exports.parseSqref = parseSqref;\n\n    exports.InputStream = InputStream;\n    exports.ParseError = ParseError;\n    exports.tokenize = tokenize;\n\n    /* -----[ a few special formats ]----- */\n\n    // various time formats\n    registerFormatParser(function(input){\n        var m, date = 0, format = \"\";\n        // have date part?\n        if ((m = /^(\\d+)([-/.])(\\d+)\\2(\\d{2}(?:\\d{2})?)(\\s*)/.exec(input))) {\n            var mo = parseInt(m[1], 10);\n            var sep = m[2];\n            var da = parseInt(m[3], 10);\n            var yr = parseInt(m[4], 10);\n            if (yr < 30) {\n                yr += 2000;\n            } else if (yr < 100) {\n                yr += 1900;\n            }\n            var monthFirst = true;\n            if (mo > 12) {\n                var tmp = mo;\n                mo = da;\n                da = tmp;\n                monthFirst = false;\n            }\n            if (!runtime.validDate(yr, mo, da)) {\n                return null;\n            }\n            date = runtime.packDate(yr, mo - 1, da);\n            if (date < 0) { date--; }\n            if (monthFirst) {\n                format = [\"mm\", \"dd\", \"yyyy\"].join(sep);\n            } else {\n                format = [\"dd\", \"mm\", \"yyyy\"].join(sep);\n            }\n            format += m[5];\n            input = input.substr(m[0].length); // skip the date\n        }\n        // hh:mm\n        if ((m = /^(\\d+):(\\d+)$/.exec(input))) {\n            var hh = parseInt(m[1], 10);\n            var mm = parseInt(m[2], 10);\n            return {\n                type   : \"date\",\n                format : format + \"hh:mm\",\n                value  : date + runtime.packTime(hh, mm, 0, 0)\n            };\n        }\n        // mm:ss.ms\n        if ((m = /^(\\d+):(\\d+)(\\.\\d+)$/.exec(input))) {\n            var mm = parseInt(m[1], 10);\n            var ss = parseInt(m[2], 10);\n            var ms = parseFloat(m[3]) * 1000;\n            return {\n                type   : \"date\",\n                format : format + \"mm:ss.00\",\n                value  : date + runtime.packTime(0, mm, ss, ms)\n            };\n        }\n        // hh:mm:ss\n        if ((m = /^(\\d+):(\\d+):(\\d+)$/.exec(input))) {\n            var hh = parseInt(m[1], 10);\n            var mm = parseInt(m[2], 10);\n            var ss = parseInt(m[3], 10);\n            return {\n                type   : \"date\",\n                format : format + \"hh:mm:ss\",\n                value  : date + runtime.packTime(hh, mm, ss, 0)\n            };\n        }\n        // hh:mm:ss.ms\n        if ((m = /^(\\d+):(\\d+):(\\d+)(\\.\\d+)$/.exec(input))) {\n            var hh = parseInt(m[1], 10);\n            var mm = parseInt(m[2], 10);\n            var ss = parseInt(m[3], 10);\n            var ms = parseFloat(m[4]) * 1000;\n            return {\n                type   : \"date\",\n                format : format + \"hh:mm:ss.00\",\n                value  : date + runtime.packTime(hh, mm, ss, ms)\n            };\n        }\n    });\n\n    // Support numeric formats with thousands separator and/or currency symbol, like `1,234,567.00`,\n    // `$1234`, `123,456.78 $` etc.  I apologize for this code.\n    registerFormatParser(function(input){\n        var m, n;\n        var culture = kendo.culture();\n        var comma = culture.numberFormat[\",\"];\n        var dot = culture.numberFormat[\".\"];\n        var currency = culture.numberFormat.currency.symbol;\n        var rxnum = getNumberRegexp(comma, dot);\n        var rxcur = new RegExp(\"^\\\\s*\\\\\" + currency + \"\\\\s*\");\n        var sign = 1;\n        var format = \"\";\n        var suffix = \"\";\n        var has_currency = false;\n        var has_percent = false;\n\n        input = InputStream(input.replace(/^\\s+|\\s+$/g, \"\"));\n\n        // has minus before currency?\n        if (input.skip(/^-\\s*/)) {\n            sign = -1;\n        }\n\n        // has currency before number?\n        if ((m = input.skip(rxcur))) {\n            has_currency = true;\n            format += '\"' + m[0] + '\"';\n        }\n\n        // has minus after currency?\n        if (input.skip(/^-\\s*/)) {\n            if (sign < 0) {\n                return null;    // not a number\n            }\n            sign = -1;\n        }\n\n        // read the number itself\n        if (!(n = input.skip(rxnum))) {\n            return null;        // not a number\n        }\n        format += \"0\";\n\n        // has currency after number?\n        if ((m = input.skip(rxcur))) {\n            if (has_currency) {\n                return null;    // either before or after, not both.\n            }\n            has_currency = true;\n            suffix = '\"' + m[0] + '\"';\n        }\n\n        // has percent after number?\n        if (!has_currency && (m = input.skip(/^\\s*%\\s*/))) {\n            has_percent = true;\n            suffix = m[0];      // no quotes this time, % is special in format\n        }\n\n        if (!input.eof()) {\n            return null;        // should anything else follow, not a number\n        }\n\n        if (n[2] || has_currency) {\n            format = format.replace(\"0\", \"#\");\n            format += \",0\";\n        }\n        if (n[3]) {\n            format += \".\" + repeat(\"0\", n[3].length - 1);\n        }\n        var value = n[0]\n            .replace(new RegExp(\"\\\\\" + comma, \"g\"), \"\")\n            .replace(new RegExp(\"\\\\\" + dot, \"g\"), \".\");\n\n        value = parseFloat(value);\n        if (has_percent) {\n            value /= 100;\n        }\n\n        format += suffix;\n        if (has_currency) {\n            format += ';-' + format;\n        }\n\n        return {\n            type: \"number\",\n            currency: has_currency,\n            format: format,\n            value: sign * value\n        };\n    });\n\n    registerFormatParser(function(input){\n        var m;\n        if ((m = /^([0-9]*)\\.([0-9]+)(\\s*%)$/.exec(input))) {\n            return {\n                type: \"number\",\n                value: parseFloat(input) / 100,\n                format: \"0.\" + repeat(\"0\", m[2].length) + m[3]\n            };\n        }\n    });\n\n    var NUMBER_FORMAT_RX = {};\n    function getNumberRegexp(comma, dot) {\n        var id = comma + dot;\n        var rx = NUMBER_FORMAT_RX[id];\n        if (!rx) {\n            rx = \"^(\\\\d+(COM\\\\d{3})*(DOT\\\\d+)?)\";\n            rx = rx.replace(/DOT/g, \"\\\\\" + dot).replace(/COM/g, \"\\\\\" + comma);\n            rx = new RegExp(rx);\n            NUMBER_FORMAT_RX[id] = rx;\n        }\n        return rx;\n    }\n\n    function repeat(str, len) {\n        var out = \"\";\n        while (len-- > 0) {\n            out += str;\n        }\n        return out;\n    }\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/excel-reader',[ \"kendo.core\", \"kendo.color\", \"../util/parse-xml\", \"./calc\" ], f);\n})(function(){\n    \"use strict\";\n\n    /* global JSZip */\n\n    // WARNING: removing the following jshint declaration and turning\n    // == into === to make JSHint happy will break functionality.\n\n\n\n    var $ = kendo.jQuery;\n    var parseXML = kendo.util.parseXML;\n    var parseReference = kendo.spreadsheet.calc.parseReference;\n\n    var MAP_EXCEL_OPERATOR = {\n        // includes only what differs; key is Excel's operator, value\n        // is our operator.\n        greaterThanOrEqual : \"greaterThanOrEqualTo\",\n        lessThanOrEqual    : \"lessThanOrEqualTo\"\n    };\n\n    var ERROR_LOG = null;\n\n    function readExcel(file, workbook, deferred) {\n        var reader = new FileReader();\n        reader.onload = function(e) {\n            var zip = new JSZip(e.target.result);\n            readWorkbook(zip, workbook, deferred);\n        };\n\n        reader.readAsArrayBuffer(file);\n    }\n\n    var SEL_CELL = [\"sheetData\", \"row\", \"c\"];\n    var SEL_COL = [\"cols\", \"col\"];\n    var SEL_DEFINED_NAME = [\"definedNames\", \"definedName\"];\n    var SEL_FORMULA = [\"sheetData\", \"row\", \"c\", \"f\"];\n    var SEL_MERGE = [\"mergeCells\", \"mergeCell\"];\n    var SEL_PANE = [\"sheetViews\", \"sheetView\", \"pane\"];\n    var SEL_ROW = [\"sheetData\", \"row\"];\n    var SEL_SELECTION = [\"sheetViews\", \"sheetView\", \"selection\"];\n    var SEL_SHEET = [\"sheets\", \"sheet\"];\n    var SEL_STRING = [\"sheetData\", \"row\", \"c\", \"is\"];\n    var SEL_TEXT = [\"t\"];\n    var SEL_SHARED_STRING = [\"si\"];\n    var SEL_VALUE = [\"sheetData\", \"row\", \"c\", \"v\"];\n    var SEL_VIEW = [\"bookViews\", \"workbookView\"];\n    var SEL_SHEET_VIEW = [\"sheetViews\", \"sheetView\"];\n    var SEL_HYPERLINK = [\"hyperlinks\", \"hyperlink\"];\n\n    /* A validation section looks like this:\n     *\n     * <dataValidations count=\"1\">\n     *   <dataValidation type=\"list\" allowBlank=\"1\" showInputMessage=\"1\" showErrorMessage=\"1\" sqref=\"B2\">\n     *     <formula1>$E$2:$E$5</formula1>\n     *   </dataValidation>\n     * </dataValidations>\n     */\n    var SEL_VALIDATION = [\"dataValidations\", \"dataValidation\"];\n    var SEL_VALIDATION_FORMULA1 = [\"dataValidations\", \"dataValidation\", \"formula1\"];\n    var SEL_VALIDATION_FORMULA2 = [\"dataValidations\", \"dataValidation\", \"formula2\"];\n\n    /* However, when a validation formula in one sheet references\n     * cells from another sheet, Excel produces this version instead:\n     *\n     * <extLst>\n     *   <ext xmlns:x14=\"http://schemas.microsoft.com/office/spreadsheetml/2009/9/main\" uri=\"{CCE6A557-97BC-4b89-ADB6-D9C93CAAB3DF}\">\n     *     <x14:dataValidations xmlns:xm=\"http://schemas.microsoft.com/office/excel/2006/main\" count=\"1\">\n     *       <x14:dataValidation type=\"list\" allowBlank=\"1\" showInputMessage=\"1\" showErrorMessage=\"1\">\n     *         <x14:formula1>\n     *           <xm:f>Sheet2!$B$3:$B$6</xm:f>\n     *         </x14:formula1>\n     *         <xm:sqref>B1</xm:sqref>\n     *       </x14:dataValidation>\n     *     </x14:dataValidations>\n     *   </ext>\n     * </extLst>\n     *\n     * I call it the \"insane version\", because that's what it is.\n     * Barring the case that the engineers who produced this horror\n     * were on LSD, the only plausible reason for it is that Microsoft\n     * does not want third party software to be compatible with Excel\n     * (sentiment I've had over and over while working on the\n     * Spreadsheet widget).\n     */\n    // XXX: technically, the aliases `x14` and `xm` below could be\n    // different, but Excel seems to be hard-coded on these; our\n    // parser does not support proper namespaces for now anyway, so\n    // hard-coded they are.\n    var SEL_VALIDATION_INSANE = [\"x14:dataValidations\", \"x14:dataValidation\"];\n    var SEL_VALIDATION_SQREF_INSANE = [\"x14:dataValidations\", \"x14:dataValidation\", \"xm:sqref\"];\n    var SEL_VALIDATION_FORMULA1_INSANE = [\"x14:dataValidations\", \"x14:dataValidation\", \"x14:formula1\", \"xm:f\"];\n    var SEL_VALIDATION_FORMULA2_INSANE = [\"x14:dataValidations\", \"x14:dataValidation\", \"x14:formula2\", \"xm:f\"];\n\n    // comment selectors (in files like comments1.xml)\n    var SEL_COMMENT = [\"commentList\", \"comment\"];\n    var SEL_AUTHOR = [\"authors\", \"author\"];\n    var SEL_COMMENT_TEXT = [\"t\"];\n\n    function xl(file) {\n        if (!/^\\//.test(file)) {\n            if (!/^xl\\//.test(file)) {\n                file = \"xl/\" + file;\n            }\n        } else {\n            file = file.substr(1);\n        }\n        return file;\n    }\n\n    function readWorkbook(zip, workbook, progress) {\n        ERROR_LOG = workbook.excelImportErrors = [];\n\n        var strings = readStrings(zip);\n        var relationships = readRelationships(zip, \"_rels/workbook.xml\");\n        var theme = readTheme(zip, relationships.byType.theme[0]);\n        var styles = readStyles(zip, theme);\n        var items = [];\n        var activeSheet = 0;\n\n        parse(zip, \"xl/workbook.xml\", {\n            enter: function(tag, attrs) {\n                if (this.is(SEL_SHEET)) {\n                    var relId = attrs[\"r:id\"];\n                    var file = relationships.byId[relId];\n                    var name = attrs.name;\n                    var dim = sheetDimensions(zip, file);\n\n                    workbook.options.columnWidth = dim.columnWidth || workbook.options.columnWidth;\n                    workbook.options.rowHeight = dim.rowHeight || workbook.options.rowHeight;\n\n                    items.push({\n                        workbook: workbook,\n                        zip: zip,\n                        strings: strings,\n                        styles: styles,\n                        file: file,\n                        options: {\n                            name: name,\n                            rows: Math.max(workbook.options.rows || 0, dim.rows),\n                            columns: Math.max(workbook.options.columns || 0, dim.cols),\n                            columnWidth: dim.columnWidth,\n                            rowHeight: dim.rowHeight\n                        }\n                    });\n                } else if (this.is(SEL_VIEW)) {\n                    if (attrs.activeTab) {\n                        activeSheet = integer(attrs.activeTab);\n                    }\n                }\n            },\n            text: function(text) {\n                var attrs = this.is(SEL_DEFINED_NAME);\n                if (attrs && !(bool(attrs[\"function\"]) || bool(attrs.vbProcedure))) {\n                    var localSheetId = attrs.localSheetId;\n                    var sheet = null;\n                    if (localSheetId != null) {\n                        sheet = items[localSheetId].options.name;\n                    }\n                    var name = attrs.name;\n                    if (name != \"_xlnm._FilterDatabase\") {\n                        if (sheet) {\n                            name = \"'\" + sheet.replace(/\\'/g, \"\\\\'\") + \"'!\" + name;\n                        }\n                        withErrorLog(sheet, null, function(){\n                            workbook.defineName(name, text, bool(attrs.hidden));\n                        }, \"reading user-defined name: \" + name);\n                    }\n                }\n            }\n        });\n\n        var loading = new $.Deferred();\n        loading.progress(function(args) {\n            if (progress) {\n                progress.notify(args);\n            }\n        })\n        .then(function() {\n            var sheets = workbook.sheets();\n            recalcSheets(sheets);\n\n            workbook.activeSheet(sheets[activeSheet]);\n\n            if (progress) {\n                progress.resolve();\n            }\n        });\n\n        loadSheets(items, workbook, loading);\n    }\n\n    function loadSheets(items, workbook, progress) {\n        var ready = (new $.Deferred()).resolve();\n        for (var i = 0; i < items.length; i++) {\n\n            (function(entry, i) {\n                ready = ready.then(function() {\n                    var sheet = workbook.insertSheet(entry.options);\n                    sheet.suspendChanges(true);\n\n                    var promise = queueSheet(sheet, entry);\n                    var args = {\n                        sheet: sheet,\n                        progress: i / (items.length - 1)\n                    };\n\n                    promise.then(function() {\n                        progress.notify(args);\n                    });\n\n                    return promise;\n                });\n            })(items[i], i);\n        }\n\n        ready.then(function() {\n            progress.resolve();\n        });\n    }\n\n    function queueSheet(sheet, ctx) {\n        var deferred = new $.Deferred();\n\n        setTimeout(function() {\n            readSheet(ctx.zip, ctx.file, sheet, ctx.strings, ctx.styles);\n            deferred.resolve();\n        }, 0);\n\n        return deferred;\n    }\n\n    function recalcSheets(sheets) {\n        for (var i = 0; i < sheets.length; i++) {\n            sheets[i]\n                .suspendChanges(false)\n                .triggerChange({ recalc: true });\n        }\n    }\n\n    function sheetDimensions(zip, file) {\n        var ref, dim = {\n            rows: 0,\n            cols: 0\n        };\n\n        parse(zip, xl(file), {\n            enter: function(tag, attrs) {\n                if (tag == \"dimension\") {\n                    ref = parseReference(attrs.ref);\n                    if (ref.bottomRight) {\n                        dim.cols = ref.bottomRight.col + 1;\n                        dim.rows = ref.bottomRight.row + 1;\n                    }\n                } else if (tag === \"sheetFormatPr\") {\n                    if (attrs.defaultColWidth) {\n                        dim.columnWidth = toColWidth(parseFloat(attrs.defaultColWidth));\n                    }\n\n                    if (attrs.defaultRowHeight) {\n                        dim.rowHeight = toRowHeight(parseFloat(attrs.defaultRowHeight));\n                    }\n                } else if (this.is(SEL_ROW) && attrs.r) {\n                    dim.rows = Math.max(dim.rows, +attrs.r);\n                } else if (this.is(SEL_CELL) && attrs.r) {\n                    ref = parseReference(attrs.r);\n                    dim.rows = Math.max(dim.rows, ref.row + 1);\n                    dim.cols = Math.max(dim.cols, ref.col + 1);\n                }\n            }\n        });\n\n        return dim;\n    }\n\n    function toColWidth(size) {\n        // No font to compute agains, hence the magic number\n        var maximumDigitWidth = 7;\n\n        // The formula below is taken from the OOXML spec\n        var fraction = (256 * size + Math.floor(128 / maximumDigitWidth)) / 256;\n        return fraction * maximumDigitWidth;\n    }\n\n    function toRowHeight(pts) {\n        return pts * (4 / 3);\n    }\n\n    function readSheet(zip, file, sheet, strings, styles) {\n        var sharedFormulas = {};\n        var ref, type, value, formula, formulaRange, isArrayFormula;\n        var nCols = sheet._columns._count;\n        var prevCellRef = null;\n        var relsFile = file.replace(/worksheets\\//, \"worksheets/_rels/\");\n        var relationships = readRelationships(zip, relsFile);\n        var formula1, formula2;\n\n        var filterRef;\n        var filterColumn;\n        var customFilterLogic;\n        var customFilterCriteria;\n        var valueFilterBlanks;\n        var valueFilterValues;\n        var filters = [];\n\n        ERROR_LOG = sheet._workbook.excelImportErrors;\n\n        file = xl(file);\n\n        parse(zip, file, {\n            enter: function(tag, attrs, closed) {\n                var tmp;\n                if (this.is(SEL_FORMULA)) {\n                    if (closed) {\n                        if (attrs.t == \"shared\" && attrs.si != null) {\n                            formula = sheet.range(sharedFormulas[attrs.si])._get(\"formula\");\n                        }\n                    }\n                }\n                else if (this.is(SEL_CELL)) {\n                    value = null;\n                    formula = null;\n                    ref = attrs.r;\n                    formulaRange = null;\n\n                    if (ref == null) {\n                        // apparently some tools omit the `r` for\n                        // consecutive cells in a row, so we'll figure\n                        // it out from the previous cell's reference.\n                        // XXX: this could be slightly optimized by\n                        // keeping it parsed instead of stringifying\n                        // it to parse it again later.\n                        ref = parseReference(prevCellRef);\n                        ref.col++;\n                        ref = ref.toString();\n                    }\n                    prevCellRef = ref;\n\n                    // XXX: can't find no type actually, so everything is\n                    // interpreted as string.  Additionally, cells having\n                    // a formula will contain both <f> and <v> nodes,\n                    // which makes the value take precedence because it's\n                    // the second node; hence, the hack is to keep note of\n                    // them in the `text` handler, and apply the\n                    // appropriate one in the `leave` handler below.\n                    type = attrs.t;\n\n                    var styleIndex = attrs.s;\n                    if (styleIndex != null) {\n                        applyStyle(sheet, ref, styles, styleIndex);\n                    }\n                }\n                else if (this.is(SEL_MERGE)) {\n                    sheet.range(attrs.ref).merge();\n                }\n                else if (this.is(SEL_COL)) {\n                    var start = integer(attrs.min) - 1;\n                    var stop = Math.min(nCols, integer(attrs.max)) - 1;\n                    var width;\n                    if (attrs.width) {\n                        width = toColWidth(parseFloat(attrs.width));\n                        if (width !== 0) {\n                            sheet._columns.values.value(start, stop, width);\n                        }\n                    }\n                    if (attrs.hidden === \"1\" || width === 0) {\n                        for (var ci = start; ci <= stop; ci++) {\n                            sheet.hideColumn(ci);\n                        }\n                    }\n                    if (attrs.style != null) {\n                        // apply style on a whole range of columns\n                        applyStyle(sheet, new kendo.spreadsheet.RangeRef(\n                            new kendo.spreadsheet.CellRef(-Infinity, start),\n                            new kendo.spreadsheet.CellRef(+Infinity, stop)\n                        ), styles, attrs.style);\n                    }\n                }\n                else if (this.is(SEL_ROW)) {\n                    var row = integer(attrs.r) - 1;\n                    var height;\n                    if (attrs.ht) {\n                        height = toRowHeight(parseFloat(attrs.ht));\n                        if (height !== 0) {\n                            sheet._rows.values.value(row, row, height);\n                        }\n                    }\n                    if (attrs.hidden === \"1\" || height === 0) {\n                        sheet.hideRow(row);\n                    }\n                }\n                else if (this.is(SEL_SELECTION)) {\n                    if (attrs.activeCell) {\n                        var acRef = parseReference(attrs.activeCell);\n                        sheet.select(acRef, true);\n                    }\n                }\n                else if (this.is(SEL_PANE)) {\n                    if (attrs.state && attrs.state.indexOf(\"frozen\") > -1) {\n                        if (attrs.xSplit) {\n                            sheet.frozenColumns(integer(attrs.xSplit));\n                        }\n\n                        if (attrs.ySplit) {\n                            sheet.frozenRows(integer(attrs.ySplit));\n                        }\n                    }\n                }\n                else if (this.is(SEL_SHEET_VIEW)) {\n                    sheet.showGridLines(bool(attrs.showGridLines, true));\n                }\n                else if (this.is(SEL_HYPERLINK)) {\n                    var relId = attrs[\"r:id\"];\n                    var target = relationships.byId[relId];\n                    if (target) {\n                        sheet.range(attrs.ref).link(target);\n                    }\n                }\n                else if (this.is([\"autoFilter\"])) {\n                    filterRef = attrs.ref;\n                    if (closed) {\n                        addAutoFilter();\n                    }\n                }\n                else if (filterRef) {\n                    if (this.is([\"filterColumn\"])) {\n                        filterColumn = parseInt(attrs.colId, 10);\n                    }\n                    else if (this.is([\"customFilters\"])) {\n                        customFilterLogic = bool(attrs.and) ? \"and\" : \"or\";\n                        customFilterCriteria = [];\n                    }\n                    else if (this.is([\"customFilter\"])) {\n                        tmp = getCustomFilter(attrs.operator, attrs.val);\n                        if (tmp) {\n                            customFilterCriteria.push({\n                                operator: tmp.operator,\n                                value: tmp.value\n                            });\n                        }\n                    }\n                    else if (this.is([\"dynamicFilter\"])) {\n                        filters.push({\n                            column: filterColumn,\n                            filter: new kendo.spreadsheet.DynamicFilter({\n                                type: dynamicFilterType(attrs.type)\n                            })\n                        });\n                    }\n                    else if (this.is([\"top10\"])) {\n                        filters.push({\n                            column: filterColumn,\n                            filter: new kendo.spreadsheet.TopFilter({\n                                value: getFilterVal(attrs.val),\n                                type: (function(percent, top){\n                                    return percent && top ? \"topPercent\"\n                                        :  top ? \"topNumber\"\n                                        :  percent ? \"bottomPercent\"\n                                        :  \"bottomNumber\";\n                                })(bool(attrs.percent), bool(attrs.top))\n                            })\n                        });\n                    }\n                    else if (this.is([\"filters\"])) {\n                        valueFilterBlanks = bool(attrs.blank);\n                        valueFilterValues = [];\n                    }\n                    else if (this.is([\"filter\"])) {\n                        valueFilterValues.push(getFilterVal(attrs.val));\n                    }\n                }\n            },\n            leave: function(tag, attrs) {\n                if (this.is(SEL_FORMULA)) {\n                    if (!formula && attrs.t == \"shared\" && attrs.si != null) {\n                        formula = sheet.range(sharedFormulas[attrs.si])._get(\"formula\");\n                    }\n                }\n                else if (this.is(SEL_CELL)) {\n                    if (formula != null) {\n                        var failed = withErrorLog(sheet, formulaRange || ref, function(){\n                            sheet.range(formulaRange || ref).formula(formula, isArrayFormula);\n                        }, \"parsing formula\");\n                        if (failed) {\n                            sheet.range(formulaRange || ref).value(formula)\n                                .background(\"#ffaaaa\");\n                        }\n                    } else if (value != null) {\n                        var range = sheet.range(ref);\n\n                        if (!range._get(\"formula\")) {\n                            // Check for \"shared\" formulas before applying a value.\n                            if (!type || type == \"n\") {\n                                value = parseFloat(value);\n                            } else if (type == \"s\") {\n                                value = strings[integer(value)];\n                            } else if (type == \"b\") {\n                                value = value === \"1\";\n                            } else if (type == \"d\") {\n                                value = kendo.parseDate(value);\n                            }\n\n                            if (value != null) {\n                                range.value(value);\n                            }\n                        }\n                    }\n                } else if (this.is(SEL_VALIDATION) ||\n                           this.is(SEL_VALIDATION_INSANE)) {\n                    (function(){\n                        var refs = kendo.spreadsheet.calc.parseSqref(attrs.sqref);\n                        var type = attrs.type.toLowerCase();\n                        var operator = attrs.operator;\n                        if (/^(?:whole|decimal)$/.test(type)) {\n                            // we only support \"number\"\n                            type = \"number\";\n                        } else if (type == \"list\") {\n                            // there'll be no operator from Excel for lists\n                            operator = \"list\";\n                        }\n                        if (!operator && /^(?:number|date)$/.test(type)) {\n                            // Excel skips setting the operator for\n                            // \"between\", because why not.\n                            operator = \"between\";\n                        }\n                        refs.forEach(function(ref){\n                            withErrorLog(sheet, ref, function(){\n                                sheet.range(ref).validation({\n                                    type             : bool(attrs.showErrorMessage, true) ? \"reject\" : \"warning\",\n                                    from             : formula1,\n                                    to               : formula2,\n                                    dataType         : type,\n                                    comparerType     : MAP_EXCEL_OPERATOR[operator] || operator,\n                                    allowNulls       : bool(attrs.allowBlank),\n                                    showButton       : bool(attrs.showDropDown) || type == \"date\" || type == \"list\",\n                                    messageTemplate  : attrs.error,\n                                    titleTemplate    : attrs.errorTitle\n                                });\n                            }, \"parsing validation\");\n                        });\n                    })();\n                } else if (tag == \"cols\") {\n                    sheet._columns._refresh();\n                } else if (tag == \"sheetData\") {\n                    sheet._rows._refresh();\n                } else if (tag == \"autoFilter\") {\n                    addAutoFilter();\n                } else if (filterRef) {\n                    if (tag == \"customFilters\") {\n                        filters.push({\n                            column: filterColumn,\n                            filter: new kendo.spreadsheet.CustomFilter({\n                                logic: customFilterLogic,\n                                criteria: customFilterCriteria\n                            })\n                        });\n                    } else if (tag == \"filters\") {\n                        filters.push({\n                            column: filterColumn,\n                            filter: new kendo.spreadsheet.ValueFilter({\n                                values: valueFilterValues,\n                                blanks: valueFilterBlanks\n                            })\n                        });\n                    }\n                }\n            },\n            text: function(text) {\n                var attrs;\n                if (this.is(SEL_VALUE) || this.is(SEL_STRING)) {\n                    value = text;\n                } else if ((attrs = this.is(SEL_FORMULA))) {\n                    formula = text;\n                    isArrayFormula = attrs.t == \"array\";\n                    if (isArrayFormula) {\n                        formulaRange = attrs.ref;\n                    } else if (attrs.t == \"shared\") {\n                        sharedFormulas[attrs.si] = ref;\n                    }\n                } else if (this.is(SEL_VALIDATION_FORMULA1) ||\n                           this.is(SEL_VALIDATION_FORMULA1_INSANE)) {\n                    formula1 = text;\n                } else if (this.is(SEL_VALIDATION_FORMULA2) ||\n                           this.is(SEL_VALIDATION_FORMULA2_INSANE)) {\n                    formula2 = text;\n                } else if (this.is(SEL_VALIDATION_SQREF_INSANE)) {\n                    // put it in <dataValidation>'s attributes where it should be\n                    this.stack[this.stack.length - 2].sqref = text;\n                }\n            }\n        });\n\n        if (relationships.byType.comments) {\n            var commentFile = relative_file(file, relationships.byType.comments[0]);\n            readComments(zip, commentFile, sheet);\n        }\n\n        if (relationships.byType.drawing) {\n            var drawingFile = relative_file(file, relationships.byType.drawing[0]);\n            readDrawings(zip, drawingFile, sheet);\n        }\n\n        function addAutoFilter() {\n            sheet.range(filterRef).filter(filters);\n            filterRef = null;\n        }\n    }\n\n    function getContentType(filename) {\n        var m = /\\.([^.]+)$/.exec(filename);\n        if (m && m[1]) {\n            return {\n                jpg  : \"image/jpeg\",\n                jpeg : \"image/jpeg\",\n                png  : \"image/png\",\n                gif  : \"image/gif\"\n            }[m[1].toLowerCase()];\n        }\n    }\n\n    function getFileName(filename) {\n        var m = /[^/]+$/.exec(filename);\n        return m && m[0];\n    }\n\n    function readDrawings(zip, file, sheet) {\n        var sel_two_cell_anchor = [ \"xdr:twoCellAnchor\" ];\n        var sel_ext = [ \"xdr:ext\" ];\n        var sel_one_cell_anchor = [ \"xdr:oneCellAnchor\" ];\n        var sel_from = [ \"xdr:from\" ];\n        var sel_to = [ \"xdr:to\" ];\n        var sel_row = [ \"xdr:row\" ];\n        var sel_col = [ \"xdr:col\" ];\n        var sel_row_offset = [ \"xdr:rowOff\" ];\n        var sel_col_offset = [ \"xdr:colOff\" ];\n        var sel_blip = [ \"xdr:blipFill\", \"a:blip\" ];\n\n        var relsFile = file.replace(/drawings\\//, \"drawings/_rels/\");\n        var relationships = readRelationships(zip, relsFile);\n\n        if (relationships.byType.image) {\n            Object.keys(relationships.byId).forEach(function(id){\n                var img = relative_file(file, relationships.byId[id]);\n                var type = getContentType(img);\n\n                if (type) {\n                    // XXX: file.asArrayBuffer() is deprecated in JSZip 3\n                    var data = zip.files[img].asArrayBuffer();\n                    var name = getFileName(img);\n                    var blob = name && !(kendo.support.browser.msie || kendo.support.browser.edge)\n                        ? new window.File([ data ], name, { type: type })\n                        : new window.Blob([ data ], { type: type });\n                    relationships.byId[id] = sheet._workbook.addImage(blob);\n                }\n            });\n        }\n\n        var cdr, ref, width, height;\n        parse(zip, file, {\n            enter: function(tag, attrs) {\n                if (this.is(sel_two_cell_anchor) || this.is(sel_one_cell_anchor)) {\n                    cdr = {};\n                }\n                else if (this.is(sel_from) || this.is(sel_to)) {\n                    ref = {};\n                }\n                else if (this.is(sel_blip)) {\n                    var id = attrs[\"r:embed\"];\n                    cdr.image = relationships.byId[id];\n                }\n                else if (this.is(sel_ext)) {\n                    width = excelToPixels(parseFloat(attrs.cx));\n                    height = excelToPixels(parseFloat(attrs.cy));\n                }\n            },\n            leave: function() {\n                if (this.is(sel_from)) {\n                    cdr.topLeftCell = new kendo.spreadsheet.CellRef(ref.row, ref.col);\n                    cdr.offsetX = excelToPixels(ref.colOffset);\n                    cdr.offsetY = excelToPixels(ref.rowOffset);\n                }\n                else if (this.is(sel_to)) {\n                    cdr.brCell = new kendo.spreadsheet.CellRef(ref.row, ref.col);\n                    cdr.brX = excelToPixels(ref.colOffset);\n                    cdr.brY = excelToPixels(ref.rowOffset);\n                }\n                // Add drawing only when it is image\n                else if (this.is(sel_two_cell_anchor) && cdr.image) {\n                    var left = sheet._columns.sum(0, cdr.topLeftCell.col - 1) + cdr.offsetX;\n                    var top = sheet._rows.sum(0, cdr.topLeftCell.row - 1) + cdr.offsetY;\n                    var right = sheet._columns.sum(0, cdr.brCell.col - 1) + cdr.brX;\n                    var bottom = sheet._rows.sum(0, cdr.brCell.row - 1) + cdr.brY;\n\n                    sheet.addDrawing({\n                        topLeftCell : cdr.topLeftCell,\n                        offsetX     : cdr.offsetX,\n                        offsetY     : cdr.offsetY,\n                        width       : width != null ? width : right - left,\n                        height      : height != null ? height : bottom - top,\n                        image       : cdr.image,\n                        opacity     : 1\n                    });\n                }\n                // Add drawing only when it is image\n                else if (this.is(sel_one_cell_anchor) && cdr.image) {\n                    sheet.addDrawing({\n                        topLeftCell : cdr.topLeftCell,\n                        offsetX     : cdr.offsetX,\n                        offsetY     : cdr.offsetY,\n                        width       : width,\n                        height      : height,\n                        image       : cdr.image,\n                        opacity     : 1\n                    });\n                }\n            },\n            text: function(text) {\n                if (this.is(sel_row)) {\n                    ref.row = parseFloat(text);\n                }\n                else if (this.is(sel_col)) {\n                    ref.col = parseFloat(text);\n                }\n                else if (this.is(sel_row_offset)) {\n                    ref.rowOffset = parseFloat(text);\n                }\n                else if (this.is(sel_col_offset)) {\n                    ref.colOffset = parseFloat(text);\n                }\n            }\n        });\n    }\n\n    function readComments(zip, file, sheet) {\n        var authors = [];\n        var author;\n        var comment;\n        parse(zip, file, {\n            enter: function(tag, attrs) {\n                if (this.is(SEL_COMMENT)) {\n                    comment = {\n                        author: authors[attrs.authorId],\n                        ref: attrs.ref,\n                        text: \"\"\n                    };\n                } else if (this.is(SEL_AUTHOR)) {\n                    author = \"\";\n                }\n            },\n            leave: function() {\n                if (this.is(SEL_COMMENT)) {\n                    sheet.range(comment.ref).comment(comment.text);\n                } else if (this.is(SEL_AUTHOR)) {\n                    authors.push(author);\n                }\n            },\n            text: function(text) {\n                if (this.is(SEL_COMMENT_TEXT)) {\n                    comment.text += text;\n                } else if (this.is(SEL_AUTHOR)) {\n                    author += text;\n                }\n            }\n        });\n    }\n\n    function getCustomFilter(op, value) {\n        var ourOp = {\n            equal               : \"eq\",\n            notEqual            : \"ne\",\n            greaterThan         : \"gt\",\n            greaterThanOrEqual  : \"gte\",\n            lessThan            : \"lt\",\n            lessThanOrEqual     : \"lte\"\n        }[op];\n\n        value = getFilterVal(value);\n\n        if (ourOp && typeof value == \"number\") {\n            return { operator: ourOp, value: value };\n        }\n\n        if ((op == \"notEqual\" || !op) && typeof value == \"string\") {\n            // Excel text operators support * and ? wildcards.  Since\n            // our startswith/endswith/contains filters do not, we\n            // can't really use them here, so we'll apply the more\n            // generic \"matches\" and \"doesnotmatch\" filters.\n            return {\n                operator: op ? \"doesnotmatch\" : \"matches\",\n                value: value\n            };\n        }\n    }\n\n    function dynamicFilterType(type) {\n        return {\n            Q1  : \"quarter1\",\n            Q2  : \"quarter2\",\n            Q3  : \"quarter3\",\n            Q4  : \"quarter4\",\n            M1  : \"january\",\n            M2  : \"february\",\n            M3  : \"march\",\n            M4  : \"april\",\n            M5  : \"may\",\n            M6  : \"june\",\n            M7  : \"july\",\n            M8  : \"august\",\n            M9  : \"september\",\n            M10 : \"october\",\n            M11 : \"november\",\n            M12 : \"december\"\n        }[type.toUpperCase()] || type;\n    }\n\n    function getFilterVal(val) {\n        var tmp = parseFloat(val);\n        if (!isNaN(tmp) && tmp == val) {\n            return tmp;\n        }\n        return val;\n    }\n\n    function withErrorLog(sheet, ref, func, context) {\n        try {\n            func();\n            return false;\n        } catch(ex) {\n            var err = { context: context, error: String(ex) };\n            if (sheet && sheet.name) {\n                err.sheet = sheet.name();\n            } else if (sheet) {\n                err.sheet = sheet;\n            }\n            if (ref) {\n                err.location = String(ref);\n            }\n            ERROR_LOG.push(err);\n            return true;\n        }\n    }\n\n    var BORDER_WIDTHS = {\n        \"none\"            : 0,\n        \"thin\"            : 1,\n        \"medium\"          : 2,\n        \"dashed\"          : 1,\n        \"dotted\"          : 1,\n        \"thick\"           : 3,\n        \"double\"          : 3,\n        \"hair\"            : 1,\n        \"mediumDashed\"    : 2,\n        \"dashDot\"         : 1,\n        \"mediumDashDot\"   : 2,\n        \"dashDotDot\"      : 1,\n        \"mediumDashDotDot\": 2,\n        \"slantDashDot\"    : 1\n    };\n\n    var DEFAULT_FORMATS = {\n        0  : \"General\",\n        1  : \"0\",\n        2  : \"0.00\",\n        3  : \"#,##0\",\n        4  : \"#,##0.00\",\n        9  : \"0%\",\n        10 : \"0.00%\",\n        11 : \"0.00E+00\",\n        12 : \"# ?/?\",\n        13 : \"# ??/??\",\n        14 : \"mm-dd-yy\",\n        15 : \"d-mmm-yy\",\n        16 : \"d-mmm\",\n        17 : \"mmm-yy\",\n        18 : \"h:mm AM/PM\",\n        19 : \"h:mm:ss AM/PM\",\n        20 : \"h:mm\",\n        21 : \"h:mm:ss\",\n        22 : \"m/d/yy h:mm\",\n        37 : \"#,##0 ;(#,##0)\",\n        38 : \"#,##0 ;[Red](#,##0)\",\n        39 : \"#,##0.00;(#,##0.00)\",\n        40 : \"#,##0.00;[Red](#,##0.00)\",\n        45 : \"mm:ss\",\n        46 : \"[h]:mm:ss\",\n        47 : \"mmss.0\",\n        48 : \"##0.0E+0\",\n        49 : \"@\"\n    };\n\n    function applyStyle(sheet, ref, styles, styleIndex) {\n        var range = sheet.range(ref);\n        var xf = styles.inlineStyles[styleIndex], base, value;\n        if (xf.xfId) {\n            base = styles.namedStyles[xf.xfId];\n        }\n        if (shouldSet(\"applyBorder\", \"borderId\")) {\n            setBorder(styles.borders[value]);\n        }\n        if (shouldSet(\"applyFont\", \"fontId\")) {\n            setFont(styles.fonts[value]);\n        }\n        if (shouldSet(\"applyAlignment\", \"textAlign\")) {\n            range.textAlign(value);\n        }\n        if (shouldSet(\"applyAlignment\", \"verticalAlign\")) {\n            range.verticalAlign(value);\n        }\n        if (shouldSet(\"applyAlignment\", \"indent\")) {\n            range.indent(value);\n        }\n        if (shouldSet(\"applyAlignment\", \"wrapText\")) {\n            // don't use range.wrap to avoid recomputing row height\n            range._property(\"wrap\", value);\n        }\n        if (shouldSet(\"applyFill\", \"fillId\")) {\n            setFill(styles.fills[value]);\n        }\n        if (shouldSet(\"applyNumberFormat\", \"numFmtId\")) {\n            setFormat(styles.numFmts[value] || DEFAULT_FORMATS[value]);\n        }\n\n        function setFormat(f) {\n            var format = typeof f == \"string\" ? f : f.formatCode;\n            if (format != null && !/^general$/i.test(format)) {\n                // XXX: drop locale info.\n                // http://stackoverflow.com/questions/894805/excel-number-format-what-is-409\n                // not supported by the formatting library.\n                format = format.replace(/^\\[\\$-[0-9]+\\]/, \"\");\n                range.format(format);\n            }\n        }\n\n        function setFill(f) {\n            if (f.type == \"solid\") {\n                range.background(f.color);\n            }\n        }\n\n        function setFont(f) {\n            range.fontFamily(f.name);\n            //range.fontSize(f.size); //XXX: will recalc row height.\n            // converting from points to pixels\n            if (f.size) {\n                range._property(\"fontSize\", f.size * 4 / 3);\n            }\n            if (f.bold) {\n                range.bold(true);\n            }\n            if (f.italic) {\n                range.italic(true);\n            }\n            if (f.underline) {\n                range.underline(true);\n            }\n            if (f.color) {\n                range.color(f.color);\n            }\n        }\n\n        function setBorder(b) {\n            function set(side, prop) {\n                var border = b[side];\n                if (!border) {\n                    return;\n                }\n\n                var width = BORDER_WIDTHS[border.style];\n                if (width === 0) {\n                    return;\n                }\n\n                var color = border.color;\n                if (color == null) {\n                    color = \"#000\";\n                }\n\n                range._property(prop, { size: width, color: color });\n            }\n\n            set(\"left\", \"borderLeft\");\n            set(\"top\", \"borderTop\");\n            set(\"right\", \"borderRight\");\n            set(\"bottom\", \"borderBottom\");\n        }\n\n        function shouldSet(applyName, propName) {\n            var t = xf[applyName];\n            if (t != null && !t) {\n                return false;\n            }\n            value = xf[propName];\n            if (base && value == null) {\n                t = base[applyName];\n                if (t != null && !t) {\n                    return false;\n                }\n                value = base[propName];\n            }\n            return value != null;\n        }\n    }\n\n    function parse(zip, file, callbacks) {\n        var part = zip.files[file];\n        if (part) {\n            parseXML(part.asUint8Array(), callbacks);\n        }\n    }\n\n    function readStrings(zip) {\n        var strings = [];\n        var current = null;\n        parse(zip, \"xl/sharedStrings.xml\", {\n            leave: function() {\n                if (this.is(SEL_SHARED_STRING)) {\n                    strings.push(current);\n                    current = null;\n                }\n            },\n            text: function(text) {\n                if (this.is(SEL_TEXT)) {\n                    if (current == null) {\n                        current = \"\";\n                    }\n                    current += text;\n                }\n            }\n        });\n        return strings;\n    }\n\n    function readRelationships(zip, file) {\n        var map = { byId: {}, byType: { theme: [] } };\n        parse(zip, xl(file) + \".rels\", {\n            enter: function(tag, attrs) {\n                if (tag == \"Relationship\") {\n                    map.byId[attrs.Id] = attrs.Target;\n\n                    var type = attrs.Type.match(/\\w+$/)[0];\n                    var entries = map.byType[type] || [];\n                    entries.push(attrs.Target);\n                    map.byType[type] = entries;\n                }\n            }\n        });\n        return map;\n    }\n\n    var SEL_BORDER = [\"borders\", \"border\"];\n    var SEL_FILL = [\"fills\", \"fill\"];\n    var SEL_FONT = [\"fonts\", \"font\"];\n    var SEL_INLINE_STYLE = [\"cellXfs\", \"xf\"];\n    var SEL_NAMED_STYLE = [\"cellStyleXfs\", \"xf\"];\n    var SEL_NUM_FMT = [\"numFmts\", \"numFmt\"];\n\n    var INDEXED_COLORS = [\n        toCSSColor(\"FF000000\"), toCSSColor(\"FFFFFFFF\"), toCSSColor(\"FFFF0000\"),\n        toCSSColor(\"FF00FF00\"), toCSSColor(\"FF0000FF\"), toCSSColor(\"FFFFFF00\"),\n        toCSSColor(\"FFFF00FF\"), toCSSColor(\"FF00FFFF\"), toCSSColor(\"FF000000\"),\n        toCSSColor(\"FFFFFFFF\"), toCSSColor(\"FFFF0000\"), toCSSColor(\"FF00FF00\"),\n        toCSSColor(\"FF0000FF\"), toCSSColor(\"FFFFFF00\"), toCSSColor(\"FFFF00FF\"),\n        toCSSColor(\"FF00FFFF\"), toCSSColor(\"FF800000\"), toCSSColor(\"FF008000\"),\n        toCSSColor(\"FF000080\"), toCSSColor(\"FF808000\"), toCSSColor(\"FF800080\"),\n        toCSSColor(\"FF008080\"), toCSSColor(\"FFC0C0C0\"), toCSSColor(\"FF808080\"),\n        toCSSColor(\"FF9999FF\"), toCSSColor(\"FF993366\"), toCSSColor(\"FFFFFFCC\"),\n        toCSSColor(\"FFCCFFFF\"), toCSSColor(\"FF660066\"), toCSSColor(\"FFFF8080\"),\n        toCSSColor(\"FF0066CC\"), toCSSColor(\"FFCCCCFF\"), toCSSColor(\"FF000080\"),\n        toCSSColor(\"FFFF00FF\"), toCSSColor(\"FFFFFF00\"), toCSSColor(\"FF00FFFF\"),\n        toCSSColor(\"FF800080\"), toCSSColor(\"FF800000\"), toCSSColor(\"FF008080\"),\n        toCSSColor(\"FF0000FF\"), toCSSColor(\"FF00CCFF\"), toCSSColor(\"FFCCFFFF\"),\n        toCSSColor(\"FFCCFFCC\"), toCSSColor(\"FFFFFF99\"), toCSSColor(\"FF99CCFF\"),\n        toCSSColor(\"FFFF99CC\"), toCSSColor(\"FFCC99FF\"), toCSSColor(\"FFFFCC99\"),\n        toCSSColor(\"FF3366FF\"), toCSSColor(\"FF33CCCC\"), toCSSColor(\"FF99CC00\"),\n        toCSSColor(\"FFFFCC00\"), toCSSColor(\"FFFF9900\"), toCSSColor(\"FFFF6600\"),\n        toCSSColor(\"FF666699\"), toCSSColor(\"FF969696\"), toCSSColor(\"FF003366\"),\n        toCSSColor(\"FF339966\"), toCSSColor(\"FF003300\"), toCSSColor(\"FF333300\"),\n        toCSSColor(\"FF993300\"), toCSSColor(\"FF993366\"), toCSSColor(\"FF333399\"),\n        toCSSColor(\"FF333333\"),\n        toCSSColor(\"FF000000\"), // System Foreground\n        toCSSColor(\"FFFFFFFF\")  // System Background\n    ];\n\n    function readStyles(zip, theme) {\n        var styles = {\n            fonts        : [],\n            numFmts      : {},\n            fills        : [],\n            borders      : [],\n            namedStyles  : [],\n            inlineStyles : []\n        };\n        var font = null;\n        var fill = null;\n        var border = null;\n        var xf = null;\n        parse(zip, \"xl/styles.xml\", {\n            enter: function(tag, attrs, closed) {\n                if (this.is(SEL_NUM_FMT)) {\n                    styles.numFmts[attrs.numFmtId] = attrs;\n                }\n                else if (this.is(SEL_FONT)) {\n                    styles.fonts.push(font = {});\n                    if (closed) {\n                        // apparently, there's XLSX in the wild with\n                        // <font/>, because why not (also, <border/>).\n                        // if we don't null the variable, we always\n                        // enter below and effectively ignore the rest\n                        // of the file.\n                        font = null;\n                    }\n                } else if (font) {\n                    if (tag == \"sz\") {\n                        font.size = parseFloat(attrs.val);\n                    } else if (tag == \"name\") {\n                        font.name = attrs.val;\n                    } else if (tag == \"b\") {\n                        font.bold = bool(attrs.val, true);\n                    } else if (tag == \"i\") {\n                        font.italic = bool(attrs.val, true);\n                    } else if (tag == \"u\") {\n                        font.underline = (attrs.val == null || attrs.val == \"single\");\n                    } else if (tag == \"color\") {\n                        font.color = getColor(attrs, null);\n                    }\n                }\n                else if (this.is(SEL_FILL)) {\n                    styles.fills.push(fill = {});\n                    if (closed) {\n                        fill = null;\n                    }\n                } else if (fill) {\n                    if (tag == \"patternFill\") {\n                        fill.type = attrs.patternType;\n                    } else if (tag == \"fgColor\" && fill.type === \"solid\") {\n                        fill.color = getColor(attrs, INDEXED_COLORS[0]);\n                    } else if (tag == \"bgColor\" && fill.type !== \"solid\") {\n                        fill.color = getColor(attrs, INDEXED_COLORS[0]);\n                    }\n                }\n                else if (this.is(SEL_BORDER)) {\n                    styles.borders.push(border = {});\n                    if (closed) {\n                        border = null;\n                    }\n                } else if (border) {\n                    if (/^(?:left|top|right|bottom)$/.test(tag)) {\n                        border[tag] = { style: attrs.style || \"none\" };\n                    }\n                    if (tag == \"color\") {\n                        var side = this.stack[this.stack.length - 2].$tag;\n                        border[side].color = getColor(attrs, INDEXED_COLORS[0]);\n                    }\n                }\n                else if (this.is(SEL_NAMED_STYLE)) {\n                    xf = getXf(attrs);\n                    styles.namedStyles.push(xf);\n                    if (closed) {\n                        xf = null;\n                    }\n                } else if (this.is(SEL_INLINE_STYLE)) {\n                    xf = getXf(attrs);\n                    styles.inlineStyles.push(xf);\n                    if (closed) {\n                        xf = null;\n                    }\n                } else if (xf) {\n                    if (tag == \"alignment\") {\n                        if (/^(?:left|center|right|justify)$/.test(attrs.horizontal)) {\n                            xf.textAlign = attrs.horizontal;\n                        }\n                        if (/^(?:top|center|bottom)$/.test(attrs.vertical)) {\n                            xf.verticalAlign = attrs.vertical;\n                        }\n                        if (attrs.wrapText != null) {\n                            xf.wrapText = bool(attrs.wrapText);\n                        }\n                        if (attrs.indent != null) {\n                            xf.indent = integer(attrs.indent);\n                        }\n                    }\n                }\n            },\n            leave: function(tag) {\n                if (this.is(SEL_FONT)) {\n                    font = null;\n                } else if (this.is(SEL_FILL)) {\n                    fill = null;\n                } else if (this.is(SEL_BORDER)) {\n                    border = null;\n                } else if (tag == \"xf\") {\n                    xf = null;\n                }\n            }\n        });\n\n        function getXf(attrs) {\n            var xf = {\n                borderId          : integer(attrs.borderId),\n                fillId            : integer(attrs.fillId),\n                fontId            : integer(attrs.fontId),\n                numFmtId          : integer(attrs.numFmtId),\n                pivotButton       : bool(attrs.pivotButton),\n                quotePrefix       : bool(attrs.quotePrefix),\n                xfId              : integer(attrs.xfId)\n            };\n            addBool(\"applyAlignment\");\n            addBool(\"applyBorder\");\n            addBool(\"applyFill\");\n            addBool(\"applyFont\");\n            addBool(\"applyNumberFormat\");\n            addBool(\"applyProtection\");\n            function addBool(name) {\n                if (attrs[name] != null) {\n                    xf[name] = bool(attrs[name]);\n                }\n            }\n            return xf;\n        }\n\n        function getColor(attrs, defaultThemeColor) {\n            if (attrs.rgb) {\n                return toCSSColor(attrs.rgb);\n            } else if (attrs.indexed) {\n                return INDEXED_COLORS[integer(attrs.indexed)];\n            } else if (attrs.theme) {\n                var themeColor = theme.colorScheme[integer(attrs.theme)];\n                if (!themeColor) {\n                    // returning black by default for font color causes\n                    // https://github.com/telerik/kendo-ui-core/issues/5826\n                    // in default cell style, color is undefined\n                    return defaultThemeColor;\n                }\n\n                var color = kendo.parseColor(themeColor);\n\n                if (attrs.tint) {\n                    color = color.toHSL();\n\n                    var tint = parseFloat(attrs.tint);\n                    if (tint < 0) {\n                        color.l = color.l * (1 + tint);\n                    } else {\n                        color.l = color.l * (1 - tint) + (100 - 100 * (1 - tint));\n                    }\n                }\n\n                return color.toCssRgba();\n            }\n        }\n\n        return styles;\n    }\n\n    var SEL_SCHEME_RGBCLR = [\"a:clrScheme\", \"*\", \"a:srgbClr\"];\n    var SEL_SCHEME_SYSCLR = [\"a:clrScheme\", \"*\", \"a:sysClr\"];\n    function readTheme(zip, rel) {\n        var scheme = [];\n        var theme = {\n            colorScheme: scheme\n        };\n\n        var file = xl(rel);\n        if (zip.files[file]) {\n            parse(zip, file, {\n                enter: function(tag, attrs) {\n                    if (this.is(SEL_SCHEME_SYSCLR)) {\n                        scheme.push(toCSSColor(\n                            attrs.val == \"window\" ? \"FFFFFFFF\" : \"FF000000\"\n                        ));\n                    } else if (this.is(SEL_SCHEME_RGBCLR)) {\n                        scheme.push(toCSSColor(\"FF\" + attrs.val));\n                    }\n                }\n            });\n\n            if (scheme.length > 3) {\n                // lt1 <-> dk1\n                swap(scheme, 0, 1);\n                // lt2 <-> dk2\n                swap(scheme, 2, 3);\n            }\n        }\n\n        function swap(arr, a, b) {\n            var tmp = arr[a];\n            arr[a] = arr[b];\n            arr[b] = tmp;\n        }\n\n        return theme;\n    }\n\n    function integer(val) {\n        return val == null ? null : parseInt(val, 10);\n    }\n\n    function bool(val, def) {\n        if (val == null) {\n            return def;\n        }\n        return val == \"true\" || val === true || val == 1;\n    }\n\n    function toCSSColor(rgb) {\n        var m = /^([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(rgb);\n        return \"rgba(\" +\n            parseInt(m[2], 16) + \", \" +\n            parseInt(m[3], 16) + \", \" +\n            parseInt(m[4], 16) + \", \" +\n            parseInt(m[1], 16) / 255 + \")\";\n    }\n\n    function relative_file(base, name) {\n        base = base.split(/\\/+/);\n        name = name.split(/\\/+/);\n        base.pop();\n        while (name.length) {\n            var part = name.shift();\n            if (part === \"\") {\n                base = [];      // absolute\n            } else if (part === \".\") {\n                continue;\n            } else if (part === \"..\") {\n                base.pop();\n            } else {\n                base.push(part);\n            }\n        }\n        return base.join(\"/\");\n    }\n\n    function excelToPixels(val) {\n        return val / 9525;\n    }\n\n    kendo.spreadsheet.readExcel = readExcel;\n    kendo.spreadsheet._readSheet = readSheet;\n    kendo.spreadsheet._readStrings = readStrings;\n    kendo.spreadsheet._readStyles = readStyles;\n    kendo.spreadsheet._readTheme = readTheme;\n    kendo.spreadsheet._readWorkbook = readWorkbook;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/workbook',[ \"kendo.core\", \"./runtime\", \"./references\", \"./excel-reader\" ], f);\n})(function(){\n\n(function(kendo) {\n\n\n\n\n    var $ = kendo.jQuery;\n    var Formula = kendo.spreadsheet.calc.runtime.Formula;\n    var Ref = kendo.spreadsheet.Ref;\n    var CalcError = kendo.spreadsheet.CalcError;\n\n    kendo.spreadsheet.messages.workbook = {\n        defaultSheetName: \"Sheet\"\n    };\n\n    function loadBinary(url, callback) {\n        var xhr = new XMLHttpRequest();\n        xhr.onload = function() {\n            callback(xhr.response, xhr.getResponseHeader(\"Content-Type\"));\n        };\n        xhr.onerror = function() {\n            callback(null);\n        };\n        xhr.open(\"GET\", url);\n        xhr.responseType = \"arraybuffer\";\n        xhr.send();\n    }\n\n    var Workbook = kendo.Observable.extend({\n        options: {},\n\n        init: function(options, view) {\n            kendo.Observable.fn.init.call(this);\n\n            this.options = options;\n\n            this._view = view;\n            this._sheets = [];\n            this._images = {};\n            this._imgID = 0;\n\n            this._sheetsSearchCache = {};\n\n            this._sheet = this.insertSheet({\n                rows: this.options.rows,\n                columns: this.options.columns,\n                rowHeight: this.options.rowHeight,\n                columnWidth: this.options.columnWidth,\n                headerHeight: this.options.headerHeight,\n                headerWidth: this.options.headerWidth,\n                dataSource: this.options.dataSource\n            });\n\n            this.undoRedoStack = new kendo.util.UndoRedoStack();\n            this.undoRedoStack.bind([\"undo\", \"redo\"], this._onUndoRedo.bind(this));\n\n            this._context = new kendo.spreadsheet.FormulaContext(this);\n            this._validationContext = new kendo.spreadsheet.ValidationFormulaContext(this);\n            this._names = Object.create(null);\n\n            this.fromJSON(this.options);\n        },\n\n        clipboard: function() {\n            if(!this._clipboard) {\n                 this._clipboard = new kendo.spreadsheet.Clipboard(this);\n            }\n            return this._clipboard;\n        },\n\n        destroy: function() {\n            this.unbind();\n\n            if (this._clipboard) {\n                this._clipboard.destroy();\n            }\n        },\n\n        events: [\n            \"cut\",\n            \"copy\",\n            \"paste\",\n            \"changing\",\n            \"change\",\n            \"excelImport\",\n            \"excelExport\",\n            \"insertSheet\",\n            \"removeSheet\",\n            \"selectSheet\",\n            \"renameSheet\",\n            \"insertRow\",\n            \"insertColumn\",\n            \"deleteRow\",\n            \"deleteColumn\",\n            \"hideRow\",\n            \"hideColumn\",\n            \"unhideRow\",\n            \"unhideColumn\",\n            \"select\",\n            \"changeFormat\",\n            \"dataBinding\",\n            \"dataBound\",\n            \"progress\"\n        ],\n\n        _sheetChanging: function(e) {\n            if (this.trigger(\"changing\", e)) {\n                e.preventDefault();\n            }\n        },\n\n        _sheetChange: function(e) {\n            this.trigger(\"change\", e);\n        },\n\n        _sheetInsertRow: function(e) {\n            if (this.trigger(\"insertRow\", {\n                sheet: e.sender,\n                index: e.index\n            })) {\n                e.preventDefault();\n            }\n        },\n\n        _sheetInsertColumn: function(e) {\n            if (this.trigger(\"insertColumn\", {\n                sheet: e.sender,\n                index: e.index\n            })) {\n                e.preventDefault();\n            }\n        },\n\n        _sheetDeleteRow: function(e) {\n            if (this.trigger(\"deleteRow\", {\n                sheet: e.sender,\n                index: e.index\n            })) {\n                e.preventDefault();\n            }\n        },\n\n        _sheetDeleteColumn: function(e) {\n            if (this.trigger(\"deleteColumn\", {\n                sheet: e.sender,\n                index: e.index\n            })) {\n                e.preventDefault();\n            }\n        },\n\n        _sheetHideRow: function(e) {\n            if (this.trigger(\"hideRow\", {\n                sheet: e.sender,\n                index: e.index\n            })) {\n                e.preventDefault();\n            }\n        },\n\n        _sheetHideColumn: function(e) {\n            if (this.trigger(\"hideColumn\", {\n                sheet: e.sender,\n                index: e.index\n            })) {\n                e.preventDefault();\n            }\n        },\n\n        _sheetUnhideRow: function(e) {\n            if (this.trigger(\"unhideRow\", {\n                sheet: e.sender,\n                index: e.index\n            })) {\n                e.preventDefault();\n            }\n        },\n\n        _sheetUnhideColumn: function(e) {\n            if (this.trigger(\"unhideColumn\", {\n                sheet: e.sender,\n                index: e.index\n            })) {\n                e.preventDefault();\n            }\n        },\n\n        _sheetSelect: function(e) {\n            this.trigger(\"select\", e);\n        },\n\n        _sheetDataBinding: function(e) {\n            if (this.trigger(\"dataBinding\", {\n                sheet: e.sender\n            })) {\n                e.preventDefault();\n            }\n        },\n\n        _sheetDataBound: function(e) {\n            this.trigger(\"dataBound\", {\n                sheet: e.sender\n            });\n        },\n\n        _sheetProgress: function(e) {\n            var that = this;\n\n            setTimeout(function() {\n                that.trigger(\"progress\", {\n                    toggle: e.toggle\n                });\n            });\n        },\n\n        _sheetCommandRequest: function(e) {\n            this.trigger(\"commandRequest\", e);\n        },\n\n        _inputForRef: function(ref) {\n            var self = this;\n            return self._sheet.withCultureDecimals(function(){\n                return new kendo.spreadsheet.Range(ref, self._sheet).input();\n            });\n        },\n\n        _onUndoRedo: function(e) {\n            e.command.range().select();\n        },\n\n        execute: function(options) {\n            var commandOptions = $.extend({ workbook: this }, options.options);\n            var command = new kendo.spreadsheet[options.command](commandOptions);\n            var sheet = this.activeSheet();\n\n            if (commandOptions.origin) {\n                command.origin(commandOptions.origin);\n            }\n\n            if (commandOptions.operatingRange) {\n                command.range(commandOptions.operatingRange);\n            } else {\n                command.range(sheet.selection());\n            }\n\n            if (commandOptions.editRange) {\n                command._editRange = commandOptions.editRange;\n            }\n\n            var result = command.exec();\n\n            if (!result || result.reason !== \"error\") {\n                if (!command.cannotUndo) {\n                    this.undoRedoStack.push(command);\n                }\n            }\n\n            // when the undo/redo stack is truncated (by e.g. adding a\n            // non-redo command after undoing) it's possible to\n            // discard images from the dropped commands.\n            this.cleanupImages();\n\n            return result;\n        },\n\n        resetFormulas: function() {\n            this._sheets.forEach(function(sheet){\n                sheet.resetFormulas();\n            });\n        },\n\n        resetValidations: function() {\n            this._sheets.forEach(function(sheet){\n                sheet.resetValidations();\n            });\n        },\n\n        refresh: function(reason) {\n            if (reason.recalc) {\n                this.resetFormulas();\n                this.resetValidations();\n                this._sheet.recalc(this._context);\n                this._sheet.revalidate(this._validationContext);\n            }\n        },\n\n        activeSheet: function(sheet) {\n            if (sheet === undefined) {\n                return this._sheet;\n            }\n\n            if (!this.sheetByName(sheet.name())) {\n                return;\n            }\n\n            this._sheet = sheet;\n\n            //TODO: better way to get all reasons?\n            sheet.triggerChange(kendo.spreadsheet.ALL_REASONS);\n        },\n\n        moveSheetToIndex: function(sheet, toIndex) {\n            var fromIndex = this.sheetIndex(sheet);\n            var sheets = this._sheets;\n\n            if (fromIndex === -1) {\n                return;\n            }\n\n            this._sheetsSearchCache = {};\n\n            sheets.splice(toIndex, 0, sheets.splice(fromIndex, 1)[0]);\n\n            this.trigger(\"change\", { sheetSelection: true });\n        },\n\n        insertSheet: function(options) {\n            options = options || {};\n            var that = this;\n            var insertIndex = typeof options.index === \"number\" ? options.index : that._sheets.length;\n            var sheetName;\n            var sheets = that._sheets;\n\n            var getUniqueSheetName = function(sheetNameSuffix) {\n                sheetNameSuffix = sheetNameSuffix ? sheetNameSuffix : 1;\n\n                var name = kendo.spreadsheet.messages.workbook.defaultSheetName + sheetNameSuffix;\n\n                if (!that.sheetByName(name)) {\n                    return name;\n                }\n\n                return getUniqueSheetName(sheetNameSuffix + 1);\n            };\n\n            if (options.name && that.sheetByName(options.name)) {\n                return;\n            }\n\n            this._sheetsSearchCache = {};\n\n            sheetName = options.name || getUniqueSheetName();\n\n            var sheet = new kendo.spreadsheet.Sheet(\n                options.rows || this.options.rows,\n                options.columns || this.options.columns,\n                options.rowHeight || this.options.rowHeight,\n                options.columnWidth || this.options.columnWidth,\n                options.headerHeight || this.options.headerHeight,\n                options.headerWidth || this.options.headerWidth,\n                options.defaultCellStyle || this.options.defaultCellStyle\n            );\n\n            sheet._workbook = this;\n\n            sheet._name(sheetName);\n\n            this._bindSheetEvents(sheet);\n\n            sheets.splice(insertIndex, 0, sheet);\n\n            if (options.data) {\n                sheet.fromJSON(options.data);\n            }\n\n            if (options.dataSource) {\n                sheet.setDataSource(options.dataSource);\n            }\n\n            this.trigger(\"change\", { sheetSelection: true });\n\n            return sheet;\n        },\n\n        _bindSheetEvents: function(sheet) {\n            sheet.bind(\"changing\", this._sheetChanging.bind(this));\n            sheet.bind(\"change\", this._sheetChange.bind(this));\n            sheet.bind(\"insertRow\", this._sheetInsertRow.bind(this));\n            sheet.bind(\"insertColumn\", this._sheetInsertColumn.bind(this));\n            sheet.bind(\"deleteRow\", this._sheetDeleteRow.bind(this));\n            sheet.bind(\"deleteColumn\", this._sheetDeleteColumn.bind(this));\n            sheet.bind(\"hideRow\", this._sheetHideRow.bind(this));\n            sheet.bind(\"hideColumn\", this._sheetHideColumn.bind(this));\n            sheet.bind(\"unhideRow\", this._sheetUnhideRow.bind(this));\n            sheet.bind(\"unhideColumn\", this._sheetUnhideColumn.bind(this));\n            sheet.bind(\"select\", this._sheetSelect.bind(this));\n            sheet.bind(\"commandRequest\", this._sheetCommandRequest.bind(this));\n            sheet.bind(\"dataBinding\", this._sheetDataBinding.bind(this));\n            sheet.bind(\"dataBound\", this._sheetDataBound.bind(this));\n            sheet.bind(\"progress\", this._sheetProgress.bind(this));\n        },\n\n        sheets: function() {\n            return this._sheets.slice();\n        },\n\n        sheetByName: function (sheetName) {\n            return this._sheets[this.sheetIndex(sheetName)];\n        },\n\n        sheetByIndex: function(index) {\n            return this._sheets[index];\n        },\n\n        sheetIndex: function(sheet) {\n            var sheets = this._sheets;\n            var sheetName = (typeof sheet == \"string\" ? sheet : sheet.name()).toLowerCase();\n            var idx = this._sheetsSearchCache[sheetName];\n\n            if (idx >= 0) {\n                return idx;\n            }\n\n            for(idx = 0; idx < sheets.length; idx++) {\n                var name = sheets[idx].name().toLowerCase();\n                this._sheetsSearchCache[name] = idx;\n\n                if (name === sheetName) {\n                    return idx;\n                }\n            }\n\n            return -1;\n        },\n\n        renameSheet: function(sheet, newSheetName) {\n            var oldSheetName = sheet.name().toLowerCase();\n\n            if (!newSheetName ||\n                oldSheetName === newSheetName.toLowerCase() ||\n                this.sheetByName(newSheetName)) {\n                return;\n            }\n\n            sheet = this.sheetByName(oldSheetName);\n\n            if (!sheet) {\n                return;\n            }\n\n            this._sheetsSearchCache = {};\n\n            if (this.trigger(\"renameSheet\", {\n                sheet: sheet,\n                newSheetName: newSheetName\n            })) {\n                return;\n            }\n\n            // update references\n            this._sheets.forEach(function(sheet){\n                sheet._forFormulas(function(formula){\n                    formula.renameSheet(oldSheetName, newSheetName);\n                });\n            });\n\n            this.forEachName(function(def, name){\n                // 1. redefine sheet-local names\n                if (def.nameref.renameSheet(oldSheetName, newSheetName)) {\n                    this.undefineName(name);\n                    def.name = def.nameref.print();\n                    this.nameDefinition(def.name, def);\n                }\n                // 2. if the value is reference or formula, update it\n                if (def.value instanceof Ref || def.value instanceof Formula) {\n                    def.value.renameSheet(oldSheetName, newSheetName);\n                }\n            }.bind(this));\n\n            sheet._name(newSheetName);\n\n            this.trigger(\"change\", { sheetSelection: true });\n\n            return sheet;\n        },\n\n        removeSheet: function(sheet) {\n            var that = this;\n            var sheets = that._sheets;\n            var name = sheet.name();\n            var index = that.sheetIndex(sheet);\n\n            if (sheets.length === 1) {\n                return;\n            }\n\n            if (this.trigger(\"removeSheet\", { sheet: sheet })) {\n                return;\n            }\n\n            this._sheetsSearchCache = {};\n\n            if (index > -1) {\n                sheet.unbind();\n\n                sheets.splice(index, 1);\n\n                if (that.activeSheet().name() === name) {\n                    var newSheet = sheets[index === sheets.length ? index-1 : index];\n                    that.activeSheet(newSheet);\n                } else {\n                    this.trigger(\"change\", { recalc: true,  sheetSelection: true });\n                }\n            }\n        },\n\n        _clearSheets: function() {\n            for (var i = 0; i < this._sheets.length; i++) {\n                this._sheets[i]._activeDrawing = [];\n                this._sheets[i]._drawings = [];\n                this._sheets[i].unbind();\n            }\n            this._sheets = [];\n            this._sheetsSearchCache = {};\n            this._names = {};\n            this._images = {};\n            this._imgID = 0;\n        },\n\n        // _loadImages: function() {\n        //     var self = this;\n        //     var ids = Object.keys(self._images);\n        //     var count = ids.length;\n        //     if (count) {\n        //         ids.forEach(function(id){\n        //             var img = self._images[id];\n        //             if (!img.blob) {\n        //                 loadBinary(img.url, function(data, type) {\n        //                     // XXX: can we do something better in case of error?\n        //                     if (data != null) {\n        //                         img.blob = new Blob([ data ], { type: type });\n        //                         delete img.url;\n        //                     }\n        //                     next();\n        //                 });\n        //             }\n        //         });\n        //     } else {\n        //         next();\n        //     }\n        //     function next() {\n        //         if (--count <= 0) {\n        //             self.activeSheet().triggerChange({ layout: true });\n        //         }\n        //     }\n        // },\n\n        fromJSON: function(json) {\n            if (json.sheets) {\n                this._clearSheets();\n\n                if (json.images) {\n                    this._imgID = 0;\n                    this._images = {};\n                    Object.keys(json.images).forEach(function(id){\n                        if (!isNaN(id)) {\n                            var num = parseFloat(id);\n                            if (isFinite(num)) {\n                                this._imgID = Math.max(this._imgID, num);\n                            }\n                        }\n                        this._images[id] = { url: json.images[id] };\n                    }, this);\n                    // this._loadImages();\n                }\n\n                for (var idx = 0; idx < json.sheets.length; idx++) {\n                    var data = json.sheets[idx];\n                    var args = sheetParamsFromJSON(data, this.options);\n                    var sheet = this.insertSheet({\n                        rows         : args.rowCount,\n                        columns      : args.columnCount,\n                        rowHeight    : args.rowHeight,\n                        columnWidth  : args.columnWidth,\n                        headerHeight : args.headerHeight,\n                        headerWidth  : args.headerWidth,\n                        data         : data\n                    });\n\n                    if (data.dataSource) {\n                        sheet.setDataSource(data.dataSource);\n                    }\n                }\n            }\n\n            if (json.activeSheet) {\n                this.activeSheet(this.sheetByName(json.activeSheet));\n            } else {\n                this.activeSheet(this._sheets[0]);\n            }\n\n            if (json.names) {\n                json.names.forEach(function(def){\n                    this.defineName(def.name, def.value, def.hidden);\n                }, this);\n            }\n        },\n\n        toJSON: function() {\n            this.resetFormulas();\n            this.resetValidations();\n            var names = Object.keys(this._names).map(function(name){\n                var def = this._names[name];\n                var val = def.value;\n                if (val instanceof Ref || val instanceof Formula) {\n                    val = val.print(0, 0, true);\n                } else if (val instanceof CalcError) {\n                    val = val + \"\";\n                } else {\n                    val = JSON.stringify(val);\n                }\n                return {\n                    value     : val,\n                    hidden    : def.hidden,\n                    name      : def.name,\n\n                    // these two are not really useful in\n                    // deserialization, but are handy in OOXML export.\n                    sheet     : def.nameref.sheet,\n                    localName : def.nameref.name\n                };\n            }, this);\n            return {\n                activeSheet: this.activeSheet().name(),\n                sheets: this._sheets.map(function(sheet) {\n                    sheet.recalc(this._context);\n                    sheet.revalidate(this._validationContext);\n                    return sheet.toJSON();\n                }, this),\n                names: names,\n                columnWidth: this.options.columnWidth,\n                rowHeight: this.options.rowHeight\n            };\n        },\n\n        saveJSON: function() {\n            var self = this;\n            var deferred = new $.Deferred();\n            var data = self.toJSON();\n            var ids = Object.keys(self._images).filter(function(id){\n                return self.usesImage(id) === 1;\n            });\n            var count = ids.length;\n            data.images = {};\n            if (count) {\n                ids.forEach(function(id){\n                    var img = self._images[id];\n                    if (img.blob) {\n                        var reader = new FileReader();\n                        reader.onload = function() {\n                            data.images[id] = reader.result;\n                            next();\n                        };\n                        reader.readAsDataURL(img.blob);\n                    } else {\n                        data.images[id] = img.url;\n                        next();\n                    }\n                });\n            } else {\n                next();\n            }\n            return deferred.promise();\n\n            function next() {\n                if (--count <= 0) {\n                    deferred.resolve(data);\n                }\n            }\n        },\n\n        fromFile: function(file) {\n            var deferred = new $.Deferred();\n            var promise = deferred.promise();\n            var args = { file: file, promise: promise };\n\n            if (file && !this.trigger(\"excelImport\", args)) {\n                this._clearSheets();\n                kendo.spreadsheet.readExcel(file, this, deferred);\n            } else {\n                deferred.reject();\n            }\n\n            return promise;\n        },\n\n        saveAsExcel: function(options) {\n            var self = this;\n            options = $.extend({}, self.options.excel, options);\n            var data = self.toJSON();\n\n            if (self.trigger(\"excelExport\", { workbook: data })) {\n                return;\n            }\n\n            var ids = Object.keys(self._images).filter(function(id){\n                return self.usesImage(id) === 1;\n            });\n            var count = ids.length;\n            var images = count ? {} : null;\n            if (count) {\n                ids.forEach(function(id){\n                    var img = self._images[id];\n                    if (img.blob) {\n                        var reader = new FileReader();\n                        reader.onload = function() {\n                            images[id] = {\n                                type: img.blob.type,\n                                name: img.blob.name,\n                                data: reader.result\n                            };\n                            next();\n                        };\n                        reader.readAsArrayBuffer(img.blob);\n                    } else {\n                        loadBinary(img.url, function(data, type){\n                            images[id] = { type: type, data: data };\n                            next();\n                        });\n                    }\n                });\n            } else {\n                next();\n            }\n\n            function next() {\n                if (--count <= 0) {\n                    data.images = images;\n                    var workbook = new kendo.ooxml.Workbook(data);\n                    kendo.saveAs({\n                        dataURI: options.forceProxy ? workbook.toDataURL() : workbook.toBlob(),\n                        fileName: data.fileName || options.fileName,\n                        proxyURL: options.proxyURL,\n                        forceProxy: options.forceProxy\n                    });\n                }\n            }\n        },\n\n        draw: function(options, callback) {\n            if (typeof options == \"function\" && !callback) {\n                callback = options;\n                options = {};\n            }\n            var parts = [], sheets = this._sheets;\n            (function loop(i){\n                if (i < sheets.length) {\n                    sheets[i].draw(kendo.spreadsheet.SHEETREF, options, function(group){\n                        parts.push(group);\n                        loop(i + 1);\n                    });\n                } else {\n                    var group = parts[0];\n                    for (i = 1; i < parts.length; ++i) {\n                        group.children = group.children.concat(parts[i].children);\n                    }\n                    callback(group);\n                }\n            })(0);\n        },\n\n        nameForRef: function(ref, sheet) {\n            if (sheet === undefined) {\n                sheet = ref.sheet;\n            }\n            sheet = sheet.toLowerCase();\n            var str = ref + \"\";\n            for (var name in this._names) {\n                var def = this._names[name];\n                var val = def.value;\n                if (val instanceof Ref) {\n                    if (!val.sheet || (val.sheet && sheet == val.sheet.toLowerCase())) {\n                        if (val + \"\" == str) {\n                            return def;\n                        }\n                    }\n                }\n            }\n            return { name: str };\n        },\n\n        defineName: function(name, value, hidden) {\n            var x = kendo.spreadsheet.calc.parseNameDefinition(name, value);\n            name = x.name.print();\n            this._names[name.toLowerCase()] = {\n                value   : x.value,\n                hidden  : hidden,\n                name    : name,\n                nameref : x.name\n            };\n        },\n\n        undefineName: function(name) {\n            delete this._names[name.toLowerCase()];\n        },\n\n        nameValue: function(name) {\n            name = name.toLowerCase();\n            if (name in this._names) {\n                return this._names[name].value;\n            }\n            return null;\n        },\n\n        nameDefinition: function(name, def) {\n            name = name.toLowerCase();\n            if (arguments.length > 1) {\n                if (def === undefined) {\n                    delete this._names[name];\n                } else {\n                    this._names[name] = def;\n                }\n            }\n            return this._names[name];\n        },\n\n        forEachName: function(func) {\n            Object.keys(this._names).forEach(function(name){\n                func(this._names[name], name);\n            }, this);\n        },\n\n        adjustNames: function(affectedSheet, forRow, start, delta) {\n            affectedSheet = affectedSheet.toLowerCase();\n            Object.keys(this._names).forEach(function(name){\n                var def = this._names[name];\n                var x = def.value;\n                if (x instanceof Ref &&\n                    x.sheet.toLowerCase() == affectedSheet) {\n                    def.value = x.adjust(null, null, null, null, forRow, start, delta);\n                }\n                else if (x instanceof Formula) {\n                    x.adjust(affectedSheet, forRow ? \"row\" : \"col\", start, delta);\n                }\n            }, this);\n        },\n\n        addImage: function(image) {\n            var id = String(++this._imgID);\n            if (typeof image == \"string\") {\n                this._images[id] = { url: image };\n            } else {\n                this._images[id] = { blob: image };\n            }\n            return id;\n        },\n\n        imageUrl: function(id) {\n            var img = this._images[id];\n            var url = img.url;\n            if (!url) {\n                url = img.url = window.URL.createObjectURL(img.blob);\n            }\n            return url;\n        },\n\n        cleanupImages: function() {\n            Object.keys(this._images).forEach(function(id){\n                if (!this.usesImage(id)) {\n                    var url = this._images[id].url;\n                    if (url) {\n                        window.URL.revokeObjectURL(url);\n                    }\n                    delete this._images[id];\n                }\n            }, this);\n        },\n\n        usesImage: function(img) {\n            var i;\n            var sheets = this._sheets;\n            for (i = sheets.length; --i >= 0;) {\n                if (sheets[i].usesImage(img)) {\n                    return 1;\n                }\n            }\n            var stack = this.undoRedoStack.stack;\n            for (i = stack.length; --i >= 0;) {\n                if (stack[i].usesImage(img)) {\n                    return 2; // signal that it's only in the undo stack\n                }\n            }\n            return false;\n        }\n\n    });\n\n    function sheetParamsFromJSON(data, options) {\n        function or(a, b, c) {\n            return a !== undefined ? a : b !== undefined ? b : c;\n        }\n\n        var rowCount     = or(data.rowCount, options.rows, 200),\n            columnCount  = or(data.columnCount, options.columns, 50),\n            rowHeight    = or(data.rowHeight, options.rowHeight, 20),\n            columnWidth  = or(data.columnWidth, options.columnWidth, 64),\n            headerHeight = or(data.headerHeight, options.headerHeight, 20),\n            headerWidth  = or(data.headerWidth, options.headerWidth, 32);\n\n        if (data.rows !== undefined) {\n            for (var i = 0; i < data.rows.length; ++i) {\n                var row = data.rows[i];\n                var ri = or(row.index, i);\n                if (ri >= rowCount) { rowCount = ri + 1; }\n                if (row.cells) {\n                    for (var j = 0; j < row.cells.length; ++j) {\n                        var cell = row.cells[j];\n                        var ci = or(cell.index, j);\n                        if (ci >= columnCount) { columnCount = ci + 1; }\n                    }\n                }\n            }\n        }\n\n        return {\n            rowCount     : rowCount,\n            columnCount  : columnCount,\n            rowHeight    : rowHeight,\n            columnWidth  : columnWidth,\n            headerHeight : headerHeight,\n            headerWidth  : headerWidth\n        };\n    }\n\n    kendo.spreadsheet.Workbook = Workbook;\n    if (kendo.PDFMixin) {\n        kendo.PDFMixin.extend(Workbook.prototype);\n\n        Workbook.prototype.saveAsPDF = function(options) {\n            var progress = new $.Deferred();\n            var promise = progress.promise();\n            var args = { promise: promise };\n            if (this.trigger(\"pdfExport\", args)) {\n                return;\n            }\n\n            this._drawPDF(options, progress)\n            .then(function(root) {\n                return options.forceProxy\n                    ? kendo.pdf.exportPDF(root) // produce data URI for proxy\n                    : kendo.pdf.exportPDFToBlob(root);\n            })\n            .done(function(dataURI) {\n                kendo.saveAs({\n                    dataURI: dataURI,\n                    fileName: options.fileName,\n                    proxyURL: options.proxyURL,\n                    forceProxy: options.forceProxy,\n                    proxyTarget: options.proxyTarget\n                });\n\n                progress.resolve();\n            })\n            .fail(function(err) {\n                progress.reject(err);\n            });\n\n            return promise;\n        };\n\n        Workbook.prototype._drawPDF = function(options) {\n            var result = new $.Deferred();\n            var callback = function(group) {\n                result.resolve(group);\n            };\n            switch(options.area) {\n            case \"workbook\":\n                options.workbook.draw(options, callback);\n                break;\n            case \"sheet\":\n                options.workbook.activeSheet().draw(options, callback);\n                break;\n            case \"selection\":\n                options.workbook.activeSheet().selection().draw(options, callback);\n                break;\n            }\n\n            return result.promise();\n        };\n    }\n})(kendo);\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/formulacontext',[ 'kendo.core' ], f);\n})(function() {\n\n\n\n    var spreadsheet = kendo.spreadsheet;\n    var CellRef = spreadsheet.CellRef;\n    var RangeRef = spreadsheet.RangeRef;\n    var UnionRef = spreadsheet.UnionRef;\n    var NameRef = spreadsheet.NameRef;\n    var Ref = spreadsheet.Ref;\n\n    var FormulaContext = kendo.Class.extend({\n        init: function (workbook) {\n            this.workbook = workbook;\n        },\n\n        getRefCells: function(ref, hiddenInfo, fsheet, frow, fcol, wantNulls) {\n            var sheet, formula, value, i;\n            if (ref instanceof CellRef) {\n                sheet = this.workbook.sheetByName(ref.sheet);\n                if (!sheet || !ref.valid()) {\n                    return [{\n                        value: new kendo.spreadsheet.calc.runtime.CalcError(\"REF\")\n                    }];\n                }\n                formula = sheet.formula(ref);\n                value = sheet.range(ref.row, ref.col).value();\n\n                if (wantNulls || formula != null || value != null) {\n                    return [{\n                        formula: formula,\n                        value: value,\n                        row: ref.row,\n                        col: ref.col,\n                        sheet: ref.sheet,\n                        hidden: hiddenInfo ? (sheet.columnWidth(ref.col) === 0 || sheet.rowHeight(ref.row) === 0) : false\n                    }];\n                } else {\n                    return [];\n                }\n            }\n            if (ref instanceof RangeRef) {\n                i = this.workbook.sheetIndex(ref.sheet);\n                var states = [], n = i;\n                if (ref.endSheet) {\n                    // \"3D\" reference.\n                    n = this.workbook.sheetIndex(ref.endSheet);\n                    if (i > n) {\n                        var tmp = i;\n                        i = n;\n                        n = tmp;\n                    }\n                }\n\n                if (i < 0 || n < 0 || !ref.valid()) {\n                    return [{\n                        value: new kendo.spreadsheet.calc.runtime.CalcError(\"REF\")\n                    }];\n                }\n\n                // XXX: This is nicer, but significantly slower.\n                // Should investigate why, or add some options to make\n                // it faster (i.e. probably because it adds all cell\n                // properties, while we only need value and formula).\n                //\n                //     var add = function(row, col, data){\n                //         data.row = row;\n                //         data.col = col;\n                //         data.sheet = sheet.name();\n                //         states.push(data);\n                //     };\n                //     while (i <= n) {\n                //         sheet = this.workbook.sheetByIndex(i++);\n                //         sheet.forEach(ref, add);\n                //     }\n                //\n                // For now keep doing it \"manually\".\n\n                while (i <= n) {\n                    sheet = this.workbook.sheetByIndex(i++);\n                    var tl = sheet._grid.normalize(ref.topLeft);\n                    var br = sheet._grid.normalize(ref.bottomRight);\n\n                    var startCellIndex = sheet._grid.cellRefIndex(tl);\n                    var endCellIndex = sheet._grid.cellRefIndex(br);\n\n                    var values = sheet._properties.iterator(\"value\", startCellIndex, endCellIndex);\n\n                    for (var col = tl.col; col <= br.col; ++col) {\n                        for (var row = tl.row; row <= br.row; ++row) {\n                            var index = sheet._grid.index(row, col);\n                            formula = sheet._properties.get(\"formula\", index);\n                            value = values.at(index);\n                            if (wantNulls || formula != null || value != null) {\n                                states.push({\n                                    formula : formula,\n                                    value   : value,\n                                    row     : row,\n                                    col     : col,\n                                    sheet   : sheet.name(),\n                                    hidden  : hiddenInfo ? (sheet.columnWidth(col) === 0 || sheet.rowHeight(row) === 0) : false\n                                });\n                            }\n                        }\n                    }\n                }\n\n                return states;\n            }\n            if (ref instanceof UnionRef) {\n                var a = [];\n                for (i = 0; i < ref.refs.length; ++i) {\n                    a = a.concat(this.getRefCells(ref.refs[i], hiddenInfo, fsheet, frow, fcol));\n                }\n                return a;\n            }\n            if (ref instanceof NameRef) {\n                var val = this.nameValue(ref, fsheet, frow, fcol);\n                // XXX: revise this\n                if (val instanceof Ref) {\n                    return this.getRefCells(val, hiddenInfo, fsheet, frow, fcol);\n                }\n                return [{\n                    value: val == null ? new kendo.spreadsheet.calc.runtime.CalcError(\"NAME\") : val\n                }];\n            }\n            return [];\n        },\n\n        isMerged: function(ref) {\n            var sheet = this.workbook.sheetByName(ref.sheet);\n            return sheet.isMerged(ref);\n        },\n\n        nameValue: function(ref, fsheet, frow, fcol) {\n            var val;\n            if (ref.hasSheet()) {\n                // qualified name\n                val = this.workbook.nameValue(this._displayString(ref.print()));\n            } else {\n                // try local name\n                ref = ref.clone().setSheet(fsheet, true);\n                val = this.workbook.nameValue(this._displayString(ref.print()));\n                if (val == null) {\n                    // try global name\n                    val = this.workbook.nameValue(this._displayString(ref.name));\n                }\n            }\n            if (val instanceof Ref) {\n                val = val.absolute(frow, fcol);\n            }\n            return val;\n        },\n\n        getData: function(ref, fsheet, frow, fcol, wantNulls) {\n            var single = ref instanceof CellRef;\n            if (ref instanceof NameRef) {\n                single = this.workbook.nameValue(ref.name) instanceof CellRef;\n            }\n            var data = this.getRefCells(ref, false, fsheet, frow, fcol, wantNulls).map(function(cell){\n                var val = cell.value;\n                if (val instanceof kendo.spreadsheet.calc.runtime.Formula) {\n                    val = val.value;\n                }\n                return val;\n            });\n            return single ? data[0] : data;\n        },\n\n        onFormula: function(f) {\n            var sheet = this.workbook.sheetByName(f.sheet);\n            var row = f.row, col = f.col, value = f.value;\n            var currentFormula = sheet.formula({ row: row, col: col });\n            if (currentFormula !== f) {\n                // could have been deleted or modified in the mean time,\n                // if the formula was asynchronous.  ignore this result.\n                return false;\n            }\n\n            var arrayRange = f.arrayFormulaRange;\n            if (arrayRange) {\n                // `value` will always be a Matrix in this case;\n                // enforced in runtime.js (Context::_resolve).  We\n                // must fill only cells in arrayRange.\n                var tlRow, tlCol;\n                var width = value.width;\n                var height = value.height;\n                sheet.forEach(arrayRange, function(row, col){\n                    if (tlRow === undefined) {\n                        tlRow = row;\n                        tlCol = col;\n                    }\n                    var vrow = row - tlRow;\n                    var vcol = col - tlCol;\n                    var val;\n                    if (vrow < height && vcol < width) {\n                        val = value.get(vrow, vcol);\n                    } else {\n                        val = new kendo.spreadsheet.calc.runtime.CalcError(\"N/A\");\n                    }\n                    sheet._value(row, col, val);\n                });\n            }\n            else {\n                // formulas may return references.  if a range or union,\n                // we'll just save the first cell.\n                if (value instanceof Ref) {\n                    value = this.getData(value, f.sheet, row, col);\n                    if (Array.isArray(value)) {\n                        value = value[0];\n                    }\n                    if (value === undefined) {\n                        value = null; // clear contents\n                    }\n                }\n\n                // when not saved as an array formula, a formula\n                // returning a Matrix will just save the first value.\n                if (value instanceof kendo.spreadsheet.calc.runtime.Matrix) {\n                    value = value.get(0, 0);\n                }\n\n                sheet._value(row, col, value);\n            }\n\n            clearTimeout(sheet._formulaContextRefresh);\n            sheet._formulaContextRefresh = setTimeout(function(){\n                sheet.batch(function(){}, { layout: true });\n            }, 50);\n\n            return true;\n        },\n        _displayString: function(val) {\n            if (/^[a-z_][a-z0-9_]*$/i.test(val)) {\n                return val;\n            }\n            return \"'\" + val.replace(/\\x27/g, \"\\\\'\") + \"'\";\n        }\n    });\n\n    var ValidationFormulaContext = FormulaContext.extend({\n        onFormula: function() {\n            return true;\n        }\n    });\n\n    spreadsheet.FormulaContext = FormulaContext;\n    spreadsheet.ValidationFormulaContext = ValidationFormulaContext;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/controller',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo) {\n    'use strict';\n\n    var $ = kendo.jQuery;\n    var alphaNumRegExp = /:alphanum$/;\n\n    var ACTIONS = {\n        \"up\": \"up\",\n        \"down\": \"down\",\n        \"left\": \"left\",\n        \"right\": \"right\",\n        \"home\": \"first-col\",\n        \"end\": \"last-col\",\n        \"ctrl+left\": \"word-left\",\n        \"ctrl+right\": \"word-right\",\n        \"ctrl+up\": \"word-up\",\n        \"ctrl+down\": \"word-down\",\n        \"ctrl+home\": \"first\",\n        \"ctrl+end\": \"last\",\n        \"pageup\": \"prev-page\",\n        \"pagedown\": \"next-page\"\n    };\n\n    var ENTRY_ACTIONS = {\n        \"tab\": \"next\",\n        \"shift+tab\": \"previous\",\n        \"enter\": \"lower\",\n        \"shift+enter\": \"upper\",\n        \"delete\": \"clearContents\",\n        \"backspace\": \"clearContents\",\n        \"shift+:alphanum\": \"edit\",\n        \"alt+:alphanum\": \"edit\",\n        \":alphanum\": \"edit\",\n        \"ctrl+:alphanum\": \"ctrl\",\n        \"alt+ctrl+:alphanum\": \"edit\",\n        \":edit\": \"edit\"\n    };\n\n    var CONTAINER_EVENTS = {\n        \"wheel\": \"onWheel\",\n        \"*+mousedown\": \"onMouseDown\",\n        \"contextmenu\": \"onContextMenu\",\n        \"*+mousedrag\": \"onMouseDrag\",\n        \"*+mouseup\": \"onMouseUp\",\n        \"*+dblclick\": \"onDblClick\",\n        \"mousemove\": \"onMouseMove\"\n    };\n\n    var CLIPBOARD_EVENTS = {\n        \"pageup\": \"onPageUp\",\n        \"pagedown\": \"onPageDown\",\n        \"mouseup\": \"onMouseUp\",\n        \"*+cut\": \"onCut\",\n        \"*+paste\": \"onPaste\",\n        \"*+copy\": \"onCopy\"\n    };\n\n    var EDITOR_EVENTS = {\n        \"esc\": \"onEditorEsc\",\n        \"enter\": \"onEditorBlur\",\n        \"alt+enter\": \"insertNewline\",\n        \"shift+enter\": \"onEditorBlur\",\n        \"tab\": \"onEditorBlur\",\n        \"shift+tab\": \"onEditorBlur\",\n        \"shift+ctrl+enter\": \"onEditorArrayFormula\"\n    };\n\n    var FORMULABAR_EVENTS = $.extend({ focus: \"onEditorBarFocus\" }, EDITOR_EVENTS);\n    var FORMULAINPUT_EVENTS = $.extend({ focus: \"onEditorCellFocus\" }, EDITOR_EVENTS);\n\n    var SELECTION_MODES = {\n       cell: \"range\",\n       rowheader: \"row\",\n       columnheader: \"column\",\n       topcorner: \"sheet\",\n       autofill: \"autofill\"\n    };\n\n    function toActionSelector(selectors) {\n        return selectors.map(function(action) {\n            return '[data-action=\"' + action + '\"]';\n        }).join(\",\");\n    }\n\n    var COMPOSITE_UNAVAILABLE_ACTION_SELECTORS = toActionSelector([ 'cut', 'copy', 'paste', 'insert-left', 'insert-right', 'insert-above', 'insert-below' ]);\n    var UNHIDE_ACTION_SELECTORS = toActionSelector([ 'unhide-row', 'unhide-column' ]);\n\n    var ACTION_KEYS = [];\n    var SHIFT_ACTION_KEYS = [];\n    var ENTRY_ACTION_KEYS = [];\n\n    for (var key in ACTIONS) {\n        ACTION_KEYS.push(key);\n        SHIFT_ACTION_KEYS.push(\"shift+\" + key);\n    }\n\n    for (key in ENTRY_ACTIONS) {\n        ENTRY_ACTION_KEYS.push(key);\n    }\n\n    CLIPBOARD_EVENTS[ACTION_KEYS] = \"onAction\";\n    CLIPBOARD_EVENTS[SHIFT_ACTION_KEYS] = \"onShiftAction\";\n    CLIPBOARD_EVENTS[ENTRY_ACTION_KEYS] = \"onEntryAction\";\n\n    FORMULAINPUT_EVENTS[ACTION_KEYS] = \"onEditorAction\";\n    FORMULAINPUT_EVENTS[SHIFT_ACTION_KEYS] = \"onEditorShiftAction\";\n\n    var Controller = kendo.Class.extend({\n        init: function(view, workbook) {\n            this.view = view;\n            this.workbook(workbook);\n            this.container = $(view.container);\n            this.clipboardElement = $(view.clipboard);\n            this.cellContextMenu = view.cellContextMenu;\n            this.rowHeaderContextMenu = view.rowHeaderContextMenu;\n            this.colHeaderContextMenu = view.colHeaderContextMenu;\n            this.drawingContextMenu = view.drawingContextMenu;\n            this.scroller = view.scroller;\n            this.tabstrip = view.tabstrip;\n            this.sheetsbar = view.sheetsbar;\n\n            view.nameEditor.bind(\"enter\", this.onNameEditorEnter.bind(this));\n            view.nameEditor.bind(\"cancel\", this.onNameEditorCancel.bind(this));\n            view.nameEditor.bind(\"select\", this.onNameEditorSelect.bind(this));\n            view.nameEditor.bind(\"delete\", this.onNameEditorDelete.bind(this));\n\n            this.editor = view.editor;\n            this.editor.bind(\"change\", this.onEditorChange.bind(this));\n            this.editor.bind(\"activate\", this.onEditorActivate.bind(this));\n            this.editor.bind(\"deactivate\", this.onEditorDeactivate.bind(this));\n            this.editor.bind(\"update\", this.onEditorUpdate.bind(this));\n\n            $(view.scroller).on(\"scroll\", this.onScroll.bind(this));\n            this.listener = new kendo.spreadsheet.EventListener(this.container, this, CONTAINER_EVENTS);\n            $(view.scroller).on(\"mousedown\", this.onMouseDown.bind(this));\n\n            this._enableEditorEvents();\n\n            if (this.sheetsbar) {\n                this.sheetsbar.bind(\"select\", this.onSheetBarSelect.bind(this));\n                this.sheetsbar.bind(\"reorder\", this.onSheetBarReorder.bind(this));\n                this.sheetsbar.bind(\"rename\", this.onSheetBarRename.bind(this));\n                this.sheetsbar.bind(\"remove\", this.onSheetBarRemove.bind(this));\n            }\n\n            this.cellContextMenu.bind(\"select\", this.onContextMenuSelect.bind(this));\n            this.rowHeaderContextMenu.bind(\"select\", this.onContextMenuSelect.bind(this));\n            this.colHeaderContextMenu.bind(\"select\", this.onContextMenuSelect.bind(this));\n            this.drawingContextMenu.bind(\"select\", this.onContextMenuSelect.bind(this));\n\n            // this is necessary for Windows to catch prevent context menu correctly\n            this.cellContextMenu.element\n                .add(this.rowHeaderContextMenu.element)\n                .add(this.colHeaderContextMenu.element)\n                .add(this.drawingContextMenu.element)\n                .on(\"contextmenu\", false);\n\n            if (this.tabstrip) {\n                this.tabstrip.bind(\"action\", this.onCommandRequest.bind(this));\n                this.tabstrip.bind(\"dialog\", this.onDialogRequest.bind(this));\n            }\n        },\n\n        _enableEditorEvents: function (enable) {\n            if (enable === undefined || enable) {\n                this.keyListener = new kendo.spreadsheet.EventListener(this.clipboardElement, this, CLIPBOARD_EVENTS);\n                this.barKeyListener = new kendo.spreadsheet.EventListener(this.editor.barElement(), this, FORMULABAR_EVENTS);\n                this.inputKeyListener = new kendo.spreadsheet.EventListener(this.editor.cellElement(), this, FORMULAINPUT_EVENTS);\n            } else {\n                this.keyListener.destroy();\n                this.barKeyListener.destroy();\n                this.inputKeyListener.destroy();\n            }\n        },\n\n        _execute: function(options) {\n            var result = this._workbook.execute(options);\n\n            if (options.command === \"EditCommand\" && !result) {\n                this._workbook.trigger(\"change\", { editorClose: true });\n            }\n\n            if (result) {\n                this._preventNavigation = true;\n                if (result.reason === \"error\") {\n                    this.editor.deactivate(true); // make sure we don't call any change hooks\n                    this.view.showError(result, function(){\n                        // we only get here in case of a validation error when the user decided to retry.\n                        this.activateEditor(false);\n                        // reset to last input from user\n                        this.editor.value(this._lastEditorValue);\n                        // however, set _value manually such that it'll detect change properly.  ugly :-\\\n                        this.editor._value = this._workbook._inputForRef(this._workbook.activeSheet()._viewActiveCell());\n                        // seems like a nice UX to have the whole input selected\n                        this.editor.select();\n                    }.bind(this));\n                } else {\n                    this.view.openDialog(result.reason);\n                }\n            }\n\n            return result;\n        },\n\n        _activeTooltip: function() {\n            return this._workbook.activeSheet().activeCell().simplify().toString();\n        },\n\n        onContextMenuSelect: function(e) {\n            var action = $(e.item).data(\"action\");\n            var command;\n            switch(action) {\n              case \"cut\":\n                command = { command: \"ToolbarCutCommand\", options: { workbook: this._workbook } };\n                break;\n              case \"copy\":\n                command = { command: \"ToolbarCopyCommand\", options: { workbook: this._workbook } };\n                break;\n              case \"paste\":\n                command = { command: \"ToolbarPasteCommand\", options: { workbook: this._workbook } };\n                break;\n              case \"delete-drawing\":\n                command = { command: \"DeleteDrawingCommand\", options: { drawing: this.navigator._sheet._activeDrawing } };\n                break;\n              case \"bring-to-front\":\n                command = { command: \"BringToFrontCommand\", options: { drawing: this.navigator._sheet._activeDrawing } };\n                break;\n              case \"send-to-back\":\n                command = { command: \"SendToBackCommand\", options: { drawing: this.navigator._sheet._activeDrawing } };\n                break;\n              case \"unmerge\":\n                command = { command: \"MergeCellCommand\", options: { value: \"unmerge\" } };\n                break;\n              case \"merge\":\n                this.view.openDialog(\"merge\");\n                break;\n              case \"hide-row\":\n                command = { command: \"HideLineCommand\", options: { axis: \"row\" } };\n                break;\n              case \"hide-column\":\n                command = { command: \"HideLineCommand\", options: { axis: \"column\" } };\n                break;\n              case \"unhide-row\":\n                command = { command: \"UnHideLineCommand\", options: { axis: \"row\" } };\n                break;\n              case \"unhide-column\":\n                command = { command: \"UnHideLineCommand\", options: { axis: \"column\" } };\n                break;\n              case \"delete-row\":\n                command = { command: \"DeleteRowCommand\" };\n                break;\n              case \"delete-column\":\n                command = { command: \"DeleteColumnCommand\" };\n                break;\n            }\n\n            if (command) {\n                this._execute(command);\n            }\n        },\n\n        onSheetBarRemove: function(e) {\n            var sheet = this._workbook.sheetByName(e.name);\n\n            //TODO: move to model!\n            if (!sheet) {\n                return;\n            }\n\n            this._workbook.removeSheet(sheet);\n        },\n\n        destroy: function() {\n            this.listener.destroy();\n            this._enableEditorEvents(false);\n            this.keyListener.destroy();\n            this.inputKeyListener.destroy();\n        },\n\n        onSheetBarSelect: function(e) {\n            var sheet;\n            var workbook = this._workbook;\n\n            if (e.isAddButton) {\n                if (this._workbook.trigger(\"insertSheet\")) {\n                    return;\n                }\n\n                sheet = workbook.insertSheet();\n            } else {\n                sheet = workbook.sheetByName(e.name);\n            }\n\n            //TODO: move to model\n            if (workbook.activeSheet().name() !== sheet.name()) {\n                if (this._workbook.trigger(\"selectSheet\", { sheet: sheet })) {\n                    return;\n                }\n\n                if (!this.editor.canInsertRef(false)) {\n                    this.editor.deactivate();\n                }\n\n                workbook.activeSheet(sheet);\n            }\n        },\n\n        onSheetBarReorder: function(e) {\n            var workbook = this._workbook;\n            var sheet = workbook.sheetByIndex(e.oldIndex);\n            var activeSheet = workbook.activeSheet();\n            var activeSheetName = activeSheet.name();\n\n            workbook.moveSheetToIndex(sheet, e.newIndex);\n\n            if (activeSheetName !== sheet.name()) {\n                if (workbook.trigger(\"selectSheet\", { sheet: sheet })) {\n                    workbook.activeSheet(activeSheet);\n                    return;\n                }\n\n                if (!this.editor.canInsertRef(false)) {\n                    this.editor.deactivate();\n                }\n\n                workbook.activeSheet(sheet);\n            }\n        },\n\n        onSheetBarRename: function(e) {\n            var sheet = this._workbook.sheetByIndex(e.sheetIndex);\n\n            if (this._workbook.sheetByName(e.name)) {\n                this.view.showError({ reason: \"error\", type: \"duplicateSheetName\" });\n                return;\n            }\n\n            this._workbook.renameSheet(sheet, e.name);\n\n            this.clipboardElement.focus();\n        },\n\n        sheet: function(sheet) {\n            this.navigator = sheet.navigator();\n            this.axisManager = sheet.axisManager();\n        },\n\n        workbook: function(workbook) {\n            this._workbook = workbook;\n            this.clipboard = workbook.clipboard();\n            workbook.bind(\"commandRequest\", this.onCommandRequest.bind(this));\n        },\n\n        refresh: function() {\n            var editor = this.editor;\n            var workbook = this._workbook;\n            var sheet = workbook.activeSheet();\n\n            this._viewPortHeight = this.view.scroller.clientHeight;\n            this.navigator.height(this._viewPortHeight);\n\n            if (!editor.isActive() && !this.isEditorDisabled) {\n                editor.enable(sheet.selection().enable() !== false);\n                this.resetEditorValue();\n            }\n\n            var ref = sheet.selection()._ref.simplify();\n            var def = this._workbook.nameForRef(ref, sheet.name());\n            this.view.nameEditor.value(def.name);\n        },\n\n        onScroll: function() {\n            this.view.render({ scroll: true });\n        },\n\n        onWheel: function(event) {\n            var deltaX = event.originalEvent.deltaX;\n            var deltaY = event.originalEvent.deltaY;\n\n            if (event.originalEvent.deltaMode === 1) {\n                deltaX *= 10;\n                deltaY *= 10;\n            }\n\n            this.scrollWith(deltaX, deltaY);\n\n            event.preventDefault();\n        },\n\n        onAction: function(event, action) {\n            var sheet = this._workbook.activeSheet();\n            sheet._activeDrawing = null;\n            this.navigator.moveActiveCell(ACTIONS[action]);\n            event.preventDefault();\n        },\n\n        onPageUp: function() {\n            this.scrollDown(-this._viewPortHeight);\n        },\n\n        onPageDown: function() {\n            this.scrollDown(this._viewPortHeight);\n        },\n\n        onEntryAction: function(event, action) {\n            var sheet = this._workbook.activeSheet();\n\n            if (event.mod) {\n                var key = String.fromCharCode(event.keyCode);\n                var shouldPrevent = true;\n\n                switch(key) {\n                  case \"A\":\n                    sheet._activeDrawing = null;\n                    this.navigator.selectAll();\n                    break;\n                  case \"Y\":\n                    this._workbook.undoRedoStack.redo();\n                    break;\n                  case \"Z\":\n                    this._workbook.undoRedoStack.undo();\n                    break;\n                  default:\n                    shouldPrevent = false;\n                    break;\n                }\n                if (shouldPrevent) {\n                    event.preventDefault();\n                }\n            } else {\n                var disabled = sheet.selection().enable() === false;\n                var casual = action !== \":edit\";\n\n                if (action == \"delete\" || action == \"backspace\") {\n                    if (sheet._activeDrawing) {\n                        this._execute({\n                            command: \"DeleteDrawingCommand\",\n                            options: { drawing: sheet._activeDrawing }\n                        });\n                    } else if (!disabled) {\n                        this._execute({ command: \"ClearContentCommand\" });\n                    }\n                    event.preventDefault();\n                } else if (alphaNumRegExp.test(action) || !casual) {\n                    sheet._activeDrawing = null;\n                    if (disabled) {\n                        event.preventDefault();\n                        return;\n                    }\n                    if (casual) {\n                        this.editor.value(\"\");\n                    }\n                    this.activateEditor(casual);\n                } else {\n                    this.navigator.navigateInSelection(ENTRY_ACTIONS[action]);\n                    event.preventDefault();\n                }\n            }\n        },\n\n        onShiftAction: function(event, action) {\n            this.navigator.modifySelection(ACTIONS[action.replace(\"shift+\", \"\")], this.appendSelection);\n            event.preventDefault();\n        },\n\n        onMouseMove: function(event) {\n            var sheet = this._workbook.activeSheet();\n\n            if (sheet.resizingInProgress() || sheet.selectionInProgress()) {\n                return;\n            }\n\n            var object = this.objectAt(event);\n            if (object.type === \"columnresizehandle\" || object.type === \"rowresizehandle\") {\n                sheet.positionResizeHandle(object.ref);\n            } else {\n                sheet.removeResizeHandle();\n            }\n\n            sheet._renderComment(object.type == \"cell\" ? object.ref : null);\n        },\n\n        onMouseDown: function(event) {\n            var object = this.objectAt(event);\n            if (object.pane) {\n                this.originFrame = object.pane;\n            }\n\n            if (this._startResizingDrawing(event, object)) {\n                event.stopPropagation();\n                return;\n            }\n\n            var sheet = this._workbook.activeSheet();\n            var win = this.container.closest('[' + kendo.attr(\"role\") + '=\"window\"]');\n            if (win.length) {\n                win = kendo.widgetInstance(win);\n                if (win && win.options.modal) {\n                    event.stopPropagation();\n                }\n            }\n\n            sheet._activeDrawing = null;\n            if (object.type === \"drawing\") {\n                sheet._activeDrawing = object.drawing;\n                object.copy = object.drawing.clone();\n                object.startBox = sheet.drawingBoundingBox(object.copy);\n                sheet.startDragging(object);\n                sheet.triggerChange({ dragging: true });\n                event.preventDefault();\n                return;\n            }\n\n            if (object.type === \"outside\") {\n                event.preventDefault();\n                event.stopPropagation();\n                return;\n            }\n\n            if (object.type === \"editor\") {\n                // XXX: canceling the edits, because they might not\n                // validate.  Not sure it's the Right Thing.\n                this.onEditorEsc();\n                this.openCustomEditor();\n                event.preventDefault();\n                return;\n            }\n\n            if (this.editor.canInsertRef(false) && object.ref) {\n                this._workbook.activeSheet()._setFormulaSelections(this.editor.highlightedRefs());\n                this.navigator.startSelection(object.ref, this._selectionMode, this.appendSelection, event.shiftKey, this.view);\n                event.preventDefault();\n                return;\n            } else {\n                this._preventNavigation = false;\n                this.editor.deactivate();\n                if (this._preventNavigation) {\n                    return;     // validation error\n                }\n            }\n\n            if (object.type === \"columnresizehandle\" || object.type === \"rowresizehandle\") {\n                sheet.startResizing({ x: object.x, y: object.y });\n                event.preventDefault();\n                return;\n            }\n\n            if (object.type === \"filtericon\") {\n                this.openFilterMenu(event);\n                event.preventDefault();\n                return;\n            }\n\n            this._selectionMode = SELECTION_MODES[object.type];\n            this.appendSelection = event.mod;\n            this.navigator.startSelection(object.ref, this._selectionMode, this.appendSelection, event.shiftKey, this.view);\n        },\n\n        _startResizingDrawing: function(event) {\n            var handle = $(event.target).closest(\".k-spreadsheet-drawing-handle\");\n            if (handle.length) {\n                var location = this.translateCoords(event);\n                var direction = handle.data(\"direction\");\n                var sheet = this._workbook.activeSheet();\n                var drawing = sheet._activeDrawing;\n                sheet.startDragging({\n                    pane     : this.originFrame,\n                    drawing  : drawing,\n                    copy     : drawing.clone(),\n                    startBox : sheet.drawingBoundingBox(drawing),\n                    resize   : direction,\n                    //aspect   : drawing.width / drawing.height,\n                    startX   : location.x,\n                    startY   : location.y\n                });\n                return true;\n            }\n        },\n\n        onContextMenu: function(event) {\n            var sheet = this._workbook.activeSheet();\n\n            event.preventDefault();\n\n            if (sheet.resizingInProgress() || sheet.draggingInProgress()) {\n                return;\n            }\n\n            this.cellContextMenu.close();\n            this.colHeaderContextMenu.close();\n            this.rowHeaderContextMenu.close();\n            this.drawingContextMenu.close();\n\n            var menu;\n\n            var object = this.objectAt(event);\n\n            if (object.type === \"columnresizehandle\" || object.type === \"rowresizehandle\") {\n                return;\n            }\n\n            if (object.ref) {\n                this.navigator.selectForContextMenu(object.ref, SELECTION_MODES[object.type]);\n            } else if (object.type == \"drawing\") {\n                this.navigator.selectDrawingForContextMenu(object.drawing);\n            }\n\n            var isComposite = this.navigator._sheet.select() instanceof kendo.spreadsheet.UnionRef;\n            var showUnhide = false;\n            var showUnmerge = false;\n\n            if (object.type == \"columnheader\") {\n                menu = this.colHeaderContextMenu;\n                showUnhide = !isComposite && this.axisManager.selectionIncludesHiddenColumns();\n            } else if (object.type == \"rowheader\") {\n                menu = this.rowHeaderContextMenu;\n                showUnhide = !isComposite && this.axisManager.selectionIncludesHiddenRows();\n            } else if (object.type == \"drawing\") {\n                menu = this.drawingContextMenu;\n            } else {\n                menu = this.cellContextMenu;\n                showUnmerge = this.navigator.selectionIncludesMergedCells();\n            }\n\n            menu.element.find(COMPOSITE_UNAVAILABLE_ACTION_SELECTORS).toggle(!isComposite);\n            menu.element.find(UNHIDE_ACTION_SELECTORS).toggle(showUnhide);\n            menu.element.find('[data-action=unmerge]').toggle(showUnmerge);\n\n            // avoid the immediate close\n            setTimeout(function() {\n                menu.open(event.pageX, event.pageY);\n            });\n        },\n\n        prevent: function(event) {\n            event.preventDefault();\n        },\n\n        constrainResize: function(type, ref) {\n            var sheet = this._workbook.activeSheet();\n            var resizeHandle = sheet.resizeHandlePosition();\n\n            return !resizeHandle || type === \"outside\" || type === \"topcorner\" || ref.col < resizeHandle.col || ref.row < resizeHandle.row;\n        },\n\n        _dragDrawing: function(event) {\n            var sheet = this._workbook.activeSheet();\n            var drag = sheet.draggingInProgress();\n            if (!drag) {\n                return false;\n            }\n\n            var location = this.translateCoords(event);\n            var drawing = drag.drawing;\n            var deltaX = location.x - drag.startX;\n            var deltaY = location.y - drag.startY;\n\n            if (drag.resize == \"SE\") {\n                if (drag.aspect) {\n                    if (Math.abs(deltaX) > Math.abs(deltaY)) {\n                        drawing.width = Math.max(drag.copy.width + deltaX, 20);\n                        drawing.height = drawing.width / drag.aspect;\n                    } else {\n                        drawing.height = Math.max(drag.copy.height + deltaY, 20);\n                        drawing.width = drawing.height * drag.aspect;\n                    }\n                } else {\n                    drawing.width = Math.max(drag.copy.width + deltaX, 20);\n                    drawing.height = Math.max(drag.copy.height + deltaY, 20);\n                }\n            }\n            else if (drag.resize == \"E\") {\n                drawing.width = Math.max(drag.copy.width + deltaX, 20);\n            }\n            else if (drag.resize == \"S\") {\n                drawing.height = Math.max(drag.copy.height + deltaY, 20);\n            }\n            else if (drag.resize == \"N\") {\n                if (drag.copy.height - deltaY > 20) {\n                    drawing.height = drag.copy.height - deltaY;\n                    drawing.offsetY = drag.copy.offsetY + deltaY;\n                }\n            }\n            else if (drag.resize == \"W\") {\n                if (drag.copy.width - deltaX > 20) {\n                    drawing.width = drag.copy.width - deltaX;\n                    drawing.offsetX = drag.copy.offsetX + deltaX;\n                }\n            }\n            else if (drag.resize == \"NE\") {\n                drawing.width = Math.max(drag.copy.width + deltaX, 20);\n                if (drag.copy.height - deltaY > 20) {\n                    drawing.height = drag.copy.height - deltaY;\n                    drawing.offsetY = drag.copy.offsetY + deltaY;\n                }\n            }\n            else if (drag.resize == \"SW\") {\n                drawing.height = Math.max(drag.copy.height + deltaY, 20);\n                if (drag.copy.width - deltaX > 20) {\n                    drawing.width = drag.copy.width - deltaX;\n                    drawing.offsetX = drag.copy.offsetX + deltaX;\n                }\n            }\n            else if (drag.resize == \"NW\") {\n                if (drag.copy.height - deltaY > 20) {\n                    drawing.height = drag.copy.height - deltaY;\n                    drawing.offsetY = drag.copy.offsetY + deltaY;\n                }\n                if (drag.copy.width - deltaX > 20) {\n                    drawing.width = drag.copy.width - deltaX;\n                    drawing.offsetX = drag.copy.offsetX + deltaX;\n                }\n            }\n            // just moving (no resize)\n            else {\n                drawing.offsetX = drag.copy.offsetX + deltaX;\n                drawing.offsetY = drag.copy.offsetY + deltaY;\n            }\n\n            sheet.triggerChange({ dragging: true });\n\n            return true;\n        },\n\n        onMouseDrag: function(event) {\n            if (this._selectionMode === \"sheet\") {\n                return;\n            }\n\n            var location = { clientX: event.clientX, clientY: event.clientY };\n            var sheet = this._workbook.activeSheet();\n\n            if (this._dragDrawing(event)) {\n                return;\n            }\n\n            var object = this.objectAt(location);\n\n            if (sheet.resizingInProgress()) {\n\n                if (!this.constrainResize(object.type, object.ref)) {\n                    sheet.resizeHintPosition({ x: object.x, y: object.y });\n                }\n\n                return;\n            }\n\n            if (object.type === \"outside\") {\n                this.startAutoScroll(object);\n                return;\n            }\n\n            if (this.originFrame === object.pane) {\n                this.selectToLocation(location);\n            } else { // cross frame selection\n                var frame = this.originFrame._grid;\n\n                if (object.x > frame.right) {\n                    kendo.scrollLeft(this);\n                }\n\n                if (object.y > frame.bottom) {\n                    this.scrollTop();\n                }\n\n                if (object.y < frame.top || object.x < frame.left) {\n                    this.startAutoScroll(object, location);\n                } else {\n                    this.selectToLocation(location);\n                }\n            }\n\n            event.preventDefault();\n        },\n\n        onMouseUp: function(event) {\n            var sheet = this._workbook.activeSheet();\n            sheet.completeResizing();\n            sheet.completeDragging();\n\n            this.navigator.completeSelection();\n            this.stopAutoScroll();\n\n            var editor = this.editor.activeEditor();\n            if (!editor) {\n                return;\n            }\n            var el = event.target;\n            while (el) {\n                if (el === editor.element[0]) {\n                    return;\n                }\n                el = el.parentNode;\n            }\n\n            var object = this.objectAt(event);\n            if (object && object.ref && editor.canInsertRef(false)) {\n                editor.refAtPoint(sheet);\n                sheet._setFormulaSelections(editor.highlightedRefs());\n            }\n        },\n\n        onDblClick: function(event) {\n            var object = this.objectAt(event);\n            var disabled = this._workbook.activeSheet().selection().enable() === false;\n\n            if (object.type !== \"cell\" || disabled) {\n                return;\n            }\n\n            var sel = this._workbook.activeSheet().selection();\n            this.activateEditor(!sel.value() && !sel.formula());\n            this.onEditorUpdate();\n        },\n\n        onCut: function(e) {\n            var self = this;\n            setTimeout(function(){\n                self.clipboard.menuInvoked = (e === undefined);\n                self._execute({\n                    command: \"CutCommand\",\n                    options: { workbook: self.view._workbook, event: e.originalEvent || e }\n                });\n            });\n        },\n\n        clipBoardValue: function() {\n            return this.clipboardElement.html();\n        },\n\n        _pasteImage: function(blob) {\n            var self = this;\n            var img = new window.Image();\n            img.src = window.URL.createObjectURL(blob);\n            img.onload = function() {\n                self._execute({\n                    command: \"InsertImageCommand\",\n                    options: {\n                        blob: blob,\n                        width: img.width,\n                        height: img.height\n                    }\n                });\n            };\n            setTimeout(function(){\n                window.URL.revokeObjectURL(img.src);\n            }, 10);\n        },\n\n        onPaste: function(e) {\n            var self = this;\n            var html = \"\";\n            var plain = \"\";\n            self.clipboard.menuInvoked = (e === undefined);\n            if (e) {\n                var clipboardData = e.originalEvent.clipboardData;\n                if (clipboardData && clipboardData.getData) {\n                    e.preventDefault();\n                    var hasHTML = false;\n                    var hasPlainText = false;\n                    // Firefox uses DOMStringList, needs special handling\n                    if (window.DOMStringList && clipboardData.types instanceof window.DOMStringList) {\n                        hasHTML = clipboardData.types.contains(\"text/html\");\n                        hasPlainText = clipboardData.types.contains(\"text/plain\");\n                    } else if (Array.isArray(clipboardData.types)) {\n                        hasHTML = clipboardData.types.indexOf(\"text/html\") >= 0;\n                        hasPlainText = clipboardData.types.indexOf(\"text/plain\") >= 0;\n                    } else {\n                        hasHTML = /text\\/html/.test(clipboardData.types);\n                        hasPlainText = /text\\/plain/.test(clipboardData.types);\n                    }\n                    if (hasHTML) {\n                        html = clipboardData.getData('text/html').trim();\n                    }\n                    if (hasPlainText) {\n                        plain = clipboardData.getData('text/plain').trim();\n                    }\n                    if (!html && !plain && clipboardData.items && clipboardData.items.length) {\n                        for (var i = 0; i < clipboardData.items.length; ++i) {\n                            var item = clipboardData.items[i];\n                            if (item.kind == \"file\" && /^image\\/(?:png|jpe?g|gif)$/i.test(item.type)) {\n                                return self._pasteImage(item.getAsFile());\n                            }\n                        }\n                    }\n                } else {\n                    if (window.clipboardData.files && window.clipboardData.files.length) {\n                        var file = window.clipboardData.files[0];\n                        if (/^image\\/(?:png|jpe?g|gif)$/i.test(file.type)) {\n                            return self._pasteImage(file);\n                        }\n                    }\n\n                    plain = window.clipboardData.getData(\"Text\");\n                    if (plain) {\n                        plain = plain.trim();\n                    }\n\n                    // There's no way to get the HTML clipboard contents in IE other than letting\n                    // the browser handle the event (it pastes into our clipboardElement), and then\n                    // we can read the HTML from there.  Need to allow a small timeout for this.\n                    self.clipboardElement.empty();\n                    setTimeout(function(){\n                        html = self.clipboardElement.html();\n                        if (html || plain) {\n                            self.clipboard.external({ html: html, plain: plain });\n                            self._execute({\n                                command: \"PasteCommand\",\n                                options: { workbook: self.view._workbook, event: e.originalEvent || e }\n                            });\n                        }\n                    });\n\n                    return;\n                }\n            } else {\n                if (kendo.support.browser.msie) {\n                    self.clipboardElement.trigger(\"focus\").select();\n                    document.execCommand('paste');\n                    return;\n                } else {\n                    self.clipboard.menuInvoked = true;\n                }\n            }\n\n            if (!html && !plain) {\n                return;\n            }\n            self.clipboard.external({ html: html, plain:plain });\n            self._execute({\n                command: \"PasteCommand\",\n                options: { workbook: self.view._workbook, event: e.originalEvent || e }\n            });\n        },\n\n        onCopy: function(e) {\n            this.clipboard.menuInvoked = (e === undefined);\n            this._execute({\n                command: \"CopyCommand\",\n                options: { workbook: this.view._workbook, event: e.originalEvent || e }\n            });\n        },\n\n////////////////////////////////////////////////////////////////////\n\n        scrollTop: function() {\n            this.scroller.scrollTop = 0;\n        },\n\n        scrollLeft: function() {\n            this.scroller.scrollLeft = 0;\n        },\n\n        scrollDown: function(value) {\n            this.scroller.scrollTop += value;\n        },\n\n        scrollRight: function(value) {\n            this.scroller.scrollLeft += value;\n        },\n\n        scrollWith: function(right, down) {\n            this.scroller.scrollTop += down;\n            this.scroller.scrollLeft += right;\n        },\n\n        translateCoords: function(location) {\n            var box = this.container[0].getBoundingClientRect();\n            return {\n                x: location.clientX - box.left,\n                y: location.clientY - box.top\n            };\n        },\n\n        objectAt: function(location, noDrawing) {\n            if (!location) {\n                return;\n            }\n            location = this.translateCoords(location);\n            return this.view.objectAt(location.x, location.y, noDrawing);\n        },\n\n        selectToLocation: function(cellLocation) {\n            var object = this.objectAt(cellLocation, true);\n\n            if (object.pane && object.ref) { // cell, rowheader or columnheader\n                this.extendSelection(object);\n                this.lastKnownCellLocation = cellLocation;\n                this.originFrame = object.pane;\n            }\n\n            this.stopAutoScroll();\n        },\n\n        extendSelection: function(object) {\n            this.navigator.extendSelection(object.ref, this._selectionMode);\n        },\n\n        autoScroll: function() {\n            var x = this._autoScrollTarget.x;\n            var y = this._autoScrollTarget.y;\n            var boundaries = this.originFrame._grid;\n            var scroller = this.view.scroller;\n            var scrollStep = 8;\n\n            var scrollLeft = scroller.scrollLeft;\n            var scrollTop = scroller.scrollTop;\n\n            if (x < boundaries.left) {\n                this.scrollRight(-scrollStep);\n            }\n            if (x > boundaries.right) {\n                this.scrollRight(scrollStep);\n            }\n            if (y < boundaries.top) {\n                this.scrollDown(-scrollStep);\n            }\n            if (y > boundaries.bottom) {\n                this.scrollDown(scrollStep);\n            }\n\n            if (scrollTop === scroller.scrollTop && scrollLeft === scroller.scrollLeft) {\n                this.selectToLocation(this.finalLocation);\n            } else {\n                this.extendSelection(this.objectAt(this.lastKnownCellLocation));\n            }\n        },\n\n        startAutoScroll: function(viewObject, location) {\n            if (!this._scrollInterval) {\n                this._scrollInterval = setInterval(this.autoScroll.bind(this), 50);\n            }\n\n            this.finalLocation = location || this.lastKnownCellLocation;\n\n            this._autoScrollTarget = viewObject;\n        },\n\n        stopAutoScroll: function() {\n            clearInterval(this._scrollInterval);\n            this._scrollInterval = null;\n        },\n\n        openCustomEditor: function() {\n            this.view.openCustomEditor();\n        },\n\n        openFilterMenu: function(event) {\n            var object = this.objectAt(event);\n            var sheet = this._workbook.activeSheet();\n            var column = sheet.filterColumn(object.ref);\n            var filterMenu = this.view.createFilterMenu(column);\n\n            filterMenu.bind(\"action\", this.onCommandRequest.bind(this));\n            filterMenu.bind(\"action\", filterMenu.close.bind(filterMenu));\n\n            filterMenu.openFor(event.target, event);\n        },\n\n////////////////////////////////////////////////////////////////////\n\n        _saveEditorValue: function(arrayFormula) {\n            var sheet = this.editor._range.sheet();\n            var value = this.editor.value();\n            if (this._workbook.activeSheet() !== sheet) {\n                // remove highlighted refs (XXX: which are mostly wrong, BTW)\n                this._workbook.activeSheet()._setFormulaSelections();\n                // go back to the original sheet\n                this._workbook.activeSheet(sheet);\n            }\n            sheet.isInEditMode(false);\n            this._lastEditorValue = value;\n            this._execute({\n                command: \"EditCommand\",\n                options: {\n                    value: value,\n                    arrayFormula: arrayFormula\n                }\n            });\n        },\n\n        onEditorChange: function() {\n            this._saveEditorValue(false);\n        },\n\n        onEditorArrayFormula: function() {\n            this._saveEditorValue(true);\n            this.editor.deactivate(true);\n        },\n\n        onEditorActivate: function() {\n            var workbook = this._workbook;\n            var sheet = workbook.activeSheet();\n\n            sheet._setFormulaSelections(this.editor.highlightedRefs());\n            sheet.isInEditMode(true);\n        },\n\n        onEditorDeactivate: function() {\n            var sheet = this._workbook.activeSheet();\n\n            sheet.isInEditMode(false);\n            sheet._setFormulaSelections([]);\n        },\n\n        onEditorUpdate: function() {\n            this._workbook.activeSheet()._setFormulaSelections(this.editor.highlightedRefs());\n        },\n\n        onEditorBarFocus: function() {\n            var disabled = this._workbook.activeSheet().selection().enable() === false;\n            if (disabled) {\n                return;\n            }\n            this.editor\n                .activate({\n                    range: this._workbook.activeSheet().selection(),\n                    rect: this.view.activeCellRectangle(),\n                    tooltip: this._activeTooltip()\n                });\n        },\n\n        onEditorCellFocus: function() {\n            this.editor.scale();\n        },\n\n        onEditorEsc: function() {\n            this.resetEditorValue();\n            this.editor.deactivate();\n\n            this.clipboardElement.trigger(\"focus\");\n        },\n\n        insertNewline: function(e) {\n            e.preventDefault();\n            this.editor.insertNewline();\n        },\n\n        onEditorBlur: function(_, action) {\n            if (this.editor.isFiltered()) {\n                return;\n            }\n\n            this._preventNavigation = false;\n            this.editor.deactivate();\n\n            if (!this._preventNavigation) {\n                this.clipboardElement.trigger(\"focus\");\n                this.navigator.navigateInSelection(ENTRY_ACTIONS[action]);\n            }\n        },\n\n        onEditorAction: function(event, action) {\n            var editor = this.editor;\n            var sheet = this._workbook.activeSheet();\n\n            if (this._casualEditing && /^(?:up|right|down|left)$/.test(action)) {\n                this.deactivateEditor();\n                this.navigator.moveActiveCell(ACTIONS[action]);\n                event.preventDefault();\n            }\n            else if (editor.canInsertRef(true)) {\n                this.navigator.moveActiveCell(ACTIONS[action]);\n                editor.activeEditor().refAtPoint(sheet);\n                sheet._setFormulaSelections(editor.highlightedRefs());\n                event.preventDefault();\n            }\n        },\n\n        onEditorShiftAction: function(event, action) {\n            var editor = this.editor;\n            var sheet = this._workbook.activeSheet();\n\n            if (editor.canInsertRef(true)) {\n                this.navigator.modifySelection(ACTIONS[action.replace(\"shift+\", \"\")], this.appendSelection);\n\n                editor.activeEditor().refAtPoint(sheet);\n                sheet._setFormulaSelections(editor.highlightedRefs());\n\n                event.preventDefault();\n            }\n        },\n\n////////////////////////////////////////////////////////////////////\n        resetEditorValue: function() {\n            var sheet = this._workbook.activeSheet();\n            var ref = sheet.activeCell();\n            var input = this._workbook._inputForRef(ref);\n            var x = sheet.range(ref).intersectingArrayFormula();\n            if (x) {\n                input = \"=\" + x.formula;\n            }\n            this.editor.value(input, !!x);\n        },\n\n        activateEditor: function(casual) {\n            // This flag will be false when F2 has been pressed, and\n            // true when editing is \"casual\", i.e., user just started\n            // typing.  In this case we want arrow keys to do cell\n            // navigation rather than move the cursor.\n            // https://github.com/telerik/kendo-ui-core/issues/3644\n            this._casualEditing = casual;\n\n            this.editor.activate({\n                range: this._workbook.activeSheet().selection(),\n                rect: this.view.activeCellRectangle(),\n                tooltip: this._activeTooltip()\n            }).focus();\n        },\n\n        deactivateEditor: function() {\n            this.view.editor.deactivate();\n        },\n\n        onCommandRequest: function(e) {\n            if (e.command) {\n                this._execute(e);\n            } else {\n                this._workbook.undoRedoStack[e.action]();\n            }\n        },\n\n        onDialogRequest: function(e) {\n            var additionalOptions = {\n                pdfExport: this._workbook.options.pdf,\n                excelExport: this._workbook.options.excel\n            };\n\n            if (e.options) {\n                $.extend(true, e.options, additionalOptions);\n            } else {\n                e.options = additionalOptions;\n            }\n\n            this.view.openDialog(e.name, e.options);\n        },\n\n        onNameEditorEnter: function() {\n            var ref;\n            var workbook = this._workbook;\n            var sheet = workbook.activeSheet();\n            var name = this.view.nameEditor.value();\n\n            // 1. does it look like a reference, or already defined\n            // name?  If so, just select it (don't define/modify any\n            // names)\n            ref = kendo.spreadsheet.calc.parseReference(name, true) || workbook.nameValue(name);\n            if (ref instanceof kendo.spreadsheet.Ref) {\n                if (ref.sheet && ref.sheet.toLowerCase() != sheet.name().toLowerCase()) {\n                    // reference points to another sheet, select it if found\n                    var tmp = workbook.sheetByName(ref.sheet);\n                    if (tmp) {\n                        workbook.activeSheet(tmp);\n                        sheet = tmp;\n                    }\n                }\n                sheet.range(ref).select();\n                return;\n            }\n\n            ref = sheet.selection()._ref.clone().simplify().setSheet(sheet.name(), true);\n\n            // XXX: should we check if a name is already defined for this range, and update it instead?\n            // Excel just adds a new one, and provides a more complete Name Manager dialog.\n            //var def = workbook.nameForRef(ref, sheet.name());\n\n            // just define new name\n            this._execute({\n                command: \"DefineNameCommand\",\n                options: { name: name, value: ref }\n            });\n\n            this.clipboardElement.trigger(\"focus\");\n        },\n        onNameEditorCancel: function() {\n            this.clipboardElement.trigger(\"focus\");\n        },\n        onNameEditorSelect: function(ev) {\n            var name = ev.name;\n            var workbook = this._workbook;\n            var sheet = workbook.activeSheet();\n            var ref = workbook.nameValue(name);\n            if (ref instanceof kendo.spreadsheet.Ref) {\n                if (ref.sheet && ref.sheet.toLowerCase() != sheet.name().toLowerCase()) {\n                    // reference points to another sheet, select it if found\n                    var tmp = workbook.sheetByName(ref.sheet);\n                    if (tmp) {\n                        workbook.activeSheet(tmp);\n                        sheet = tmp;\n                    }\n                }\n                sheet.range(ref).select();\n                return;\n            }\n            this.clipboardElement.trigger(\"focus\");\n        },\n        onNameEditorDelete: function(ev) {\n            this._execute({\n                command: \"DeleteNameCommand\",\n                options: { name: ev.name }\n            });\n            this.clipboardElement.trigger(\"focus\");\n        }\n    });\n\n    kendo.spreadsheet.Controller = Controller;\n})(window.kendo);\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/view',[ \"kendo.core\", \"kendo.menu\", \"./sheetsbar\", \"../util/main\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    var $ = kendo.jQuery;\n    var CellRef = kendo.spreadsheet.CellRef;\n    var DOT = \".\";\n    var RESIZE_HANDLE_WIDTH = 7;\n    var EDIT_BUTTON_WIDTH = 20;\n    var ERROR = \"Error\";\n    var viewClassNames = {\n        view: \"k-spreadsheet-view\",\n        fixedContainer: \"k-spreadsheet-fixed-container\",\n        editContainer: \"k-spreadsheet-edit-container\",\n        scroller: \"k-spreadsheet-scroller\",\n        viewSize: \"k-spreadsheet-view-size\",\n        clipboard: \"k-spreadsheet-clipboard\",\n        cellEditor: \"k-spreadsheet-cell-editor\",\n        barEditor: \"k-spreadsheet-editor\",\n        topCorner: \"k-spreadsheet-top-corner\",\n        filterHeadersWrapper: \"k-filter-wrapper\",\n        filterRange: \"k-filter-range\",\n        filterButton: \"k-spreadsheet-filter\",\n        filterButtonSelected: \"k-selected\",\n        horizontalResize: \"k-horizontal-resize\",\n        verticalResize: \"k-vertical-resize\",\n        icon: \"k-icon\",\n        iconFilterDefault: \"k-i-arrow-60-down\",\n        sheetsBar: \"k-spreadsheet-sheets-bar\",\n        sheetsBarActive: \"k-spreadsheet-sheets-bar-active\",\n        sheetsBarInactive: \"k-spreadsheet-sheets-bar-inactive\",\n        cellContextMenu: \"k-spreadsheet-cell-context-menu\",\n        rowHeaderContextMenu: \"k-spreadsheet-row-header-context-menu\",\n        colHeaderContextMenu: \"k-spreadsheet-col-header-context-menu\",\n        drawingContextMenu: \"k-spreadsheet-drawing-context-menu\"\n    };\n\n    kendo.spreadsheet.messages.view = {\n        nameBox: \"Name Box\",\n        errors: {\n            openUnsupported: \"Unsupported format. Please select an .xlsx file.\",\n            shiftingNonblankCells: \"Cannot insert cells due to data loss possibility. Select another insert location or delete the data from the end of your worksheet.\",\n            insertColumnWhenRowIsSelected: \"Cannot insert column when all columns are selected.\",\n            insertRowWhenColumnIsSelected: \"Cannot insert row when all rows are selected.\",\n            filterRangeContainingMerges: \"Cannot create a filter within a range containing merges\",\n            sortRangeContainingMerges: \"Cannot sort a range containing merges\",\n            cantSortMultipleSelection: \"Cannot sort multiple selection\",\n            cantSortNullRef: \"Cannot sort empty selection\",\n            cantSortMixedCells: \"Cannot sort range containing cells of mixed shapes\",\n            validationError: \"The value that you entered violates the validation rules set on the cell.\",\n            cannotModifyDisabled: \"Cannot modify disabled cells.\",\n            insertRowBelowLastRow: \"Cannot insert row below the last row.\",\n            insertColAfterLastCol: \"Cannot insert column to the right of the last column.\"\n        },\n        tabs: {\n            home: \"Home\",\n            insert: \"Insert\",\n            data: \"Data\"\n        }\n    };\n\n    kendo.spreadsheet.messages.menus = {\n        \"cut\"          : \"Cut\",\n        \"copy\"         : \"Copy\",\n        \"paste\"        : \"Paste\",\n        \"merge\"        : \"Merge\",\n        \"unmerge\"      : \"Unmerge\",\n        \"delete\"       : \"Delete\",\n        \"hide\"         : \"Hide\",\n        \"unhide\"       : \"Unhide\",\n        \"bringToFront\" : \"Bring to front\",\n        \"sendToBack\"   : \"Send to back\"\n    };\n\n    function selectElementContents(el) {\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n\n        var range = document.createRange();\n        range.selectNodeContents(el);\n\n        sel.addRange(range);\n    }\n\n    function cellBefore(table, row) {\n        var cells = table.trs[row].children;\n        return cells[cells.length - 2];\n    }\n\n    function cellAbove(table, row) {\n        var prevRow = table.trs[row-1];\n        var index = table.trs[row].children.length-1;\n\n        if (prevRow && index >= 0) {\n            return prevRow.children[index];\n        }\n    }\n\n    function cellBorder(value) {\n        return (value.size || 1) + \"px solid \" + (value.color || \"#000\");\n    }\n\n    function asURL(link) {\n        if (!/:\\/\\//.test(link)) {\n            link = \"http://\" + link;\n        }\n        return link;\n    }\n\n    function drawCell(collection, cell, cls, showGrid) {\n        function maybeLink(el) {\n            var link = cell.link;\n            if (!link) {\n                if (typeof cell.value == \"object\") {\n                    link = cell.value.link;\n                }\n            }\n            if (link) {\n                var style = {\n                    textDecoration: \"none\"\n                };\n                if (cell.color) {\n                    style.color = cell.color;\n                }\n                if (cell.underline) {\n                    style.textDecoration = \"underline\";\n                }\n                return kendo.dom.element(\"a\", {\n                    href   : asURL(link),\n                    style  : style,\n                    target : \"_blank\" // XXX: customizable?\n                }, el ? [ el ] : []);\n            }\n            return el;\n        }\n\n        var shouldDraw = (cell.value != null || (cell.validation != null && !cell.validation.value) || \n                          cell.background || cell.merged || cell.comment);\n        if (!cls && !shouldDraw) {\n            return;\n        }\n\n        var style = {};\n        var background = cell.background;\n        if (background) {\n            var defaultBorder = background;\n            if (showGrid) {\n                // darken\n                defaultBorder = kendo.parseColor(defaultBorder).toHSV();\n                defaultBorder.v *= 0.9;\n                defaultBorder = defaultBorder.toCssRgba();\n            }\n            defaultBorder = cellBorder({ color: defaultBorder });\n            style.outline = defaultBorder;\n        }\n\n        if (background) {\n            style.backgroundColor = background;\n        }\n\n        if (cell.color) {\n            style.color = cell.color;\n        }\n\n        if (cell.fontFamily) {\n            style.fontFamily = cell.fontFamily;\n        }\n\n        if (cell.underline) {\n            style.textDecoration = \"underline\";\n        }\n\n        if (cell.italic) {\n            style.fontStyle = \"italic\";\n        }\n\n        if (cell.textAlign) {\n            style.textAlign = cell.textAlign;\n        }\n\n        if (cell.bold) {\n            style.fontWeight = \"bold\";\n        }\n\n        if (cell.fontSize) {\n            style.fontSize = cell.fontSize + \"px\";\n        }\n\n        if (cell.wrap === true) {\n            style.whiteSpace = \"pre-wrap\";\n            style.overflowWrap = \"break-word\";\n            style.wordWrap = \"break-word\";\n        } else {\n            style.whiteSpace = \"pre\";\n            style.overflowWrap = \"normal\";\n            style.wordWrap = \"normal\";\n        }\n\n        style.left = (cell.left + 1) + \"px\";\n        style.top = (cell.top + 1) + \"px\";\n        style.width = (cell.width - 1) + \"px\";\n        style.height = (cell.height - 1) + \"px\";\n\n        var data = cell.value, type = typeof data, format = cell.format;\n        if (!format && type == \"number\" && data != Math.floor(data)) {\n            format = \"0.##############\";\n        }\n        if (format && data != null) { \n            data = kendo.spreadsheet.formatting.format(data, format);\n            if (data.__dataType) {\n                type = data.__dataType;\n            }\n        } else if (data !== null && data !== undefined) {\n            if(cell.html){\n                data = kendo.dom.html(data);\n            } else {\n                data = kendo.dom.text(data);\n            }\n        }\n\n        if (!style.textAlign) {\n            switch (type) {\n              case \"number\":\n              case \"date\":\n              case \"percent\":\n              case \"currency\":\n                style.textAlign = \"right\";\n                break;\n              case \"boolean\":\n                style.textAlign = \"center\";\n                break;\n            }\n        }\n\n        // defined in print.js\n        kendo.spreadsheet.draw.applyIndent(cell, style);\n\n        var classNames = [ paneClassNames.cell ];\n\n        if (cls) {\n            classNames.push(cls);\n        }\n        if (cell.enable === false) {\n            classNames.push(\"k-disabled\");\n        }\n        if (cell.merged) {\n            classNames.push(\"k-spreadsheet-merged-cell\");\n        }\n        if (cell.comment) {\n            classNames.push(\"k-spreadsheet-has-comment\");\n        }\n\n        var verticalAlign = cell.verticalAlign || \"bottom\";\n\n        if (verticalAlign && data) {\n            data = kendo.dom.element(\"div\", { className: \"k-vertical-align-\" + verticalAlign }, [ maybeLink(data) ]);\n        } else {\n            data = maybeLink(data);\n        }\n\n        var children = data ? [ data ] : [];\n        var properties = {\n            style: style\n        };\n        var validation = cell.validation;\n        if (validation && !validation.value) {\n            children.push(kendo.dom.element(\"span\", { className: \"k-dirty\" }));\n            classNames.push(\"k-dirty-cell\");\n\n            properties.title = validation.message;\n        }\n        properties.className = classNames.join(\" \");\n\n        var div = kendo.dom.element(\"div\", properties, children);\n        collection.push(div);\n        return div;\n    }\n\n    function addCell(table, row, cell) {\n        var style = {};\n\n        if (cell.background) {\n            style.backgroundColor = cell.background;\n        }\n\n        if (cell.color) {\n            style.color = cell.color;\n        }\n\n        if (cell.fontFamily) {\n            style.fontFamily = cell.fontFamily;\n        }\n\n        if (cell.underline) {\n            style.textDecoration = \"underline\";\n        }\n\n        if (cell.italic) {\n            style.fontStyle = \"italic\";\n        }\n\n        if (cell.textAlign) {\n            style.textAlign = cell.textAlign;\n        }\n\n        if (cell.verticalAlign) {\n            style.verticalAlign = (cell.verticalAlign === \"center\") ? \"middle\" : cell.verticalAlign;\n        }\n\n        if (cell.bold) {\n            style.fontWeight = \"bold\";\n        }\n\n        if (cell.fontSize) {\n            style.fontSize = cell.fontSize + \"px\";\n        }\n\n        if (cell.wrap === true) {\n            style.whiteSpace = \"pre-wrap\";\n        }\n\n        if (cell.borderRight) {\n            style.borderRight = cellBorder(cell.borderRight);\n        } else if (cell.background) {\n            style.borderRightColor = cell.background;\n        }\n\n        if (cell.borderBottom) {\n            style.borderBottom = cellBorder(cell.borderBottom);\n        } else if (cell.background) {\n            style.borderBottomColor = cell.background;\n        }\n\n        var data = cell.value, type = typeof data, format = cell.format;\n        if (!format && type == \"number\" && data != Math.floor(data)) {\n            format = \"0.##############\";\n        }\n        if (format && data != null) { \n            data = kendo.spreadsheet.formatting.format(data, format);\n            if (data.__dataType) {\n                type = data.__dataType;\n            }\n        }\n\n        if (!style.textAlign) {\n            switch (type) {\n              case \"number\":\n              case \"date\":\n              case \"percent\":\n              case \"currency\":\n                style.textAlign = \"right\";\n                break;\n              case \"boolean\":\n                style.textAlign = \"center\";\n                break;\n            }\n        }\n\n        var className = null;\n\n        if (cell.enable === false) {\n            className = \"k-disabled\";\n        }\n\n        var td = table.addCell(row, data, style, className, cell.validation);\n\n        var border, sibling;\n\n        if (cell.borderLeft) {\n            sibling = cellBefore(table, row);\n            border = cellBorder(cell.borderLeft);\n            if (sibling && border) {\n                sibling.attr.style.borderRight = border;\n            }\n        } else if (cell.background) {\n            style.borderLeftColor = cell.background;\n        }\n\n        if (cell.borderTop) {\n            sibling = cellAbove(table, row);\n            border = cellBorder(cell.borderTop);\n            if (sibling && border) {\n                sibling.attr.style.borderBottom = border;\n            }\n        } else if (cell.background) {\n            style.borderTopColor = cell.background;\n        }\n\n        return td;\n    }\n\n    var HtmlTable = kendo.Class.extend({\n        init: function() {\n            this.cols = [];\n            this.trs = [];\n            this._height = 0;\n            this._width = 0;\n        },\n\n        addColumn: function(width) {\n            this._width += width;\n\n            var col = kendo.dom.element(\"col\", { style: { width: width + \"px\" } });\n\n            col.visible = width > 0;\n\n            this.cols.push(col);\n        },\n\n        addRow: function(height) {\n            var attr = null;\n\n            attr = { style: { height: height + \"px\" } };\n\n            this._height += height;\n\n            var tr = kendo.dom.element(\"tr\", attr);\n\n            tr.visible = height > 0;\n\n            this.trs.push(tr);\n        },\n\n        addCell: function(rowIndex, text, style, className, validation) {\n            if (text === null || text === undefined) {\n                text = \"\";\n            }\n            if (!(text instanceof kendo.dom.Node)) {\n                text = kendo.dom.text(text);\n            }\n\n            var children = [ text ];\n            var properties = { style: style };\n\n            if (validation && !validation.value) {\n                children.push(kendo.dom.element(\"span\", { className: \"k-dirty\" }));\n\n                className = (className || \"\") + (className ? \" \" : \"\") + \"k-dirty-cell\";\n                properties.title = validation.message;\n            }\n\n            if (className) {\n                properties.className = className;\n            }\n            var td = kendo.dom.element(\"td\", properties, children);\n\n            this.trs[rowIndex].children.push(td);\n            return td;\n        },\n\n        toDomTree: function(x, y, className) {\n            this.trs = this.trs.filter(function(tr) {\n                return tr.visible;\n            });\n\n            var offset = 0;\n            this.cols = this.cols.filter(function(col, ci) {\n                if (!col.visible) {\n                    this.trs.forEach(function(tr) {\n                        tr.children.splice(ci - offset, 1);\n                    });\n                    offset++;\n                }\n\n                return col.visible;\n            }, this);\n\n            return kendo.dom.element(\"table\", {\n                style: { left: x + \"px\", top: y + \"px\", height: this._height + \"px\", width: this._width + \"px\" },\n                className: className,\n                role: \"presentation\"\n            },[\n                kendo.dom.element(\"colgroup\", null, this.cols),\n                kendo.dom.element(\"tbody\", null, this.trs)\n            ]);\n        }\n    });\n\n    var CELL_CONTEXT_MENU = '<ul class=\"#=classNames.cellContextMenu#\">' +\n        '<li data-action=cut>#: messages.cut #</li>' +\n        '<li data-action=copy>#: messages.copy #</li>' +\n        '<li data-action=paste>#: messages.paste #</li>' +\n        '<li class=\"k-separator\"></li>' +\n        '<li data-action=merge>#: messages.merge #</li>' +\n        '<li data-action=unmerge>#: messages.unmerge #</li>' +\n    '</ul>';\n\n    var ROW_HEADER_CONTEXT_MENU = '<ul class=\"#=classNames.rowHeaderContextMenu#\">' +\n        '<li data-action=cut>#: messages.cut #</li>' +\n        '<li data-action=copy>#: messages.copy #</li>' +\n        '<li data-action=paste>#: messages.paste #</li>' +\n        '<li class=\"k-separator\"></li>' +\n        '<li data-action=\"delete-row\">#: messages.delete #</li>'+\n        '<li data-action=\"hide-row\">#: messages.hide #</li>'+\n        '<li data-action=\"unhide-row\">#: messages.unhide #</li>'+\n    '</ul>';\n\n    var COL_HEADER_CONTEXT_MENU = '<ul class=\"#=classNames.colHeaderContextMenu#\">' +\n        '<li data-action=cut>#: messages.cut #</li>' +\n        '<li data-action=copy>#: messages.copy #</li>' +\n        '<li data-action=paste>#: messages.paste #</li>' +\n        '<li class=\"k-separator\"></li>' +\n        '<li data-action=\"delete-column\">#: messages.delete #</li>'+\n        '<li data-action=\"hide-column\">#: messages.hide #</li>'+\n        '<li data-action=\"unhide-column\">#: messages.unhide #</li>'+\n    '</ul>';\n\n    var DRAWING_CONTEXT_MENU = '<ul class=\"#=classNames.drawingContextMenu#\">' +\n        // '<li data-action=cut>#: messages.cut #</li>' +\n        // '<li data-action=copy>#: messages.copy #</li>' +\n        // '<li data-action=paste>#: messages.paste #</li>' +\n        // '<li class=\"k-separator\"></li>' +\n        '<li data-action=\"bring-to-front\">#: messages.bringToFront #</li>' +\n        '<li data-action=\"send-to-back\">#: messages.sendToBack #</li>' +\n        '<li class=\"k-separator\"></li>' +\n        '<li data-action=\"delete-drawing\">#: messages.delete #</li>' +\n    '</ul>';\n\n    kendo.spreadsheet.ContextMenu = kendo.ui.ContextMenu;\n\n    var VIEW_CONTENTS = kendo.template('<div class=\"#=classNames.view#\"><div class=\"#=classNames.fixedContainer#\"></div><div class=\"#=classNames.scroller#\"><div class=\"#=classNames.viewSize#\"></div></div>' +\n        '<div tabindex=\"0\" class=\"#=classNames.clipboard#\" contenteditable=true></div><div class=\"#=classNames.cellEditor#\"></div></div><div class=\"#=classNames.sheetsBar#\"></div>' +\n        CELL_CONTEXT_MENU + ROW_HEADER_CONTEXT_MENU + COL_HEADER_CONTEXT_MENU + DRAWING_CONTEXT_MENU\n    );\n\n    function within(value, min, max) {\n        return value >= min && value <= max;\n    }\n\n    var View = kendo.Class.extend({\n        init: function(element, options) {\n            var classNames = View.classNames;\n\n            this.element = element;\n\n            this.options = $.extend(true, {\n                messages: kendo.spreadsheet.messages.view\n            }, this.options, options);\n\n            this._chrome();\n\n            this._dialogs = [];\n\n            element.append(VIEW_CONTENTS({\n                classNames: classNames,\n                messages: kendo.spreadsheet.messages.menus\n            }));\n\n            this._formulaInput();\n\n            this.wrapper =      element.find(DOT + classNames.view);\n            this.container =    element.find(DOT + classNames.fixedContainer)[0];\n            this.scroller =     element.find(DOT + classNames.scroller)[0];\n            this.clipboard =    element.find(DOT + classNames.clipboard);\n\n            this.viewSize = $(this.scroller.firstChild);\n\n            this.tree = new kendo.dom.Tree(this.container);\n            this.clipboardContents = new kendo.dom.Tree(this.clipboard[0]);\n\n            this.editor = new kendo.spreadsheet.SheetEditor(this);\n\n            this._sheetsbar();\n\n            var contextMenuConfig = {\n                target: element,\n                animation: false,\n                showOn: \"never\" // this is just an invalid event name to prevent the show\n            };\n\n            this.cellContextMenu = new kendo.spreadsheet.ContextMenu(element.find(DOT + classNames.cellContextMenu), contextMenuConfig);\n\n            this.colHeaderContextMenu = new kendo.spreadsheet.ContextMenu(element.find(DOT + classNames.colHeaderContextMenu), contextMenuConfig);\n\n            this.rowHeaderContextMenu = new kendo.spreadsheet.ContextMenu(element.find(DOT + classNames.rowHeaderContextMenu), contextMenuConfig);\n\n            this.drawingContextMenu = new kendo.spreadsheet.ContextMenu(element.find(DOT + classNames.drawingContextMenu), contextMenuConfig);\n        },\n\n        enableClipboard: function(enable) {\n            this.isClipboardDeactivated = !enable;\n\n            if (enable) {\n                this.clipboard.attr(\"contenteditable\", enable);\n            } else {\n                this.clipboard.removeAttr(\"contenteditable\");\n            }\n        },\n\n        _resize: function() {\n            var actionBar = $(this.formulaBar.element).parents(\".k-spreadsheet-action-bar\");\n            var outerHeight = kendo._outerHeight;\n            var tabstripHeight = this.tabstrip ? outerHeight(this.tabstrip.element) : 0;\n            var formulaBarHeight = actionBar ? outerHeight(actionBar) : 0;\n            var sheetsBarHeight = this.sheetsbar ? outerHeight(this.sheetsbar.element) : 0;\n\n            this.wrapper.height(\n                this.element.height() -\n                    (tabstripHeight + formulaBarHeight + sheetsBarHeight)\n            );\n\n            if (this.tabstrip) {\n                this.tabstrip.quickAccessAdjust();\n            }\n        },\n\n        _chrome: function() {\n            var wrapper = $(\"<div class='k-spreadsheet-action-bar' />\").prependTo(this.element);\n\n            var nameEditor = $(\"<div class='k-spreadsheet-name-editor' />\").appendTo(wrapper);\n            this.nameEditor = new kendo.spreadsheet.NameEditor(nameEditor, this.options);\n\n            var formulaBar = $(\"<div />\").appendTo(wrapper);\n            this.formulaBar = new kendo.spreadsheet.FormulaBar(formulaBar);\n\n            if (this.options.toolbar) {\n                this._tabstrip();\n            }\n        },\n\n        _formulaInput: function() {\n            var editor = this.element.find(DOT + View.classNames.cellEditor);\n\n            this.formulaInput = new kendo.spreadsheet.FormulaInput(editor, {\n                autoScale: true\n            });\n        },\n\n        _sheetsbar: function() {\n            if (this.options.sheetsbar) {\n                var options = $.extend(true, {\n                    openDialog: this.openDialog.bind(this)\n                }, this.options.sheetsbar);\n\n                this.sheetsbar = new kendo.spreadsheet.SheetsBar(this.element.find(DOT + View.classNames.sheetsBar), options);\n            }\n        },\n\n        _tabstrip: function() {\n            var messages = this.options.messages.tabs;\n            var options = $.extend(true, { home: true, insert: true, data: true }, this.options.toolbar);\n            var tabs = [];\n\n            if (this.tabstrip) {\n                this.tabstrip.destroy();\n                this.element.children(\".k-tabstrip\").remove();\n            }\n\n            for (var name in options) {\n                if (options[name] === true || options[name] instanceof Array) {\n                    tabs.push({ id: name, text: messages[name], content: \"\" });\n                }\n            }\n\n            this.tabstrip = new kendo.spreadsheet.TabStrip($(\"<div />\").prependTo(this.element), {\n                animation: false,\n                dataTextField: \"text\",\n                dataContentField: \"content\",\n                dataSource: tabs,\n                toolbarOptions: options,\n                view: this\n            });\n\n            this.tabstrip.select(0);\n        },\n\n        _executeCommand: function(e) {\n            this._sheet.trigger(\"commandRequest\", e);\n        },\n\n        workbook: function(workbook) {\n            this._workbook = workbook;\n            workbook._view = this;\n            this.nameEditor._workbook = workbook;\n        },\n\n        sheet: function(sheet) {\n            this._sheet = sheet;\n        },\n\n        activeCellRectangle: function() {\n            return this.cellRectangle(this._sheet._viewActiveCell());\n        },\n\n        _rectangle: function(pane, ref) {\n            return pane._grid.boundingRectangle(ref.toRangeRef());\n        },\n\n        isColumnResizer: function(x, pane, col) {\n            // relative to content\n            x -= this._sheet._grid._headerWidth;\n\n            // add scroll if pane is not frozen\n            if (!pane._grid.columns.frozen) {\n                x += this.scroller.scrollLeft;\n            }\n\n            col = this._sheet._grid._columns.locate(0, col, function(w){\n                return Math.abs(x - w) <= RESIZE_HANDLE_WIDTH/2;\n            });\n\n            return col !== null && !this._sheet.isHiddenColumn(col) ? col : null;\n        },\n\n        isRowResizer: function(y, pane, row) {\n            // relative to content\n            y -= this._sheet._grid._headerHeight;\n\n            // add scroll if pane is not frozen\n            if (!pane._grid.rows.frozen) {\n                y += this.scroller.scrollTop;\n            }\n\n            row = this._sheet._grid._rows.locate(0, row, function(h){\n                return Math.abs(y - h) <= RESIZE_HANDLE_WIDTH/2;\n            });\n\n            return row !== null && !this._sheet.isHiddenRow(row) ? row : null;\n        },\n\n        isFilterIcon: function(x, y, pane, ref) {\n            var self = this;\n            var theGrid = pane._grid;\n            var scrollTop = theGrid.rows.frozen ? 0 : self.scroller.scrollTop;\n            var scrollLeft = theGrid.columns.frozen ? 0 : self.scroller.scrollLeft;\n\n            x -= self._sheet._grid._headerWidth - scrollLeft;\n            y -= self._sheet._grid._headerHeight - scrollTop;\n\n            return kendo.util.withExit(function(exit){\n                self._sheet.forEachFilterHeader(ref, function(ref) {\n                    var rect = self._rectangle(pane, ref);\n                    if (pane.filterIconRect(rect).intersects(x, y)) {\n                        exit(true);\n                    }\n                });\n            });\n        },\n\n        isAutoFill: function(x, y, pane) {\n            var selection = this._sheet.select();\n\n            if (selection.size > 1) {\n                return false;\n            }\n\n            x -= this._sheet._grid._headerWidth;\n            y -= this._sheet._grid._headerHeight;\n\n            if (!pane._grid.columns.frozen) {\n                x += this.scroller.scrollLeft;\n            }\n\n            if (!pane._grid.rows.frozen) {\n                y += this.scroller.scrollTop;\n            }\n\n            var rectangle = this._rectangle(pane, selection);\n\n            return Math.abs(rectangle.right - x) < 8 && Math.abs(rectangle.bottom - y) < 8;\n        },\n\n        isEditButton: function(x, y, pane) {\n            var ed = this._sheet.activeCellCustomEditor();\n            if (ed) {\n                var r = this.activeCellRectangle();\n                // XXX: hard-coded button width (20)\n\n                if (y >= r.top && y <= r.bottom) {\n                    return pane._editorInLastColumn ? x < r.left && x >= r.left - EDIT_BUTTON_WIDTH\n                        : x > r.right && x <= r.right + EDIT_BUTTON_WIDTH;\n                }\n            }\n        },\n\n        drawingAt: function(x, y, pane) {\n            x -= this._sheet._grid._headerWidth;\n            y -= this._sheet._grid._headerHeight;\n\n            if (!pane._grid.columns.frozen) {\n                x += this.scroller.scrollLeft;\n            }\n\n            if (!pane._grid.rows.frozen) {\n                y += this.scroller.scrollTop;\n            }\n\n            var sheet = this._sheet;\n            var drawings = this._sheet._drawings;\n            for (var i = drawings.length; --i >= 0;) {\n                var d = drawings[i];\n                var box = sheet.drawingBoundingBox(d);\n                if (box.intersects(x, y)) {\n                    return {\n                        drawing: d,\n\n                        // also include how far is the drawing's\n                        // top-left from the mouse position, as it's\n                        // not easy to compute some place else.\n                        drx: box.left - x,\n                        dry: box.top - y\n                    };\n                }\n            }\n        },\n\n        objectAt: function(x, y, noDrawing) {\n            var grid = this._sheet._grid;\n            var object, pane;\n\n            if (x < 0 || y < 0 || x > this.scroller.clientWidth || y > this.scroller.clientHeight) {\n                object = { type: \"outside\" };\n            } else if (x < grid._headerWidth && y < grid._headerHeight) {\n                object = { type: \"topcorner\" };\n            } else {\n                pane = this.paneAt(x, y);\n\n                if (!pane) {\n                    object = { type: \"outside\" };\n                } else {\n                    if (!noDrawing) {\n                        var drawing = this.drawingAt(x, y, pane);\n                        if (drawing) {\n                            return {\n                                type: \"drawing\",\n                                drawing: drawing.drawing,\n                                drx: drawing.drx,\n                                dry: drawing.dry,\n                                pane: pane,\n                                startX: x,\n                                startY: y\n                            };\n                        }\n                    }\n\n                    var row = pane._grid.rows.indexVisible(y, this.scroller.scrollTop);\n                    var column = pane._grid.columns.indexVisible(x, this.scroller.scrollLeft);\n\n                    var type = \"cell\";\n                    var ref = new CellRef(row, column);\n                    var selecting = this._sheet.selectionInProgress();\n\n                    if (this.isAutoFill(x, y, pane)) {\n                        type = \"autofill\";\n                    } else if (this.isFilterIcon(x, y, pane, ref)) {\n                        type = \"filtericon\";\n                    } else if (!selecting && x < grid._headerWidth) {\n                        type = \"rowheader\";\n                        if ((row = this.isRowResizer(y, pane, row)) !== null) {\n                            ref = new CellRef(row, -Infinity);\n                            type = \"rowresizehandle\";\n                        }\n                    } else if (!selecting && y < grid._headerHeight) {\n                        type = \"columnheader\";\n                        if ((column = this.isColumnResizer(x, pane, column)) !== null) {\n                            ref = new CellRef(-Infinity, column);\n                            type = \"columnresizehandle\";\n                        }\n                    } else if (this.isEditButton(x, y, pane)) {\n                        type = \"editor\";\n                    }\n\n                    object = { type: type, ref: ref };\n                }\n            }\n\n            object.pane = pane;\n            object.x = x;\n            object.y = y;\n            return object;\n        },\n\n        paneAt: function(x, y) {\n            return this.panes.filter(function paneLocationWithin(pane) {\n                var grid = pane._grid;\n                return within(y, grid.top, grid.bottom) && within(x, grid.left, grid.right);\n            })[0];\n        },\n\n        containingPane: function(cell) {\n            return this.panes.filter(function(pane) {\n                if (pane._grid.contains(cell)) {\n                    return true;\n                }\n                return false;\n            })[0];\n        },\n\n        cellRectangle: function(cell) {\n            var theGrid = this.containingPane(cell)._grid;\n            var rectangle = this._sheet._grid.rectangle(cell);\n\n            return rectangle.offset(\n                theGrid.headerWidth - (theGrid.columns.frozen ? 0 : this.scroller.scrollLeft),\n                theGrid.headerHeight - (theGrid.rows.frozen ? 0 : this.scroller.scrollTop)\n            );\n        },\n\n        refresh: function(reason) {\n            var sheet = this._sheet;\n\n            if (this.tabstrip) {\n                this.tabstrip.refreshTools(sheet.range(sheet.activeCell()));\n            }\n\n            if (reason.sheetSelection && this.sheetsbar) {\n                this.sheetsbar.renderSheets(this._workbook.sheets(), this._workbook.sheetIndex(this._sheet));\n            }\n\n            this._resize();\n\n            //TODO: refresh sheets list on sheetSelection\n            this.viewSize[0].style.height = sheet._grid.totalHeight() + \"px\";\n            this.viewSize[0].style.width = sheet._grid.totalWidth() + \"px\";\n\n            if (reason.layout) {\n                var frozenColumns = sheet.frozenColumns();\n                var frozenRows = sheet.frozenRows();\n\n                // main or bottom or right pane\n                this.panes = [ this._pane(frozenRows, frozenColumns) ];\n\n                // left pane\n                if (frozenColumns > 0) {\n                    this.panes.push(this._pane(frozenRows, 0, null, frozenColumns));\n                }\n\n                // top pane\n                if (frozenRows > 0) {\n                    this.panes.push(this._pane(0, frozenColumns, frozenRows, null));\n                }\n\n                // left-top \"fixed\" pane\n                if (frozenRows > 0 && frozenColumns > 0) {\n                    this.panes.push(this._pane(0, 0, frozenRows, frozenColumns));\n                }\n            }\n\n            if (reason.filter) {\n                this._destroyFilterMenu();\n            }\n\n            if (reason.activeCell) {\n                this._focus = sheet.activeCell().toRangeRef();\n            }\n        },\n\n        createFilterMenu: function(column) {\n            this._destroyFilterMenu();\n\n            var sheet = this._sheet;\n            var ref = sheet.filter().ref;\n            var range = new kendo.spreadsheet.Range(ref, sheet);\n            var element = $(\"<div />\").appendTo(this.element);\n            var options = { column: column, range: range };\n            var filterMenu = new kendo.spreadsheet.FilterMenu(element, options);\n\n            this._filterMenu = filterMenu;\n\n            return filterMenu;\n        },\n\n        selectClipboardContents: function() {\n            if (!this.isClipboardDeactivated) {\n                this.clipboard.focus();\n                selectElementContents(this.clipboard[0]);\n            }\n        },\n\n        scrollIntoView: function(cell) {\n            var willScroll = false;\n            var theGrid = this.containingPane(cell)._grid;\n\n            var boundaries = theGrid.scrollBoundaries(cell);\n\n            var scroller = this.scroller;\n            var scrollTop = theGrid.rows.frozen ? 0 : scroller.scrollTop;\n            var scrollLeft = theGrid.columns.frozen ? 0 : scroller.scrollLeft;\n\n            if (boundaries.top < scrollTop) {\n                willScroll = true;\n                scroller.scrollTop = boundaries.scrollTop;\n            }\n\n            if (boundaries.bottom > scrollTop) {\n                willScroll = true;\n                scroller.scrollTop = boundaries.scrollBottom;\n            }\n\n            if (boundaries.left < scrollLeft) {\n                willScroll = true;\n                scroller.scrollLeft = boundaries.scrollLeft;\n            }\n\n            if (boundaries.right > scrollLeft) {\n                willScroll = true;\n                scroller.scrollLeft = boundaries.scrollRight;\n            }\n\n            return willScroll;\n        },\n\n        _destroyDialog: function() {\n            this._dialogs.pop();\n        },\n\n        openCustomEditor: function() {\n            var self = this;\n            var cell = self._sheet.activeCell().first();\n            var editor = self._sheet.activeCellCustomEditor();\n            var range = self._sheet.range(cell);\n            editor.edit({\n                range      : range,\n                rect       : self.activeCellRectangle(),\n                view       : this,\n                validation : this._sheet.validation(cell),\n                callback   : function(value, parse){\n                    self._executeCommand({\n                        command: \"EditCommand\",\n                        options: {\n                            operatingRange: range,\n                            editRange: range,\n                            property: parse ? \"input\" : \"value\",\n                            value: value\n                        }\n                    });\n                }\n            });\n        },\n\n        openDialog: function(name, options) {\n            var sheet = this._sheet;\n            return sheet.withCultureDecimals(function(){\n                var dialog = kendo.spreadsheet.dialogs.create(name, options);\n\n                if (dialog) {\n                    dialog.bind(\"action\", this._executeCommand.bind(this));\n                    dialog.bind(\"deactivate\", this._destroyDialog.bind(this));\n                    this._dialogs.push(dialog);\n\n                    var ref = sheet.activeCell();\n                    var range = new kendo.spreadsheet.Range(ref, sheet);\n\n                    dialog.open(range);\n                    return dialog;\n                }\n            }.bind(this));\n        },\n\n        showError: function(options, reopenEditor) {\n            var currentDialogs = this._dialogs;\n            var errorMessages = this.options.messages.errors;\n            var hasOpenedError = false;\n\n            if (currentDialogs.length > 0) {\n                currentDialogs.forEach(function(dialog) {\n                    if (dialog.options && dialog.options.title === ERROR) {\n                        hasOpenedError = true;\n                    }\n                });\n            }\n            if (hasOpenedError) {\n                return;\n            }\n\n            var focusButton = function(e) {\n                var cont = e.sender.dialog().element;\n                cont.find(\".k-button\").first().trigger(\"focus\");\n                cont.find(\".k-button, input\").on(\"keydown\", function(ev){\n                    if (ev.keyCode == kendo.keys.ESC) {\n                        e.sender.close();\n                    }\n                });\n            };\n\n            var onClose = function(e) {\n                var dlg = e.sender;\n                this.selectClipboardContents();\n                if (dlg._retry && reopenEditor) {\n                    reopenEditor();\n                }\n            }.bind(this);\n\n            if (kendo.spreadsheet.dialogs.registered(options.type)) {\n                var dialogOptions = {\n                    close: onClose\n                };\n\n                if (options.type === \"validationError\") {\n                    dialogOptions = $.extend(dialogOptions, {\n                        title: options.title || \"Error\",\n                        text: options.body ? options.body : errorMessages[options.type],\n                        activate: focusButton\n                    });\n                }\n\n                this.openDialog(options.type, dialogOptions);\n            } else {\n                this.openDialog(\"message\", {\n                    title : options.title || \"Error\",\n                    text  : options.body ? options.body : errorMessages[options.type],\n                    activate: focusButton,\n                    close: onClose\n                });\n            }\n        },\n\n        destroy: function() {\n            this._dialogs.forEach(function(dialog) {\n                dialog.destroy();\n            });\n\n            if (this.cellContextMenu) {\n                this.cellContextMenu.destroy();\n            }\n\n            this.rowHeaderContextMenu.destroy();\n            this.colHeaderContextMenu.destroy();\n            this.drawingContextMenu.destroy();\n\n            this.cellContextMenu = this.rowHeaderContextMenu =\n                                   this.colHeaderContextMenu =\n                                   this.drawingContextMenu = null;\n\n            if (this.tabstrip) {\n                this.tabstrip.destroy();\n                this.tabstrip = null;\n            }\n\n            this._destroyFilterMenu();\n        },\n\n        _destroyFilterMenu: function() {\n            if (this._filterMenu) {\n                this._filterMenu.destroy();\n                this._filterMenu = undefined;\n                this._filterMenuColumn = undefined;\n            }\n        },\n\n        render: function(reason) {\n            if (!this.element.is(\":visible\")) {\n                return;\n            }\n            var sheet = this._sheet;\n            var focus = sheet.focus();\n            var scrollbarSize = kendo.support.scrollbar();\n            var contentWidth = this.wrapper[0].clientWidth - scrollbarSize;\n            var contentHeight = this.wrapper[0].clientHeight - scrollbarSize;\n\n            if (focus && this.scrollIntoView(focus)) {\n                return;\n            }\n\n            var resizeDirection =\n                !sheet.resizingInProgress() ? \"none\" :\n                sheet.resizeHandlePosition().col === -Infinity ? \"column\" :\n                \"row\";\n\n            this.wrapper\n                .toggleClass(viewClassNames.editContainer, this.editor.isActive())\n                .toggleClass(viewClassNames.horizontalResize, resizeDirection == \"row\")\n                .toggleClass(viewClassNames.verticalResize, resizeDirection == \"column\");\n\n            var grid = sheet._grid;\n            var content = [];\n            var args = {\n                scroller: this.scroller,\n                toplevelElements: content,\n                contentWidth: contentWidth,\n                contentHeight: contentHeight\n            };\n            this.panes.forEach(function(pane) {\n                content.push(pane.render(args));\n            });\n\n            var topCorner = kendo.dom.element(\"div\", {\n                style: { width: grid._headerWidth + \"px\", height: grid._headerHeight + \"px\" },\n                className: View.classNames.topCorner\n            });\n\n            content.push(topCorner);\n\n            if (sheet.resizeHandlePosition() && sheet.resizeHintPosition()) {\n                content.push(this.renderResizeHint());\n            }\n\n            this.tree.render(content);\n\n            $(this.container).css({\n                width: contentWidth,\n                height: contentHeight\n            });\n\n            if (this.editor.isActive()) {\n                this.editor.toggleTooltip(this.activeCellRectangle());\n            } else if (!(reason.resize ||\n                         reason.comment ||\n                         sheet.selectionInProgress() ||\n                         sheet.resizingInProgress() ||\n                         sheet.draggingInProgress() ||\n                         sheet.isInEditMode())) {\n                this.renderClipboardContents();\n            }\n        },\n\n        // this renders the big blue line during resizing\n        renderResizeHint: function() {\n            var sheet = this._sheet;\n            var ref = sheet.resizeHandlePosition();\n\n            var horizontal = ref.col !== -Infinity;\n\n            var style;\n            if (horizontal) {\n                style = {\n                    height: this.scroller.clientHeight + \"px\",\n                    width: RESIZE_HANDLE_WIDTH + \"px\",\n                    left: sheet.resizeHintPosition().x + \"px\",\n                    top: \"0px\"\n                };\n            } else {\n                style = {\n                    height: RESIZE_HANDLE_WIDTH + \"px\",\n                    width: this.scroller.clientWidth + \"px\",\n                    top: sheet.resizeHintPosition().y + \"px\",\n                    left: \"0px\"\n                };\n            }\n\n            var classNames = Pane.classNames;\n\n            return kendo.dom.element(\"div\", {\n                className: classNames.resizeHint + (!horizontal ? \" \" + classNames.resizeHintVertical : \"\"),\n                style: style\n            },[\n                kendo.dom.element(\"div\", { className: classNames.resizeHintHandle }),\n                kendo.dom.element(\"div\", { className: classNames.resizeHintMarker })\n            ]);\n        },\n\n        renderClipboardContents: function() {\n            var sheet = this._sheet;\n            var grid = sheet._grid;\n\n            // if (sheet._activeDrawing && sheet._activeDrawing.image) {\n            //     var url = this._workbook.imageUrl(sheet._activeDrawing.image);\n            //     var img = kendo.dom.element(\"img\", {\n            //         src: url,\n            //         style: {\n            //             width: sheet._activeDrawing.width + \"px\",\n            //             height: sheet._activeDrawing.height + \"px\"\n            //         }\n            //     });\n            //     this.clipboardContents.render([ img ]);\n            //     this.selectClipboardContents();\n            //     return;\n            // }\n\n            var selection = grid.normalize(sheet.select().toRangeRef());\n            var status = this._workbook.clipboard().canCopy();\n            if (status.canCopy === false && status.multiSelection) {\n                this.clipboardContents.render([]);\n                this.selectClipboardContents();\n                return;\n            }\n\n            selection = sheet.trim(selection);\n\n            var table = new HtmlTable();\n\n            var selectionView = grid.rangeDimensions(selection);\n\n            selectionView.rows.forEach(function(height) {\n                table.addRow(height);\n            });\n\n            selectionView.columns.forEach(function(width) {\n                table.addColumn(width);\n            });\n\n            var tmp = sheet._getMergedCells(selection);\n            var primaryMergedCells = tmp.primary;\n            var secondaryMergedCells = tmp.secondary;\n\n            sheet.forEach(selection, function(row, col, cell) {\n                var location = new CellRef(row, col).print();\n\n                if (!secondaryMergedCells[location]) {\n                    var td = addCell(table, row - selection.topLeft.row, cell);\n\n                    var mergedCell = primaryMergedCells[location];\n\n                    if (mergedCell) {\n                        td.attr.colspan = mergedCell.width();\n                        td.attr.rowspan = mergedCell.height();\n                    }\n                }\n            });\n\n            if (kendo.support.browser.msie) {\n                this.clipboard.empty();\n            }\n\n            this.clipboardContents.render([ table.toDomTree(0, 0, \"kendo-clipboard-\" + this._workbook.clipboard()._uid) ]);\n\n            this.selectClipboardContents();\n        },\n\n        _pane: function(row, column, rowCount, columnCount) {\n            var pane = new Pane(this._sheet, this._sheet._grid.pane({ row: row, column: column, rowCount: rowCount, columnCount: columnCount }));\n            pane.refresh(this.scroller.clientWidth, this.scroller.clientHeight);\n            return pane;\n        }\n    });\n\n    var paneClassNames = {\n        cell: \"k-spreadsheet-cell\",\n        vaxis: \"k-spreadsheet-vaxis\",\n        haxis: \"k-spreadsheet-haxis\",\n        vborder: \"k-spreadsheet-vborder\",\n        hborder: \"k-spreadsheet-hborder\",\n        rowHeader: \"k-spreadsheet-row-header\",\n        columnHeader: \"k-spreadsheet-column-header\",\n        pane: \"k-spreadsheet-pane\",\n        data: \"k-spreadsheet-data\",\n        mergedCell: \"k-spreadsheet-merged-cell\",\n        mergedCellsWrapper: \"k-merged-cells-wrapper\",\n        activeCell: \"k-spreadsheet-active-cell\",\n        selection: \"k-spreadsheet-selection\",\n        selectionWrapper: \"k-selection-wrapper\",\n        autoFillWrapper: \"k-auto-fill-wrapper\",\n        single: \"k-single\",\n        top: \"k-top\",\n        right: \"k-right\",\n        bottom: \"k-bottom\",\n        left: \"k-left\",\n        resizeHandle: \"k-resize-handle\",\n        columnResizeHandle: \"k-column-resize-handle\",\n        rowResizeHandle: \"k-row-resize-handle\",\n        resizeHint: \"k-resize-hint\",\n        resizeHintHandle: \"k-resize-hint-handle\",\n        resizeHintMarker: \"k-resize-hint-marker\",\n        resizeHintVertical: \"k-resize-hint-vertical\",\n        selectionHighlight: \"k-spreadsheet-selection-highlight\",\n        series: [\n            \"k-series-a\",\n            \"k-series-b\",\n            \"k-series-c\",\n            \"k-series-d\",\n            \"k-series-e\",\n            \"k-series-f\"\n        ]\n    };\n\n    var Pane = kendo.Class.extend({\n        init: function(sheet, grid) {\n            this._sheet = sheet;\n            this._grid = grid;\n        },\n\n        refresh: function(width, height) {\n            this._grid.refresh(width, height);\n        },\n\n        isVisible: function(scrollLeft, scrollTop, ref) {\n            return this._grid.view(scrollLeft, scrollTop).ref.intersects(ref);\n        },\n\n        render: function(args) {\n            var scroller = args.scroller;\n            var scrollLeft = scroller.scrollLeft;\n            var scrollTop = scroller.scrollTop;\n\n            if (scrollTop < 0) {\n                scrollTop = 0;\n            }\n\n            if (scrollLeft < 0) {\n                scrollLeft = 0;\n            }\n\n            var classNames = Pane.classNames;\n            var sheet = this._sheet;\n            var grid = this._grid;\n            var view = grid.view(scrollLeft, scrollTop);\n            this._currentView = view;\n            this._currentRect = this._rectangle(view.ref);\n            this._selectedHeaders = sheet.selectedHeaders();\n\n            var children = [];\n\n            children.push(this.renderData(args));\n\n            if (!sheet._activeDrawing) {\n                children.push(this.renderSelection(scroller));\n            }\n\n            children.push(this.renderAutoFill());\n\n            children.push(this.renderEditorSelection());\n\n            children.push(this.renderFilterHeaders());\n\n            if (grid.hasRowHeader) {\n                var rowHeader = kendo.dom.element(\"div\", {\n                    className: classNames.rowHeader,\n                    style: {\n                        width: grid.headerWidth + \"px\",\n                        top: view.rowOffset + \"px\"\n                    }\n                });\n                children.push(rowHeader);\n                sheet.forEach(view.ref.leftColumn(), function(row){\n                    if (!sheet.isHiddenRow(row)) {\n                        var text = row + 1, height = sheet.rowHeight(row);\n                        rowHeader.children.push(kendo.dom.element(\"div\", {\n                            className: this.headerClassName(row, \"row\"),\n                            style: {\n                                width: grid.headerWidth + \"px\",\n                                height: height + \"px\"\n                            }\n                        }, [ kendo.dom.element(\"div\", {\n                            className: \"k-vertical-align-center\"\n                        }, [ kendo.dom.text(text+\"\") ])]));\n                    }\n                }.bind(this));\n            }\n\n            if (grid.hasColumnHeader) {\n                var columnHeader = kendo.dom.element(\"div\", {\n                    className: classNames.columnHeader,\n                    style: {\n                        top: \"0px\",\n                        left: view.columnOffset + \"px\",\n                        width: this._currentRect.width + \"px\",\n                        height: grid.headerHeight + \"px\"\n                    }\n                });\n                children.push(columnHeader);\n                var left = 0;\n                sheet.forEach(view.ref.topRow(), function(row, col){\n                    if (!sheet.isHiddenColumn(col)) {\n                        var text = kendo.spreadsheet.Ref.display(null, Infinity, col),\n                            width = sheet.columnWidth(col);\n                        columnHeader.children.push(kendo.dom.element(\"div\", {\n                            className: this.headerClassName(col, \"col\"),\n                            style: {\n                                position: \"absolute\",\n                                left: left + \"px\",\n                                width: width + \"px\",\n                                height: grid.headerHeight + \"px\"\n                            }\n                        }, [ kendo.dom.element(\"div\", {\n                            className: \"k-vertical-align-center\"\n                        }, [ kendo.dom.text(text+\"\") ])]));\n                        left += width;\n                    }\n                }.bind(this));\n            }\n\n            if (sheet.resizeHandlePosition() && (grid.hasColumnHeader || grid.hasRowHeader)) {\n                if (!sheet.resizeHintPosition()) {\n                    this.renderResizeHandle(children);\n                }\n            }\n\n            var paneClasses = [classNames.pane];\n\n            if (grid.hasColumnHeader) {\n                paneClasses.push(classNames.top);\n            }\n\n            if (grid.hasRowHeader) {\n                paneClasses.push(classNames.left);\n            }\n\n            return kendo.dom.element(\"div\", {\n                style: grid.style,\n                className: paneClasses.join(\" \")\n            }, children);\n        },\n\n        headerClassName: function(index, type) {\n            var selectedHeaders = this._selectedHeaders;\n\n            var itemSelection;\n            var allHeaders;\n\n            if (type === \"row\") {\n                itemSelection = selectedHeaders.rows[index];\n                allHeaders = selectedHeaders.allRows;\n            } else {\n                itemSelection = selectedHeaders.cols[index];\n                allHeaders = selectedHeaders.allCols;\n            }\n\n            var className = itemSelection || (selectedHeaders.all ? \"full\" : (allHeaders ? \"partial\" : \"none\"));\n\n            if (className) {\n                className = \"k-selection-\" + className;\n            }\n\n            return className;\n        },\n\n        renderData: function(args) {\n            var sheet = this._sheet;\n            var view = this._currentView;\n            var cont = kendo.dom.element(\"div\", {\n                className: Pane.classNames.data,\n                style: {\n                    position: \"relative\",\n                    left: view.columnOffset + \"px\",\n                    top: view.rowOffset + \"px\"\n                }\n            });\n            var rect = this._currentRect;\n            var layout = kendo.spreadsheet.draw.doLayout(sheet, view.ref, { forScreen: true }), prev;\n            var grid = this._grid;\n            var showGridLines = sheet._showGridLines;\n            if (showGridLines) {\n                // draw axis first\n                prev = null;\n                layout.xCoords.forEach(function(x){\n                    if (x !== prev) {\n                        prev = x;\n                        cont.children.push(kendo.dom.element(\"div\", {\n                            className: paneClassNames.vaxis,\n                            style: {\n                                left: x + \"px\",\n                                height: rect.height + \"px\",\n                                borderColor: sheet.gridLinesColor()\n                            }\n                        }));\n                    }\n                });\n                prev = null;\n                layout.yCoords.forEach(function(y){\n                    if (y !== prev) {\n                        prev = y;\n                        cont.children.push(kendo.dom.element(\"div\", {\n                            className: paneClassNames.haxis,\n                            style: {\n                                top: y + \"px\",\n                                width: rect.width + \"px\",\n                                borderColor: sheet.gridLinesColor()\n                            }\n                        }));\n                    }\n                });\n            }\n            var borders = kendo.spreadsheet.draw.Borders();\n            var activeCellRange = sheet.activeCell().toRangeRef();\n            var activeCell = activeCellRange.topLeft;\n\n            layout.cells.forEach(function(cell){\n                var cls = null;\n                var absRow = cell.row + view.ref.topLeft.row;\n                var absCol = cell.col + view.ref.topLeft.col;\n                if (sheet._activeDrawing) {\n                    var ref = sheet._activeDrawing.topLeftCell;\n                    if (ref && ref.row == absRow && ref.col == absCol) {\n                        cls = \"k-spreadsheet-drawing-anchor-cell\";\n                    }\n                } else if (absRow == activeCell.row && absCol == activeCell.col) {\n                    // active cell.  normally we enter here only once.\n                    cls = [\n                        Pane.classNames.activeCell\n                    ].concat(this._activeFormulaColor(),\n                             this._directionClasses(activeCellRange));\n                    if (sheet.singleCellSelection()) {\n                        cls.push(Pane.classNames.single);\n                    }\n                    cls = cls.join(\" \");\n                }\n                borders.add(cell);\n                drawCell(cont.children, cell, cls, showGridLines);\n                if (cell.comment && sheet._commentRef &&\n                    absRow == sheet._commentRef.row && absCol == sheet._commentRef.col) {\n                    var ttOffset = 4;\n                    var left = cell.right + grid.left + view.columnOffset + ttOffset;\n                    var style = { top: (cell.top + grid.top + view.rowOffset) + \"px\" };\n                    if (left + 200 > args.contentWidth) {\n                        style.right = (args.contentWidth - grid.left - cell.left - view.columnOffset + ttOffset) + \"px\";\n                    } else {\n                        style.left = left + \"px\";\n                    }\n                    var div = kendo.dom.element(\"div\", {\n                        className: \"k-tooltip k-spreadsheet-cell-comment\",\n                        style: style\n                    }, [ kendo.dom.text(cell.comment) ]);\n                    args.toplevelElements.push(div);\n                }\n            }, this);\n            borders.vert.forEach(function(a){\n                a.forEach(function(b){\n                    if (!b.rendered) {\n                        b.rendered = true;\n                        var style = {\n                            left        : b.x + \"px\",\n                            top         : b.top + \"px\",\n                            height      : (b.bottom - b.top + 1) + \"px\",\n                            borderWidth : b.size + \"px\",\n                            borderColor : b.color\n                        };\n                        if (b.size != 1) {\n                            style.transform = \"translateX(-\" + (b.size-1)/2 + \"px)\";\n                        }\n                        cont.children.push(kendo.dom.element(\"div\", {\n                            className: paneClassNames.vborder,\n                            style: style\n                        }));\n                    }\n                });\n            });\n            borders.horiz.forEach(function(a){\n                a.forEach(function(b){\n                    if (!b.rendered) {\n                        b.rendered = true;\n                        var style = {\n                            top         : b.y + \"px\",\n                            left        : b.left + \"px\",\n                            width       : (b.right - b.left) + \"px\",\n                            borderWidth : b.size + \"px\",\n                            borderColor : b.color\n                        };\n                        if (b.size != 1) {\n                            style.transform = \"translateY(-\" + (b.size-1)/2 + \"px)\";\n                        }\n                        cont.children.push(kendo.dom.element(\"div\", {\n                            className: paneClassNames.hborder,\n                            style: style\n                        }));\n                    }\n                });\n            });\n            this.renderDrawings(layout, cont.children);\n            return cont;\n        },\n\n        renderDrawings: function(layout, container) {\n            var sheet = this._sheet;\n            var workbook = sheet._workbook;\n            layout.drawings.forEach(function(d){\n                var drawing = d.drawing;\n                var box = d.box;\n                var div = box.toDiv(\"k-spreadsheet-drawing\");\n                if (drawing.image) {\n                    div.children.push(kendo.dom.element(\"div\", {\n                        className: \"k-spreadsheet-drawing-image\",\n                        style: {\n                            backgroundImage: \"url('\" + workbook.imageUrl(drawing.image) + \"')\",\n                            opacity: drawing.opacity\n                        }\n                    }));\n                }\n                if (drawing === sheet._activeDrawing) {\n                    div.attr.className += \" k-spreadsheet-active-drawing\";\n                    drawingResizeHandles(div.children);\n                }\n                container.push(div);\n            });\n        },\n\n        renderResizeHandle: function(container) {\n            var sheet = this._sheet;\n            var ref = sheet.resizeHandlePosition();\n            var rectangle = this._rectangle(ref);\n            var classNames = [ Pane.classNames.resizeHandle ];\n\n            var style;\n            if (ref.col !== -Infinity) {\n                if (this._grid.rows._start > 0) {\n                    return;\n                }\n                style = {\n                    height: this._grid.headerHeight + \"px\",\n                    width: RESIZE_HANDLE_WIDTH + \"px\",\n                    left: rectangle.right - RESIZE_HANDLE_WIDTH/2  + \"px\",\n                    top: \"0px\"\n                };\n                classNames.push(viewClassNames.horizontalResize);\n            } else {\n                if (this._grid.columns._start > 0) {\n                    return;\n                }\n                style = {\n                    height: RESIZE_HANDLE_WIDTH + \"px\",\n                    width:  this._grid.headerWidth + \"px\",\n                    top: rectangle.bottom - RESIZE_HANDLE_WIDTH/2  + \"px\",\n                    left: \"0px\"\n                };\n                classNames.push(viewClassNames.verticalResize);\n            }\n\n            container.push(kendo.dom.element(\"div\", {\n                className: classNames.join(\" \"),\n                style: style\n            }));\n        },\n\n        filterIconRect: function(rect) {\n            var BUTTON_SIZE = 16;\n            var BUTTON_OFFSET = 3;\n\n            return new kendo.spreadsheet.Rectangle(\n                rect.right - BUTTON_SIZE - BUTTON_OFFSET,\n                rect.top + BUTTON_OFFSET,\n                BUTTON_SIZE,\n                BUTTON_SIZE\n            );\n        },\n\n        renderFilterHeaders: function() {\n            var sheet = this._sheet;\n            var children = [];\n            var classNames = View.classNames;\n            var filter = sheet.filter();\n\n            function icon(className) {\n                return kendo.dom.element(\"span\", {\n                    className: classNames.icon + \" \" + className\n                });\n            }\n\n            function filterButton(classNames, position, index) {\n                var style = {\n                    left: position.left + \"px\",\n                    top: position.top + \"px\"\n                };\n                var filtered = filter && filter.columns.some(function(c) {\n                    return c.index === index;\n                });\n                var classes = classNames.filterButton;\n\n                if (filtered) {\n                    classes += \" \" + classNames.filterButtonSelected;\n                }\n\n                var button = kendo.dom.element(\n                    \"span\",\n                    { className: classes, style: style },\n                    [ icon(classNames.iconFilterDefault) ]\n                );\n\n                return button;\n            }\n\n            if (filter) {\n                this._addDiv(children, filter.ref, classNames.filterRange);\n            }\n\n            sheet.forEachFilterHeader(this._currentView.ref, function(ref) {\n                var rect = this._rectangle(ref);\n                var position = this.filterIconRect(rect);\n                var column = this._sheet.filterColumn(ref);\n                var button = filterButton(classNames, position, column);\n\n                children.push(button);\n            }.bind(this));\n\n            return kendo.dom.element(\"div\", {\n                className: classNames.filterHeadersWrapper\n            }, children);\n\n        },\n\n        renderEditorSelection: function() {\n            var classNames = Pane.classNames;\n            var sheet = this._sheet;\n            var selections = [];\n\n            sheet._formulaSelections.forEach(function(range) {\n                var ref = range.ref;\n\n                if (ref === kendo.spreadsheet.NULLREF) {\n                    return;\n                }\n\n                this._addDiv(selections, ref, classNames.selectionHighlight + \" \" + range.colorClass);\n            }.bind(this));\n\n            return kendo.dom.element(\"div\", { className: classNames.selectionWrapper }, selections);\n\n        },\n\n        renderSelection: function(scroller) {\n            var classNames = Pane.classNames;\n            var selections = [];\n            var selectionClasses = [classNames.selection];\n            var sheet = this._sheet;\n            var activeCell = sheet.activeCell().toRangeRef();\n            var selection = sheet.select();\n\n            selectionClasses = selectionClasses.concat(this._activeFormulaColor());\n\n            if (selection.size() === 1) {\n                selectionClasses.push(\"k-single-selection\");\n            }\n\n            if (this._sheet.autoFillPunch()) {\n                selectionClasses.push(\"k-dim-auto-fill-handle\");\n            }\n\n            selection.forEach(function(ref) {\n                if (ref !== kendo.spreadsheet.NULLREF) {\n                    this._addDiv(selections, ref, selectionClasses.join(\" \"));\n                }\n            }.bind(this));\n\n            this._renderCustomEditorButton(selections, activeCell, scroller);\n\n            return kendo.dom.element(\"div\", { className: classNames.selectionWrapper }, selections);\n        },\n\n        renderAutoFill: function() {\n            var autoFillRectangle = [];\n\n            if (this._sheet.autoFillInProgress()) {\n                var autoFillRef = this._sheet.autoFillRef();\n                var punch = this._sheet.autoFillPunch();\n                var direction = this._sheet._autoFillDirection;\n\n                this._addDiv(autoFillRectangle, autoFillRef, \"k-auto-fill\");\n\n                if (punch) { // collapsing, add overlay\n                    this._addDiv(autoFillRectangle, punch, \"k-auto-fill-punch\");\n                } else if (direction !== undefined) { // expanding - add hint\n                    var ref, cssClass;\n\n                    switch(direction) {\n                        case 0:\n                            ref = autoFillRef.bottomRight;\n                            cssClass = \"k-auto-fill-br-hint\";\n                            break;\n                        case 1:\n                            ref = autoFillRef.bottomRight;\n                            cssClass = \"k-auto-fill-br-hint\";\n                            break;\n                        case 2:\n                            ref = new CellRef(autoFillRef.topLeft.row, autoFillRef.bottomRight.col);\n                            cssClass = \"k-auto-fill-tr-hint\";\n                            break;\n                        case 3:\n                            ref = new CellRef(autoFillRef.bottomRight.row, autoFillRef.topLeft.col);\n                            cssClass = \"k-auto-fill-bl-hint\";\n                            break;\n                    }\n\n                    var rectangle = this._addDiv(autoFillRectangle, ref, cssClass);\n                    if (rectangle) {\n                        var hint = kendo.dom.element(\"span\", { className: \"k-tooltip\" }, [ kendo.dom.text(this._sheet._autoFillHint) ]);\n                        rectangle.children.push(hint);\n                    }\n                }\n            }\n\n            return kendo.dom.element(\"div\", { className: Pane.classNames.autoFillWrapper }, autoFillRectangle);\n        },\n\n        _addDiv: function(collection, ref, className) {\n            var view = this._currentView, div;\n\n            if (view.ref.intersects(ref)) {\n                div = this._rectangle(ref).resize(1, 1).toDiv(className);\n                collection.push(div);\n            }\n            return div;\n        },\n\n        _renderCustomEditorButton: function(collection, ref, scroller) {\n            var self = this;\n            var sheet = self._sheet;\n            var view = self._currentView;\n            var columnCount = self._grid.columns._axis._count;\n            var ed = sheet.activeCellCustomEditor();\n\n            if (ed && view.ref.intersects(ref)) {\n                var rectangle = self._rectangle(ref);\n                sheet.forEach(ref.collapse(), function(row, col, cell) {\n                    cell.left = rectangle.left;\n                    cell.top = rectangle.top;\n                    cell.width = rectangle.width;\n                    cell.height = rectangle.height;\n\n                    var btnClass = \"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-spreadsheet-editor-button\";\n                    var isLastColumn = col == columnCount - 1 || self._buttonOutOfVisiblePane(row, col, scroller);\n                    if (isLastColumn) {\n                        btnClass += \" k-spreadsheet-last-column\";\n                    }\n                    self._editorInLastColumn = isLastColumn;\n                    var btn = kendo.dom.element(\"div\", {\n                        className: btnClass,\n                        style: {\n                            left   : (cell.left + (isLastColumn ? 0 : cell.width)) + \"px\",\n                            top    : cell.top + \"px\",\n                            height : cell.height + \"px\"\n                        }\n                    });\n                    if (ed.icon) {\n                        btn.children.push(kendo.dom.element(\"span\", {\n                            className: \"k-icon \" + ed.icon\n                        }));\n                    }\n                    collection.push(btn);\n                });\n            }\n        },\n\n        _activeFormulaColor: function() {\n            var activeFormulaSelection;\n            var colorClasses = [];\n\n            if (this._sheet.isInEditMode()) {\n                activeFormulaSelection = this._sheet._formulaSelections.filter(function(sel) { return sel.active && sel.type == \"ref\"; })[0];\n\n                if (activeFormulaSelection) {\n                    colorClasses.push(activeFormulaSelection.colorClass);\n                }\n            }\n\n            return colorClasses;\n        },\n\n        _directionClasses: function(cell) {\n            var cellClasses = [];\n            var classNames = Pane.classNames;\n            var view = this._currentView.ref;\n\n            if (!cell.move(0, -1).intersects(view)) {\n                cellClasses.push(classNames.left);\n            }\n\n            if (!cell.move(-1, 0).intersects(view)) {\n                cellClasses.push(classNames.top);\n            }\n\n            if (!cell.move(0, 1).intersects(view)) {\n                cellClasses.push(classNames.right);\n            }\n\n            if (!cell.move(1, 0).intersects(view)) {\n                cellClasses.push(classNames.bottom);\n            }\n\n            return cellClasses;\n        },\n\n        _rectangle: function(ref) {\n            return this._grid.boundingRectangle(ref.toRangeRef()).offset(-this._currentView.mergedCellLeft, -this._currentView.mergedCellTop);\n        },\n\n        _buttonOutOfVisiblePane: function(row, col, scroller) {\n            var self = this;\n            var theGrid = self._grid;\n            var sheet = self._sheet;\n            var ref = sheet.range(row, col)._ref;\n            var boundaries = theGrid.scrollBoundaries(ref);\n            var scrollLeft = theGrid.columns.frozen ? 0 : scroller.scrollLeft;\n\n            if (boundaries.right + EDIT_BUTTON_WIDTH > scrollLeft || col + 1 === sheet.frozenColumns()) {\n                return true;\n            }\n        }\n    });\n\n    function drawingResizeHandles(container) {\n        [ \"N\", \"NE\", \"E\", \"SE\", \"S\", \"SW\", \"W\", \"NW\" ].forEach(function(direction) {\n            container.push(kendo.dom.element(\"div\", {\n                \"className\": \"k-spreadsheet-drawing-handle \" + direction,\n                \"data-direction\": direction\n            }));\n        });\n    }\n\n    kendo.spreadsheet.View = View;\n    kendo.spreadsheet.Pane = Pane;\n    kendo.spreadsheet.drawCell = drawCell;\n\n    $.extend(true, View, { classNames: viewClassNames });\n    $.extend(true, Pane, { classNames: paneClassNames });\n\n})(window.kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/customeditors',[ \"kendo.core\", \"kendo.popup\", \"kendo.calendar\", \"kendo.listview\", \"./sheet\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    \"use strict\";\n\n    \n\n    var $ = kendo.jQuery;\n\n    var EDITORS = {};\n\n    var registerEditor = kendo.spreadsheet.registerEditor = function(name, editor) {\n        EDITORS[name] = editor;\n    };\n\n    kendo.spreadsheet.Sheet.prototype.activeCellCustomEditor = function() {\n        var cell = this.activeCell().first();\n\n        if (this.range(cell).enable()) {\n            var val = this.validation(cell);\n            var key = this._properties.get(\"editor\", this._grid.cellRefIndex(cell));\n            var editor;\n\n            if (key != null) {\n                editor = EDITORS[key];\n            }\n            else if (val && val.showButton) {\n                key = \"_validation_\" + val.dataType;\n                editor = EDITORS[key];\n            }\n\n            if (typeof editor == \"function\") {\n                editor = EDITORS[key] = editor();\n            }\n\n            return editor;\n        }\n    };\n\n    registerEditor(\"_validation_date\", function(){\n        var context, calendar, popup;\n\n        function create() {\n            if (!calendar) {\n                calendar = $(\"<div>\").kendoCalendar();\n                popup = $(\"<div>\").kendoPopup();\n                calendar.appendTo(popup);\n                calendar = calendar.getKendoCalendar();\n                popup = popup.getKendoPopup();\n\n                calendar.bind(\"change\", function(){\n                    popup.close();\n                    var date = calendar.value();\n                    if (!context.range.format()) {\n                        context.range.format(\"yyyy-mm-dd\");\n                    }\n                    context.callback(kendo.spreadsheet.dateToNumber(date));\n                });\n            }\n            popup.setOptions({\n                anchor: context.view.element.find(\".k-spreadsheet-editor-button\")\n            });\n        }\n\n        function open() {\n            create();\n\n            var date = context.range.value();\n            var sheet = context.range.sheet();\n            if (date != null) {\n                calendar.value(kendo.spreadsheet.numberToDate(date));\n            } else {\n                calendar.value(null);\n            }\n            var val = context.validation;\n            if (val) {\n                var min = kendo.ui.Calendar.fn.options.min;\n                var max = kendo.ui.Calendar.fn.options.max;\n                var fromValidation = val.from;\n                var toValidation = val.to;\n                var formula = kendo.spreadsheet.calc.runtime.Formula;\n\n                if (/^(?:greaterThan|between)/.test(val.comparerType)) {\n                    if(fromValidation instanceof formula && _rowAndColPresent(fromValidation.value)) {\n                        min = kendo.spreadsheet.numberToDate(sheet.range(fromValidation.value.row, fromValidation.value.col).value());\n                    } else {\n                        min = kendo.spreadsheet.numberToDate(fromValidation.value);\n                    }\n                }\n                if (val.comparerType == \"between\") {\n                    if(toValidation instanceof formula && _rowAndColPresent(toValidation.value)) {\n                        max = kendo.spreadsheet.numberToDate(sheet.range(toValidation.value.row, toValidation.value.col).value());\n                    } else {\n                        max = kendo.spreadsheet.numberToDate(val.to.value);\n                    }\n                }\n                if (val.comparerType == \"lessThan\" || val.comparerType == \"lessThanOrEqualTo\") {\n                    if(fromValidation instanceof formula && _rowAndColPresent(fromValidation.value)) {\n                        max = kendo.spreadsheet.numberToDate(sheet.range(fromValidation.value.row, fromValidation.value.col).value());\n                    } else {\n                        max = kendo.spreadsheet.numberToDate(val.from.value);\n                    }\n                }\n                calendar.setOptions({\n                    disableDates: function(date) {\n                        var from, to;\n\n                        if(fromValidation && fromValidation instanceof formula && _rowAndColPresent(fromValidation.value)) {\n                            from = sheet.range(fromValidation.value.row, fromValidation.value.col).value();\n                        } else {\n                            from = fromValidation ? fromValidation.value|0 : 0;\n                        }\n\n                        if(toValidation && toValidation instanceof formula && _rowAndColPresent(toValidation.value)) {\n                            to = sheet.range(toValidation.value.row, toValidation.value.col).value();\n                        } else {\n                            to = toValidation ? toValidation.value|0 : 0;\n                        }\n\n                        date = kendo.spreadsheet.dateToNumber(date) | 0;\n                        return !kendo.spreadsheet.validation\n                            .validationComparers[val.comparerType](date, from, to);\n                    },\n                    min: min,\n                    max: max\n                });\n            } else {\n                calendar.setOptions({ disableDates: null, min: null, max: null });\n            }\n            popup.open();\n        }\n\n        function _rowAndColPresent(value) {\n            return (value && value.row !== null && value.col !== null && value.row > -1 && value.col > -1);\n        }\n\n        return {\n            edit: function(options) {\n                context = options;\n                open();\n            },\n            icon: \"k-i-calendar\"\n        };\n    });\n\n    registerEditor(\"_validation_list\", function(){\n        var context, list, popup;\n        function create() {\n            if (!list) {\n                list = $(\"<ul class='k-list k-reset'/>\").kendoStaticList({\n                    template   : \"#:value#\",\n                    selectable : true,\n                    autoBind   : false\n                });\n                popup = $(\"<div class='k-spreadsheet-list-popup'>\").kendoPopup();\n                list.appendTo(popup);\n                popup = popup.getKendoPopup();\n                list = list.getKendoStaticList();\n\n                list.bind(\"change\", function(){\n                    popup.close();\n                    var item = list.value()[0];\n                    if (item) {\n                        context.callback(item.value);\n                    }\n                });\n            }\n            popup.setOptions({\n                anchor: context.view.element.find(\".k-spreadsheet-editor-button\")\n            });\n        }\n        function open() {\n            create();\n            var items = context.validation.from.value;\n            var data = [], add = function(el){ data.push({ value: el }); };\n            if (items instanceof kendo.spreadsheet.calc.runtime.Matrix) {\n                items.each(add);\n            } else {\n                // actually Excel expects a simple string for list\n                // validation (comma-separated labels).\n                (items+\"\").split(/\\s*,\\s*/).forEach(add);\n            }\n            var dataSource = new kendo.data.DataSource({ data: data });\n            list.setDataSource(dataSource);\n            dataSource.read();\n            popup.open();\n        }\n        return {\n            edit: function(options) {\n                context = options;\n                open();\n            },\n            icon: \"k-i-arrow-60-down\"\n        };\n    });\n\n})(window.kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/grid',[ \"kendo.core\", \"./references\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    \n\n    var CellRef = kendo.spreadsheet.CellRef;\n    var RangeRef = kendo.spreadsheet.RangeRef;\n    var UnionRef = kendo.spreadsheet.UnionRef;\n\n    var Rectangle = kendo.Class.extend({\n        init: function Rectangle(left, top, width, height) {\n            this.left = left;\n            this.top = top;\n            this.width = width;\n            this.height = height;\n            this.right = this.left + this.width;\n            this.bottom = this.top + this.height;\n        },\n\n        offset: function(left, top) {\n            return new Rectangle(this.left + left, this.top + top, this.width, this.height);\n        },\n\n        resize: function(width, height) {\n            return new Rectangle(this.left, this.top, this.width + width, this.height + height);\n        },\n\n        intersects: function(x, y) {\n            if (x instanceof Rectangle) {\n                return this.intersectsRect(x);\n            }\n            return this.left < x && x < this.left + this.width &&\n                   this.top < y && y < this.top + this.height;\n        },\n\n        intersectsRect: function(b) {\n            var a = this;\n            return a.left <= b.right\n                && b.left <= a.right\n                && a.top <= b.bottom\n                && b.top <= a.bottom;\n        },\n\n        toDiv: function(className) {\n            return kendo.dom.element(\"div\", {\n                className: className,\n                style: {\n                    width:  this.width + \"px\",\n                    height: this.height + \"px\",\n                    top:    this.top + \"px\",\n                    left:   this.left + \"px\"\n                }\n            });\n        }\n    });\n\n    // XXX: can we use ES5 yet? :-/\n    //\n    // Object.defineProperty(Rectangle.prototype, \"right\", {\n    //     get() {\n    //         return this.left + this.width;\n    //     }\n    // });\n    // Object.defineProperty(Rectangle.prototype, \"bottom\", {\n    //     get() {\n    //         return this.top + this.height;\n    //     }\n    // });\n\n    var Grid = kendo.Class.extend({\n        init: function(rows, columns, rowCount, columnCount, headerHeight, headerWidth) {\n            this.rowCount = rowCount;\n            this.columnCount = columnCount;\n            this._columns = columns;\n            this._rows = rows;\n            this._headerHeight = headerHeight;\n            this._headerWidth = headerWidth;\n        },\n\n        _resize: function(new_rows, new_cols) {\n            this.rowCount = new_rows;\n            this.columnCount = new_cols;\n        },\n\n        isAxis: function(ref) {\n            ref = ref.toRangeRef();\n            var topLeft = ref.topLeft;\n            var bottomRight = ref.bottomRight;\n            return (topLeft.row === 0 && bottomRight.row === this.rowCount - 1) || (topLeft.col === 0 && bottomRight.col === this.columnCount - 1);\n        },\n\n        width: function(start, end) {\n            return this._columns.sum(start, end);\n        },\n\n        height: function(start, end) {\n            return this._rows.sum(start, end);\n        },\n\n        totalHeight: function() {\n            return this._rows.total + this._headerHeight;\n        },\n\n        totalWidth: function() {\n            return this._columns.total + this._headerWidth;\n        },\n\n        index: function(row, column) {\n            return column * this.rowCount + row;\n        },\n\n        cellRef: function(index) {\n            return new CellRef(index % this.rowCount, (index / this.rowCount) >> 0);\n        },\n\n        rowRef: function(row) {\n            return new RangeRef(new CellRef(row, 0), new CellRef(row, this.columnCount - 1));\n        },\n\n        colRef: function(col) {\n            return new RangeRef(new CellRef(0, col), new CellRef(this.rowCount - 1, col));\n        },\n\n        cellRefIndex: function(ref) {\n            return this.index(ref.row, ref.col);\n        },\n\n        normalize: function(ref) {\n            if (ref instanceof RangeRef) {\n                return new RangeRef(\n                    this.normalize(ref.topLeft),\n                    this.normalize(ref.bottomRight)\n                ).setSheet(ref.sheet, ref.hasSheet());\n            }\n\n            if (ref instanceof UnionRef) {\n                return ref.map(function(ref) {\n                    return this.normalize(ref);\n                }, this);\n            }\n\n            if (ref instanceof CellRef) {\n                ref = ref.clone();\n                ref.col = Math.max(0, Math.min(this.columnCount - 1, ref.col));\n                ref.row = Math.max(0, Math.min(this.rowCount - 1, ref.row));\n            }\n\n            return ref;\n        },\n\n        rectangle: function(ref) {\n            var topLeft = this.normalize(ref.topLeft);\n            var bottomRight = this.normalize(ref.bottomRight);\n            return new Rectangle(\n                this.width(0, topLeft.col - 1),\n                this.height(0, topLeft.row - 1),\n                this.width(topLeft.col, bottomRight.col),\n                this.height(topLeft.row, bottomRight.row)\n            );\n        },\n\n        pane: function(options) {\n            return new PaneGrid(\n                new kendo.spreadsheet.PaneAxis(this._rows, options.row, options.rowCount, this._headerHeight),\n                new kendo.spreadsheet.PaneAxis(this._columns, options.column, options.columnCount, this._headerWidth),\n                this\n            );\n        },\n\n        rangeDimensions: function(rangeRef) {\n            return {\n                rows: this._rows.values.iterator(rangeRef.topLeft.row, rangeRef.bottomRight.row),\n                columns: this._columns.values.iterator(rangeRef.topLeft.col, rangeRef.bottomRight.col)\n            };\n        },\n\n        forEach: function(ref, callback) {\n            var topLeft = this.normalize(ref.topLeft);\n            var bottomRight = this.normalize(ref.bottomRight);\n\n            for (var ci = topLeft.col; ci <= bottomRight.col; ci ++) {\n                for (var ri = topLeft.row; ri <= bottomRight.row; ri ++) {\n                    callback(new CellRef(ri, ci));\n                }\n            }\n        },\n\n        trim: function(ref, property) {\n            var topLeft = this.normalize(ref.topLeft);\n            var bottomRight = this.normalize(ref.bottomRight);\n            var bottomRightRow = topLeft.row;\n            var bottomRightCol = topLeft.col;\n\n            for (var ci = topLeft.col; ci <= bottomRight.col; ci ++) {\n                var start = this.index(topLeft.row, ci);\n                var end = this.index(bottomRight.row, ci);\n                var values = property.tree.intersecting(start, end);\n                if(values.length) {\n                    var cell = this.cellRef(values[values.length - 1].end);\n                    bottomRightRow = Math.max(bottomRightRow, cell.row);\n                    bottomRightCol = ci;\n                }\n            }\n            return new RangeRef(ref.topLeft, new CellRef(Math.min(bottomRightRow, ref.bottomRight.row), bottomRightCol));\n        }\n    });\n\n    var PaneGrid = kendo.Class.extend({\n        init: function(rows, columns, grid) {\n            this.rows = rows;\n            this.columns = columns;\n            this._grid = grid;\n\n            this.headerHeight = rows.headerSize;\n            this.headerWidth = columns.headerSize;\n            this.hasRowHeader = columns.hasHeader;\n            this.hasColumnHeader = rows.hasHeader;\n        },\n\n        refresh: function(width, height) {\n            this.columns.viewSize(width);\n            this.rows.viewSize(height);\n\n            var x = this.columns.paneSegment();\n            var y = this.rows.paneSegment();\n\n            this.left = x.offset;\n            this.top = y.offset;\n            this.right = x.offset + x.length;\n            this.bottom = y.offset + y.length;\n\n            this.style = {\n                top: y.offset  + \"px\",\n                left: x.offset + \"px\",\n                height: y.length + \"px\",\n                width: x.length + \"px\"\n            };\n        },\n\n        view: function(left, top) {\n            var rows = this.rows.visible(top);\n            var columns = this.columns.visible(left);\n\n            return {\n                rows: rows,\n                columns: columns,\n\n                rowOffset: rows.offset,\n                columnOffset: columns.offset,\n\n                mergedCellLeft: columns.start,\n                mergedCellTop: rows.start,\n\n                ref: new RangeRef(\n                    new CellRef(rows.values.start, columns.values.start),\n                    new CellRef(rows.values.end, columns.values.end)\n                )\n            };\n        },\n\n        contains: function(ref) {\n            return this.rows.contains(ref.topLeft.row, ref.bottomRight.row) &&\n                this.columns.contains(ref.topLeft.col, ref.bottomRight.col);\n        },\n\n        index: function(row, column) {\n            return this._grid.index(row, column);\n        },\n\n        boundingRectangle: function(ref) {\n            return this._grid.rectangle(ref);\n        },\n\n        cellRefIndex: function(ref) {\n            return this._grid.cellRefIndex(ref);\n        },\n\n        scrollBoundaries: function(cell) {\n            var position = this.boundingRectangle(cell);\n\n            var boundaries = {\n                top: Math.max(0, position.top - this.top + (this.hasColumnHeader ? 0 : this.headerHeight)),\n                left: Math.max(0, position.left - this.left + (this.hasRowHeader ? 0 : this.headerWidth)),\n                right: position.right - this.columns._viewSize + this.headerWidth,\n                bottom: position.bottom - this.rows._viewSize + this.headerHeight\n            };\n\n            var widthCompensation = this.columns.defaultValue / 2;\n            var heightCompensation = this.rows.defaultValue / 2;\n\n            boundaries.scrollTop = boundaries.top - heightCompensation;\n            boundaries.scrollBottom = boundaries.bottom + heightCompensation;\n\n            boundaries.scrollLeft = boundaries.left - widthCompensation;\n            boundaries.scrollRight = boundaries.right + widthCompensation;\n            return boundaries;\n        }\n    });\n\n    kendo.spreadsheet.Grid = Grid;\n    kendo.spreadsheet.PaneGrid = PaneGrid;\n    kendo.spreadsheet.Rectangle = Rectangle;\n})(kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/axis',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    var Axis = kendo.Class.extend({\n        init: function(count, value) {\n            this._value = value;\n            this._count = count;\n            this.values = new kendo.spreadsheet.RangeList(0, count - 1, value);\n            this._hidden = new kendo.spreadsheet.RangeList(0, count - 1, 0);\n\n            this.scrollBarSize = kendo.support.scrollbar();\n            this._refresh();\n        },\n\n        _resize: function(count) {\n            if (count > this._count) {\n                this.values.value(this._count, count - 1, this._value);\n                this._hidden.value(this._count, count - 1, 0);\n            } else if (count < this._count) {\n                this.values.value(count, this._count - 1, 0);\n                this._hidden.value(count, this._count - 1, 0);\n            }\n            this._count = count;\n            this._refresh();\n        },\n\n        adjust: function(start, delta) {\n            // adjust this axis for insert/remove rows/cols operation\n            if (delta < 0) {\n                // removing -- copy from start+|delta| to start\n                this.values.copy(start - delta, this._count - 1, start);\n                this._hidden.copy(start - delta, this._count - 1, start);\n            } else {\n                // adding -- copy from start to start+delta, and set\n                // values for inserted things to default.\n                this.values.copy(start, this._count, start + delta);\n                this._hidden.copy(start, this._count, start + delta);\n                this.values.value(start, start + delta - 1, this._value);\n                this._hidden.value(start, start + delta - 1, 0);\n            }\n            this._refresh();\n        },\n\n        toJSON: function(field, positions) {\n            var values = [];\n\n            var iterator = this.values.iterator(0, this._count - 1);\n\n            for (var idx = 0; idx < this._count; idx++) {\n                var value = iterator.at(idx);\n                var hidden = this._hidden.value(idx, idx);\n\n                if (value === this._value && !hidden) {\n                    continue;\n                }\n\n                var position = positions[idx];\n\n                if (position === undefined) {\n                    position = values.length;\n\n                    var item = { index: idx };\n\n                    item[field] = value;\n                    if (hidden) {\n                        item.hidden = hidden;\n                    }\n\n                    values.push(item);\n\n                    positions[idx] = position;\n                }\n            }\n\n            return values;\n        },\n\n        fromJSON: function(field, values) {\n            for (var idx = 0; idx < values.length; idx++) {\n                var el = values[idx];\n\n                var index = el.index;\n                if (index === undefined) {\n                    index = idx;\n                }\n\n                // when this particular axis is hidden, the value for\n                // the field (\"height\" or \"width\") will be zero, and\n                // in the \"hidden\" field we'll have the actual value\n                // before it was hidden.\n                // https://github.com/telerik/kendo-ui-core/issues/3523\n                var value = el[field];\n\n                if (value === 0) {\n                    this._hidden.value(index, index, el.hidden || this._value);\n                    this.value(index, index, 0);\n                } else {\n                    this.value(index, index, value);\n                }\n            }\n        },\n\n        hide: function(index) {\n            if (!this.hidden(index)) {\n                var value = this.value(index, index);\n                this._hidden.value(index, index, value);\n                this.value(index, index, 0);\n            }\n        },\n\n        hidden: function(index) {\n            return this._hidden.value(index, index) !== 0;\n        },\n\n        includesHidden: function(start, end) {\n             return this._hidden.intersecting(start, end).length > 1;\n        },\n\n        nextVisible: function(index) {\n            var end = this._count - 1, i = index;\n            while (++i <= end) {\n                if (!this.hidden(i)) {\n                    return i;\n                }\n            }\n            return index;\n        },\n\n        nextUntil: function(index, pred) {\n            var end = this._count - 1, i = index, advanced = false;\n            while (++i <= end) {\n                var val = pred(i, advanced, this.hidden(i));\n                if (typeof val == \"number\") {\n                    return val;\n                } else if (val) {\n                    break;\n                }\n                advanced = true;\n            }\n            return i - 1;\n        },\n\n        nextPage: function(index, pageSize) {\n            return this.index(this.sum(0, index - 1) + pageSize);\n        },\n\n        prevPage: function(index, pageSize) {\n            return this.index(this.sum(0, index) - pageSize);\n        },\n\n        firstVisible: function() {\n            var firstHidden = this._hidden.first();\n            if (firstHidden.value === 0) {\n                return 0;\n            } else {\n                return firstHidden.end + 1;\n            }\n        },\n\n        lastVisible: function() {\n            var lastHidden = this._hidden.last();\n            if (lastHidden.value === 0) {\n                return this._count - 1;\n            } else {\n                return lastHidden.start - 1;\n            }\n        },\n\n        prevVisible: function(index) {\n            var i = index;\n            while (--i >= 0) {\n                if (!this.hidden(i)) {\n                    return i;\n                }\n            }\n            return index;\n        },\n\n        prevUntil: function(index, pred) {\n            var i = index, advanced = false;\n            while (--i >= 0) {\n                var val = pred(i, advanced, this.hidden(i));\n                if (typeof val == \"number\") {\n                    return val;\n                } else if (val) {\n                    break;\n                }\n                advanced = true;\n            }\n            return i + 1;\n        },\n\n        unhide: function(index) {\n            if (this.hidden(index)) {\n                var value = this._hidden.value(index, index);\n                this._hidden.value(index, index, 0);\n                this.value(index, index, value);\n            }\n        },\n\n        value: function(start, end, value) {\n            if (value !== undefined) {\n                this.values.value(start, end, value);\n                this._refresh();\n            } else {\n                return this.values.iterator(start, end).at(0);\n            }\n        },\n\n        sum: function(start, end) {\n            var values = this.values.iterator(start, end);\n\n            var sum = 0;\n\n            for (var idx = start; idx <= end; idx ++) {\n                sum += values.at(idx);\n            }\n\n            return sum;\n        },\n\n        locate: function(start, end, predicate) {\n            var values = this.values.iterator(start, end);\n            var sum = 0;\n            for (var idx = start; idx <= end; idx++) {\n                sum += values.at(idx);\n                var val = predicate(sum);\n                if (val) {\n                    return idx;\n                }\n            }\n            return null;\n        },\n\n        visible: function(start, end) {\n            var startSegment = null;\n            var endSegment = null;\n            var lastPage = false;\n\n            if (end >= this.total + this.scrollBarSize) {\n                lastPage = true;\n            }\n\n            var ranges = this._pixelValues.intersecting(start, end);\n\n            startSegment = ranges[0];\n            endSegment = ranges[ranges.length - 1];\n\n            if (!startSegment) {\n                return { values: this.values.iterator(0, 0), offset: 0 };\n            }\n\n            var startOffset = start - startSegment.start;\n\n            var startIndex = ((startOffset / startSegment.value.value) >> 0) + startSegment.value.start;\n\n            var offset = startOffset - (startIndex - startSegment.value.start) * startSegment.value.value;\n\n            var endOffset = end - endSegment.start;\n            var endIndex = ((endOffset / endSegment.value.value) >> 0) + endSegment.value.start;\n\n            if (endIndex > endSegment.value.end) {\n                endIndex = endSegment.value.end;\n            }\n\n            if (lastPage) {\n                offset += endSegment.value.value - (endOffset - (endIndex - endSegment.value.start) * endSegment.value.value);\n            }\n\n            offset = Math.min(-offset, 0);\n\n            return {\n                values: this.values.iterator(startIndex, endIndex),\n                offset: offset\n            };\n        },\n\n        index: function(value) {\n            var index = 0;\n            var iterator = this.values.iterator(0, this._count - 1);\n            var current = iterator.at(0);\n\n            while (current < value && index < this._count - 1) {\n                current += iterator.at(++index);\n            }\n\n            return index;\n        },\n\n        indexVisible: function(value) {\n            var index = this.index(value);\n            if (this.hidden(index)) {\n                index = this.prevVisible(index);\n            }\n            return index;\n        },\n\n        _refresh: function() {\n            var current = 0;\n            this._pixelValues = this.values.map(function(range) {\n                var start = current;\n                current += (range.end - range.start + 1) * range.value;\n                var end = current - 1;\n                return new kendo.spreadsheet.ValueRange(start, end, range);\n            });\n            this.total = current;\n        },\n\n        getState: function() {\n            return {\n                values: this.values.getState(),\n                hidden: this._hidden.getState(),\n                count: this._count\n            };\n        },\n\n        setState: function(state) {\n            this.values.setState(state.values);\n            this._hidden.setState(state.hidden);\n            var nowCount = this._count;\n            if (nowCount > state.count) {\n                this._count = state.count;\n                this._resize(nowCount); // calls _refresh too\n            } else {\n                this._refresh();\n            }\n        }\n    });\n\n    var PaneAxis = kendo.Class.extend({\n        init: function(axis, start, count, headerSize) {\n           this._axis = axis;\n           this._start = start;\n           this._count = count;\n           this.hasHeader = start === 0;\n           this.headerSize = headerSize;\n           this.defaultValue = axis._value;\n           this.frozen = count > 0;\n        },\n\n        viewSize: function(viewSize) {\n            this._viewSize = viewSize;\n        },\n\n        sum: function(start, end) {\n            return this._axis.sum(start, end - 1);\n        },\n\n        start: function() {\n            return this.sum(0, this._start);\n        },\n\n        size: function() {\n            return this.sum(this._start, this._start + this._count);\n        },\n\n        index: function(value, offset) {\n            return this._axis.index(value + (this.frozen ? 0 : offset) - this.headerSize);\n        },\n\n        indexVisible: function(value, offset) {\n            return this._axis.indexVisible(value + (this.frozen ? 0 : offset) - this.headerSize);\n        },\n\n        //XXX: rename this method\n        paneSegment: function() {\n            var offset = this.start();\n            var length;\n\n            if (!this.hasHeader) {\n                offset += this.headerSize;\n            }\n\n            if (this.frozen) {\n                length = this.size();\n                if (this.hasHeader) {\n                    length += this.headerSize;\n                } else {\n                    length -= this.headerSize;\n                }\n            } else {\n                length = this._viewSize - offset;\n            }\n\n            return {\n                offset: offset,\n                length: length\n            };\n        },\n\n        visible: function(offset) {\n            var start = this.start();\n            var size;\n\n            if (this.frozen) {\n                size = this.size();\n                if (!this.hasHeader) {\n                    size -= this.headerSize;\n                }\n            } else {\n                size = this._viewSize - start - this.headerSize;\n                start += offset;\n            }\n\n            var result = this._axis.visible(start, start + size - 1);\n\n            if (this.frozen) {\n                result.offset = 0;\n            }\n\n            result.start = start;\n\n            if (this.hasHeader) {\n                result.offset += this.headerSize;\n                result.start -= this.headerSize;\n            }\n\n            return result;\n        },\n\n        contains: function(start, end) {\n            if (this.frozen) {\n                if (start > this._start + this._count) {\n                    return false;\n                }\n                if (end < this._start) {\n                    return false;\n                }\n                return true;\n            } else {\n                return end >= this._start;\n            }\n        }\n    });\n\n    kendo.spreadsheet.Axis = Axis;\n    kendo.spreadsheet.PaneAxis = PaneAxis;\n\n})(kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/filter',[ \"kendo.core\", \"kendo.data\" ], f);\n})(function(){\n(function(kendo) {\n\n\n    var Filter = kendo.spreadsheet.Filter = kendo.Class.extend({\n        prepare: function() {\n        },\n        value: function(cell) {\n            return cell.value;\n        },\n        matches: function() {\n            throw new Error(\"The 'matches' method is not implemented.\");\n        },\n        toJSON: function() {\n            throw new Error(\"The 'toJSON' method is not implemented.\");\n        }\n    });\n\n    Filter.create = function(options) {\n        var filter = options.filter;\n\n        if (!filter) {\n            throw new Error(\"Filter type not specified.\");\n        }\n\n        var constructor = kendo.spreadsheet[filter.charAt(0).toUpperCase() + filter.substring(1) + \"Filter\"];\n\n        if (!constructor) {\n            throw new Error(\"Filter type not recognized.\");\n        }\n\n        return new constructor(options);\n    };\n\n    kendo.spreadsheet.ValueFilter = Filter.extend({\n        _values: [],\n\n        _dates: [],\n\n        _blanks: false,\n\n        init: function ValueFilter(options) {\n            if (options.values !== undefined) {\n                this._values = options.values;\n            }\n\n            if (options.blanks !== undefined) {\n                this._blanks = options.blanks;\n            }\n\n            if (options.dates !== undefined) {\n                this._dates = options.dates;\n            }\n        },\n\n        value: function(cell) {\n            var value = cell.value;\n\n            if (this._dates.length > 0 && cell.format && typeof value === \"number\") {\n                var type = kendo.spreadsheet.formatting.type(value, cell.format);\n\n                if (type === \"date\") {\n                    value = kendo.spreadsheet.numberToDate(value);\n                }\n            }\n\n            return value;\n        },\n\n        matches: function(value) {\n            if (value === null || value === undefined) {\n                return this._blanks;\n            }\n\n            if (value instanceof Date) {\n                return this._dates.some(function(date) {\n                    return date.year === value.getFullYear() &&\n                        (date.month === undefined || date.month === value.getMonth()) &&\n                        (date.day === undefined || date.day === value.getDate()) &&\n                        (date.hours === undefined || date.hours === value.getHours()) &&\n                        (date.minutes === undefined || date.minutes === value.getMinutes()) &&\n                        (date.seconds === undefined || date.seconds === value.getSeconds());\n                });\n            }\n\n            return this._values.indexOf(value) >= 0;\n        },\n        toJSON: function() {\n            return {\n                filter: \"value\",\n                blanks: this._blanks,\n                values: this._values.slice(0)\n            };\n        }\n    });\n\n    kendo.spreadsheet.CustomFilter = Filter.extend({\n        _logic: \"and\",\n        init: function CustomFilter(options) {\n            if (options.logic !== undefined) {\n                this._logic = options.logic;\n            }\n\n            if (options.criteria === undefined) {\n                throw new Error(\"Must specify criteria.\");\n            }\n\n            this._criteria = options.criteria;\n\n            var expression = kendo.data.Query.filterExpr({\n                logic: this._logic,\n                filters: this._criteria,\n                accentFoldingFiltering: kendo.culture().name\n            }).expression;\n\n            this._matches = new Function(\"d\", \"return \" + expression);\n        },\n        matches: function(value) {\n            if (value === null) {\n                return false;\n            }\n\n            return this._matches(value);\n        },\n        value: function(cell) {\n            var value = cell.value;\n            var criterionValue = this._criteria[0].value;\n            var criterionType = criterionValue instanceof Date ? \"date\" : typeof criterionValue;\n            var valueType = typeof value;\n\n            if (cell.format) {\n                valueType = kendo.spreadsheet.formatting.type(value, cell.format);\n            }\n\n            if (valueType != criterionType) {\n                if (criterionType == \"string\") {\n                    if (cell.format) {\n                        value = kendo.spreadsheet.formatting.text(value, cell.format);\n                    }\n                    value = value + \"\";\n                }\n            } else if (valueType == \"date\") {\n                value = kendo.spreadsheet.numberToDate(value);\n            }\n\n            return value;\n        },\n        toJSON: function() {\n            return {\n                filter: \"custom\",\n                logic: this._logic,\n                criteria: this._criteria\n            };\n        }\n    });\n\n    kendo.spreadsheet.TopFilter = Filter.extend({\n        init: function TopFilter(options) {\n            this._type = options.type;\n            this._value = options.value;\n            this._values = [];\n        },\n\n        prepare: function(cells) {\n            var values = cells.map(this.value)\n            .sort()\n            .filter(function(value, index, array) {\n                return index === 0 || value !== array[index - 1];\n            });\n\n            if (this._type === \"topNumber\" || this._type == \"topPercent\") {\n                values.sort(function(x, y) {\n                    return y - x;\n                });\n            } else {\n                values.sort(function(x, y) {\n                    return x - y;\n                });\n            }\n\n            var count = this._value;\n\n            if (this._type === \"topPercent\" || this._type === \"bottomPercent\") {\n                count = (values.length * count / 100) >> 0;\n            }\n\n            this._values = values.slice(0, count);\n        },\n        matches: function(value) {\n            return this._values.indexOf(value) >= 0;\n        },\n        toJSON: function() {\n            return {\n                filter: \"top\",\n                type: this._type,\n                value: this._value\n            };\n        }\n    });\n\n    kendo.spreadsheet.DynamicFilter = Filter.extend({\n        init: function DynamicFilter(options) {\n            this._type = options.type;\n\n            this._predicate = this[options.type];\n\n            if (typeof this._predicate !== \"function\") {\n                throw new Error(\"DynamicFilter type '\" + options.type + \"' not recognized.\");\n            }\n        },\n        value: function(cell) {\n            var value = cell.value;\n\n            if (cell.format) {\n                var type = kendo.spreadsheet.formatting.type(value, cell.format);\n\n                if (type === \"date\") {\n                    value = kendo.spreadsheet.numberToDate(value);\n                }\n            }\n\n            return value;\n        },\n        prepare: function(cells) {\n            var sum = 0;\n            var count = 0;\n\n            for (var ci = 0; ci < cells.length; ci++) {\n                var value = this.value(cells[ci]);\n\n                if (typeof value === \"number\") {\n                    sum += value;\n                    count ++;\n                }\n            }\n\n            if (count > 0) {\n                this._average = sum / count;\n            } else {\n                this._average = 0;\n            }\n        },\n        matches: function(value) {\n            return this._predicate(value);\n        },\n        aboveAverage: function(value) {\n            if (value instanceof Date) {\n                value = kendo.spreadsheet.dateToNumber(value);\n            }\n\n            if (typeof value !== \"number\") {\n                return false;\n            }\n\n            return value > this._average;\n        },\n        belowAverage: function(value) {\n            if (value instanceof Date) {\n                value = kendo.spreadsheet.dateToNumber(value);\n            }\n\n            if (typeof value !== \"number\") {\n                return false;\n            }\n\n            return value < this._average;\n        },\n        tomorrow: function(value) {\n            if (value instanceof Date) {\n                var tomorrow = kendo.date.addDays(kendo.date.today(), 1);\n\n                return kendo.date.getDate(value).getTime() === tomorrow.getTime();\n            }\n\n            return false;\n        },\n        today: function(value) {\n            if (value instanceof Date) {\n                return kendo.date.isToday(value);\n            }\n\n            return false;\n        },\n        yesterday: function(value) {\n            if (value instanceof Date) {\n                var yesterday = kendo.date.addDays(kendo.date.today(), -1);\n\n                return kendo.date.getDate(value).getTime() === yesterday.getTime();\n            }\n\n            return false;\n        },\n        nextWeek: function(value) {\n            return sameWeek(kendo.date.addDays(kendo.date.today(), 7), value);\n        },\n        thisWeek: function(value) {\n            return sameWeek(kendo.date.today(), value);\n        },\n        lastWeek: function(value) {\n            return sameWeek(kendo.date.addDays(kendo.date.today(), -7), value);\n        },\n        nextMonth: function(value) {\n            return sameMonth(value, 1);\n        },\n        thisMonth: function(value) {\n            return sameMonth(value, 0);\n        },\n        lastMonth: function(value) {\n            return sameMonth(value, -1);\n        },\n        nextQuarter: function(value) {\n            if (value instanceof Date) {\n                var today = kendo.date.today();\n\n                var diff = quarter(value) - quarter(today);\n\n                return (diff === 1 && today.getFullYear() === value.getFullYear()) ||\n                       (diff == -3 && today.getFullYear() + 1 === value.getFullYear());\n            }\n\n            return false;\n        },\n        thisQuarter: function(value) {\n            if (value instanceof Date) {\n                var today = kendo.date.today();\n\n                var diff = quarter(value) - quarter(today);\n\n                return diff === 0 && today.getFullYear() === value.getFullYear();\n            }\n\n            return false;\n        },\n        lastQuarter: function(value) {\n            if (value instanceof Date) {\n                var today = kendo.date.today();\n\n                var diff = quarter(today) - quarter(value);\n\n                return (diff === 1 && today.getFullYear() === value.getFullYear()) ||\n                       (diff == -3 && today.getFullYear() - 1 === value.getFullYear());\n            }\n\n            return false;\n        },\n        nextYear: function(value) {\n            return sameYear(value, 1);\n        },\n        thisYear: function(value) {\n            return sameYear(value, 0);\n        },\n        lastYear: function(value) {\n            return sameYear(value, -1);\n        },\n        yearToDate: function(value) {\n            if (value instanceof Date) {\n                var today = kendo.date.today();\n\n                return value.getFullYear() === today.getFullYear() && value <= today;\n            }\n\n            return false;\n        },\n        toJSON: function() {\n            return {\n                filter: \"dynamic\",\n                type: this._type\n            };\n        }\n    });\n\n    [1, 2, 3, 4].forEach(function(target) {\n        kendo.spreadsheet.DynamicFilter.prototype[\"quarter\" + target] = function(value) {\n           if (value instanceof Date) {\n              return quarter(value) === target;\n           }\n\n           return false;\n        };\n    });\n\n    kendo.cultures[\"en-US\"].calendar.months.names.forEach(function(month, index) {\n        kendo.spreadsheet.DynamicFilter.prototype[month.toLowerCase()] = function(value) {\n           if (value instanceof Date) {\n               return value.getMonth() === index;\n           }\n\n           return false;\n        };\n    });\n\n    function quarter(value) {\n        var month = value.getMonth() + 1;\n\n        if (month >= 1 && month <= 3) {\n            return 1;\n        } else if(month >= 4 && month <= 6) {\n            return 2;\n        } else if (month >= 7 && month <= 9) {\n            return 3;\n        } else {\n            return 4;\n        }\n    }\n\n    function sameYear(value, offset) {\n        if (value instanceof Date) {\n            var today = kendo.date.today();\n\n            today.setFullYear(today.getFullYear() + offset);\n\n            return today.getFullYear() === value.getFullYear();\n        }\n\n        return false;\n    }\n\n    function sameMonth(value, offset) {\n        if (value instanceof Date) {\n            var today = kendo.date.firstDayOfMonth(kendo.date.today());\n\n            today.setMonth(today.getMonth() + offset, 1);\n\n            return today.getTime() === kendo.date.firstDayOfMonth(value).getTime();\n        }\n\n        return false;\n    }\n\n    function sameWeek(a, b) {\n        if (b instanceof Date) {\n            var firstWeek = kendo.date.dayOfWeek(kendo.date.getDate(a), 1);\n\n            var secondWeek = kendo.date.dayOfWeek(kendo.date.getDate(b), 1);\n\n            return firstWeek.getTime() === secondWeek.getTime();\n        }\n\n        return false;\n    }\n\n})(kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/sorter',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    var Sorter = kendo.Class.extend({\n        init: function(grid, lists) {\n            this._grid = grid;\n            this._lists = lists;\n        },\n\n        indices: function(rangeRef, list, ascending, indices) {\n            var comparer = Sorter.ascendingComparer;\n\n            if (ascending === false) {\n                comparer = Sorter.descendingComparer;\n            }\n\n            return list.sortedIndices(this._grid.cellRefIndex(rangeRef.topLeft),\n                this._grid.cellRefIndex(rangeRef.bottomRight), comparer, indices);\n        },\n\n        sortBy: function(ref, column, list, ascending, indices) {\n            var sortedIndices = this.indices(ref.toColumn(column), list, ascending, indices);\n\n            for (var ci = ref.topLeft.col; ci <= ref.bottomRight.col; ci++) {\n                var start = this._grid.index(ref.topLeft.row, ci);\n                var end = this._grid.index(ref.bottomRight.row, ci);\n\n                for (var li = 0; li < this._lists.length; li++) {\n                    if (start < this._lists[li].lastRangeStart()) {\n                        this._lists[li].sort(start, end, sortedIndices);\n                    }\n                }\n            }\n\n            return sortedIndices;\n        }\n    });\n\n    Sorter.ascendingComparer = function(a, b) {\n        if (a === null && b === null) {\n            return 0;\n        }\n\n        if (a === null) {\n            return 1;\n        }\n\n        if (b === null) {\n            return -1;\n        }\n\n        var typeA = typeof a;\n        var typeB = typeof b;\n\n        if (typeA === \"number\") {\n            if (typeB === \"number\") {\n                return a - b;\n            } else {\n               return -1;\n            }\n        }\n\n        if (typeA === \"string\") {\n            switch (typeB) {\n                case \"number\":\n                    return 1;\n                case \"string\":\n                    return a.localeCompare(b);\n                default:\n                    return -1;\n            }\n        }\n\n        if (typeA === \"boolean\") {\n            switch (typeB) {\n                case \"number\":\n                    return 1;\n                case \"string\":\n                    return 1;\n                case \"boolean\":\n                    return a - b;\n                default:\n                    return -1;\n            }\n        }\n\n        if (a instanceof kendo.spreadsheet.calc.runtime.CalcError) {\n            if (b instanceof kendo.spreadsheet.calc.runtime.CalcError) {\n                return 0;\n            } else {\n                return 1;\n            }\n        }\n\n        throw new Error(\"Cannot compare \" + a + \" and \" + b);\n    };\n\n    Sorter.descendingComparer = function(a, b) {\n        if (a === null && b === null) {\n            return 0;\n        }\n\n        if (a === null) {\n            return 1;\n        }\n\n        if (b === null) {\n            return -1;\n        }\n\n        return Sorter.ascendingComparer(b, a);\n    };\n\n    kendo.spreadsheet.Sorter = Sorter;\n})(kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n// -*- fill-column: 100 -*-\n\n(function(f, define){\n    define('spreadsheet/numformat',[ \"./calc\", \"kendo.dom\", \"../util/main\" ], f);\n})(function(){\n    \"use strict\";\n\n    // WARNING: removing the following jshint declaration and turning\n    // == into === to make JSHint happy will break functionality.\n\n\n\n    var util = kendo.util;\n    var calc = kendo.spreadsheet.calc;\n    var dom = kendo.dom;\n\n    var RX_COLORS = /^\\[(black|green|white|blue|magenta|yellow|cyan|red)\\]/i;\n    var RX_CONDITION = /^\\[(<=|>=|<>|<|>|=)(-?[0-9.]+)\\]/;\n\n    /* The proper amount of suffering for whoever designed the Excel\n       Custom Number Format would be to have him implement the\n       formatter himself. */\n\n    function parse(input) {\n        input = calc.InputStream(input);\n        var sections = [], haveConditional = false, decimalPart;\n\n        while (!input.eof()) {\n            var sec = readSection();\n            sections.push(sec);\n            if (sec.cond) {\n                haveConditional = true;\n            }\n        }\n\n        // From https://support.office.com/en-us/article/Create-or-delete-a-custom-number-format-78f2a361-936b-4c03-8772-09fab54be7f4:\n        //\n        //    A number format can have up to four sections of code, separated by semicolons. These\n        //    code sections define the format for positive numbers, negative numbers, zero values,\n        //    and text, in that order.\n        //\n        //    You do not have to include all code sections in your custom number format. If you\n        //    specify only two code sections for your custom number format, the first section is\n        //    used for positive numbers and zeros, and the second section is used for negative\n        //    numbers. If you specify only one code section, it is used for all numbers. If you want\n        //    to skip a code section and include a code section that follows it, you must include\n        //    the ending semicolon for the section that you skip.\n        //\n        // However, if sections have conditionals, it is not clear if:\n        //\n        //    - still at most four are allowed\n        //    - is the last section still for text\n        //\n        // We will assume that if no sections have conditionals, then there must be at most 4, and\n        // they will be interpreted in the order above.  If the first section contains a\n        // conditional, then there can be any number of them; if the last one is not conditional\n        // then it will be interpreted as text format.\n\n        if (!haveConditional) {\n            if (sections.length == 1) {\n                sections[0].cond = \"num\";\n            }\n            else if (sections.length == 2) {\n                sections[0].cond = { op: \">=\", value: 0 };\n                sections[1].cond = { op: \"<\", value: 0 };\n            }\n            else if (sections.length >= 3) {\n                sections[0].cond = { op: \">\", value: 0 };\n                sections[1].cond = { op: \"<\", value: 0 };\n                sections[2].cond = { op: \"=\", value: 0 };\n                if (sections.length > 3) {\n                    sections[3].cond = \"text\";\n                    sections = sections.slice(0, 4);\n                }\n            }\n        }\n\n        return sections;\n\n        function maybeColor() {\n            var m = input.skip(RX_COLORS);\n            if (m) {\n                return m[1].toLowerCase();\n            }\n        }\n\n        function maybeCondition() {\n            var m = input.skip(RX_CONDITION);\n            if (m) {\n                var val = parseFloat(m[2]);\n                if (!isNaN(val)) {\n                    return { op: m[1], value: val, custom: true };\n                }\n            }\n        }\n\n        function readFormat() {\n            var format = [], tok, prev = null;\n            while (!input.eof() && (tok = readNext())) {\n                // disambiguate: m/mm might mean month or minutes depending on surrounding context.\n                if (tok.type == \"date\") {\n                    if (prev && /^(el)?time$/.test(prev.type) && prev.part == \"h\"\n                        && tok.part == \"m\" && tok.format < 3) {\n                        // m or mm that follows hours should display minutes\n                        tok.type = \"time\";\n                    }\n                } else if (/^(el)?time$/.test(tok.type) && tok.part == \"s\") {\n                    if (prev && prev.type == \"date\" && prev.part == \"m\"\n                        && prev.format < 3) {\n                        // m or mm followed by seconds should display minutes\n                        prev.type = \"time\";\n                    }\n                }\n                if (!(/^(?:str|space|fill)$/.test(tok.type))) {\n                    prev = tok;\n                }\n                format.push(tok);\n            }\n            return format;\n        }\n\n        function maybeFraction(tok) {\n            if (tok.type != \"date\" || (tok.part == \"m\" && tok.format < 3)) {\n                var m = input.skip(/^\\.(0+)/);\n                if (m) {\n                    tok.fraction = m[1].length;\n                    if (tok.type == \"date\") {\n                        tok.type = \"time\";\n                    }\n                }\n            }\n            return tok;\n        }\n\n        function readNext() {\n            var ch, m;\n            // numbers\n            if ((m = input.skip(/^([#0?]+)(?:,([#0?]+))+/))) {\n                // thousands separator.  seems convenient to treat\n                // this as a single token.\n                return { type: \"digit\", sep: true, format: m[1] + m[2], decimal: decimalPart };\n            }\n            if ((m = input.skip(/^[#0?]+/))) {\n                return { type: \"digit\", sep: false, format: m[0], decimal: decimalPart };\n            }\n            // XXX: handle this one!\n            if ((m = input.skip(/^(e)([+-])/i))) {\n                return { type: \"exp\", ch: m[1], sign: m[2] };\n            }\n            // dates\n            if ((m = input.skip(/^(d{1,4}|m{1,5}|yyyy|yy)/i))) {\n                m = m[1].toLowerCase();\n                return maybeFraction({ type: \"date\", part: m.charAt(0), format: m.length });\n            }\n            // time (interpret as a date)\n            if ((m = input.skip(/^(hh?|ss?)/i))) { // m and mm are handled above\n                m = m[1].toLowerCase();\n                return maybeFraction({ type: \"time\", part: m.charAt(0), format: m.length });\n            }\n            // elapsed time (interpret as interval of days)\n            if ((m = input.skip(/^\\[(hh?|mm?|ss?)\\]/i))) {\n                m = m[1].toLowerCase();\n                return maybeFraction({ type: \"eltime\", part: m.charAt(0), format: m.length });\n            }\n            if ((m = input.skip(/^(a[.]?m[.]?\\/p[.]?m[.]?|a\\/p)/i))) {\n                m = m[1].split(\"/\");\n                return { type: \"ampm\", am: m[0], pm: m[1] };\n            }\n            switch ((ch = input.next())) { // JSHint sadness\n              case \";\":\n                return null;\n              case \"\\\\\":\n                // quotes next character\n                return { type: \"str\", value: input.next() };\n              case '\"':\n                return { type: \"str\", value: input.readEscaped(ch) };\n              case \"@\":\n                return { type: \"text\" };\n              case \"_\":\n                // whitespace of the width of following character\n                return { type: \"space\", value: input.next() };\n              case \"*\":\n                // fills cell width with the following character\n                return { type: \"fill\", value: input.next() };\n              case \".\":\n                if (input.lookingAt(/^\\s*[#0?]/)) {\n                    decimalPart = true;\n                    return { type: \"dec\" };\n                }\n                return { type: \"str\", value: \".\" };\n              case \"%\":\n                return { type: \"percent\" };\n              case \",\":\n                return { type: \"comma\" };\n            }\n\n            // whatever we can't make sense of, output literally.\n            return { type: \"str\", value: ch };\n        }\n\n        function readSection() {\n            decimalPart = false;\n            var color = maybeColor(), cond = maybeCondition();\n            if (!color && cond) {\n                color = maybeColor();\n            }\n            return {\n                color : color,\n                cond  : cond,\n                body  : readFormat()\n            };\n        }\n    }\n\n    function print(sections) {\n        return sections.map(printSection).join(\";\");\n\n        function printSection(sec) {\n            var out = \"\";\n            if (sec.color) {\n                out += \"[\" + sec.color + \"]\";\n            }\n            if (sec.cond) {\n                if (!(sec.cond == \"text\" || sec.cond == \"num\")) {\n                    out += \"[\" + sec.cond.op + sec.cond.value + \"]\";\n                }\n            }\n            out += sec.body.map(printToken).join(\"\");\n            return out;\n        }\n\n        function maybeFraction(fmt, tok) {\n            if (tok.fraction) {\n                fmt += \".\" + padLeft(\"\", tok.fraction, \"0\");\n            }\n            return fmt;\n        }\n\n        function printToken(tok) {\n            if (tok.type == \"digit\") {\n                if (tok.sep) {\n                    return tok.format.charAt(0) + \",\" + tok.format.substr(1);\n                } else {\n                    return tok.format;\n                }\n            }\n            else if (tok.type == \"exp\") {\n                return tok.ch + tok.sign;\n            }\n            else if (tok.type == \"date\" || tok.type == \"time\") {\n                return maybeFraction(padLeft(\"\", tok.format, tok.part), tok);\n            }\n            else if (tok.type == \"eltime\") {\n                return maybeFraction(\"[\" + padLeft(\"\", tok.format, tok.part) + \"]\", tok);\n            }\n            else if (tok.type == \"ampm\") {\n                return tok.am + \"/\" + tok.pm;\n            }\n            else if (tok.type == \"str\") {\n                return JSON.stringify(tok.value);\n            }\n            else if (tok.type == \"text\") {\n                return \"@\";\n            }\n            else if (tok.type == \"space\") {\n                return \"_\" + tok.value;\n            }\n            else if (tok.type == \"fill\") {\n                return \"*\" + tok.value;\n            }\n            else if (tok.type == \"dec\") {\n                return \".\";\n            }\n            else if (tok.type == \"percent\") {\n                return \"%\";\n            }\n            else if (tok.type == \"comma\") {\n                return \",\";\n            }\n        }\n    }\n\n    function adjustDecimals(sections, x) {\n        sections.forEach(function(sec) {\n            var diff = x;\n            if (sec.cond == \"text\") {\n                return;\n            }\n            var body = sec.body, adjusted = false, i = body.length;\n            while (diff !== 0 && --i >= 0) {\n                var tok = body[i];\n                if (tok.type == \"digit\") {\n                    if (tok.decimal) {\n                        adjusted = true;\n                        if (diff > 0) {\n                            tok.format += padLeft(\"\", diff, \"0\");\n                        } else if (diff < 0) {\n                            var tmp = tok.format.length;\n                            tok.format = tok.format.substr(0, tmp + diff);\n                            diff += tmp - tok.format.length;\n                        }\n                        if (tok.format.length === 0) {\n                            body.splice(i, 1);\n                            while (--i >= 0) {\n                                tok = body[i];\n                                if (tok.type == \"digit\" && tok.decimal) {\n                                    ++i;\n                                    break;\n                                }\n                                if (tok.type == \"dec\") {\n                                    body.splice(i, 1);\n                                    break;\n                                }\n                            }\n                        }\n                    }\n                    if (diff > 0) {\n                        break;\n                    }\n                }\n            }\n            if (!adjusted && diff > 0) {\n                // no decimal part was found, insert one after the last digit token.\n                body.splice(\n                    i + 1, 0, {\n                        type    : \"dec\"\n                    }, {\n                        type    : \"digit\",\n                        sep     : false,\n                        decimal : true,\n                        format  : padLeft(\"\", diff, \"0\")\n                    }\n                );\n            }\n        });\n    }\n\n    function TokenStream(parts) {\n        var index = 0;\n        return {\n            next: function() {\n                return parts[index++];\n            },\n            eof: function() {\n                return index >= parts.length;\n            },\n            ahead: function(n, f) {\n                if (index + n <= parts.length) {\n                    var val = f.apply(null, parts.slice(index, index + n));\n                    if (val) {\n                        index += n;\n                    }\n                    return val;\n                }\n            },\n            restart: function() {\n                index = 0;\n            }\n        };\n    }\n\n    function compileFormatPart(format) {\n        var input = TokenStream(format.body);\n        var hasDate = false;\n        var hasTime = false;\n        var hasAmpm = false;\n        var percentCount = 0;\n        var currency = /[\\$\\xA2-\\xA5\\u058F\\u060B\\u09F2\\u09F3\\u09FB\\u0AF1\\u0BF9\\u0E3F\\u17DB\\u20A0-\\u20BD\\uA838\\uFDFC\\uFE69\\uFF04\\uFFE0\\uFFE1\\uFFE5\\uFFE6]/;\n        var scaleCount = 0;\n        var code = \"var intPart, decPart, isNegative, date, time; \";\n        var separeThousands = false;\n        var declen = 0;\n        var intFormat = [], decFormat = [];\n        var condition = format.cond;\n        var preamble = \"\";\n\n        if (condition == \"text\") {\n            preamble = \"if (typeof value == 'string' || value instanceof kendo.spreadsheet.CalcError) { \";\n        }\n        else if (condition == \"num\") {\n            preamble = \"if (typeof value == 'number') { \";\n        }\n        else if (condition) {\n            var op = condition.op == \"=\" ? \"==\" : condition.op;\n            preamble = \"if (typeof value == 'number' && value \"\n                + op + \" \" + condition.value + \") { \";\n            if (!condition.custom) {\n                code += \"value = Math.abs(value); \";\n            }\n        }\n\n        if (format.color) {\n            code += \"result.color = \" + JSON.stringify(format.color) + \"; \";\n        }\n\n        function checkComma(a, b) {\n            if ((a.type == \"digit\" && b.type == \"comma\") ||\n                (a.type == \"comma\" && a.hidden && b.type == \"comma\"))\n            {\n                b.hidden = true;\n                scaleCount++;\n            }\n        }\n\n        while (!input.eof()) {\n            input.ahead(2, checkComma);\n            var tok = input.next();\n            if (tok.type == \"percent\") {\n                percentCount++;\n            }\n            else if (tok.type == \"digit\") {\n                if (tok.decimal) {\n                    declen += tok.format.length;\n                    decFormat.push(tok.format);\n                } else {\n                    intFormat.push(tok.format);\n                    if (tok.sep) {\n                        separeThousands = true;\n                    }\n                }\n            }\n            else if (tok.type == \"time\") {\n                hasTime = true;\n            }\n            else if (tok.type == \"date\") {\n                hasDate = true;\n            }\n            else if (tok.type == \"ampm\") {\n                hasAmpm = hasTime = true;\n            }\n        }\n\n        if (percentCount > 0) {\n            code += \"value *= \" + Math.pow(100, percentCount) + \"; \";\n        }\n        if (scaleCount > 0) {\n            code += \"value /= \" + Math.pow(1000, scaleCount) + \"; \";\n        }\n        if (intFormat.length) {\n            code += \"intPart = runtime.formatInt(culture, value, \" + JSON.stringify(intFormat) + \", \" + declen + \", \" + separeThousands + \"); \";\n            code += \"isNegative = parseInt(intPart[0]) < 0;\";\n        }\n        if (decFormat.length) {\n            code += \"decPart = runtime.formatDec(value, \" + JSON.stringify(decFormat) + \", \" + declen + \"); \";\n        }\n        if (intFormat.length || decFormat.length) {\n            code += \"type = 'number'; \";\n        }\n        if (hasDate) {\n            code += \"date = runtime.unpackDate(value); \";\n        }\n        if (hasTime) {\n            code += \"time = runtime.unpackTime(value); \";\n        }\n        if (hasDate || hasTime) {\n            code += \"type = 'date'; \";\n        }\n\n        if (percentCount > 0 || scaleCount > 0 || intFormat.length || decFormat.length || hasDate || hasTime) {\n            if (!preamble) {\n                preamble = \"if (typeof value == 'number') { \";\n            }\n        }\n\n        input.restart();\n        code += \"var matchedCurrency = false;\";\n        while (!input.eof()) {\n            var tok = input.next();\n            if (tok.type == \"dec\") {\n                code += \"output += culture.numberFormat['.']; \";\n            }\n            else if (tok.type == \"comma\" && !tok.hidden) {\n                code += \"output += ','; \";\n            }\n            else if (tok.type == \"percent\") {\n                code += \"type = 'percent'; \";\n                code += \"output += culture.numberFormat.percent.symbol; \";\n            }\n            else if (tok.type == \"str\") {\n                if (currency.test(tok.value)) {\n                    code += \"type = 'currency'; \";\n                    code += \"if (isNegative) { output += '-'; matchedCurrency = true; }\";\n                }\n                code += \"output += \" + JSON.stringify(tok.value) + \"; \";\n            }\n            else if (tok.type == \"text\") {\n                code += \"type = 'text'; \";\n                code += \"output += value; \";\n            }\n            else if (tok.type == \"space\") {\n                code += \"if (output) result.body.push(output); \";\n                code += \"output = ''; \";\n                code += \"result.body.push({ type: 'space', value: \" + JSON.stringify(tok.value) + \" }); \";\n            }\n            else if (tok.type == \"fill\") {\n                code += \"output += runtime.fill(\" + JSON.stringify(tok.value) + \"); \";\n            }\n            else if (tok.type == \"digit\") {\n                code += \"if (isNegative && intPart[0] && matchedCurrency) {intPart[0] = intPart[0].replace('-', '');}\";\n                code += \"output += \" + (tok.decimal ? \"decPart\" : \"intPart\") + \".shift(); \";\n            }\n            else if (tok.type == \"date\") {\n                code += \"output += runtime.date(culture, date, \"\n                    + JSON.stringify(tok.part) + \", \" + tok.format + \"); \";\n            }\n            else if (tok.type == \"time\") {\n                code += \"output += runtime.time(time, \"\n                    + JSON.stringify(tok.part) + \", \" + tok.format + \", \" + hasAmpm + \", \" + tok.fraction + \"); \";\n            }\n            else if (tok.type == \"eltime\") {\n                code += \"output += runtime.eltime(value, \"\n                    + JSON.stringify(tok.part) + \", \" + tok.format + \", \" + tok.fraction + \"); \";\n            }\n            else if (tok.type == \"ampm\") {\n                // XXX: should use culture?  As per the \"spec\", Excel\n                // displays whatever the token was (AM/PM, a/p etc.)\n                code += \"output += time.hours < 12 ? \" + JSON.stringify(tok.am) + \" : \" + JSON.stringify(tok.pm) + \"; \";\n            }\n        }\n\n        code += \"if (output) result.body.push(output); \";\n        code += \"result.type = type; \";\n        code += \"return result; \";\n\n        if (preamble) {\n            code = preamble + code + \"}\";\n        }\n\n        return code;\n    }\n\n    var TEXT = compileFormatPart({ cond: \"text\", body: [ { type: \"text\" } ] });\n\n    var compile = util.memoize(function(format) {\n        var tree = parse(format);\n        var code = tree.map(compileFormatPart);\n        code.push(TEXT);\n        code = code.join(\"\\n\");\n        code = \"'use strict'; return function(value, culture){ \"\n            + \"if (!culture) culture = kendo.culture(); \"\n            + \"var output = '', type = null, result = { body: [] }; \" + code + \"; return result; };\";\n        return new Function(\"runtime\", code)(runtime);\n    });\n\n    // Attempts to produce a format compatible with kendo.parseDate from our Excel format.  Needed\n    // in runtime.parseDate (passing Excel format to kendo.parseDate will mess up the month or\n    // minutes).  https://github.com/telerik/kendo-ui-core/issues/3797\n    var makeDateFormat = util.memoize(function(format){\n        var tree = parse(format);\n        var section, found = false, hasAmpm = false;\n\n        // locate a section that contains date/time formatting.  only the first will be converted.\n        for (var i = 0; i < tree.length; ++i) {\n            section = tree[i];\n            for (var j = 0; j < section.body.length; ++j) {\n                if (/^(?:date|time|ampm)$/.test(section.body[j].type)) {\n                    found = true;\n                    if (section.body[j].type == \"ampm\") {\n                        hasAmpm = true;\n                    }\n                }\n            }\n            if (found) {\n                break;\n            }\n        }\n        if (!found) {\n            return null;\n        }\n\n        return section.body.map(printToken).join(\"\");\n\n        // a little copy/paste goes a long way\n\n        function maybeFraction(fmt, tok) {\n            if (tok.fraction) {\n                fmt += padLeft(\"\", Math.max(tok.fraction, 3), \"f\");\n            }\n            return fmt;\n        }\n\n        function printToken(tok) {\n            if (tok.type == \"digit\") {\n                if (tok.sep) {\n                    return tok.format.charAt(0) + \",\" + tok.format.substr(1);\n                } else {\n                    return tok.format;\n                }\n            }\n            else if (tok.type == \"exp\") {\n                return tok.ch + tok.sign;\n            }\n            else if (tok.type == \"date\" || tok.type == \"time\") {\n                var part = tok.part;\n                if (tok.type == \"date\" && /^m/.test(part)) {\n                    part = \"M\"; // month, not minutes\n                }\n                else if (tok.type == \"time\" && /^h/.test(part)) {\n                    if (!hasAmpm) {\n                        // 24-hours clock is H or HH\n                        part = part.toUpperCase();\n                    }\n                }\n                return maybeFraction(padLeft(\"\", tok.format, part), tok);\n            }\n            else if (tok.type == \"ampm\") {\n                return \"tt\";\n            }\n            else if (tok.type == \"str\") {\n                // XXX: this is a bit wrong.  it doesn't look like kendo.toString / kendo.parseDate\n                // support arbitrary text (in Excel formats that's quoted), for example:\n                //    kendo.toString(new Date(), \"here's the day dude: dd\")\n                //   \"3ere'8 t3e 19ay 19u19e: 19\"   (it's 19th June, 3 o'clock, probably 8 seconds)\n                return tok.value;\n            }\n            else if (tok.type == \"space\") {\n                return \" \";\n            }\n            else if (tok.type == \"dec\") {\n                return \".\";\n            }\n            else if (tok.type == \"percent\") {\n                return \"%\";\n            }\n            else if (tok.type == \"comma\") {\n                return \",\";\n            }\n            else {\n                return \"\";\n            }\n        }\n    });\n\n    var runtime = {\n\n        unpackDate: calc.runtime.unpackDate,\n        unpackTime: calc.runtime.unpackTime,\n\n        date: function(culture, d, part, length) {\n            switch (part) {\n              case \"d\":\n                switch (length) {\n                  case 1: return d.date;\n                  case 2: return padLeft(d.date, 2, \"0\");\n                  case 3: return culture.calendars.standard.days.namesAbbr[d.day];\n                  case 4: return culture.calendars.standard.days.names[d.day];\n                }\n                break;\n              case \"m\":\n                switch (length) {\n                  case 1: return d.month + 1;\n                  case 2: return padLeft(d.month + 1, 2, \"0\");\n                  case 3: return culture.calendars.standard.months.namesAbbr[d.month];\n                  case 4: return culture.calendars.standard.months.names[d.month];\n                  case 5: return culture.calendars.standard.months.names[d.month].charAt(0);\n                }\n                break;\n              case \"y\":\n                switch (length) {\n                  case 2: return d.year % 100;\n                  case 4: return d.year;\n                }\n                break;\n            }\n            return \"##\";\n        },\n\n        time: function(t, part, length, ampm, fraclen) {\n            var ret, fraction;\n            switch (part) {\n              case \"h\":\n                ret = padLeft(ampm ? t.hours % 12 || 12 : t.hours, length, \"0\");\n                if (fraclen) {\n                    fraction = (t.minutes + (t.seconds + t.milliseconds / 1000) / 60) / 60;\n                }\n                break;\n              case \"m\":\n                ret = padLeft(t.minutes, length, \"0\");\n                if (fraclen) {\n                    fraction = (t.seconds + t.milliseconds / 1000) / 60;\n                }\n                break;\n              case \"s\":\n                ret = padLeft(t.seconds, length, \"0\");\n                if (fraclen) {\n                    fraction = t.milliseconds / 1000;\n                }\n                break;\n            }\n            if (fraction) {\n                ret += runtime.toFixed(fraction, fraclen).replace(/^0+/, \"\");\n            }\n            return ret;\n        },\n\n        eltime: function(value, part, length, fraclen) {\n            var ret, fraction;\n            switch (part) {\n              case \"h\":\n                ret = value * 24;\n                break;\n              case \"m\":\n                ret = value * 24 * 60;\n                break;\n              case \"s\":\n                ret = value * 24 * 60 * 60;\n                break;\n            }\n            if (fraclen) {\n                fraction = ret - (ret | 0);\n            }\n            ret = padLeft(ret | 0, length, \"0\");\n            if (fraction) {\n                ret += runtime.toFixed(fraction, fraclen).replace(/^0+/, \"\");\n            }\n            return ret;\n        },\n\n        fill: function(ch) {\n            // XXX: how to implement this?\n            return ch;\n        },\n\n        // formatting integer part is slightly different than decimal\n        // part, so they're implemented in two functions.  For the\n        // integer part we need to walk the value and the format\n        // backwards (right-to-left).\n\n        formatInt: function(culture, value, parts, declen, sep) {\n            // toFixed is perfect for rounding our value; if there is\n            // no format for decimals, for example, we want the number\n            // rounded up.\n            value = runtime.toFixed(value, declen).replace(/\\..*$/, \"\");\n            var lastPart = parts[parts.length - 1];\n\n            if (declen > 0 && lastPart[parts.length - 1] != \"0\") {\n                // if the rounded number is zero and we have decimal\n                // format, consider it a non-significant digit (Excel\n                // won't display the leading zero for 0.2 in format #.#).\n                // the zero won't e omitted if using 0.0 format\n                if (value === \"0\") { value = \"\"; }\n                else if (value === \"-0\") { value = \"-\"; }\n            }\n\n            var shouldInsertMinus = false;\n            var iv = value.length - 1;\n            var result = [];\n            var len = 0, str;\n\n            function add(ch, skipMinus) {\n                if (sep && len && len % 3 === 0 && /^[0-9]$/.test(ch)) {\n                    str = culture.numberFormat[\",\"] + str;\n                }\n                if(skipMinus && ch === \"-\") {\n                    shouldInsertMinus = true;\n                    ch = \"0\";\n                }\n                str = ch + str;\n                len++;\n            }\n\n            for (var j = parts.length; --j >= 0;) {\n                var format = parts[j];\n                str = \"\";\n                for (var k = format.length; --k >= 0;) {\n                    var chf = format.charAt(k);\n                    if (iv < 0) {\n                        if (chf == \"0\") {\n                            add(\"0\");\n                        } else if (chf == \"?\") {\n                            add(\" \");\n                        }\n                    } else {\n                        if (value == \"0\" && chf == \"?\") {\n                            add(\" \");\n                        } else if (chf == \"0\") {\n                            add(value.charAt(iv), true);\n                        } else {\n                            add(value.charAt(iv));\n                        }\n                        iv--;\n                    }\n                }\n                if (j === 0) {\n                    while (iv >= 0) {\n                        add(value.charAt(iv--));\n                    }\n                }\n                result.unshift(str);\n            }\n\n            if(shouldInsertMinus) {\n                result[0] = \"-\" + result[0];\n            }\n\n            return result;\n        },\n\n        // for decimal part we walk in normal direction and pad on the\n        // right if required (for '0' or '?' chars).\n\n        formatDec: function(value, parts, declen) {\n            value = runtime.toFixed(value, declen);\n            var pos = value.indexOf(\".\");\n            if (pos >= 0) {\n                value = value.substr(pos + 1).replace(/0+$/, \"\");\n            } else {\n                value = \"\";\n            }\n\n            var iv = 0;\n            var result = [];\n\n            for (var j = 0; j < parts.length; ++j) {\n                var format = parts[j];\n                var str = \"\";\n                for (var k = 0; k < format.length; ++k) {\n                    var chf = format.charAt(k);\n                    if (iv < value.length) {\n                        str += value.charAt(iv++);\n                    } else if (chf == \"0\") {\n                        str += \"0\";\n                    } else if (chf == \"?\") {\n                        str += \" \";\n                    }\n                }\n                result.push(str);\n            }\n\n            return result;\n        },\n\n        // JS's toFixed is broken, it's only OK to use it on integers.\n        toFixed: function(value, decimals) {\n            return (function toFixed(value, last) {\n                if (!isFinite(value)) {\n                    return \"#NUM!\";\n                }\n\n                // deal early with the trivial cases\n                if (value < 0) {    // JS's Math.round is broken with negative numbers\n                    return \"-\" + toFixed(-value);\n                }\n\n                if (decimals === 0) { // no decimals\n                    return String(Math.round(value));\n                }\n\n                if (value === Math.round(value) && !/e/i.test(String(value))) { // value is integer and not too big\n                    return value.toFixed(decimals);\n                }\n\n                // this handles cases like 0.3.toFixed(20) == \"0.29999999999999998890\", or\n                // 2.1825.toFixed(20) = \"2.18250000000000010658\".\n                // https://github.com/telerik/kendo-ui-core/issues/3520#issuecomment-333768221\n                // https://twitter.com/mcbazon/status/1035828655652593665\n                var num = digNumber(value);\n                var intpart = num.intpart;\n                var decpart = num.decpart;\n                if (decpart.length <= decimals) {\n                    while (decpart.length < decimals) {\n                        decpart += \"0\";\n                    }\n                    return intpart + \".\" + decpart;\n                }\n\n                if (last) {\n                    // \"we should definitely not get here\" (famous last words).  Let's MAKE SURE\n                    // there's no more recursion.\n                    return intpart + \".\" + decpart.substr(0, decimals);\n                }\n\n                // if there are more decimals than wanted, round and try again.\n                // it should not recurse more than once.\n                var f = Math.pow(10, decimals);\n                return toFixed(Math.round(value * f) / f, true);\n\n            })(Number(value.toFixed(14))); /* restrict to 14 decimals, because 0.1 + 0.2 ===\n                                                 * 0.30000000000000004 */\n        }\n\n    };\n\n    function padLeft(val, width, ch) {\n        val += \"\";\n        while (val.length < width) {\n            val = ch + val;\n        }\n        return val;\n    }\n\n    function padRight(val, width, ch) {\n        val += \"\";\n        while (val.length < width) {\n            val += ch;\n        }\n        return val;\n    }\n\n    // given a number, return { intpart, decpart } as strings.  the main difficulty here is that JS\n    // will stringify really large values in scientific notation (e.g. 1.23e+30, which is actually\n    // the integer 1230000000000000000000000000000).\n    function digNumber(num) {\n        var str = String(num).toLowerCase();\n        var intpart, decpart, m;\n        var pos = str.indexOf(\".\");\n        if (pos < 0) {\n            pos = str.indexOf(\"e\");\n            if (pos < 0) {\n                intpart = str;\n                decpart = \"\";\n            } else {\n                intpart = str.substr(0, pos);\n                decpart = str.substr(pos);\n            }\n        } else {\n            intpart = str.substr(0, pos);\n            decpart = str.substr(pos + 1);\n        }\n        if ((m = /(\\d*)e([-+]?\\d+)/.exec(decpart))) {\n            var exp = parseInt(m[2], 10);\n            if (exp >= 0) {\n                decpart = padRight(m[1], exp, \"0\");\n                intpart += decpart.substr(0, exp);\n                decpart = decpart.substr(exp);\n            } else {\n                intpart = padLeft(intpart, -exp, \"0\");\n                decpart = intpart.substr(exp) + m[1];\n                intpart = intpart.substr(0, intpart.length + exp);\n            }\n        }\n        return { intpart: intpart || \"0\", decpart: decpart };\n    }\n\n    /* -----[ exports ]----- */\n\n    function text(f) {\n        var a = f.body;\n        var text = \"\";\n        for (var i = 0; i < a.length; ++i) {\n            var el = a[i];\n            if (typeof el == \"string\") {\n                text += el;\n            } else if (el.type == \"space\") {\n                text += \" \";\n            }\n        }\n        return text;\n    }\n\n    kendo.spreadsheet.formatting = {\n        compile : compile,\n        parse: parse,\n        format: function(value, format, culture) {\n            var f = compile(format)(value, culture);\n            var span = dom.element(\"span\");\n            span.__dataType = f.type;\n            var a = f.body;\n            if (f.color) {\n                span.attr.style = { color: f.color };\n            }\n            for (var i = 0; i < a.length; ++i) {\n                var el = a[i];\n                if (typeof el == \"string\") {\n                    span.children.push(dom.text(el));\n                } else if (el.type == \"space\") {\n                    span.children.push(dom.element(\"span\", {\n                        style: { visibility: \"hidden\" }\n                    }, [ dom.text(el.value) ]));\n                }\n            }\n            return span;\n        },\n        text: function(value, format, culture) {\n            var f = compile(format)(value, culture);\n            return text(f);\n        },\n        textAndColor: function(value, format, culture) {\n            var f = compile(format)(value, culture);\n            return { text: text(f), color: f.color, type: f.type };\n        },\n        type: function(value, format) {\n            return compile(format)(value).type;\n        },\n        adjustDecimals: function(format, diff) {\n            var ast = parse(format);\n            adjustDecimals(ast, diff);\n            return print(ast);\n        },\n        makeDateFormat: makeDateFormat\n    };\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n// -*- fill-column: 100 -*-\n\n(function(f, define){\n    define('spreadsheet/runtime.functions',[ \"./runtime\", \"../util/main\" ], f);\n})(function(){\n    \"use strict\";\n\n    // WARNING: removing the following jshint declaration and turning\n    // == into === to make JSHint happy will break functionality.\n\n\n\n    var util = kendo.util;\n    var spreadsheet = kendo.spreadsheet;\n    var calc = spreadsheet.calc;\n    var runtime = calc.runtime;\n    var defineFunction = runtime.defineFunction;\n    var defineAlias = runtime.defineAlias;\n    var CalcError = runtime.CalcError;\n    var RangeRef = spreadsheet.RangeRef;\n    var CellRef = spreadsheet.CellRef;\n    var UnionRef = spreadsheet.UnionRef;\n    var Matrix = runtime.Matrix;\n    var Ref = spreadsheet.Ref;\n    var NameRef = spreadsheet.NameRef;\n    var daysInMonth = runtime.daysInMonth;\n    var packDate = runtime.packDate;\n    var unpackDate = runtime.unpackDate;\n    var daysInYear = runtime.daysInYear;\n    var limitPrecision = runtime.limitPrecision;\n\n    /* -----[ Math functions ]----- */\n\n    [ \"abs\", \"cos\", \"sin\", \"acos\", \"asin\", \"tan\", \"atan\", \"exp\", \"sqrt\" ].forEach(function(name){\n        defineFunction(name, Math[name]).args([\n            [ \"*n\", \"number\" ]\n        ]);\n    });\n\n    defineFunction(\"ln\", Math.log).args([\n        [ \"*n\", \"number\" ]\n    ]);\n\n    defineFunction(\"log\", function(num, base){\n        return Math.log(num) / Math.log(base);\n    }).args([\n        [ \"*num\", \"number++\" ],\n        [ \"*base\", [ \"or\", \"number++\", [ \"null\", 10 ] ] ],\n        [ \"?\", [ \"assert\", \"$base != 1\", \"DIV/0\" ] ]\n    ]);\n\n    defineFunction(\"log10\", function(num){\n        return Math.log(num) / Math.log(10);\n    }).args([\n        [ \"*num\", \"number++\" ]\n    ]);\n\n    defineFunction(\"pi\", function(){\n        return Math.PI;\n    }).args([]);\n\n    defineFunction(\"sqrtpi\", function(n){\n        return Math.sqrt(n * Math.PI);\n    }).args([\n        [ \"*num\", \"number+\" ]\n    ]);\n\n    defineFunction(\"degrees\", function(rad){\n        return ((180 * rad) / Math.PI) % 360;\n    }).args([\n        [ \"*radians\", \"number\" ]\n    ]);\n\n    defineFunction(\"radians\", function(deg){\n        return Math.PI * deg / 180;\n    }).args([\n        [ \"*degrees\", \"number\" ]\n    ]);\n\n    function _cosh(n){\n        return (Math.exp(n) + Math.exp(-n)) / 2;\n    }\n\n    defineFunction(\"cosh\", _cosh).args([\n        [ \"*num\", \"number\" ]\n    ]);\n\n    defineFunction(\"acosh\", function(n){\n        return Math.log(n + Math.sqrt(n - 1) * Math.sqrt(n + 1));\n    }).args([\n        [ \"*num\", \"number\" ],\n        [ \"?\", [ \"assert\", \"$num >= 1\" ] ]\n    ]);\n\n    function _sinh(n){\n        return (Math.exp(n) - Math.exp(-n)) / 2;\n    }\n\n    defineFunction(\"sinh\", _sinh).args([\n        [ \"*num\", \"number\" ]\n    ]);\n\n    defineFunction(\"asinh\", function(n){\n        return Math.log(n + Math.sqrt(n * n + 1));\n    }).args([\n        [ \"*num\", \"number\" ]\n    ]);\n\n    defineFunction(\"sec\", function(n){\n        return 1 / Math.cos(n);\n    }).args([\n        [ \"*num\", \"number\" ]\n    ]);\n\n    defineFunction(\"sech\", function(n){\n        return 1 / _cosh(n);\n    }).args([\n        [ \"*num\", \"number\" ]\n    ]);\n\n    defineFunction(\"csc\", function(n){\n        return 1 / Math.sin(n);\n    }).args([\n        [ \"*num\", \"number\" ]\n    ]);\n\n    defineFunction(\"csch\", function(n){\n        return 1 / _sinh(n);\n    }).args([\n        [ \"*num\", \"number\" ]\n    ]);\n\n    defineFunction(\"atan2\", function(x, y){\n        return Math.atan(y / x);\n    }).args([\n        [ \"*x\", \"divisor\" ],\n        [ \"*y\", \"number\" ]\n    ]);\n\n    function _tanh(n) {\n        return _sinh(n) / _cosh(n);\n    }\n\n    defineFunction(\"tanh\", _tanh).args([\n        [ \"*num\", \"number\" ]\n    ]);\n\n    defineFunction(\"atanh\", function(n){\n        return Math.log(Math.sqrt(1 - n*n) / (1 - n));\n    }).args([\n        [ \"*num\", [ \"and\", \"number\", [ \"(between)\", -1, 1 ] ] ]\n    ]);\n\n    defineFunction(\"cot\", function(n){\n        return 1 / Math.tan(n);\n    }).args([\n        [ \"*num\", \"divisor\" ]\n    ]);\n\n    defineFunction(\"coth\", function(n){\n        return 1 / _tanh(n);\n    }).args([\n        [ \"*num\", \"divisor\" ]\n    ]);\n\n    defineFunction(\"acot\", function(n){\n        return Math.PI / 2 - Math.atan(n);\n    }).args([\n        [ \"*num\", \"number\" ]\n    ]);\n\n    defineFunction(\"acoth\", function(n){\n        return Math.log((n + 1) / (n - 1)) / 2;\n    }).args([\n        [ \"*num\", \"number\" ],\n        [ \"?\", [ \"or\",\n                 [ \"assert\", \"$num < -1\"],\n                 [ \"assert\", \"$num > 1\" ] ] ]\n    ]);\n\n    defineFunction(\"power\", function(a, b){\n        return Math.pow(a, b);\n    }).args([\n        [ \"*a\", \"number\" ],\n        [ \"*b\", \"number\" ]\n    ]);\n\n    defineFunction(\"mod\", function(a, b){\n        return a % b;\n    }).args([\n        [ \"*a\", \"number\" ],\n        [ \"*b\", \"divisor\" ]\n    ]);\n\n    defineFunction(\"quotient\", function(a, b){\n        return Math.floor(a / b);\n    }).args([\n        [ \"*a\", \"number\" ],\n        [ \"*b\", \"divisor\" ]\n    ]);\n\n    defineFunction(\"ceiling\", function(num, s){\n        return s ? s * Math.ceil(num / s) : 0;\n    }).args([\n        [ \"*number\", \"number\" ],\n        [ \"*significance\", \"number\" ],\n        [ \"?\", [ \"assert\", \"$significance >= 0 || $number < 0\" ] ]\n    ]);\n\n    defineFunction(\"ceiling.precise\", function(num, s){\n        s = Math.abs(s);\n        return s ? s * Math.ceil(num / s) : 0;\n    }).args([\n        [ \"*number\", \"number\" ],\n        [ \"*significance\", [ \"or\", \"number\", [ \"null\", 1 ] ] ]\n    ]);\n\n    defineAlias(\"iso.ceiling\", \"ceiling.precise\");\n\n    // XXX: how do we know if this function is correct?\n    //\n    // https://support.office.com/en-gb/article/CEILING-MATH-function-80f95d2f-b499-4eee-9f16-f795a8e306c8\n    //\n    // There are many combinations of Significance and Mode values that affect rounding of negative\n    // numbers in different ways.  right, thanks for the info. :-\\\n    defineFunction(\"ceiling.math\", function(num, s, mode){\n        if (!s || !num) {\n            return 0;\n        }\n        if (num < 0 && ((!mode && s < 0) || (mode && s > 0))) {\n            s = -s;\n        }\n        return s ? s * Math.ceil(num / s) : 0;\n    }).args([\n        [ \"*number\", \"number\" ],\n        [ \"*significance\", [ \"or\", \"number\", [ \"null\", \"$number < 0 ? -1 : 1\" ] ] ],\n        [ \"*mode\", [ \"or\", \"logical\", [ \"null\", 0 ] ] ]\n    ]);\n\n    defineFunction(\"floor\", function(num, s){\n        return s ? s * Math.floor(num / s) : 0;\n    }).args([\n        [ \"*number\", \"number\" ],\n        [ \"*significance\", \"number\" ],\n        [ \"?\", [ \"assert\", \"$significance >= 0 || $number < 0\" ] ]\n    ]);\n\n    defineFunction(\"floor.precise\", function(num, s){\n        s = Math.abs(s);\n        return s ? s * Math.floor(num / s) : 0;\n    }).args([\n        [ \"*number\", \"number\" ],\n        [ \"*significance\", [ \"or\", \"number\", [ \"null\", 1 ] ] ]\n    ]);\n\n    // XXX: check this\n    defineFunction(\"floor.math\", function(num, s, mode){\n        if (!s || !num) {\n            return 0;\n        }\n        if (num < 0 && ((!mode && s < 0) || (mode && s > 0))) {\n            s = -s;\n        }\n        return s ? s * Math.floor(num / s) : 0;\n    }).args([\n        [ \"*number\", \"number\" ],\n        [ \"*significance\", [ \"or\", \"number\", [ \"null\", \"$number < 0 ? -1 : 1\" ] ] ],\n        [ \"*mode\", [ \"or\", \"logical\", [ \"null\", 0 ] ] ]\n    ]);\n\n    defineFunction(\"int\", Math.floor).args([\n        [ \"*number\", \"number\" ]\n    ]);\n\n    defineFunction(\"mround\", function(num, mult){\n        return mult ? mult * Math.round(num / mult) : 0;\n    }).args([\n        [ \"*number\", \"number\" ],\n        [ \"*multiple\", \"number\" ]\n    ]);\n\n    defineFunction(\"round\", function(num, digits){\n        var sign = num < 0 ? -1 : 1;\n        if (sign < 0) { num = -num; }\n        digits = Math.pow(10, digits);\n        num = limitPrecision(num * digits);\n        num = Math.round(num);\n        return sign * num / digits;\n    }).args([\n        [ \"*number\", \"number\" ],\n        [ \"*digits\", \"number\" ]\n    ]);\n\n    defineFunction(\"roundup\", function(num, digits){\n        digits = Math.pow(10, digits);\n        num = limitPrecision(num * digits);\n        num = num < 0 ? Math.floor(num) : Math.ceil(num);\n        return num / digits;\n    }).args([\n        [ \"*number\", \"number\" ],\n        [ \"*digits\", \"number\" ]\n    ]);\n\n    defineFunction(\"rounddown\", function(num, digits){\n        digits = Math.pow(10, digits);\n        num = limitPrecision(num * digits);\n        num = num < 0 ? Math.ceil(num) : Math.floor(num);\n        return num / digits;\n    }).args([\n        [ \"*number\", \"number\" ],\n        [ \"*digits\", \"number\" ]\n    ]);\n\n    defineFunction(\"even\", function(num){\n        var n = num < 0 ? Math.floor(num) : Math.ceil(num);\n        return n % 2 ? n + (n < 0 ? -1 : 1) : n;\n    }).args([\n        [ \"*number\", \"number\" ]\n    ]);\n\n    defineFunction(\"odd\", function(num){\n        var n = num < 0 ? Math.floor(num) : Math.ceil(num);\n        return n % 2 ? n : n + (n < 0 ? -1 : 1);\n    }).args([\n        [ \"*number\", \"number\" ]\n    ]);\n\n    defineFunction(\"sign\", function(num){\n        return num < 0 ? -1 : num > 0 ? 1 : 0;\n    }).args([\n        [ \"*number\", \"number\" ]\n    ]);\n\n    function _gcd(a, b) {\n        while (b) {\n            var r = a % b;\n            a = b;\n            b = r;\n        }\n        return a;\n    }\n\n    function _lcm(a, b) {\n        return Math.abs(a * b) / _gcd(a, b);\n    }\n\n    defineFunction(\"gcd\", function(args){\n        var a = args[0];\n        for (var i = 1; i < args.length; ++i) {\n            a = _gcd(a, args[i]);\n        }\n        return a;\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ]\n    ]);\n\n    defineFunction(\"lcm\", function(args){\n        var a = args[0];\n        for (var i = 1; i < args.length; ++i) {\n            a = _lcm(a, args[i]);\n        }\n        return a;\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ]\n    ]);\n\n    defineFunction(\"sum\", function(numbers){\n        return numbers.reduce(function(sum, num){\n            return sum + num;\n        }, 0);\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ]\n    ]);\n\n    defineFunction(\"product\", function(numbers){\n        return numbers.reduce(function(prod, num){\n            return prod * num;\n        }, 1);\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ]\n    ]);\n\n    defineFunction(\"sumproduct\", function(first, rest) {\n        var sum = 0;\n        first.each(function(p, row, col){\n            if (typeof p == \"number\") {\n                for (var i = 0; i < rest.length; ++i) {\n                    var v = rest[i].get(row, col);\n                    if (typeof v != \"number\") {\n                        return;\n                    }\n                    p *= v;\n                }\n                sum += p;\n            }\n        });\n        return sum;\n    }).args([\n        [ \"a1\", \"matrix\" ],\n        [ \"+\",\n          [ \"a2\", [ \"and\", \"matrix\",\n                    [ \"assert\", \"$a2.width == $a1.width\" ],\n                    [ \"assert\", \"$a2.height == $a1.height\" ] ] ] ]\n    ]);\n\n    defineFunction(\"sumsq\", function(numbers){\n        return numbers.reduce(function(sum, num){\n            return sum + num * num;\n        }, 0);\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ]\n    ]);\n\n    defineFunction(\"sumx2my2\", function(a, b){\n        var sum = 0;\n        a.each(function(x, row, col){\n            var y = b.get(row, col);\n            if (typeof x == \"number\" && typeof y == \"number\") {\n                sum += x*x - y*y;\n            }\n        });\n        return sum;\n    }).args([\n        [ \"a\", \"matrix\" ],\n        [ \"b\", [ \"and\", \"matrix\",\n                 [ \"assert\", \"$b.width == $a.width\" ],\n                 [ \"assert\", \"$b.height == $a.height\" ] ] ]\n    ]);\n\n    defineFunction(\"sumx2py2\", function(a, b){\n        var sum = 0;\n        a.each(function(x, row, col){\n            var y = b.get(row, col);\n            if (typeof x == \"number\" && typeof y == \"number\") {\n                sum += x*x + y*y;\n            }\n        });\n        return sum;\n    }).args([\n        [ \"a\", \"matrix\" ],\n        [ \"b\", [ \"and\", \"matrix\",\n                 [ \"assert\", \"$b.width == $a.width\" ],\n                 [ \"assert\", \"$b.height == $a.height\" ] ] ]\n    ]);\n\n    defineFunction(\"sumxmy2\", function(a, b){\n        var sum = 0;\n        a.each(function(x, row, col){\n            var y = b.get(row, col);\n            if (typeof x == \"number\" && typeof y == \"number\") {\n                sum += (x - y) * (x - y);\n            }\n        });\n        return sum;\n    }).args([\n        [ \"a\", \"matrix\" ],\n        [ \"b\", [ \"and\", \"matrix\",\n                 [ \"assert\", \"$b.width == $a.width\" ],\n                 [ \"assert\", \"$b.height == $a.height\" ] ] ]\n    ]);\n\n    defineFunction(\"seriessum\", function(x, n, m, a){\n        var sum = 0;\n        a.each(function(coef){\n            if (typeof coef != \"number\") {\n                throw new CalcError(\"VALUE\");\n            }\n            sum += coef * Math.pow(x, n);\n            n += m;\n        });\n        return sum;\n    }).args([\n        [ \"x\", \"number\" ],\n        [ \"y\", \"number\" ],\n        [ \"m\", \"number\" ],\n        [ \"a\", \"matrix\" ]\n    ]);\n\n    defineFunction(\"min\", function(numbers){\n        return numbers.length ? Math.min.apply(Math, numbers) : 0;\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number!\" ] ]\n    ]);\n\n    defineFunction(\"max\", function(numbers){\n        return numbers.length ? Math.max.apply(Math, numbers) : 0;\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number!\" ] ]\n    ]);\n\n    defineFunction(\"counta\", function(values){\n        return values.length;\n    }).args([\n        [ \"values\", [ \"#collect\", \"anyvalue\" ] ]\n    ]);\n\n    defineFunction(\"count\", function(numbers){\n        return numbers.length;\n    }).args([\n        [ \"numbers\", [ \"#collect\", \"number\" ] ]\n    ]);\n\n    defineFunction(\"countunique\", function(values){\n        var count = 0, seen = [];\n        values.forEach(function(val){\n            if (seen.indexOf(val) < 0) {\n                count++;\n                seen.push(val);\n            }\n        });\n        return count;\n    }).args([\n        [ \"values\", [ \"#collect\", \"anyvalue\" ] ]\n    ]);\n\n    defineFunction(\"countblank\", function(a){\n        var count = 0;\n        function add(val) {\n            if (val == null || val === \"\") {\n                count++;\n            }\n        }\n        function loop(args){\n            for (var i = 0; i < args.length; ++i) {\n                var x = args[i];\n                if (x instanceof Matrix) {\n                    x.each(add, true);\n                } else {\n                    add(x);\n                }\n            }\n        }\n        loop(a);\n        return count;\n    }).args([\n        [ \"+\", [ \"args\", [ \"or\", \"matrix\", \"anyvalue\" ] ] ]\n    ]);\n\n    defineFunction(\"iseven\", function(num){\n        return num % 2 === 0;\n    }).args([\n        [ \"*number\", \"number\" ]\n    ]);\n\n    defineFunction(\"isodd\", function(num){\n        return num % 2 !== 0;\n    }).args([\n        [ \"*number\", \"number\" ]\n    ]);\n\n    defineFunction(\"n\", function(val){\n        if (typeof val == \"boolean\") {\n            return val ? 1 : 0;\n        }\n        if (typeof val == \"number\") {\n            return val;\n        }\n        return 0;\n    }).args([\n        [ \"*value\", \"anyvalue\" ]\n    ]);\n\n    defineFunction(\"na\", function(){\n        return new CalcError(\"N/A\");\n    }).args([]);\n\n    /* -----[ the \"*IFS\" functions ]----- */\n\n    // helper function: take `args` like COUNTIFS (see Excel docs) and\n    // calls `f` for each cell matching all criteria.  `f` receives\n    // `chunks` (parsed args containing matrix and predicate) and\n    // row,col of matching cells.\n    function forIFS(args, f) {\n        var chunks = [], i = 0, matrix = args[0];\n        while (i < args.length) {\n            chunks.push({\n                matrix: args[i++],\n                pred: parseCriteria(args[i++])\n            });\n        }\n        ROW: for (var row = 0; row < matrix.height; ++row) {\n            COL: for (var col = 0; col < matrix.width; ++col) {\n                for (i = 0; i < chunks.length; ++i) {\n                    var val = chunks[i].matrix.get(row, col);\n                    if (!chunks[i].pred(val == null || val === \"\" ? 0 : val)) {\n                        continue COL;\n                    }\n                }\n                f(row, col);\n            }\n        }\n    }\n\n    var ARGS_COUNTIFS = [\n        [ \"m1\", \"matrix\" ],\n        [ \"c1\", \"anyvalue\" ],\n        [ [ \"m2\", \"matrix\" ],\n          [ \"c2\", \"anyvalue\" ] ]\n    ];\n\n    defineFunction(\"countifs\", function(m1, c1, rest){\n        var count = 0;\n        rest.unshift(m1, c1);\n        forIFS(rest, function(){ count++; });\n        return count;\n    }).args(ARGS_COUNTIFS);\n\n    var ARGS_SUMIFS = [\n        [ \"range\", \"matrix\" ]\n    ].concat(ARGS_COUNTIFS);\n\n    defineFunction(\"sumifs\", function(range, m1, c1, args){\n        // hack: insert a predicate that filters out non-numeric\n        // values; should also accept blank cells.  it's safe to\n        // modify args.\n        args.unshift(range, numericPredicate, m1, c1);\n        var sum = 0;\n        forIFS(args, function(row, col){\n            var val = range.get(row, col);\n            if (val) {\n                sum += val;\n            }\n        });\n        return sum;\n    }).args(ARGS_SUMIFS);\n\n    // similar to sumifs, but compute average of matching cells\n    defineFunction(\"averageifs\", function(range, m1, c1, args){\n        args.unshift(range, numericPredicate, m1, c1);\n        var sum = 0, count = 0;\n        forIFS(args, function(row, col){\n            var val = range.get(row, col);\n            if (val == null || val === \"\") {\n                val = 0;\n            }\n            sum += val;\n            count++;\n        });\n        return count ? sum / count : new CalcError(\"DIV/0\");\n    }).args(ARGS_SUMIFS);\n\n    defineFunction(\"countif\", function(matrix, criteria){\n        criteria = parseCriteria(criteria);\n        var count = 0;\n        matrix.each(function(val){\n            if (criteria(val)) {\n                count++;\n            }\n        });\n        return count;\n    }).args([\n        [ \"range\", \"matrix\" ],\n        [ \"*criteria\", \"anyvalue\" ]\n    ]);\n\n    var ARGS_SUMIF = [\n        [ \"range\", \"matrix\" ],\n        [ \"*criteria\", \"anyvalue\" ],\n        [ \"sumRange\", [ \"or\", \"area\", \"#matrix\", [ \"null\", \"$range\" ] ] ]\n    ];\n\n    function fetchSumRange(continuation) {\n        return function(callback, range, criteria, sumRange) {\n            var self = this;\n            if (sumRange instanceof Ref) {\n                // make sure it covers the same area as `range`, as the spec mentions:\n                //\n                //     The sum_range argument does not have to be the same size and shape as the\n                //     range argument. The actual cells that are added are determined by using the\n                //     upper leftmost cell in the sum_range argument as the beginning cell, and then\n                //     including cells that correspond in size and shape to the range argument.\n                //\n                // It does make one wonder, since only the top-left cell in `sumRange` matters, why\n                // should it be a range at all?  Oh well, Excel.\n                var r = sumRange.clone().toRangeRef();\n                if (r.width() != range.width || r.height() != range.height) {\n                    if (!isFinite(r.topLeft.row)) {\n                        r.topLeft.row = 0;\n                    }\n                    if (!isFinite(r.topLeft.col)) {\n                        r.topLeft.col = 0;\n                    }\n                    r.bottomRight.row = r.topLeft.row + range.height - 1;\n                    r.bottomRight.col = r.topLeft.col + range.width - 1;\n                    return self.resolveCells([ r ], function(){\n                        callback(continuation(range, criteria, self.asMatrix(r)));\n                    });\n                }\n            }\n            callback(continuation(range, criteria, self.asMatrix(sumRange)));\n        };\n    }\n\n    defineFunction(\"sumif\", fetchSumRange(function(range, criteria, sumRange){\n        var sum = 0;\n        criteria = parseCriteria(criteria);\n        range.each(function(val, row, col){\n            if (criteria(val)) {\n                var v = sumRange.get(row, col);\n                if (numericPredicate(v)) {\n                    sum += v || 0;\n                }\n            }\n        });\n        return sum;\n    })).argsAsync(ARGS_SUMIF);\n\n    defineFunction(\"averageif\", fetchSumRange(function(range, criteria, sumRange){\n        var sum = 0, count = 0;\n        criteria = parseCriteria(criteria);\n        range.each(function(val, row, col){\n            if (criteria(val)) {\n                var v = sumRange.get(row, col);\n                if (numericPredicate(v)) {\n                    sum += v || 0;\n                    count++;\n                }\n            }\n        });\n        return count ? sum / count : new CalcError(\"DIV/0\");\n    })).argsAsync(ARGS_SUMIF);\n\n    (function(def){\n        def(\"large\", function(numbers, nth){\n            return numbers.sort(descending)[nth];\n        });\n        def(\"small\", function(numbers, nth){\n            return numbers.sort(ascending)[nth];\n        });\n    })(function(name, handler){\n        defineFunction(name, function(matrix, nth){\n            var numbers = [];\n            var error = matrix.each(function(val){\n                if (val instanceof CalcError) {\n                    return val;\n                }\n                if (typeof val == \"number\") {\n                    numbers.push(val);\n                }\n            });\n            if (error) {\n                return error;\n            }\n            if (nth > numbers.length) {\n                return new CalcError(\"NUM\");\n            }\n            return handler(numbers, nth - 1);\n        }).args([\n            [ \"array\", \"matrix\" ],\n            [ \"*nth\", \"number++\" ]\n        ]);\n    });\n\n    function _avg(numbers) {\n        return numbers.reduce(function(sum, num){\n            return sum + num;\n        }, 0) / numbers.length;\n    }\n\n    function _var_sp(numbers, divisor, avg) {\n        if (avg == null) {\n            avg = _avg(numbers);\n        }\n        return numbers.reduce(function(sum, num){\n            return sum + Math.pow(num - avg, 2);\n        }, 0) / divisor;\n    }\n\n    function _stdev_sp(numbers, divisor) {\n        return Math.sqrt(_var_sp(numbers, divisor));\n    }\n\n    // https://support.office.com/en-sg/article/STDEV-S-function-7d69cf97-0c1f-4acf-be27-f3e83904cc23\n    defineFunction(\"stdev.s\", function(numbers){\n        return _stdev_sp(numbers, numbers.length - 1);\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ],\n        [ \"?\", [ \"assert\", \"$numbers.length >= 2\", \"NUM\" ] ]\n    ]);\n\n    // https://support.office.com/en-sg/article/STDEV-P-function-6e917c05-31a0-496f-ade7-4f4e7462f285\n    defineFunction(\"stdev.p\", function(numbers){\n        return _stdev_sp(numbers, numbers.length);\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number!\" ] ],\n        [ \"?\", [ \"assert\", \"$numbers.length >= 1\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"var.s\", function(numbers){\n        return _var_sp(numbers, numbers.length - 1);\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ],\n        [ \"?\", [ \"assert\", \"$numbers.length >= 2\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"var.p\", function(numbers){\n        return _var_sp(numbers, numbers.length);\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ],\n        [ \"?\", [ \"assert\", \"$numbers.length >= 2\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"median\", function(numbers){\n        var n = numbers.length;\n        numbers.sort(ascending);\n        if (n % 2) {\n            // when length is odd, the median is the number in the middle\n            return numbers[n >> 1];\n        }\n        // that's the average of the two middle numbers, written in in a fancy way\n        return (numbers[n >>= 1] + numbers[n - 1]) / 2;\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ],\n        [ \"?\", [ \"assert\", \"$numbers.length > 0\", \"N/A\" ] ]\n    ]);\n\n    defineFunction(\"mode.sngl\", function(numbers){\n        numbers.sort(ascending);\n        var prev = null, count = 0, max = 1, mode = null;\n        for (var i = 0; i < numbers.length; ++i) {\n            var n = numbers[i];\n            if (n != prev) {\n                count = 1;\n                prev = n;\n            } else {\n                count++;\n            }\n            if (count > max) {\n                max = count;\n                mode = n;\n            }\n        }\n        return mode == null ? new CalcError(\"N/A\") : mode;\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ]\n    ]);\n\n    defineFunction(\"mode.mult\", function(numbers){\n        var seen = Object.create(null), max = 2, res = [];\n        numbers.forEach(function(num){\n            var s = seen[num] || 0;\n            seen[num] = ++s;\n            if (s == max) {\n                res.push(num);\n            } else if (s > max) {\n                max = s;\n                res = [ num ];\n            }\n        });\n        var m = new Matrix(this);\n        res.forEach(function(num, i){\n            m.set(i, 0, num);\n        });\n        return m;\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ]\n    ]);\n\n    defineFunction(\"geomean\", function(numbers){\n        var n = numbers.length;\n        var p = numbers.reduce(function(p, num){\n            if (num < 0) {\n                throw new CalcError(\"NUM\");\n            }\n            return p * num;\n        }, 1);\n        return Math.pow(p, 1/n);\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ],\n        [ \"?\", [ \"assert\", \"$numbers.length > 0\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"harmean\", function(numbers){\n        var n = numbers.length;\n        var s = numbers.reduce(function(s, num){\n            if (!num) {\n                throw new CalcError(\"DIV/0\");\n            }\n            return s + 1 / num;\n        }, 0);\n        return n / s;\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ],\n        [ \"?\", [ \"assert\", \"$numbers.length > 0\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"trimmean\", function(numbers, p){\n        var n = numbers.length;\n        numbers.sort(ascending);\n        var discard = Math.floor(n * p);\n        if (discard % 2) {\n            --discard;\n        }\n        discard /= 2;\n        var sum = 0;\n        for (var i = discard; i < n-discard; ++i) {\n            sum += numbers[i];\n        }\n        return sum / (n - discard * 2);\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\", 1 ] ],\n        [ \"percent\", [ \"and\", \"number\", [ \"[between)\", 0, 1 ] ] ],\n        [ \"?\", [ \"assert\", \"$numbers.length > 0\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"frequency\", function(data, bins){\n        // apparently this always returns a vertical matrix in Excel, so we collect all numbers in\n        // bins instead of receiving it as a Matrix and try to mimic its shape.\n        data.sort(ascending);\n        bins.sort(ascending);\n        var prev = -Infinity;\n        var i = 0;\n        function count(max) {\n            var n = 0;\n            while (i < data.length && data[i] > prev && data[i] <= max) {\n                ++n; ++i;\n            }\n            return n;\n        }\n        var m = new Matrix(this);\n        bins.forEach(function(val, i){\n            var n = count(val);\n            prev = val;\n            m.set(i, 0, n);\n        });\n        m.set(m.height, 0, data.length - i);\n        return m;\n    }).args([\n        [ \"data\", [ \"collect\", \"number\", 1 ] ],\n        [ \"bins\", [ \"collect\", \"number\", 1 ] ]\n    ]);\n\n    defineFunction(\"rank.eq\", function(val, numbers, asc) {\n        numbers.sort(asc ? ascending : descending);\n        var pos = numbers.indexOf(val);\n        return pos < 0 ? new CalcError(\"N/A\") : pos + 1;\n    }).args([\n        [ \"value\", \"number\" ],\n        [ \"numbers\", [ \"collect\", \"number\" ] ],\n        [ \"order\", [ \"or\", \"logical\", [ \"null\", false ] ] ]\n    ]);\n\n    defineAlias(\"rank\", \"rank.eq\");\n\n    defineFunction(\"rank.avg\", function(val, numbers, asc) {\n        numbers.sort(asc ? ascending : descending);\n        var pos = numbers.indexOf(val);\n        if (pos < 0) {\n            return new CalcError(\"N/A\");\n        }\n        for (var i = pos; numbers[i] == val; ++i){}\n        return (pos + i + 1) / 2;\n    }).args([\n        [ \"value\", \"number\" ],\n        [ \"numbers\", [ \"collect\", \"number\" ] ],\n        [ \"order\", [ \"or\", \"logical\", [ \"null\", false ] ] ]\n    ]);\n\n    // formula available at https://support.office.microsoft.com/en-us/article/KURT-function-cbbc2312-dfa6-4cc4-b5c0-1b3c59cc9377\n    defineFunction(\"kurt\", function(numbers){\n        var n = numbers.length;\n        var avg = _avg(numbers);\n        var variance = _var_sp(numbers, n-1, avg);\n        var stddev = Math.sqrt(variance);\n        var sum = numbers.reduce(function(sum, num){\n            return sum + Math.pow((num - avg) / stddev, 4);\n        }, 0);\n        return n*(n+1)/((n-1)*(n-2)*(n-3)) * sum\n            - 3*Math.pow(n-1, 2)/((n-2)*(n-3));\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ],\n        [ \"?\", [ \"assert\", \"$numbers.length >= 4\", \"NUM\" ] ]\n    ]);\n\n    function _percentrank(numbers, x, exc) {\n        var nlt = 0, ngt = 0, left = null, right = null, found = false;\n        numbers.forEach(function(num){\n            if (num < x) {\n                nlt++;\n                left = left == null ? num : Math.max(left, num);\n            } else if (num > x) {\n                ngt++;\n                right = right == null ? num : Math.min(right, num);\n            } else {\n                found = true;\n            }\n        });\n        if (!nlt && !ngt) {\n            return new CalcError(\"N/A\");\n        }\n        if (found) {\n            if (exc) {\n                return (nlt + 1) / (numbers.length + 1);\n            }\n            return nlt / (nlt + ngt);\n        }\n        return ((right - x) * _percentrank(numbers, left, exc) +\n                (x - left) * _percentrank(numbers, right, exc)) / (right - left);\n    }\n\n    var ARGS_PERCENTRANK = [\n        [ \"array\", [ \"collect\", \"number\", 1 ] ],\n        [ \"x\", \"number\" ],\n        [ \"significance\", [ \"or\", [ \"null\", 3 ], \"integer++\" ] ],\n        [ \"?\", [ \"assert\", \"$array.length > 0\", \"NUM\" ] ]\n    ];\n\n    defineFunction(\"percentrank.inc\", function(numbers, x, significance) {\n        var p = _percentrank(numbers, x, 0);\n        p = p.toFixed(significance + 1);\n        return parseFloat(p.substr(0, p.length - 1));\n    }).args(ARGS_PERCENTRANK);\n\n    defineFunction(\"percentrank.exc\", function(numbers, x, significance) {\n        var p = _percentrank(numbers, x, 1);\n        p = p.toFixed(significance + 1);\n        return parseFloat(p.substr(0, p.length - 1));\n    }).args(ARGS_PERCENTRANK);\n\n    defineAlias(\"percentrank\", \"percentrank.inc\");\n\n    function _covariance(x, y, divisor) {\n        var sum = 0;\n        var ax = _avg(x);\n        var ay = _avg(y);\n        var n = x.length;\n        for (var i = 0; i < n; ++i) {\n            sum += (x[i] - ax) * (y[i] - ay);\n        }\n        return sum / divisor;\n    }\n\n    defineFunction(\"covariance.p\", function(x, y){\n        return _covariance(x, y, x.length);\n    }).args([\n        [ \"array1\", [ \"collect\", \"number\", 1 ] ],\n        [ \"array2\", [ \"collect\", \"number\", 1 ] ],\n        [ \"?\", [ \"assert\", \"$array1.length == $array2.length\", \"N/A\" ] ],\n        [ \"?\", [ \"assert\", \"$array1.length > 0\", \"DIV/0\" ] ]\n    ]);\n\n    defineFunction(\"covariance.s\", function(x, y){\n        return _covariance(x, y, x.length - 1);\n    }).args([\n        [ \"array1\", [ \"collect\", \"number\", 1 ] ],\n        [ \"array2\", [ \"collect\", \"number\", 1 ] ],\n        [ \"?\", [ \"assert\", \"$array1.length == $array2.length\", \"N/A\" ] ],\n        [ \"?\", [ \"assert\", \"$array1.length > 1\", \"DIV/0\" ] ]\n    ]);\n\n    defineAlias(\"covar\", \"covariance.p\");\n\n    /* -----[ Factorials ]----- */\n\n    var _fact = util.memoize(function(n){\n        for (var i = 2, fact = 1; i <= n; ++i) {\n            fact *= i;\n        }\n        return fact;\n    });\n\n    defineFunction(\"fact\", _fact).args([\n        [ \"*n\", \"integer+\" ]\n    ]);\n\n    defineFunction(\"factdouble\", function(n){\n        for (var i = 2 + (n&1), fact = 1; i <= n; i += 2) {\n            fact *= i;\n        }\n        return fact;\n    }).args([\n        [ \"*n\", \"integer+\" ]\n    ]);\n\n    defineFunction(\"multinomial\", function(numbers){\n        var div = 1, sum = 0;\n        numbers.forEach(function(n){\n            if (n < 0) {\n                throw new CalcError(\"NUM\");\n            }\n            sum += n;\n            div *= _fact(n);\n        });\n        return _fact(sum) / div;\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ]\n    ]);\n\n    var _combinations = util.memoize(function (n, k){\n        for (var f1 = k + 1, f2 = 1, p1 = 1, p2 = 1; f2 <= n - k; ++f1, ++f2) {\n            p1 *= f1;\n            p2 *= f2;\n        }\n        return p1/p2;\n    });\n\n    defineFunction(\"combin\", _combinations).args([\n        [ \"*n\", \"integer++\" ],\n        [ \"*k\", [ \"and\", \"integer\", [ \"[between]\", 0, \"$n\" ] ] ]\n    ]);\n\n    defineFunction(\"combina\", function(n, k){\n        return _combinations(n + k - 1, n - 1);\n    }).args([\n        [ \"*n\", \"integer++\" ],\n        [ \"*k\", [ \"and\", \"integer\", [ \"[between]\", 1, \"$n\" ] ] ]\n    ]);\n\n    /* -----[ Statistical functions ]----- */\n\n    defineFunction(\"average\", function(numbers){\n        var sum = numbers.reduce(function(sum, num){\n            return sum + num;\n        }, 0);\n        return sum / numbers.length;\n    }).args([\n        // most numeric functions must treat booleans as numbers (1 for TRUE\n        // and 0 for FALSE), but AVERAGE shouldn't.\n        [ \"numbers\", [ \"collect\", \"number!\" ] ],\n        [ \"?\", [ \"assert\", \"$numbers.length > 0\", \"DIV/0\" ] ]\n    ]);\n\n    defineFunction(\"averagea\", function(values){\n        var sum = 0, count = 0;\n        values.forEach(function(num){\n            if (typeof num != \"string\") {\n                sum += num;\n            }\n            ++count;\n        });\n        return count ? sum / count : new CalcError(\"DIV/0\");\n    }).args([\n        [ \"values\", [ \"collect\", \"anyvalue\" ] ]\n    ]);\n\n    function _percentile(numbers, rank) {\n        numbers.sort(ascending);\n        var n = numbers.length;\n        var k = rank | 0, d = rank - k;\n        if (k === 0) {\n            return numbers[0];\n        }\n        if (k >= n) {\n            return numbers[n - 1];\n        }\n        --k;\n        return numbers[k] + d * (numbers[k + 1] - numbers[k]);\n    }\n\n    function _percentile_inc(numbers, p){\n        // algorithm from https://en.wikipedia.org/wiki/Percentile#Microsoft_Excel_method\n        var rank = p * (numbers.length - 1) + 1;\n        return _percentile(numbers, rank);\n    }\n\n    function _percentile_exc(numbers, p){\n        // https://en.wikipedia.org/wiki/Percentile#NIST_method\n        var rank = p * (numbers.length + 1);\n        return _percentile(numbers, rank);\n    }\n\n    defineFunction(\"percentile.inc\", _percentile_inc).args([\n        [ \"numbers\", [ \"collect\", \"number\", 1 ] ],\n        [ \"p\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ]\n    ]);\n\n    defineFunction(\"percentile.exc\", _percentile_exc).args([\n        [ \"numbers\", [ \"collect\", \"number\", 1 ] ],\n        [ \"p\", [ \"and\", \"number\", [ \"(between)\", 0, 1 ] ] ]\n    ]);\n\n    defineFunction(\"quartile.inc\", function(numbers, quarter){\n        return _percentile_inc(numbers, quarter / 4);\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\", 1 ] ],\n        [ \"quarter\", [ \"values\", 0, 1, 2, 3, 4 ] ]\n    ]);\n\n    defineFunction(\"quartile.exc\", function(numbers, quarter){\n        return _percentile_exc(numbers, quarter / 4);\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\", 1 ] ],\n        [ \"quarter\", [ \"values\", 0, 1, 2, 3, 4 ] ]\n    ]);\n\n    defineAlias(\"quartile\", \"quartile.inc\");\n    defineAlias(\"percentile\", \"percentile.inc\");\n\n    var AGGREGATE_FUNCS = [\n        \"AVERAGE\", \"COUNT\", \"COUNTA\", \"MAX\", \"MIN\", \"PRODUCT\",\n        \"STDEV.S\", \"STDEV.P\", \"SUM\", \"VAR.S\", \"VAR.P\", \"MEDIAN\",\n        \"MODE.SNGL\", \"LARGE\", \"SMALL\", \"PERCENTILE.INC\",\n        \"QUARTILE.INC\", \"PERCENTILE.EXC\", \"QUARTILE.EXC\"\n    ];\n\n    function fetchValuesForAggregate(self, args, options) {\n        var values = [];\n        var opt_ignore_hidden_rows = 1;\n        var opt_ignore_errors = 2;\n        var opt_use_aggregates = 4;\n        (function fetchValues(args) {\n            if (args instanceof Ref) {\n                self.getRefCells(args, true).forEach(function(cell){\n                    var value = cell.value;\n                    if ((options & opt_ignore_hidden_rows) && cell.hidden) {\n                        return;\n                    }\n                    if (cell.formula) {\n                        // XXX: formula.print is fast, but still, can't we do any better here?\n                        //      perhaps access the input string directly somehow?\n                        var str = cell.formula.print(cell.row, cell.col);\n                        if (/^\\s*(?:aggregate|subtotal)\\s*\\(/i.test(str)) {\n                            if (!(options & opt_use_aggregates)) {\n                                return;\n                            }\n                        }\n                    }\n                    if ((options & opt_ignore_errors) && value instanceof CalcError) {\n                        return;\n                    }\n                    if (typeof value == \"number\" || value instanceof CalcError) {\n                        values.push(value);\n                    }\n                });\n            } else if (Array.isArray(args)) {\n                for (var i = 0; i < args.length; ++i) {\n                    fetchValues(args[i]);\n                }\n            } else if (args instanceof Matrix) {\n                args.each(fetchValues);\n            } else if (typeof args == \"number\") {\n                values.push(args);\n            } else if (args instanceof CalcError && !(options & opt_ignore_errors)) {\n                values.push(args);\n            }\n        })(args);\n        return values;\n    }\n\n    // AGGREGATE function\n    //\n    // https://support.office.com/en-SG/article/aggregate-function-c8caed56-07df-4aeb-9741-23693ffbe525\n    //\n    // we can only partially type-check this function.  also, we need to use the async version in\n    // order to resolve references and delegate values to the function to aggregate.\n    defineFunction(\"aggregate\", function(callback, funcId, options, args){\n        // options is a bit field.  that makes sense; it's the documentation which doesn't.\n        var self = this;\n        self.resolveCells(args, function(){\n            var values;\n            if (funcId > 12) {\n                // \"array form\"\n                values = fetchValuesForAggregate(self, args[0], options);\n                var k = args[1];\n                if (k instanceof CellRef) {\n                    k = self.getRefData(k);\n                }\n                if (typeof k != \"number\") {\n                    return callback(new CalcError(\"VALUE\"));\n                }\n            } else {\n                values = fetchValuesForAggregate(self, args, options);\n            }\n            self.func(AGGREGATE_FUNCS[funcId - 1], callback, values);\n        });\n    }).argsAsync([\n        [ \"funcId\", [ \"values\", 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,\n                      11, 12, 13, 14, 15, 16, 17, 18, 19 ] ],\n        [ \"options\", [ \"or\",\n                       [ \"null\", 0 ],\n                       [ \"values\", 0, 1, 2, 3, 4, 5, 6, 7  ] ] ],\n        [ \"args\", \"rest\" ]\n    ]);\n\n    defineFunction(\"subtotal\", function(callback, funcId){\n        var self = this;\n        var ignoreHidden = funcId > 100;\n        if (ignoreHidden) {\n            funcId -= 100;\n        }\n        var args = [];\n        for (var i = 2; i < arguments.length; ++i) {\n            args.push(arguments[i]);\n        }\n        self.resolveCells(args, function(){\n            var values = fetchValuesForAggregate(self, args, ignoreHidden ? 1 : 0);\n            self.func(AGGREGATE_FUNCS[funcId - 1], callback, values);\n        });\n    }).argsAsync([\n        [ \"funcId\", [ \"values\", 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,\n                      101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111 ] ],\n        [ \"+\", [ \"ref\", [ \"or\", \"ref\", \"#matrix\" ] ] ]\n    ]);\n\n    // https://support.office.com/en-sg/article/AVEDEV-function-ec78fa01-4755-466c-9a2b-0c4f9eacaf6d\n    defineFunction(\"avedev\", function(numbers){\n        var avg = numbers.reduce(function(sum, num){\n            return sum + num;\n        }, 0) / numbers.length;\n        return numbers.reduce(function(sum, num){\n            return sum + Math.abs(num - avg);\n        }, 0) / numbers.length;\n    }).args([\n        [ \"numbers\", [ \"collect\", \"number\" ] ],\n        [ \"?\", [ \"assert\", \"$numbers.length >= 2\", \"NUM\" ] ]\n    ]);\n\n    function _binom_dist(x, n, p, cumulative) {\n        if (!cumulative) {\n            return _combinations(n, x) * Math.pow(p, x) * Math.pow(1-p, n-x);\n        } else {\n            var sum = 0;\n            for (var j = 0; j <= x; ++j) {\n                sum += _combinations(n, j) * Math.pow(p, j) * Math.pow(1-p, n-j);\n            }\n            return sum;\n        }\n    }\n\n    defineFunction(\"binom.dist\", _binom_dist).args([\n        [ \"successes\", \"integer+\" ],\n        [ \"trials\", [ \"and\", \"integer\", [ \"assert\", \"$trials >= $successes\" ] ] ],\n        [ \"probability\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ],\n        [ \"cumulative\", \"logical\" ]\n    ]);\n\n    defineAlias(\"binomdist\", \"binom.dist\");\n\n    defineFunction(\"binom.inv\", function(n, p, alpha){\n        // XXX: could a binary search be faster?\n        for (var x = 0; x <= n; ++x) {\n            if (_binom_dist(x, n, p, true) >= alpha) {\n                return x;\n            }\n        }\n        return new CalcError(\"N/A\"); // XXX: is this right?\n    }).args([\n        [ \"trials\", \"integer+\" ],\n        [ \"probability\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ],\n        [ \"alpha\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ]\n    ]);\n\n    defineAlias(\"critbinom\", \"binom.inv\");\n\n    defineFunction(\"binom.dist.range\", function(n, p, s, s2){\n        var sum = 0;\n        for (var k = s; k <= s2; ++k) {\n            sum += _combinations(n, k) * Math.pow(p, k) * Math.pow(1-p, n-k);\n        }\n        return sum;\n    }).args([\n        [ \"trials\", \"integer+\" ],\n        [ \"probability\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ],\n        [ \"successes_min\", [ \"and\", \"integer\", [ \"[between]\", 0, \"$trials\" ] ] ],\n        [ \"successes_max\", [ \"or\",\n                             [ \"and\", \"integer\",\n                               [ \"[between]\", \"$successes_min\", \"$trials\" ] ],\n                             [ \"null\", \"$successes_min\" ] ] ]\n    ]);\n\n    defineFunction(\"negbinom.dist\", function(x, k, p, cumulative){\n        if (cumulative) {\n            var sum = 0;\n            while (x >= 0) {\n                sum += _combinations(x+k-1, x) * Math.pow(p, k) * Math.pow(1-p, x);\n                x--;\n            }\n            return sum;\n        }\n        return _combinations(x+k-1, x) * Math.pow(p, k) * Math.pow(1-p, x);\n    }).args([\n        [ \"number_f\", \"integer+\" ],\n        [ \"number_s\", \"integer+\" ],\n        [ \"probability_s\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ],\n        [ \"cumulative\", \"logical\" ]\n    ]);\n\n    defineAlias(\"negbinomdist\", \"negbinom.dist\");\n\n    /* -----[ lookup functions ]----- */\n\n    defineFunction(\"address\", function(row, col, abs, a1, sheet){\n        // by some lucky coincidence, we get the corret `rel` value by just subtracting 1 from the\n        // abs argument\n        var cell = new CellRef(row - 1, col - 1, abs - 1);\n        if (sheet) {\n            cell.setSheet(sheet, true);\n        }\n        return a1 ? cell.print(0, 0) : cell.print();\n    }).args([\n        [ \"row\", \"integer++\" ],\n        [ \"col\", \"integer++\" ],\n        [ \"abs\", [ \"or\", [ \"null\", 1 ], [ \"values\", 1, 2, 3, 4 ]]],\n        [ \"a1\", [ \"or\", [ \"null\", true ], \"logical\" ]],\n        [ \"sheet\", [ \"or\", \"null\", \"string\" ]]\n    ]);\n\n    defineFunction(\"areas\", function(ref){\n        var count = 0;\n        (function loop(x){\n            if (x instanceof CellRef || x instanceof RangeRef) {\n                count++;\n            } else if (x instanceof UnionRef) {\n                x.refs.forEach(loop);\n            }\n            // XXX: NameRef if we add support\n        })(ref);\n        return count;\n    }).args([\n        [ \"ref\", \"ref\" ]\n    ]);\n\n    defineFunction(\"choose\", function(index, args){\n        if (index > args.length) {\n            return new CalcError(\"N/A\");\n        } else {\n            return args[index - 1];\n        }\n    }).args([\n        [ \"*index\", \"integer\" ],\n        [ \"+\", [ \"value\", \"anything\" ] ]\n    ]);\n\n    defineFunction(\"column\", function(ref){\n        if (!ref) {\n            return this.formula.col + 1;\n        }\n        if (ref instanceof CellRef) {\n            return ref.col + 1;\n        }\n        return this.asMatrix(ref).mapCol(function(col){\n            return col + ref.topLeft.col + 1;\n        });\n    }).args([\n        [ \"ref\", [ \"or\", \"area\", \"null\" ]]\n    ]);\n\n    defineFunction(\"columns\", function(m){\n        return m instanceof Ref ? m.width() : m.width;\n    }).args([\n        [ \"ref\", [ \"or\", \"area\", \"#matrix\" ] ]\n    ]);\n\n    defineFunction(\"formulatext\", function(ref){\n        var cell = this.getRefCells(ref)[0]; // XXX: overkill, but oh well.\n        if (!cell.formula) {\n            return new CalcError(\"N/A\");\n        }\n        return cell.formula.print(cell.row, cell.col);\n    }).args([\n        [ \"ref\", \"ref\" ]\n    ]);\n\n    defineFunction(\"hlookup\", function(value, m, row, approx){\n        var resultCol = null;\n        m.eachCol(function(col){\n            var data = m.get(0, col);\n            if (approx) {\n                if (data > value) {\n                    return true;\n                }\n                resultCol = col;\n            } else if (data === value) {\n                resultCol = col;\n                return true;\n            }\n        });\n        if (resultCol == null) {\n            return new CalcError(\"N/A\");\n        }\n        return m.get(row - 1, resultCol);\n    }).args([\n        [ \"value\", \"anyvalue\" ],\n        [ \"range\", \"matrix\" ],\n        [ \"row\", \"integer++\" ],\n        [ \"approx\", [ \"or\", \"logical\", [ \"null\", true ]]]\n    ]);\n\n    defineFunction(\"index\", function(callback, ref, row, col, areanum){\n        var self = this;\n        if (ref instanceof UnionRef) {\n            ref = ref.refs[areanum - 1];\n        }\n        if ((!row && !col) || !ref) {\n            return callback(new CalcError(\"N/A\"));\n        }\n        if (ref instanceof CellRef) {\n            ref = ref.toRangeRef();\n        }\n        if (ref instanceof RangeRef) {\n            if (row && col) {\n                if (col > ref.width() || row > ref.height()) {\n                    return callback(new CalcError(\"REF\"));\n                }\n                // fetching a single cell\n                var cell = ref.toCell(row - 1, col - 1);\n                self.resolveCells([ cell ], function(){\n                    callback(self.getRefData(cell));\n                });\n                return;\n            }\n            if (!row) {\n                // fetch a full column\n                var colRange = ref.toColumn(col - 1);\n                self.resolveCells([ colRange ], function(){\n                    callback(self.asMatrix(colRange));\n                });\n                return;\n            }\n            if (!col) {\n                // fetch a full row\n                var rowRange = ref.toRow(row - 1);\n                self.resolveCells([ rowRange ], function(){\n                    callback(self.asMatrix(rowRange));\n                });\n                return;\n            }\n        }\n        else if (ref instanceof Matrix) {\n            if (ref.width > 1 && ref.height > 1) {\n                if (row && col) {\n                    return callback(ref.get(row - 1, col - 1));\n                }\n                if (!row) {\n                    return callback(ref.mapRow(function(row){\n                        return ref.get(row, col - 1);\n                    }));\n                }\n                if (!col) {\n                    return callback(ref.mapCol(function(col){\n                        return ref.get(row - 1, col);\n                    }));\n                }\n            }\n            if (ref.width == 1) {\n                return callback(ref.get(row - 1, 0));\n            }\n            if (ref.height == 1) {\n                return callback(ref.get(0, col - 1));\n            }\n        }\n        else {\n            callback(new CalcError(\"REF\"));\n        }\n    }).argsAsync([\n        [ \"range\", [ \"or\", \"ref\", \"matrix\" ] ],\n        [ \"row\", [ \"or\", \"integer+\", \"null\" ] ],\n        [ \"col\", [ \"or\", \"integer+\", \"null\" ] ],\n        [ \"areanum\", [ \"or\", \"integer++\", [ \"null\", 1 ] ] ]\n    ]);\n\n    defineFunction(\"indirect\", function(thing){\n        try {\n            // XXX: does more work than needed.  we could go for parseReference, but that one\n            // doesn't (yet?) support \"SheetName!\" prefix.\n            var f = this.formula;\n            var exp = calc.parseFormula(f.sheet, f.row, f.col, thing);\n            var ref = exp.ast;\n            if (ref instanceof NameRef) {\n                ref = this.ss.nameValue(ref, f.sheet, f.row, f.col);\n            }\n            if (!(ref instanceof Ref)) {\n                throw 1;\n            }\n            return ref.absolute(f.row, f.col);\n        } catch(ex) {\n            return new CalcError(\"REF\");\n        }\n    }).args([\n        [ \"thing\", \"string\" ]\n    ]);\n\n    // XXX: LOOKUP.  seems to be deprecated in favor of HLOOKUP/VLOOKUP\n\n    // XXX: double-check this one.\n    defineFunction(\"match\", function(val, m, type){\n        var index = 1, cmp;\n        if (type === 0) {\n            cmp = parseCriteria(val);\n        } else if (type === -1) {\n            cmp = parseCriteria(\"<=\" + val);\n        } else if (type === 1) {\n            cmp = parseCriteria(\">=\" + val);\n        }\n        if (m.each(function(el){\n            if (el != null && cmp(el)) {\n                if (type !== 0 && val != el) {\n                    --index;\n                }\n                return true;\n            }\n            index++;\n        }, true) && index > 0) {\n            return index;\n        } else {\n            return new CalcError(\"N/A\");\n        }\n    }).args([\n        [ \"value\", \"anyvalue\" ],\n        [ \"range\", \"matrix\" ],\n        [ \"type\", [ \"or\",\n                    [ \"values\", -1, 0, 1 ],\n                    [ \"null\", 1 ]]]\n    ]);\n\n    defineFunction(\"offset\", function(ref, rows, cols, height, width){\n        var topLeft = (ref instanceof CellRef ? ref : ref.topLeft).clone();\n        topLeft.row += rows;\n        topLeft.col += cols;\n        if (topLeft.row < 0 || topLeft.col < 0) {\n            return new CalcError(\"VALUE\");\n        }\n        if (height > 1 || width > 1) {\n            return new RangeRef(topLeft, new CellRef(topLeft.row + height - 1,\n                                                     topLeft.col + width - 1))\n                .setSheet(ref.sheet, ref.hasSheet());\n        }\n        return topLeft;\n    }).args([\n        [ \"ref\", \"area\" ],\n        [ \"*rows\", \"integer\" ],\n        [ \"*cols\", \"integer\" ],\n        [ \"*height\", [ \"or\", \"integer++\", [ \"null\", \"$ref.height()\" ]]],\n        [ \"*width\", [ \"or\", \"integer++\", [ \"null\", \"$ref.width()\" ]]]\n    ]);\n\n    defineFunction(\"row\", function(ref){\n        if (!ref) {\n            return this.formula.row + 1;\n        }\n        if (ref instanceof CellRef) {\n            return ref.row + 1;\n        }\n        return this.asMatrix(ref).mapRow(function(row){\n            return row + ref.topLeft.row + 1;\n        });\n    }).args([\n        [ \"ref\", [ \"or\", \"area\", \"null\" ]]\n    ]);\n\n    defineFunction(\"rows\", function(m){\n        return m instanceof Ref ? m.height() : m.height;\n    }).args([\n        [ \"ref\", [ \"or\", \"area\", \"#matrix\" ] ]\n    ]);\n\n    defineFunction(\"vlookup\", function(value, m, col, approx){\n        var resultRow = null;\n        if (typeof value != \"number\") {\n            approx = false;\n        }\n        if (typeof value == \"string\") {\n            value = value.toLowerCase();\n        }\n        m.eachRow(function(row){\n            var data = m.get(row, 0);\n            if (approx) {\n                if (data > value) {\n                    return true;\n                }\n                resultRow = row;\n            } else {\n                if (typeof data == \"string\") {\n                    data = data.toLowerCase();\n                }\n                if (data === value) {\n                    resultRow = row;\n                    return true;\n                }\n            }\n        });\n        if (resultRow == null) {\n            return new CalcError(\"N/A\");\n        }\n        return m.get(resultRow, col - 1);\n    }).args([\n        [ \"value\", \"anyvalue\" ],\n        [ \"range\", \"matrix\" ],\n        [ \"col\", \"integer++\" ],\n        [ \"approx\", [ \"or\", \"logical\", [ \"null\", true ]]]\n    ]);\n\n    /* -----[ Date and time functions ]----- */\n\n    defineFunction(\"date\", function(year, month, date){\n        return packDate(year, month-1, date);\n    }).args([\n        [ \"*year\", \"integer\" ],\n        [ \"*month\", \"integer\" ],\n        [ \"*date\", \"integer\" ]\n    ]);\n\n    defineFunction(\"day\", function(date){\n        return unpackDate(date).date;\n    }).args([\n        [ \"*date\", \"date\" ]\n    ]);\n\n    defineFunction(\"month\", function(date){\n        return unpackDate(date).month + 1;\n    }).args([\n        [ \"*date\", \"date\" ]\n    ]);\n\n    defineFunction(\"year\", function(date){\n        return unpackDate(date).year;\n    }).args([\n        [ \"*date\", \"date\" ]\n    ]);\n\n    defineFunction(\"weekday\", function(date){\n        // XXX: TODO type\n        return unpackDate(date).day + 1;\n    }).args([\n        [ \"*date\", \"date\" ]\n    ]);\n\n    // https://support.office.com/en-GB/article/WEEKNUM-function-e5c43a03-b4ab-426c-b411-b18c13c75340\n    // XXX: this is a mess.\n    defineFunction(\"weeknum\", function(date, type){\n        var fw = packDate(unpackDate(date).year, 0, 1);\n        var sy = unpackDate(fw);\n        var diff;\n        if (type == 21) {\n            // Monday-based weeks, first week is the one containing the first Thursday of the year\n            // we want to place in fw and sy the first Thursday\n            diff = 3 - (sy.day + 6) % 7;\n            if (diff < 0) {\n                diff += 7;\n            }\n            fw += diff;\n            sy.date += diff;\n            sy.day = 4;         // Thursday.\n            type = 1;\n        } else {\n            if (type == 1) {\n                type = 0;\n            } else if (type == 2) {\n                type = 1;\n            } else {\n                type = (type - 10) % 7;\n            }\n            // finally compatible with what we got:\n            // type == 0 means week starts on Sunday\n            //         1                      Monday\n            //         2                      Tuesday\n            // ...\n        }\n        diff = sy.day - type;\n        if (diff < 0) {\n            diff += 7;\n        }\n        fw -= diff;\n        return Math.ceil((date + 1 - fw) / 7);\n    }).args([\n        [ \"*date\", \"date\" ],\n        [ \"*type\", [ \"or\", [ \"null\", 1 ],\n                     [ \"values\", 1, 2, 11, 12, 13, 14, 15, 16, 17, 21 ] ] ]\n    ]);\n\n    function weeksInYear(year) {\n        var d = unpackDate(packDate(year, 0, 1));\n        if ((d.day == 4) || (d.day == 3 && runtime.isLeapYear(year))) {\n            // long year\n            return 53;\n        }\n        return 52;\n    }\n\n    defineFunction(\"isoweeknum\", function isoweeknum(date){\n        // https://en.wikipedia.org/wiki/ISO_week_date#Calculating_the_week_number_of_a_given_date\n        var d = unpackDate(date);\n        var dow = d.day || 7;\n        var wk = Math.floor((d.ord - dow + 10) / 7);\n        if (wk < 1) {\n            return weeksInYear(d.year - 1);\n        } else if (wk == 53 && wk > weeksInYear(d.year)) {\n            return 1;\n        }\n        return wk;\n    }).args([\n        [ \"*date\", \"date\" ]\n    ]);\n\n    defineFunction(\"now\", function(){\n        return runtime.dateToSerial(new Date());\n    }).args([]);\n\n    defineFunction(\"today\", function(){\n        return runtime.dateToSerial(new Date()) | 0;\n    }).args([]);\n\n    defineFunction(\"time\", function(hh, mm, ss){\n        return runtime.packTime(hh, mm, ss, 0);\n    }).args([\n        [ \"*hours\", \"integer\" ],\n        [ \"*minutes\", \"integer\" ],\n        [ \"*seconds\", \"integer\" ]\n    ]);\n\n    defineFunction(\"hour\", function(time){\n        return runtime.unpackTime(time).hours;\n    }).args([\n        [ \"*time\", \"datetime\" ]\n    ]);\n\n    defineFunction(\"minute\", function(time){\n        return runtime.unpackTime(time).minutes;\n    }).args([\n        [ \"*time\", \"datetime\" ]\n    ]);\n\n    defineFunction(\"second\", function(time){\n        return runtime.unpackTime(time).seconds;\n    }).args([\n        [ \"*time\", \"datetime\" ]\n    ]);\n\n    defineFunction(\"edate\", function(base, months){\n        var d = unpackDate(base);\n        var m = d.month + months;\n        var y = d.year + Math.floor(m/12);\n        m %= 12;\n        if (m < 0) {\n            m += 12;\n        }\n        d = Math.min(d.date, daysInMonth(y, m));\n        return packDate(y, m, d);\n    }).args([\n        [ \"*start_date\", \"date\" ],\n        [ \"*months\", \"integer\" ]\n    ]);\n\n    defineFunction(\"eomonth\", function(base, months){\n        var d = unpackDate(base);\n        var m = d.month + months;\n        var y = d.year + Math.floor(m/12);\n        m %= 12;\n        if (m < 0) {\n            m += 12;\n        }\n        d = daysInMonth(y, m);\n        return packDate(y, m, d);\n    }).args([\n        [ \"*start_date\", \"date\" ],\n        [ \"*months\", \"integer\" ]\n    ]);\n\n    defineFunction(\"workday\", function(date, n, holidays){\n        // XXX: the algorithm here is pretty dumb, can we do better?\n        var inc = n > 0 ? 1 : -1;\n        n = Math.abs(n);\n        var dow = unpackDate(date).day;\n        while (n > 0) {\n            date += inc;\n            dow = (dow + inc) % 7;\n            if (dow > 0 && dow < 6 && holidays.indexOf(date) < 0) {\n                --n;\n            }\n        }\n        return date;\n    }).args([\n        [ \"start_date\", \"date\" ],\n        [ \"days\", \"integer\" ],\n        [ \"holidays\", [ \"collect\", \"date\" ] ]\n    ]);\n\n    defineFunction(\"networkdays\", function(date, end, holidays){\n        // XXX: the algorithm here is pretty dumb, can we do better?\n        if (date > end) {\n            var tmp = date;\n            date = end;\n            end = tmp;\n        }\n        var count = 0;\n        var dow = unpackDate(date).day;\n        while (date <= end) {\n            if (dow > 0 && dow < 6 && holidays.indexOf(date) < 0) {\n                count++;\n            }\n            date++;\n            dow = (dow + 1) % 7;\n        }\n        return count;\n    }).args([\n        [ \"start_date\", \"date\" ],\n        [ \"end_date\", \"date\" ],\n        [ \"holidays\", [ \"collect\", \"date\" ] ]\n    ]);\n\n    defineFunction(\"days\", function(end, start){\n        return end - start;\n    }).args([\n        [ \"*start_date\", \"date\" ],\n        [ \"*end_date\", \"date\" ]\n    ]);\n\n    function _days_360(start, end, method) {\n        var d1 = unpackDate(start);\n        var d2 = unpackDate(end);\n\n        // https://en.wikipedia.org/wiki/360-day_calendar\n        // humanity is a mess.\n        if (method) {\n            // EU method\n            if (d1.date == 31) {\n                d1.date = 30;\n            }\n            if (d2.date == 31) {\n                d2.date = 30;\n            }\n        } else {\n            // US method\n            if (d1.month == 1 && d2.month == 1\n                && d1.date == daysInMonth(d1.year, 1)\n                && d2.date == daysInMonth(d2.year, 1)) {\n                d2.date = 30;\n            }\n            if (d1.date == daysInMonth(d1.year, d1.month)) {\n                d1.date = 30;\n                if (d2.date == 31) {\n                    d2.date = 30;\n                }\n            } else {\n                if (d1.date == 30 && d2.date == 31) {\n                    d2.date = 30;\n                }\n            }\n        }\n\n        return (360 * (d2.year - d1.year)\n                + 30 * (d2.month - d1.month)\n                + (d2.date - d1.date));\n    }\n\n    runtime._days_360 = _days_360;\n\n    defineFunction(\"days360\", _days_360).args([\n        [ \"*start_date\", \"date\" ],\n        [ \"*end_date\", \"date\" ],\n        [ \"*method\", [ \"or\", \"logical\", [ \"null\", false ] ] ]\n    ]);\n\n    defineFunction(\"yearfrac\", function(start, end, method){\n        switch (method) {\n          case 0:\n            return _days_360(start, end, false) / 360;\n          case 1:\n            return (end - start) / daysInYear(unpackDate(start).year);\n          case 2:\n            return (end - start) / 360;\n          case 3:\n            return (end - start) / 365;\n          case 4:\n            return _days_360(start, end, true) / 360;\n        }\n    }).args([\n        [ \"*start_date\", \"date\" ],\n        [ \"*end_date\", \"date\" ],\n        [ \"*method\", [ \"or\", [ \"null\", 0 ], [ \"values\", 0, 1, 2, 3, 4 ] ] ]\n    ]);\n\n    defineFunction(\"datevalue\", function(text){\n        var date = runtime.parseDate(text);\n        if (date) {\n            return runtime.dateToSerial(date);\n        }\n        return new CalcError(\"VALUE\");\n    }).args([\n        [ \"*text\", \"string\" ]\n    ]);\n\n    defineFunction(\"timevalue\", function(text){\n        var m = text.toLowerCase().match(/(\\d+):(\\d+)(:(\\d+)(\\.(\\d+))?)?\\s*(am?|pm?)?/);\n        if (m) {\n            var hh = parseFloat(m[1]);\n            var mm = parseFloat(m[2]);\n            var ss = m[3] ? parseFloat(m[4]) : 0;\n            //var ms = m[5] ? parseFloat(m[6]) : 0;\n            var ampm = m[7];\n            if (ampm && (hh > 12 || hh < 1)) {\n                return new CalcError(\"VALUE\");\n            }\n            if (/^p/.test(ampm)) {\n                hh += 12;\n            }\n            return runtime.packTime(hh, mm, ss, 0);\n        }\n        return new CalcError(\"VALUE\");\n    }).args([\n        [ \"*text\", \"string\" ]\n    ]);\n\n    /* -----[ Matrix functions ]----- */\n\n    defineFunction(\"mdeterm\", function(m){\n        var error = m.each(function(val){\n            if (typeof val != \"number\") {\n                return new CalcError(\"VALUE\");\n            }\n        }, true);\n        return error || m.determinant();\n    }).args([\n        [ \"m\", [ \"and\", \"matrix\",\n                 [ \"assert\", \"$m.width == $m.height\" ] ] ]\n    ]);\n\n    defineFunction(\"transpose\", function(m){\n        return m.transpose();\n    }).args([\n        [ \"range\", \"matrix\" ]\n    ]);\n\n    defineFunction(\"mmult\", function(a, b){\n        return a.multiply(b);\n    }).args([\n        [ \"a\", \"matrix\" ],\n        [ \"b\", [ \"and\", \"matrix\",\n                 [ \"assert\", \"$b.height == $a.width\" ] ] ]\n    ]);\n\n    defineFunction(\"munit\", function(n){\n        return new Matrix(this).unit(n);\n    }).args([\n        [ \"n\", \"integer+\" ]\n    ]);\n\n    defineFunction(\"minverse\", function(m){\n        var error = m.each(function(val){\n            if (typeof val != \"number\") {\n                return new CalcError(\"VALUE\");\n            }\n        }, true);\n        return error || m.inverse() || new CalcError(\"VALUE\");\n    }).args([\n        [ \"m\", [ \"and\", \"matrix\",\n                 [ \"assert\", \"$m.width == $m.height\" ] ] ]\n    ]);\n\n    /* -----[ Other ]----- */\n\n    defineFunction(\"rand\", function() {\n        return Math.random();\n    }).args([]);\n\n    defineFunction(\"randbetween\", function(min, max){\n        return min + Math.floor((max - min + 1) * Math.random());\n    }).args([\n        [ \"min\", \"integer\" ],\n        [ \"max\", [ \"and\", \"integer\", [ \"assert\", \"$max >= $min\" ] ] ]\n    ]);\n\n    defineFunction(\"true\", function(){\n        return true;\n    }).args([]);\n\n    defineFunction(\"false\", function(){\n        return true;\n    }).args([]);\n\n    defineFunction(\"roman\", function(num){\n        return util.arabicToRoman(num).toUpperCase();\n    }).args([\n        [ \"*number\", \"integer\" ]\n    ]);\n\n    defineFunction(\"arabic\", function(rom){\n        var num = util.romanToArabic(rom);\n        return num == null ? new CalcError(\"VALUE\") : num;\n    }).args([\n        [ \"*roman\", \"string\" ]\n    ]);\n\n    defineFunction(\"base\", function(number, radix, minLen){\n        var str = number.toString(radix).toUpperCase();\n        while (str.length < minLen) {\n            str = \"0\" + str;\n        }\n        return str;\n    }).args([\n        [ \"*number\", \"integer\" ],\n        [ \"*radix\", [ \"and\", \"integer\", [ \"[between]\", 2, 36 ] ] ],\n        [ \"*minLen\", [ \"or\", \"integer+\", [ \"null\", 0 ] ] ]\n    ]);\n\n    defineFunction(\"decimal\", function(text, radix){\n        text = text.toUpperCase();\n        var val = 0;\n        for (var i = 0; i < text.length; ++i) {\n            var d = text.charCodeAt(i);\n            if (d >= 48 && d <= 57) {\n                d -= 48;\n            } else if (d >= 65 && d < (55 + radix)) {\n                d -= 55;\n            } else {\n                return new CalcError(\"VALUE\");\n            }\n            val = val * radix + d;\n        }\n        return val;\n    }).args([\n        [ \"*text\", \"string\" ],\n        [ \"*radix\", [ \"and\", \"integer\", [ \"[between]\", 2, 36 ] ] ]\n    ]);\n\n    /* -----[ String functions ]----- */\n\n    defineFunction(\"char\", function(code){\n        return String.fromCharCode(code);\n    }).args([\n        [ \"*code\", \"integer+\" ]\n    ]);\n\n    // From XRegExp\n    var RX_NON_PRINTABLE = /[\\0-\\x1F\\x7F-\\x9F\\xAD\\u0378\\u0379\\u037F-\\u0383\\u038B\\u038D\\u03A2\\u0528-\\u0530\\u0557\\u0558\\u0560\\u0588\\u058B-\\u058E\\u0590\\u05C8-\\u05CF\\u05EB-\\u05EF\\u05F5-\\u0605\\u061C\\u061D\\u06DD\\u070E\\u070F\\u074B\\u074C\\u07B2-\\u07BF\\u07FB-\\u07FF\\u082E\\u082F\\u083F\\u085C\\u085D\\u085F-\\u089F\\u08A1\\u08AD-\\u08E3\\u08FF\\u0978\\u0980\\u0984\\u098D\\u098E\\u0991\\u0992\\u09A9\\u09B1\\u09B3-\\u09B5\\u09BA\\u09BB\\u09C5\\u09C6\\u09C9\\u09CA\\u09CF-\\u09D6\\u09D8-\\u09DB\\u09DE\\u09E4\\u09E5\\u09FC-\\u0A00\\u0A04\\u0A0B-\\u0A0E\\u0A11\\u0A12\\u0A29\\u0A31\\u0A34\\u0A37\\u0A3A\\u0A3B\\u0A3D\\u0A43-\\u0A46\\u0A49\\u0A4A\\u0A4E-\\u0A50\\u0A52-\\u0A58\\u0A5D\\u0A5F-\\u0A65\\u0A76-\\u0A80\\u0A84\\u0A8E\\u0A92\\u0AA9\\u0AB1\\u0AB4\\u0ABA\\u0ABB\\u0AC6\\u0ACA\\u0ACE\\u0ACF\\u0AD1-\\u0ADF\\u0AE4\\u0AE5\\u0AF2-\\u0B00\\u0B04\\u0B0D\\u0B0E\\u0B11\\u0B12\\u0B29\\u0B31\\u0B34\\u0B3A\\u0B3B\\u0B45\\u0B46\\u0B49\\u0B4A\\u0B4E-\\u0B55\\u0B58-\\u0B5B\\u0B5E\\u0B64\\u0B65\\u0B78-\\u0B81\\u0B84\\u0B8B-\\u0B8D\\u0B91\\u0B96-\\u0B98\\u0B9B\\u0B9D\\u0BA0-\\u0BA2\\u0BA5-\\u0BA7\\u0BAB-\\u0BAD\\u0BBA-\\u0BBD\\u0BC3-\\u0BC5\\u0BC9\\u0BCE\\u0BCF\\u0BD1-\\u0BD6\\u0BD8-\\u0BE5\\u0BFB-\\u0C00\\u0C04\\u0C0D\\u0C11\\u0C29\\u0C34\\u0C3A-\\u0C3C\\u0C45\\u0C49\\u0C4E-\\u0C54\\u0C57\\u0C5A-\\u0C5F\\u0C64\\u0C65\\u0C70-\\u0C77\\u0C80\\u0C81\\u0C84\\u0C8D\\u0C91\\u0CA9\\u0CB4\\u0CBA\\u0CBB\\u0CC5\\u0CC9\\u0CCE-\\u0CD4\\u0CD7-\\u0CDD\\u0CDF\\u0CE4\\u0CE5\\u0CF0\\u0CF3-\\u0D01\\u0D04\\u0D0D\\u0D11\\u0D3B\\u0D3C\\u0D45\\u0D49\\u0D4F-\\u0D56\\u0D58-\\u0D5F\\u0D64\\u0D65\\u0D76-\\u0D78\\u0D80\\u0D81\\u0D84\\u0D97-\\u0D99\\u0DB2\\u0DBC\\u0DBE\\u0DBF\\u0DC7-\\u0DC9\\u0DCB-\\u0DCE\\u0DD5\\u0DD7\\u0DE0-\\u0DF1\\u0DF5-\\u0E00\\u0E3B-\\u0E3E\\u0E5C-\\u0E80\\u0E83\\u0E85\\u0E86\\u0E89\\u0E8B\\u0E8C\\u0E8E-\\u0E93\\u0E98\\u0EA0\\u0EA4\\u0EA6\\u0EA8\\u0EA9\\u0EAC\\u0EBA\\u0EBE\\u0EBF\\u0EC5\\u0EC7\\u0ECE\\u0ECF\\u0EDA\\u0EDB\\u0EE0-\\u0EFF\\u0F48\\u0F6D-\\u0F70\\u0F98\\u0FBD\\u0FCD\\u0FDB-\\u0FFF\\u10C6\\u10C8-\\u10CC\\u10CE\\u10CF\\u1249\\u124E\\u124F\\u1257\\u1259\\u125E\\u125F\\u1289\\u128E\\u128F\\u12B1\\u12B6\\u12B7\\u12BF\\u12C1\\u12C6\\u12C7\\u12D7\\u1311\\u1316\\u1317\\u135B\\u135C\\u137D-\\u137F\\u139A-\\u139F\\u13F5-\\u13FF\\u169D-\\u169F\\u16F1-\\u16FF\\u170D\\u1715-\\u171F\\u1737-\\u173F\\u1754-\\u175F\\u176D\\u1771\\u1774-\\u177F\\u17DE\\u17DF\\u17EA-\\u17EF\\u17FA-\\u17FF\\u180F\\u181A-\\u181F\\u1878-\\u187F\\u18AB-\\u18AF\\u18F6-\\u18FF\\u191D-\\u191F\\u192C-\\u192F\\u193C-\\u193F\\u1941-\\u1943\\u196E\\u196F\\u1975-\\u197F\\u19AC-\\u19AF\\u19CA-\\u19CF\\u19DB-\\u19DD\\u1A1C\\u1A1D\\u1A5F\\u1A7D\\u1A7E\\u1A8A-\\u1A8F\\u1A9A-\\u1A9F\\u1AAE-\\u1AFF\\u1B4C-\\u1B4F\\u1B7D-\\u1B7F\\u1BF4-\\u1BFB\\u1C38-\\u1C3A\\u1C4A-\\u1C4C\\u1C80-\\u1CBF\\u1CC8-\\u1CCF\\u1CF7-\\u1CFF\\u1DE7-\\u1DFB\\u1F16\\u1F17\\u1F1E\\u1F1F\\u1F46\\u1F47\\u1F4E\\u1F4F\\u1F58\\u1F5A\\u1F5C\\u1F5E\\u1F7E\\u1F7F\\u1FB5\\u1FC5\\u1FD4\\u1FD5\\u1FDC\\u1FF0\\u1FF1\\u1FF5\\u1FFF\\u200B-\\u200F\\u202A-\\u202E\\u2060-\\u206F\\u2072\\u2073\\u208F\\u209D-\\u209F\\u20BB-\\u20CF\\u20F1-\\u20FF\\u218A-\\u218F\\u23F4-\\u23FF\\u2427-\\u243F\\u244B-\\u245F\\u2700\\u2B4D-\\u2B4F\\u2B5A-\\u2BFF\\u2C2F\\u2C5F\\u2CF4-\\u2CF8\\u2D26\\u2D28-\\u2D2C\\u2D2E\\u2D2F\\u2D68-\\u2D6E\\u2D71-\\u2D7E\\u2D97-\\u2D9F\\u2DA7\\u2DAF\\u2DB7\\u2DBF\\u2DC7\\u2DCF\\u2DD7\\u2DDF\\u2E3C-\\u2E7F\\u2E9A\\u2EF4-\\u2EFF\\u2FD6-\\u2FEF\\u2FFC-\\u2FFF\\u3040\\u3097\\u3098\\u3100-\\u3104\\u312E-\\u3130\\u318F\\u31BB-\\u31BF\\u31E4-\\u31EF\\u321F\\u32FF\\u4DB6-\\u4DBF\\u9FCD-\\u9FFF\\uA48D-\\uA48F\\uA4C7-\\uA4CF\\uA62C-\\uA63F\\uA698-\\uA69E\\uA6F8-\\uA6FF\\uA78F\\uA794-\\uA79F\\uA7AB-\\uA7F7\\uA82C-\\uA82F\\uA83A-\\uA83F\\uA878-\\uA87F\\uA8C5-\\uA8CD\\uA8DA-\\uA8DF\\uA8FC-\\uA8FF\\uA954-\\uA95E\\uA97D-\\uA97F\\uA9CE\\uA9DA-\\uA9DD\\uA9E0-\\uA9FF\\uAA37-\\uAA3F\\uAA4E\\uAA4F\\uAA5A\\uAA5B\\uAA7C-\\uAA7F\\uAAC3-\\uAADA\\uAAF7-\\uAB00\\uAB07\\uAB08\\uAB0F\\uAB10\\uAB17-\\uAB1F\\uAB27\\uAB2F-\\uABBF\\uABEE\\uABEF\\uABFA-\\uABFF\\uD7A4-\\uD7AF\\uD7C7-\\uD7CA\\uD7FC-\\uF8FF\\uFA6E\\uFA6F\\uFADA-\\uFAFF\\uFB07-\\uFB12\\uFB18-\\uFB1C\\uFB37\\uFB3D\\uFB3F\\uFB42\\uFB45\\uFBC2-\\uFBD2\\uFD40-\\uFD4F\\uFD90\\uFD91\\uFDC8-\\uFDEF\\uFDFE\\uFDFF\\uFE1A-\\uFE1F\\uFE27-\\uFE2F\\uFE53\\uFE67\\uFE6C-\\uFE6F\\uFE75\\uFEFD-\\uFF00\\uFFBF-\\uFFC1\\uFFC8\\uFFC9\\uFFD0\\uFFD1\\uFFD8\\uFFD9\\uFFDD-\\uFFDF\\uFFE7\\uFFEF-\\uFFFB\\uFFFE\\uFFFF]/g;\n\n    defineFunction(\"clean\", function(text){\n        return text.replace(RX_NON_PRINTABLE, \"\");\n    }).args([\n        [ \"*text\", \"string\" ]\n    ]);\n\n    defineFunction(\"code\", function(text){\n        return text.charAt(0);\n    }).args([\n        [ \"*text\", \"string\" ]\n    ]);\n\n    defineAlias(\"unichar\", \"char\");\n    defineAlias(\"unicode\", \"code\");\n\n    defineFunction(\"concatenate\", function(args){\n        var out = \"\";\n        for (var i = 0; i < args.length; ++i) {\n            out += args[i];\n        }\n        return out;\n    }).args([\n        [ \"+\",\n          [ \"*text\", \"string\" ] ]\n    ]);\n\n    defineFunction(\"dollar\", function(number, decimals){\n        var format = \"$#,##0DECIMALS;($#,##0DECIMALS)\";\n        var dec = \"\";\n        var denomitator = 1;\n\n        while (decimals-- > 0) {\n          dec += \"0\";\n        }\n\n        while (++decimals < 0) {\n          denomitator *= 10;\n        }\n\n        if (dec !== \"\") {\n          dec = \".\" + dec;\n        } else if (denomitator !== 1) {\n            number = Math.round(number / denomitator) * denomitator;\n        }\n\n        format = format.replace(/DECIMALS/g, dec);\n\n        return spreadsheet.formatting.text(number, format);\n    }).args([\n        [ \"*number\", \"number\" ],\n        [ \"*decimals\", [ \"or\", \"integer\", [ \"null\", 2 ] ] ]\n    ]);\n\n    defineFunction(\"exact\", function(a, b){\n        return a === b;\n    }).args([\n        [ \"*text1\", \"string\" ],\n        [ \"*text2\", \"string\" ]\n    ]);\n\n    defineFunction(\"find\", function(substring, string, start){\n        var pos = string.indexOf(substring, start - 1);\n        return pos < 0 ? new CalcError(\"VALUE\") : pos + 1;\n    }).args([\n        [ \"*substring\", \"string\" ],\n        [ \"*string\", \"string\" ],\n        [ \"*start\", [ \"or\", \"integer++\", [ \"null\", 1 ] ] ]\n    ]);\n\n    defineFunction(\"fixed\", function(number, decimals, noCommas){\n        var scale = Math.pow(10, decimals);\n        number = Math.round(number * scale) / scale;\n        var format = noCommas ? \"0\" : \"#,##0\";\n        if (decimals > 0) {\n            format += \".\";\n            while (decimals-- > 0) { format += \"0\"; }\n        }\n        return spreadsheet.formatting.text(number, format);\n    }).args([\n        [ \"*number\", \"number\" ],\n        [ \"*decimals\", [ \"or\", \"integer\", [ \"null\", 2 ] ] ],\n        [ \"*noCommas\", [ \"or\", \"boolean\", [ \"null\", false ] ] ]\n    ]);\n\n    defineFunction(\"left\", function(text, length){\n        return text.substr(0, length);\n    }).args([\n        [ \"*text\", \"string\" ],\n        [ \"*length\", [ \"or\", \"integer+\", [ \"null\", 1 ] ] ]\n    ]);\n\n    defineFunction(\"right\", function(text, length){\n        return text.substr(-length);\n    }).args([\n        [ \"*text\", \"string\" ],\n        [ \"*length\", [ \"or\", \"integer+\", [ \"null\", 1 ] ] ]\n    ]);\n\n    defineFunction(\"len\", function(text){\n        return text.length;\n    }).args([\n        [ \"*text\", \"string\" ]\n    ]);\n\n    defineFunction(\"lower\", function(text){\n        return text.toLowerCase();\n    }).args([\n        [ \"*text\", \"string\" ]\n    ]);\n\n    defineFunction(\"upper\", function(text){\n        return text.toUpperCase();\n    }).args([\n        [ \"*text\", \"string\" ]\n    ]);\n\n    defineFunction(\"ltrim\", function(text){\n        return text.replace(/^\\s+/, \"\");\n    }).args([\n        [ \"*text\", \"string\" ]\n    ]);\n\n    defineFunction(\"rtrim\", function(text){\n        return text.replace(/\\s+$/, \"\");\n    }).args([\n        [ \"*text\", \"string\" ]\n    ]);\n\n    defineFunction(\"trim\", function(text){\n        return text.replace(/^\\s+|\\s+$/, \"\");\n    }).args([\n        [ \"*text\", \"string\" ]\n    ]);\n\n    defineFunction(\"mid\", function(text, start, length){\n        return text.substr(start - 1, length);\n    }).args([\n        [ \"*text\", \"string\" ],\n        [ \"*start\", \"integer++\" ],\n        [ \"*length\", \"integer+\" ]\n    ]);\n\n    defineFunction(\"proper\", function(text){\n        return text.toLowerCase().replace(/\\b./g, function(s){\n            return s.toUpperCase();\n        });\n    }).args([\n        [ \"*text\", \"string\" ]\n    ]);\n\n    defineFunction(\"replace\", function(text, start, length, newText){\n        return text.substr(0, --start) + newText + text.substr(start + length);\n    }).args([\n        [ \"*text\", \"string\" ],\n        [ \"*start\", \"integer++\" ],\n        [ \"*length\", \"integer+\" ],\n        [ \"*newText\", \"string\" ]\n    ]);\n\n    defineFunction(\"rept\", function(text, number){\n        var out = \"\";\n        while (number-- > 0) { out += text; }\n        return out;\n    }).args([\n        [ \"*text\", \"string\" ],\n        [ \"*number\", \"integer+\" ]\n    ]);\n\n    defineFunction(\"search\", function(substring, string, start){\n        var pos = string.toLowerCase().indexOf(substring.toLowerCase(), start - 1);\n        return pos < 0 ? new CalcError(\"VALUE\") : pos + 1;\n    }).args([\n        [ \"*substring\", \"string\" ],\n        [ \"*string\", \"string\" ],\n        [ \"*start\", [ \"or\", \"integer++\", [ \"null\", 1 ] ] ]\n    ]);\n\n    defineFunction(\"substitute\", function(text, oldText, newText, nth){\n        if (oldText === newText) {\n            return text;\n        }\n        var a = text.split(oldText);\n        if (nth == null) {\n            return a.join(newText);\n        }\n        text = \"\";\n        nth--;\n        for (var i = 0; i < a.length; ++i) {\n            text += a[i];\n            if (i < a.length - 1) {\n                if (i === nth) {\n                    text += newText;\n                } else {\n                    text += oldText;\n                }\n            }\n        }\n        return text;\n    }).args([\n        [ \"*text\", \"string\" ],\n        [ \"*oldText\", \"string\" ],\n        [ \"*newText\", \"string\" ],\n        [ \"*nth\", [ \"or\", \"integer++\", \"null\" ] ]\n    ]);\n\n    defineFunction(\"t\", function(value){\n        return typeof value == \"string\" ? value : \"\";\n    }).args([\n        [ \"*value\", \"anyvalue\" ]\n    ]);\n\n    defineFunction(\"text\", function(value, format){\n        return spreadsheet.formatting.text(value, format);\n    }).args([\n        [ \"*value\", \"anyvalue\" ],\n        [ \"*format\", \"string\" ]\n    ]);\n\n    defineFunction(\"value\", function(value){\n        if (typeof value == \"number\") {\n            return value;\n        }\n        if (typeof value == \"boolean\") {\n            return +value;\n        }\n        // XXX: this is dirty.  we need it so we can parse i.e. \"$12,345.50\"\n        value = (value+\"\").replace(/[$,]/g, \"\");\n        value = parseFloat(value);\n        return isNaN(value) ? new CalcError(\"VALUE\") : value;\n    }).args([\n        [ \"*value\", \"anyvalue\" ]\n    ]);\n\n    function Hyperlink(link, text) {\n        this.link = link;\n        this.text = text;\n    }\n    Hyperlink.prototype.toString = function() {\n        return this.text;\n    };\n\n    defineFunction(\"hyperlink\", function(link, text){\n        return new Hyperlink(link, text);\n    }).args([\n        [ \"*link\", \"string\" ],\n        [ \"*text\", [ \"or\", \"string\", [ \"null\", \"$link\" ] ] ]\n    ]);\n\n    //// other misc functions\n\n    defineFunction(\"iferror\", function(value, valueIfError){\n        return value instanceof CalcError ? valueIfError : value;\n    }).args([\n        [ \"*value\", \"forced!\" ],\n        [ \"*value_if_error\", \"anyvalue!\" ]\n    ]);\n\n    //// utils\n\n    var parseCriteria = (function(){\n        var RXCACHE = Object.create(null);\n\n        function makeComparator(cmp, x) {\n            if (typeof x == \"string\") {\n                var num = parseFloat(x);\n                if (!isNaN(num) && num == x) {\n                    x = num;\n                }\n            }\n            return function(a) {\n                var b = x;\n                if (typeof a == \"string\" && typeof b == \"string\") {\n                    a = a.toLowerCase();\n                    b = b.toLowerCase();\n                }\n                return cmp(a, b);\n            };\n        }\n\n        function lc(a) {\n            var num, str;\n            if (typeof a == \"string\") {\n                a = a.toLowerCase();\n            }\n            if (/^[0-9.]+%$/.test(a)) {\n                str = a.substr(0, a.length - 1);\n                num = parseFloat(str);\n                if (!isNaN(num) && num == str) {\n                    a = num / 100;\n                }\n            } else if (/^[0-9.]+$/.test(a)) {\n                num = parseFloat(a);\n                if (!isNaN(num) && num == a) {\n                    a = num;\n                }\n            }\n            return a;\n        }\n\n        function compLT(a, b) { return lc(a) < lc(b); }\n        function compLTE(a, b) { return lc(a) <= lc(b); }\n        function compGT(a, b) { return lc(a) > lc(b); }\n        function compGTE(a, b) { return lc(a) >= lc(b); }\n        function compNE(a, b) { return !compEQ(a, b); }\n        function compEQ(a, b) {\n            if (b instanceof RegExp) {\n                return b.test(a);\n            }\n            if (typeof a == \"string\" || typeof b == \"string\") {\n                // if either one is string, make sure both are strings\n                a = String(a);\n                b = String(b);\n            }\n            return lc(a) == lc(b);\n        }\n\n        return function(cmp) {\n            if (typeof cmp == \"function\") {\n                return cmp;\n            }\n            var m;\n            if ((m = /^=(.*)$/.exec(cmp))) {\n                return makeComparator(compEQ, m[1]);\n            }\n            if ((m = /^<>(.*)$/.exec(cmp))) {\n                return makeComparator(compNE, m[1]);\n            }\n            if ((m = /^<=(.*)$/.exec(cmp))) {\n                return makeComparator(compLTE, m[1]);\n            }\n            if ((m = /^<(.*)$/.exec(cmp))) {\n                return makeComparator(compLT, m[1]);\n            }\n            if ((m = /^>=(.*)$/.exec(cmp))) {\n                return makeComparator(compGTE, m[1]);\n            }\n            if ((m = /^>(.*)$/.exec(cmp))) {\n                return makeComparator(compGT, m[1]);\n            }\n            if (/[?*]/.exec(cmp)) {\n                // has wildchars\n                var rx = RXCACHE[cmp];\n                if (!rx) {\n                    rx = cmp.replace(/(~\\?|~\\*|[\\]({\\+\\.\\|\\^\\$\\\\})\\[]|[?*])/g, function(s){\n                        switch (s) {\n                          case \"~?\" : return \"\\\\?\";\n                          case \"~*\" : return \"\\\\*\";\n                          case \"?\"  : return \".\";\n                          case \"*\"  : return \".*\";\n                          default   : return \"\\\\\" + s;\n                        }\n                    });\n                    rx = RXCACHE[cmp] = new RegExp(\"^\" + rx + \"$\", \"i\");\n                }\n                return makeComparator(compEQ, rx);\n            }\n            return makeComparator(compEQ, cmp);\n        };\n    })();\n\n    function numericPredicate(val) {\n        return typeof val == \"number\"\n            || typeof val == \"boolean\"\n            || val == null\n            || val === \"\";\n    }\n\n    function ascending(a, b) {\n        return a === b ? 0 : a < b ? -1 : 1;\n    }\n\n    function descending(a, b) {\n        return a === b ? 0 : a < b ? 1 : -1;\n    }\n\n    // var m = new Matrix();\n    // m.data = [[1, 2, 3], [4, 1, 6], [7, 8, 9]];\n    // //m.data = [[0, 2, 1], [2, 6, 1], [1, 1, 4]];\n    // //m.data = [[1,4,1,1], [1,4,0,1], [2,3,1,2], [3,2,6,4]];\n    // m.width = m.height = 3;\n    // var x = m.inverse();\n    // x.dump();\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n// -*- fill-column: 100 -*-\n\n(function(f, define){\n    define('spreadsheet/runtime.functions.2',[ \"./runtime\" ], f);\n})(function(){\n    \"use strict\";\n\n    // WARNING: removing the following jshint declaration and turning\n    // == into === to make JSHint happy will break functionality.\n\n\n\n    var spreadsheet = kendo.spreadsheet;\n    var calc = spreadsheet.calc;\n    var runtime = calc.runtime;\n    var defineFunction = runtime.defineFunction;\n    var CalcError = runtime.CalcError;\n    var packDate = runtime.packDate;\n    var unpackDate = runtime.unpackDate;\n    var isLeapYear = runtime.isLeapYear;\n    var daysInMonth = runtime.daysInMonth;\n    var _days_360 = runtime._days_360;\n\n    /* -----[ Spreadsheet API ]----- */\n\n    defineFunction(\"ERF\", function(ll, ul) {\n        if (ul == null) {\n            return ERF(ll);\n        }\n        return ERF(ul) - ERF(ll);\n    }).args([\n        [ \"lower_limit\", \"number\" ],\n        [ \"upper_limit\", [ \"or\", \"number\", \"null\" ] ]\n    ]);\n\n    defineFunction(\"ERFC\", ERFC).args([\n        [ \"x\", \"number\" ]\n    ]);\n\n    defineFunction(\"GAMMALN\", GAMMALN).args([\n        [ \"x\", \"number++\" ]\n    ]);\n\n    defineFunction(\"GAMMA\", GAMMA).args([\n        [ \"x\", \"number\" ]\n    ]);\n\n    defineFunction(\"GAMMA.DIST\", GAMMA_DIST).args([\n        [ \"x\", \"number+\" ],\n        [ \"alpha\", \"number++\" ],\n        [ \"beta\", \"number++\" ],\n        [ \"cumulative\", \"logical\" ]\n    ]);\n\n    defineFunction(\"GAMMA.INV\", GAMMA_INV).args([\n        [ \"p\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ],\n        [ \"alpha\", \"number++\" ],\n        [ \"beta\", \"number++\" ]\n    ]);\n\n    defineFunction(\"NORM.S.DIST\", NORM_S_DIST).args([\n        [ \"z\", \"number\" ],\n        [ \"cumulative\", \"logical\" ]\n    ]);\n\n    defineFunction(\"NORM.S.INV\", NORM_S_INV).args([\n        [ \"p\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ]\n    ]);\n\n    defineFunction(\"NORM.DIST\", NORM_DIST).args([\n        [ \"x\", \"number\" ],\n        [ \"mean\", \"number\" ],\n        [ \"stddev\", \"number++\" ],\n        [ \"cumulative\", \"logical\" ]\n    ]);\n\n    defineFunction(\"NORM.INV\", NORM_INV).args([\n        [ \"p\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ],\n        [ \"mean\", \"number\" ],\n        [ \"stddev\", \"number++\" ]\n    ]);\n\n    defineFunction(\"BETADIST\", BETADIST).args([\n        [ \"x\", \"number\" ],\n        [ \"alpha\", \"number++\" ],\n        [ \"beta\", \"number++\" ],\n        [ \"A\", [ \"or\", \"number\", [ \"null\", 0 ] ] ],\n        [ \"B\", [ \"or\", \"number\", [ \"null\", 1 ] ] ],\n        [ \"?\", [ \"assert\", \"$x >= $A\", \"NUM\" ] ],\n        [ \"?\", [ \"assert\", \"$x <= $B\", \"NUM\" ] ],\n        [ \"?\", [ \"assert\", \"$A < $B\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"BETA.DIST\", BETA_DIST).args([\n        [ \"x\", \"number\" ],\n        [ \"alpha\", \"number++\" ],\n        [ \"beta\", \"number++\" ],\n        [ \"cumulative\", \"logical\" ],\n        [ \"A\", [ \"or\", \"number\", [ \"null\", 0 ] ] ],\n        [ \"B\", [ \"or\", \"number\", [ \"null\", 1 ] ] ],\n        [ \"?\", [ \"assert\", \"$x >= $A\", \"NUM\" ] ],\n        [ \"?\", [ \"assert\", \"$x <= $B\", \"NUM\" ] ],\n        [ \"?\", [ \"assert\", \"$A < $B\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"BETA.INV\", BETA_INV).args([\n        [ \"p\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ],\n        [ \"alpha\", \"number++\" ],\n        [ \"beta\", \"number++\" ],\n        [ \"A\", [ \"or\", \"number\", [ \"null\", 0 ] ] ],\n        [ \"B\", [ \"or\", \"number\", [ \"null\", 1 ] ] ]\n    ]);\n\n    defineFunction(\"CHISQ.DIST\", chisq_left).args([\n        [ \"x\", \"number+\" ],\n        [ \"deg_freedom\", \"integer++\" ],\n        [ \"cumulative\", \"logical\" ]\n    ]);\n\n    defineFunction(\"CHISQ.DIST.RT\", chisq_right).args([\n        [ \"x\", \"number+\" ],\n        [ \"deg_freedom\", \"integer++\" ]\n    ]);\n\n    defineFunction(\"CHISQ.INV\", chisq_left_inv).args([\n        [ \"p\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ],\n        [ \"deg_freedom\", \"integer++\" ]\n    ]);\n\n    defineFunction(\"CHISQ.INV.RT\", chisq_right_inv).args([\n        [ \"p\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ],\n        [ \"deg_freedom\", \"integer++\" ]\n    ]);\n\n    defineFunction(\"CHISQ.TEST\", function(ac, ex){\n        return chisq_test(ac.data, ex.data);\n    }).args([\n        [ \"actual_range\", \"matrix\" ],\n        [ \"expected_range\", \"matrix\" ],\n        [ \"?\", [ \"assert\", \"$actual_range.width == $expected_range.width\" ] ],\n        [ \"?\", [ \"assert\", \"$actual_range.height == $expected_range.height\" ] ]\n    ]);\n\n    defineFunction(\"EXPON.DIST\", expon).args([\n        [ \"x\", \"number+\" ],\n        [ \"lambda\", \"number++\" ],\n        [ \"cumulative\", \"logical\" ]\n    ]);\n\n    defineFunction(\"POISSON.DIST\", poisson).args([\n        [ \"x\", \"integer+\" ],\n        [ \"mean\", \"number+\" ],\n        [ \"cumulative\", \"logical\" ]\n    ]);\n\n    defineFunction(\"F.DIST\", Fdist).args([\n        [ \"x\", \"number+\" ],\n        [ \"deg_freedom1\", \"integer++\" ],\n        [ \"deg_freedom2\", \"integer++\" ],\n        [ \"cumulative\", \"logical\" ]\n    ]);\n\n    defineFunction(\"F.DIST.RT\", Fdist_right).args([\n        [ \"x\", \"number+\" ],\n        [ \"deg_freedom1\", \"integer++\" ],\n        [ \"deg_freedom2\", \"integer++\" ]\n    ]);\n\n    defineFunction(\"F.INV\", Finv).args([\n        [ \"p\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ],\n        [ \"deg_freedom1\", \"integer++\" ],\n        [ \"deg_freedom2\", \"integer++\" ]\n    ]);\n\n    defineFunction(\"F.INV.RT\", Finv_right).args([\n        [ \"p\", [ \"and\", \"number\", [ \"[between]\", 0, 1 ] ] ],\n        [ \"deg_freedom1\", \"integer++\" ],\n        [ \"deg_freedom2\", \"integer++\" ]\n    ]);\n\n    defineFunction(\"F.TEST\", Ftest).args([\n        [ \"array1\", [ \"collect\", \"number\", 1 ] ],\n        [ \"array2\", [ \"collect\", \"number\", 1 ] ],\n        [ \"?\", [ \"assert\", \"$array1.length >= 2\", \"DIV/0\" ] ],\n        [ \"?\", [ \"assert\", \"$array2.length >= 2\", \"DIV/0\" ] ]\n    ]);\n\n    defineFunction(\"FISHER\", fisher).args([\n        [ \"x\", [ \"and\", \"number\", [ \"(between)\", -1, 1 ] ] ]\n    ]);\n\n    defineFunction(\"FISHERINV\", fisherinv).args([\n        [ \"y\", \"number\" ]\n    ]);\n\n    defineFunction(\"T.DIST\", Tdist).args([\n        [ \"x\", \"number\" ],\n        [ \"deg_freedom\", \"integer++\" ],\n        [ \"cumulative\", \"logical\" ]\n    ]);\n\n    defineFunction(\"T.DIST.RT\", Tdist_right).args([\n        [ \"x\", \"number\" ],\n        [ \"deg_freedom\", \"integer++\" ]\n    ]);\n\n    defineFunction(\"T.DIST.2T\", Tdist_2tail).args([\n        [ \"x\", \"number+\" ],\n        [ \"deg_freedom\", \"integer++\" ]\n    ]);\n\n    defineFunction(\"T.INV\", Tdist_inv).args([\n        [ \"p\", [ \"and\", \"number\", [ \"(between]\", 0, 1 ] ] ],\n        [ \"deg_freedom\", \"integer++\" ]\n    ]);\n\n    defineFunction(\"T.INV.2T\", Tdist_2tail_inv).args([\n        [ \"p\", [ \"and\", \"number\", [ \"(between]\", 0, 1 ] ] ],\n        [ \"deg_freedom\", \"integer++\" ]\n    ]);\n\n    defineFunction(\"T.TEST\", Tdist_test).args([\n        [ \"array1\", [ \"collect\", \"number\", 1 ] ],\n        [ \"array2\", [ \"collect\", \"number\", 1 ] ],\n        [ \"tails\", [ \"and\", \"integer\", [ \"values\", 1, 2 ] ] ],\n        [ \"type\", [ \"and\", \"integer\", [ \"values\", 1, 2, 3 ] ] ],\n        [ \"?\", [ \"assert\", \"$type != 1 || $array1.length == $array2.length\", \"N/A\" ] ],\n        [ \"?\", [ \"assert\", \"$array1.length >= 2\", \"DIV/0\" ] ],\n        [ \"?\", [ \"assert\", \"$array2.length >= 2\", \"DIV/0\" ] ]\n    ]);\n\n    defineFunction(\"CONFIDENCE.T\", confidence_t).args([\n        [ \"alpha\", [ \"and\", \"number\", [ \"(between)\", 0, 1 ] ] ],\n        [ \"standard_dev\", \"number++\" ],\n        [ \"size\", [ \"and\", \"integer++\",\n                    [ \"assert\", \"$size != 1\", \"DIV/0\" ] ] ]\n    ]);\n\n    defineFunction(\"CONFIDENCE.NORM\", confidence_norm).args([\n        [ \"alpha\", [ \"and\", \"number\", [ \"(between)\", 0, 1 ] ] ],\n        [ \"standard_dev\", \"number++\" ],\n        [ \"size\", [ \"and\", \"integer++\" ] ]\n    ]);\n\n    defineFunction(\"GAUSS\", gauss).args([\n        [ \"z\", \"number\" ]\n    ]);\n\n    defineFunction(\"PHI\", phi).args([\n        [ \"x\", \"number\" ]\n    ]);\n\n    defineFunction(\"LOGNORM.DIST\", lognorm_dist).args([\n        [ \"x\", \"number++\" ],\n        [ \"mean\", \"number\" ],\n        [ \"standard_dev\", \"number++\" ],\n        [ \"cumulative\", \"logical\" ]\n    ]);\n\n    defineFunction(\"LOGNORM.INV\", lognorm_inv).args([\n        [ \"probability\", [ \"and\", \"number\", [ \"(between)\", 0, 1 ] ] ],\n        [ \"mean\", \"number\" ],\n        [ \"standard_dev\", \"number++\" ]\n    ]);\n\n    defineFunction(\"PROB\", prob).args([\n        [ \"x_range\", [ \"collect\", \"number\", 1 ] ],\n        [ \"prob_range\", [ \"collect\", \"number\", 1 ] ],\n        [ \"lower_limit\", \"number\" ],\n        [ \"upper_limit\", [ \"or\", \"number\", [ \"null\", \"$lower_limit\" ] ] ],\n        [ \"?\", [ \"assert\", \"$prob_range.length == $x_range.length\", \"N/A\" ] ]\n    ]);\n\n    defineFunction(\"SLOPE\", slope).args([\n        [ \"known_y\", [ \"collect\", \"number\", 1 ] ],\n        [ \"known_x\", [ \"collect\", \"number\", 1 ] ],\n        [ \"?\", [ \"assert\", \"$known_x.length == $known_y.length\", \"N/A\" ] ],\n        [ \"?\", [ \"assert\", \"$known_x.length > 0 && $known_y.length > 0\", \"N/A\" ] ]\n    ]);\n\n    defineFunction(\"INTERCEPT\", intercept).args([\n        [ \"known_y\", [ \"collect\", \"number\", 1 ] ],\n        [ \"known_x\", [ \"collect\", \"number\", 1 ] ],\n        [ \"?\", [ \"assert\", \"$known_x.length == $known_y.length\", \"N/A\" ] ],\n        [ \"?\", [ \"assert\", \"$known_x.length > 0 && $known_y.length > 0\", \"N/A\" ] ]\n    ]);\n\n    defineFunction(\"PEARSON\", pearson).args([\n        [ \"array1\", [ \"collect!\", \"anything\", 1 ] ],\n        [ \"array2\", [ \"collect!\", \"anything\", 1 ] ],\n        [ \"?\", [ \"assert\", \"$array2.length == $array1.length\", \"N/A\" ] ],\n        [ \"?\", [ \"assert\", \"$array2.length > 0 && $array1.length > 0\", \"N/A\" ] ]\n    ]);\n\n    defineFunction(\"RSQ\", rsq).args([\n        [ \"known_y\", [ \"collect\", \"number\", 1 ] ],\n        [ \"known_x\", [ \"collect\", \"number\", 1 ] ],\n        [ \"?\", [ \"assert\", \"$known_x.length == $known_y.length\", \"N/A\" ] ],\n        [ \"?\", [ \"assert\", \"$known_x.length > 0 && $known_y.length > 0\", \"N/A\" ] ],\n        [ \"?\", [ \"assert\", \"$known_x.length != 1 && $known_y.length != 1\", \"N/A\" ] ]\n    ]);\n\n    defineFunction(\"STEYX\", steyx).args([\n        [ \"known_y\", [ \"collect\", \"number\", 1 ] ],\n        [ \"known_x\", [ \"collect\", \"number\", 1 ] ],\n        [ \"?\", [ \"assert\", \"$known_x.length == $known_y.length\", \"N/A\" ] ],\n        [ \"?\", [ \"assert\", \"$known_x.length >= 3 && $known_y.length >= 3\", \"DIV/0\" ] ]\n    ]);\n\n    defineFunction(\"FORECAST\", forecast).args([\n        [ \"x\", \"number\" ],\n        [ \"known_y\", [ \"collect\", \"number\", 1 ] ],\n        [ \"known_x\", [ \"collect\", \"number\", 1 ] ],\n        [ \"?\", [ \"assert\", \"$known_x.length == $known_y.length\", \"N/A\" ] ],\n        [ \"?\", [ \"assert\", \"$known_x.length > 0 && $known_y.length > 0\", \"N/A\" ] ]\n    ]);\n\n    defineFunction(\"LINEST\", linest).args([\n        [ \"known_y\", \"matrix\" ],\n        [ \"known_x\", [ \"or\", \"matrix\", \"null\" ] ],\n        [ \"const\", [ \"or\", \"logical\", [ \"null\", true ] ] ],\n        [ \"stats\", [ \"or\", \"logical\", [ \"null\", false ] ] ]\n    ]);\n\n    defineFunction(\"LOGEST\", logest).args([\n        [ \"known_y\", \"matrix\" ],\n        [ \"known_x\", [ \"or\", \"matrix\", \"null\" ] ],\n        [ \"const\", [ \"or\", \"logical\", [ \"null\", true ] ] ],\n        [ \"stats\", [ \"or\", \"logical\", [ \"null\", false ] ] ]\n    ]);\n\n    defineFunction(\"TREND\", trend).args([\n        [ \"known_y\", \"matrix\" ],\n        [ \"known_x\", [ \"or\", \"matrix\", \"null\" ] ],\n        [ \"new_x\", [ \"or\", \"matrix\", \"null\" ] ],\n        [ \"const\", [ \"or\", \"logical\", [ \"null\", true ] ] ]\n    ]);\n\n    defineFunction(\"GROWTH\", growth).args([\n        [ \"known_y\", \"matrix\" ],\n        [ \"known_x\", [ \"or\", \"matrix\", \"null\" ] ],\n        [ \"new_x\", [ \"or\", \"matrix\", \"null\" ] ],\n        [ \"const\", [ \"or\", \"logical\", [ \"null\", true ] ] ]\n    ]);\n\n    defineFunction(\"FV\", FV).args([\n        [ \"rate\", \"number\" ],\n        [ \"nper\", \"number\" ],\n        [ \"pmt\", [ \"or\", \"number\", [ \"null\", 0 ] ] ],\n        [ \"pv\", [ \"or\", \"number\", [ \"null\", 0 ] ] ],\n        [ \"type\", [ \"or\", [ \"values\", 0, 1 ], [ \"null\", 0 ] ] ],\n        [ \"?\", [ \"assert\", \"$pmt || $pv\" ] ]\n    ]);\n\n    defineFunction(\"PV\", PV).args([\n        [ \"rate\", \"number\" ],\n        [ \"nper\", \"number\" ],\n        [ \"pmt\", [ \"or\", \"number\", [ \"null\", 0 ] ] ],\n        [ \"fv\", [ \"or\", \"number\", [ \"null\", 0 ] ] ],\n        [ \"type\", [ \"or\", [ \"values\", 0, 1 ], [ \"null\", 0 ] ] ]\n    ]);\n\n    defineFunction(\"PMT\", PMT).args([\n        [ \"rate\", \"number\" ],\n        [ \"nper\", \"number\" ],\n        [ \"pmt\", \"number\" ],\n        [ \"fv\", [ \"or\", \"number\", [ \"null\", 0 ] ] ],\n        [ \"type\", [ \"or\", [ \"values\", 0, 1 ], [ \"null\", 0 ] ] ]\n    ]);\n\n    defineFunction(\"NPER\", NPER).args([\n        [ \"rate\", \"number\" ],\n        [ \"pmt\", \"number\" ],\n        [ \"pv\", \"number\" ],\n        [ \"fv\", [ \"or\", \"number\", [ \"null\", 0 ] ] ],\n        [ \"type\", [ \"or\", [ \"values\", 0, 1 ], [ \"null\", 0 ] ] ]\n    ]);\n\n    defineFunction(\"RATE\", RATE).args([\n        [ \"nper\", \"number\" ],\n        [ \"pmt\", [ \"or\", \"number\", [ \"null\", 0 ] ] ],\n        [ \"pv\", \"number\" ],\n        [ \"fv\", [ \"or\", \"number\", [ \"null\", 0 ] ] ],\n        [ \"type\", [ \"or\", [ \"values\", 0, 1 ], [ \"null\", 0 ] ] ],\n        [ \"guess\", [ \"or\", \"number++\", [ \"null\", 0.01 ] ] ],\n        [ \"?\", [ \"assert\", \"$pmt || $fv\" ] ]\n    ]);\n\n    defineFunction(\"IPMT\", IPMT).args([\n        [ \"rate\", \"number\" ],\n        [ \"per\", \"number++\" ],\n        [ \"nper\", \"number++\" ],\n        [ \"pv\", \"number\" ],\n        [ \"fv\", [ \"or\", \"number\", [ \"null\", 0 ] ] ],\n        [ \"type\", [ \"or\", [ \"values\", 0, 1 ], [ \"null\", 0 ] ] ],\n        [ \"?\", [ \"assert\", \"$per >= 1 && $per <= $nper\" ] ]\n    ]);\n\n    defineFunction(\"PPMT\", PPMT).args([\n        [ \"rate\", \"number\" ],\n        [ \"per\", \"number++\" ],\n        [ \"nper\", \"number++\" ],\n        [ \"pv\", \"number\" ],\n        [ \"fv\", [ \"or\", \"number\", [ \"null\", 0 ] ] ],\n        [ \"type\", [ \"or\", [ \"values\", 0, 1 ], [ \"null\", 0 ] ] ],\n        [ \"?\", [ \"assert\", \"$per >= 1 && $per <= $nper\" ] ]\n    ]);\n\n    defineFunction(\"CUMPRINC\", CUMPRINC).args([\n        [ \"rate\", \"number++\" ],\n        [ \"nper\", \"number++\" ],\n        [ \"pv\", \"number++\" ],\n        [ \"start_period\", \"number++\" ],\n        [ \"end_period\", \"number++\" ],\n        [ \"type\", [ \"or\", [ \"values\", 0, 1 ], [ \"null\", 0 ] ] ],\n        [ \"?\", [ \"assert\", \"$end_period >= $start_period\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"CUMIPMT\", CUMIPMT).args([\n        [ \"rate\", \"number++\" ],\n        [ \"nper\", \"number++\" ],\n        [ \"pv\", \"number++\" ],\n        [ \"start_period\", \"number++\" ],\n        [ \"end_period\", \"number++\" ],\n        [ \"type\", [ \"or\", [ \"values\", 0, 1 ], [ \"null\", 0 ] ] ],\n        [ \"?\", [ \"assert\", \"$end_period >= $start_period\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"NPV\", NPV).args([\n        [ \"rate\", \"number\" ],\n        [ \"values\", [ \"collect\", \"number\" ] ],\n        [ \"?\", [ \"assert\", \"$values.length > 0\", \"N/A\" ] ]\n    ]);\n\n    defineFunction(\"IRR\", IRR).args([\n        [ \"values\", [ \"collect\", \"number\", 1 ] ],\n        [ \"guess\", [ \"or\", \"number\", [ \"null\", 0.1 ] ] ]\n    ]);\n\n    defineFunction(\"EFFECT\", EFFECT).args([\n        [ \"nominal_rate\", \"number++\" ],\n        [ \"npery\", \"integer++\" ]\n    ]);\n\n    defineFunction(\"NOMINAL\", NOMINAL).args([\n        [ \"effect_rate\", \"number++\" ],\n        [ \"npery\", \"integer++\" ]\n    ]);\n\n    defineFunction(\"XNPV\", XNPV).args([\n        [ \"rate\", \"number\" ],\n        [ \"values\", [ \"collect\", \"number\", 1 ] ],\n        [ \"dates\", [ \"collect\", \"date\", 1 ] ],\n        [ \"?\", [ \"assert\", \"$values.length == $dates.length\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"XIRR\", XIRR).args([\n        [ \"values\", [ \"collect\", \"number\", 1 ] ],\n        [ \"dates\", [ \"collect\", \"date\", 1 ] ],\n        [ \"guess\", [ \"or\", \"number\", [ \"null\", 0.1 ] ] ],\n        [ \"?\", [ \"assert\", \"$values.length == $dates.length\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"ISPMT\", ISPMT).args([\n        [ \"rate\", \"number\" ],\n        [ \"per\", \"number++\" ],\n        [ \"nper\", \"number++\" ],\n        [ \"pv\", \"number\" ],\n        [ \"?\", [ \"assert\", \"$per >= 1 && $per <= $nper\" ] ]\n    ]);\n\n    defineFunction(\"DB\", DB).args([\n        [ \"cost\", \"number\" ],\n        [ \"salvage\", \"number\" ],\n        [ \"life\", \"number++\" ],\n        [ \"period\", \"number++\" ],\n        [ \"month\", [ \"or\", \"number\", [ \"null\", 12 ] ] ]\n    ]);\n\n    defineFunction(\"DDB\", DDB).args([\n        [ \"cost\", \"number\" ],\n        [ \"salvage\", \"number\" ],\n        [ \"life\", \"number++\" ],\n        [ \"period\", \"number++\" ],\n        [ \"factor\", [ \"or\", \"number\", [ \"null\", 2 ] ] ]\n    ]);\n\n    defineFunction(\"SLN\", SLN).args([\n        [ \"cost\", \"number\" ],\n        [ \"salvage\", \"number\" ],\n        [ \"life\", \"number++\" ]\n    ]);\n\n    defineFunction(\"SYD\", SYD).args([\n        [ \"cost\", \"number\" ],\n        [ \"salvage\", \"number\" ],\n        [ \"life\", \"number++\" ],\n        [ \"per\", \"number++\" ]\n    ]);\n\n    defineFunction(\"VDB\", VDB).args([\n        [ \"cost\", \"number+\" ],\n        [ \"salvage\", \"number+\" ],\n        [ \"life\", \"number++\" ],\n        [ \"start_period\", \"number+\" ],\n        [ \"end_period\", \"number+\" ],\n        [ \"factor\", [ \"or\", \"number+\", [ \"null\", 2 ] ] ],\n        [ \"no_switch\", [ \"or\", \"logical\", [ \"null\", false ] ] ],\n        [ \"?\", [ \"assert\", \"$end_period >= $start_period\", \"NUM\" ] ]\n    ]);\n\n    var COUPS_ARGS = [\n        [ \"settlement\", \"date\" ],\n        [ \"maturity\", \"date\" ],\n        [ \"frequency\", [ \"and\", \"integer\", [ \"values\", 1, 2, 4 ] ] ],\n        [ \"basis\", [ \"or\", [ \"null\", 0 ],\n                     [ \"and\", \"integer\", [ \"values\", 0, 1, 2, 3, 4 ] ] ] ],\n        [ \"?\", [ \"assert\", \"$settlement < $maturity\", \"NUM\" ] ]\n    ];\n\n    defineFunction(\"COUPDAYBS\", COUPDAYBS).args(COUPS_ARGS);\n\n    defineFunction(\"COUPDAYS\", COUPDAYS).args(COUPS_ARGS);\n\n    defineFunction(\"COUPDAYSNC\", COUPDAYSNC).args(COUPS_ARGS);\n\n    defineFunction(\"COUPPCD\", COUPPCD).args(COUPS_ARGS);\n\n    defineFunction(\"COUPNCD\", COUPNCD).args(COUPS_ARGS);\n\n    defineFunction(\"COUPNUM\", COUPNUM).args(COUPS_ARGS);\n\n    defineFunction(\"ACCRINTM\", ACCRINTM).args([\n        [ \"issue\", \"date\" ],\n        [ \"settlement\", \"date\" ],\n        [ \"rate\", \"number++\" ],\n        [ \"par\", [ \"or\", [ \"null\", 1000 ], \"number++\" ] ],\n        [ \"basis\", [ \"or\", [ \"null\", 0 ],\n                     [ \"and\", \"integer\", [ \"values\", 0, 1, 2, 3, 4 ] ] ] ],\n        [ \"?\", [ \"assert\", \"$issue < $settlement\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"ACCRINT\", ACCRINT).args([\n        [ \"issue\", \"date\" ],\n        [ \"first_interest\", \"date\" ],\n        [ \"settlement\", \"date\" ],\n        [ \"rate\", \"number++\" ],\n        [ \"par\", [ \"or\", [ \"null\", 1000 ], \"number++\" ] ],\n        [ \"frequency\", [ \"and\", \"integer\", [ \"values\", 1, 2, 4 ] ] ],\n        [ \"basis\", [ \"or\", [ \"null\", 0 ],\n                     [ \"and\", \"integer\", [ \"values\", 0, 1, 2, 3, 4 ] ] ] ],\n        [ \"calc_method\", [ \"or\", \"logical\", [ \"null\", true ] ] ],\n        [ \"?\", [ \"assert\", \"$issue < $settlement\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"DISC\", DISC).args([\n        [ \"settlement\", \"date\" ],\n        [ \"maturity\", \"date\" ],\n        [ \"pr\", \"number++\" ],\n        [ \"redemption\", \"number++\" ],\n        [ \"basis\", [ \"or\", [ \"null\", 0 ],\n                     [ \"and\", \"integer\", [ \"values\", 0, 1, 2, 3, 4 ] ] ] ],\n        [ \"?\", [ \"assert\", \"$settlement < $maturity\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"INTRATE\", INTRATE).args([\n        [ \"settlement\", \"date\" ],\n        [ \"maturity\", \"date\" ],\n        [ \"investment\", \"number++\" ],\n        [ \"redemption\", \"number++\" ],\n        [ \"basis\", [ \"or\", [ \"null\", 0 ],\n                     [ \"and\", \"integer\", [ \"values\", 0, 1, 2, 3, 4 ] ] ] ],\n        [ \"?\", [ \"assert\", \"$settlement < $maturity\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"RECEIVED\", RECEIVED).args([\n        [ \"settlement\", \"date\" ],\n        [ \"maturity\", \"date\" ],\n        [ \"investment\", \"number++\" ],\n        [ \"discount\", \"number++\" ],\n        [ \"basis\", [ \"or\", [ \"null\", 0 ],\n                     [ \"and\", \"integer\", [ \"values\", 0, 1, 2, 3, 4 ] ] ] ],\n        [ \"?\", [ \"assert\", \"$settlement < $maturity\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"PRICE\", PRICE).args([\n        [ \"settlement\", \"date\" ],\n        [ \"maturity\", \"date\" ],\n        [ \"rate\", \"number++\" ],\n        [ \"yld\", \"number++\" ],\n        [ \"redemption\", \"number++\" ],\n        [ \"frequency\", [ \"and\", \"integer\", [ \"values\", 1, 2, 4 ] ] ],\n        [ \"basis\", [ \"or\", [ \"null\", 0 ],\n                     [ \"and\", \"integer\", [ \"values\", 0, 1, 2, 3, 4 ] ] ] ],\n        [ \"?\", [ \"assert\", \"$settlement < $maturity\", \"NUM\" ] ]\n    ]);\n\n    defineFunction(\"PRICEDISC\", PRICEDISC).args([\n        [ \"settlement\", \"date\" ],\n        [ \"maturity\", \"date\" ],\n        [ \"discount\", \"number++\" ],\n        [ \"redemption\", \"number++\" ],\n        [ \"basis\", [ \"or\", [ \"null\", 0 ],\n                     [ \"and\", \"integer\", [ \"values\", 0, 1, 2, 3, 4 ] ] ] ],\n        [ \"?\", [ \"assert\", \"$settlement < $maturity\", \"NUM\" ] ]\n    ]);\n\n    /* -----[ utils ]----- */\n\n    // function resultAsMatrix(f) {\n    //     return function() {\n    //         var a = f.apply(this, arguments);\n    //         return this.asMatrix(a);\n    //     };\n    // }\n\n    /* -----[ definitions: statistical functions ]----- */\n\n    var MAX_IT = 300,     // Maximum allowed number of iterations\n        EPS = 2.2204e-16, // Relative accuracy; 1-3*(4/3-1) = 2.220446049250313e-16\n        FP_MIN = 1.0e-30, // Near the smallest representable as floating-point, number.\n        f_abs = Math.abs;\n\n    function ERF(x) {\n        if (f_abs(x) >= 3.3) {\n            return 1 - ERFC(x);\n        }\n        var S = x > 0 ? 1 : -1;\n        if (S == -1) {\n            x = -x;\n        }\n        var m = 0, an = 1;\n        for (var n = 1; n < 100; n++) {\n            m += an;\n            an *= 2*x*x/(2*n+1);\n        }\n        return S*2/Math.sqrt(Math.PI)*x*Math.exp(-x*x)*m;\n    }\n\n    function ERFC(x) {\n        if (f_abs(x) < 3.3) {\n            return 1 - ERF(x);\n        }\n        var s = 1;\n        if (x < 0) {\n            s = -1;\n            x = -x;\n        }\n        var frac = x;\n        for (var n = 8; n >= 1; n -= 0.5) {\n            frac = x + n/frac;\n        }\n        frac = 1 / (x + frac);\n        return s == 1\n            ? Math.exp(-x*x)/Math.sqrt(Math.PI)*frac\n            : 2 - Math.exp(-x*x)/Math.sqrt(Math.PI)*frac;\n    }\n\n    function GAMMALN(x) { // Returns the value ln[(x)] for x > 0.\n        var cof = [\n            1.000000000190015, 76.18009172947146, -86.50532032941677,\n            24.01409824083091, -1.231739572450155, 0.1208650973866179e-2, -0.5395239384953e-5\n        ];\n        var y = x, tmp = x + 5.5, ser = cof[0];\n        tmp -= (x + 0.5) * Math.log(tmp);\n        for (var j = 1; j <= 6; j++) {\n            y += 1;\n            ser += cof[j] / y;\n        }\n        return -tmp + Math.log(Math.sqrt(2*Math.PI) * ser / x); // log((x)) = log((x+1)) - log(x)\n    }\n\n    function GAMMA(x) { // returns Infinity for 0 or negative _integer argument.\n        if (x > 0) {\n            return Math.exp(GAMMALN(x));\n        }\n        var pi = Math.PI, y = -x; // For x<0 we use the reflection formula: (x)(1-x) = PI / sin(PI*x)\n        return -pi / (y*GAMMA(y)*Math.sin(pi*y));\n    }\n\n    function BETALN(a, b) {\n        return GAMMALN(a) + GAMMALN(b) - GAMMALN(a+b);\n    }\n\n    function BETA(a, b) {\n        return Math.exp(BETALN(a, b));\n    }\n\n    function gamma_inc(a, x) { // returns the normalized incomplete gamma function P(a, x); x > 0.\n        return x < a+1.0 ? g_series(a, x) : 1 - g_contfrac(a, x);\n    }\n\n    function g_series(a, x) { // evaluate P(a, x) by its series representation (converges quickly for x < a+1).\n        var sum = 1/a,\n            frac = sum,\n            ap = a;\n        var gln = GAMMALN(a), n;\n        for (n = 1; n <= MAX_IT; n++) {\n            ap++;\n            frac *= x/ap;\n            sum += frac;\n            if (f_abs(frac) < f_abs(sum)*EPS) {\n                break; // already the last frac is too small versus the current sum value\n            }\n        }\n        return sum * Math.exp(-x + a*Math.log(x) - gln); // e^{-x} * x^a * (a) * sum\n    }\n\n    function g_contfrac(a, x) { // Q(a, x) by its continued fraction representation (converges quickly for x > a + 1); modified Lentzs method (Numerical Recipes (The Art of Scientific Computing), 2rd Edition $5.2)\n        var f = FP_MIN, c = f, d = 0, aj = 1, bj = x + 1 - a;\n        var gln = GAMMALN(a);\n        for (var i = 1; i <= MAX_IT; i++) {\n            d = bj + aj * d;\n\t    if (f_abs(d) < FP_MIN) {\n                d = FP_MIN;\n            }\n\t    c = bj + aj / c;\n\t    if (f_abs(c) < FP_MIN) {\n                c = FP_MIN;\n            }\n\t    d = 1 / d;\n\t    var delta = c * d;\n\t    f *= delta;\n    \t    if (f_abs(delta - 1) < EPS) {\n                break;\n            }\n\t    bj += 2;\n\t    aj = -i * (i - a);\n\t}\n\treturn f * Math.exp(-x - gln + a * Math.log(x));\n    }\n\n    function GAMMA_DIST(x, a, b, cumulative) { // a > 0, b > 0; x >= 0\n        if (!cumulative) {\n            return Math.pow(x/b, a-1)*Math.exp(-x/b)/(b*GAMMA(a)); // the PDF of the Gamma distribution\n        }\n        return gamma_inc(a, x/b); // (else) compute the CDF (using the incomplete Gamma function)\n    }\n\n    function GAMMA_INV(p, a, b) { // the quantile function of the Gamma distribution\n\tif (p === 0) {\n            return 0;\n        }\n\tif (p == 1) {\n            return Infinity;\n        }\n\tvar m = 0, M = 10, x = 0, ab = a*b;\n\tif (ab > 1) {\n            M *= ab;\n        }\n\tfor (var i = 0; i < MAX_IT; i++) {\n\t    x = 0.5*(m + M); // console.log(x);\n\t    var q = GAMMA_DIST(x, a, b, true);\n\t    if (f_abs(p - q) < 1e-16) {\n                break;\n            }\n\t    if (q > p) {\n                M = x;\n            } else {\n                m = x;\n            }\n\t}\n\treturn x;\n    }\n\n    function NORM_S_DIST(x, cumulative) {\n        if (!cumulative) {\n            return Math.exp(-x*x/2)/Math.sqrt(2*Math.PI);\n        }\n        return 0.5 + 0.5*ERF(x/Math.sqrt(2));\n    }\n\n    function NORM_S_INV(p) { // see [1] $26.2.3 and http://home.online.no/~pjacklam/notes/invnorm/#References\n        // Coefficients in rational approximations.\n        var a = [-3.969683028665376e+01,  2.209460984245205e+02,\n                 -2.759285104469687e+02,  1.383577518672690e+02,\n                 -3.066479806614716e+01,  2.506628277459239e+00],\n            b = [-5.447609879822406e+01,  1.615858368580409e+02,\n                 -1.556989798598866e+02,  6.680131188771972e+01,\n                 -1.328068155288572e+01],\n            c = [-7.784894002430293e-03, -3.223964580411365e-01,\n                 -2.400758277161838e+00, -2.549732539343734e+00,\n                 4.374664141464968e+00,  2.938163982698783e+00],\n            d = [ 7.784695709041462e-03,  3.224671290700398e-01,\n                  2.445134137142996e+00,  3.754408661907416e+00];\n        // Define break-points.\n        var plow  = 0.02425,\n            phigh = 1 - plow;\n        var q, r;\n        // Rational approximation for lower region:\n        if (p < plow) {\n            q = Math.sqrt(-2*Math.log(p));\n            return (((((c[0]*q+c[1])*q+c[2])*q+c[3])*q+c[4])*q+c[5]) / ((((d[0]*q+d[1])*q+d[2])*q+d[3])*q+1);\n        }\n        // Rational approximation for upper region:\n        if (phigh < p) {\n            q = Math.sqrt(-2*Math.log(1-p));\n            return -(((((c[0]*q+c[1])*q+c[2])*q+c[3])*q+c[4])*q+c[5]) / ((((d[0]*q+d[1])*q+d[2])*q+d[3])*q+1);\n        }\n        // Rational approximation for central region:\n        q = p - 0.5;\n        r = q*q;\n        return (((((a[0]*r+a[1])*r+a[2])*r+a[3])*r+a[4])*r+a[5])*q / (((((b[0]*r+b[1])*r+b[2])*r+b[3])*r+b[4])*r+1);\n    }\n\n    function NORM_DIST(x, m, s, cumulative) {\n        if (!cumulative) {\n            return Math.exp(-(x-m)*(x-m)/(2*s*s))/(s*Math.sqrt(2*Math.PI)); // NORM_S_DIST((x-m)/s)/s;\n        }\n        return NORM_S_DIST((x-m)/s, true);\n    }\n\n    function NORM_INV(p, m, s) {\n        return m + s*NORM_S_INV(p);\n    }\n\n    function betastd_pdf(x, a, b) {\n        return Math.exp((a-1)*Math.log(x) + (b-1)*Math.log(1-x) - BETALN(a, b));\n    }\n\n    function betastd_cdf(x, a, b) {\n        var k = Math.exp(a*Math.log(x) + b*Math.log(1-x) - BETALN(a, b));\n        return x < (a+1)/(a+b+2) ? k*beta_lentz(a, b, x)/a : 1 - k*beta_lentz(b, a, 1-x)/b;\n    }\n\n    function beta_lentz(a, b, x) { // estimates continued fraction by modified Lentzs method ([2] $8.17.22)\n        var m, m2;\n        var aa, c, d, del, h, qab, qam, qap;\n        qab = a + b; // These qs will be used in factors that occur in the coefficients d_n\n        qap = a + 1;\n        qam = a - 1;\n        c = 1; // First step of Lentzs method.\n        d = 1 - qab * x / qap;\n        if (f_abs(d) < FP_MIN) {\n            d = FP_MIN;\n        }\n        d = 1/d;\n        h = d;\n        for (m = 1; m <= MAX_IT; m++) {\n            m2 = 2*m;\n            aa = m*(b - m)*x / ((qam + m2)*(a + m2));\n            d = 1 + aa*d; // One step (the even one) of the recurrence.\n            if (f_abs(d) < FP_MIN) {\n                d = FP_MIN;\n            }\n            c = 1 + aa/c;\n            if (f_abs(c) < FP_MIN) {\n                c = FP_MIN;\n            }\n            d = 1/d;\n            h *= d*c;\n            aa = -(a + m)*(qab + m)*x / ((a + m2)*(qap + m2));\n            d = 1 + aa*d; // Next step of the recurrence (the odd one).\n            if (f_abs(d) < FP_MIN) {\n                d = FP_MIN;\n            }\n            c = 1 + aa/c;\n            if (f_abs(c) < FP_MIN) {\n                c = FP_MIN;\n            }\n            d = 1/d;\n            del = d*c;\n            h *= del;\n            if (f_abs(del - 1) < EPS) {\n                break;\n            }\n        }\n        return h; // if(m > MAX_IT) throw new Error(\"a or b too big, or MAX_IT too small\");\n    }\n\n    function betastd_inv(p, a, b) { // the quantile function of the standard Beta distribution\n\tvar m = 0, M = 1, x = 0;\n\tfor (var i = 0; i < MAX_IT; i++) {\n\t    x = 0.5*(m + M);\n\t    var q = betastd_cdf(x, a, b);\n\t    if (f_abs(p - q) < EPS) {\n                break;\n            }\n\t    if (q > p) {\n                M = x;\n            } else {\n                m = x;\n            }\n\t}\n\treturn x;\n    }\n\n    function BETADIST(x, a, b, m, M) {\n        return betastd_cdf((x-m)/(M-m), a, b);\n    }\n\n    function BETA_DIST(x, a, b, cdf, m, M) {\n        if (cdf) {\n            return betastd_cdf((x-m)/(M-m), a, b);\n        }\n        return betastd_pdf((x-m)/(M-m), a, b) / (M-m);\n    }\n\n    function BETA_INV(p, a, b, m, M) {\n        return m + (M-m)*betastd_inv(p, a, b);\n    }\n\n    function chisq_left(x, n, cds) {  // CHISQ.DIST(x,deg_freedom,cumulative)\n        return GAMMA_DIST(x, n/2, 2, cds);\n    }\n\n    function chisq_right(x, n) { // CHISQ.DIST.RT(x,deg_freedom)\n        return 1 - chisq_left(x, n, true);\n    }\n\n    function chisq_left_inv(p, n) { // CHISQ.INV( probability, degrees_freedom )\n        return GAMMA_INV(p, n/2, 2);\n    }\n\n    function chisq_right_inv(p, n) { // CHISQ.INV.RT(probability,deg_freedom)\n        return chisq_left_inv(1-p, n);\n    }\n\n    function chisq_test(obsv, expect) {\n        var rows = obsv.length, cols = obsv[0].length;\n        var x = 0, i, j;\n        for (i = 0; i < rows; i++) {\n            for (j = 0; j < cols; j++) {\n                var eij = expect[i][j];\n                var delta = obsv[i][j] - eij;\n                delta *= delta;\n                x += delta/eij;\n            }\n        }\n        var n = (rows - 1)*(cols - 1);\n        return chisq_right(x, n);\n    }\n\n    function expon(x, r, cdf) { // EXPON.DIST(x, lambda, cumulative)\n        if (cdf) {\n            return 1 - Math.exp(-r*x);\n        }\n        return r * Math.exp(-r*x);\n    }\n\n    function poisson(k, m, cdf) { // POISSON.DIST(x, mean, cumulative)\n        if (cdf) {\n            return 1 - chisq_left(2*m, 2*(k+1), true);\n        }\n        //return chisq_left(2*m, 2*k, true) - chisq_left(2*m, 2*(k+1), true);\n        var lnf = 0;\n        for (var i = 2; i <= k; i++) {\n            lnf += Math.log(i); // compute log(k!)\n        }\n        return Math.exp(k*Math.log(m) - m - lnf);\n    }\n\n    function Fdist(x, n, d, cdf) { //F.DIST(x,deg_freedom1,deg_freedom2,cumulative)\n        if (cdf) {\n            return betastd_cdf(n*x/(d+n*x), n/2, d/2);\n        }\n        var u = n/d;\n        n /= 2; d /= 2;\n        return u/BETA(n, d) * Math.pow(u*x, n-1) / Math.pow(1+u*x, n+d);\n    }\n\n    function Fdist_right(x, n, d) { // F.DIST.RT(x,deg_freedom1,deg_freedom2)\n        return 1 - Fdist(x, n, d, true);\n    }\n\n    function Finv_right(p, n, d) { // F.INV.RT(probability,deg_freedom1,deg_freedom2\n        return d/n*(1/BETA_INV(p, d/2, n/2, 0, 1) - 1);\n    }\n\n    function Finv(p, n, d) { // F.INV(probability,deg_freedom1,deg_freedom2\n        return d/n*(1/BETA_INV(1-p, d/2, n/2, 0, 1) - 1);\n    }\n\n    function _mean(arr) {\n        var me = 0, n = arr.length;\n        for (var i = 0; i < n; i++) {\n            me += arr[i];\n        }\n        return me / n;\n    }\n\n    function _var_sq(arr, m) { // returns the (n-1)-part of the sum of the squares of deviations from m (= VAR)\n        var v = 0, n = arr.length;\n        for (var i = 0; i < n; i++) {\n            var delta = arr[i] - m;\n            v += delta*delta;\n        }\n        return v / (n-1);\n    }\n\n    function Ftest(arr1, arr2) { // F.TEST(array1,array2)\n        var n1 = arr1.length - 1, n2 = arr2.length - 1;\n        var va1 = _var_sq(arr1, _mean(arr1)),\n            va2 = _var_sq(arr2, _mean(arr2));\n        if (!va1 || !va2) {\n            throw new CalcError(\"DIV/0\");\n        }\n        return 2*Fdist(va1 / va2, n1, n2, true);\n    }\n\n    function fisher(x) { // FISHER(x)\n        return 0.5*Math.log((1+x)/(1-x));\n    }\n\n    function fisherinv(x) { // FISHERINV(x)\n        var e2 = Math.exp(2*x);\n        return (e2 - 1)/(e2 + 1);\n    }\n\n    function Tdist(x, n, cdf) { // T.DIST(x,deg_freedom, cumulative)\n        if (cdf) {\n            return 1 - 0.5*betastd_cdf(n/(x*x+n), n/2, 0.5);\n        }\n        return 1/(Math.sqrt(n)*BETA(0.5, n/2)) * Math.pow(1 + x*x/n, -(n+1)/2);\n    }\n\n    function Tdist_right(x, n) { // T.DIST.RT(x,deg_freedom)\n        return 1 - Tdist(x, n, true);\n    }\n\n    function Tdist_2tail(x, n) { // T.DIST.2T(x,deg_freedom)\n        if (x < 0) {\n            x = -x;\n        }\n        return 2*Tdist_right(x, n);\n    }\n\n    function Tdist_inv(p, n) { // T.INV(probability,deg_freedom)\n        var x = betastd_inv(2*Math.min(p, 1-p), n/2, 0.5); // ibetainv();\n        x = Math.sqrt(n * (1 - x) / x);\n        return (p > 0.5) ? x : -x;\n    }\n\n    function Tdist_2tail_inv(p, n) { // T.INV.2T(probability,deg_freedom)\n        // T2 = 2T_r = p => T_r(x,n) = p/2 => 1 - T(x,n,true) = p/2 => x = T^-1(1-p/2, n)\n        return Tdist_inv(1-p/2, n);\n    }\n\n    function Tdist_test(gr1, gr2, tail, type) { // T.TEST(array1,array2,tails,type)\n        var n1 = gr1.length, n2 = gr2.length;\n        var t_st, df; // the t-statistic and the \"degree of freedom\"\n        if (type == 1) { // paired (dependent) samples\n            var d = 0, d2 = 0;\n            for (var i = 0; i < n1; i++) {\n                var delta = gr1[i] - gr2[i];\n                d += delta;\n                d2 += delta*delta;\n            }\n            var md = d/n1; //, md2 = d2 / n1;\n            t_st = md / Math.sqrt((d2 - d*md)/(n1*(n1-1))); // has a \"Student T\" distribution\n            return tail == 1 ? Tdist_right(t_st, n1-1) : Tdist_2tail(t_st, n1-1);\n        }\n        // unpaired (independent) samples\n        var m1 = _mean(gr1), m2 = _mean(gr2),\n            v1 = _var_sq(gr1, m1), v2 = _var_sq(gr2, m2);\n        if (type == 3) { // unpaired, unequal variances\n            var u1 = v1/n1, u2 = v2/n2, u = u1 + u2;\n            var q1 = u1/u, q2 = u2/u; // u==0 must be invalidated\n            df = 1/(q1*q1/(n1-1) + q2*q2/(n2-1));\n            t_st =  f_abs(m1-m2)/Math.sqrt(u);\n            return tail == 1 ? Tdist_right(t_st, df) : Tdist_2tail(t_st, df);\n        }\n        else { // (type == 2) unpaired, equal variances (\"equal\" in the sense that there is no significant difference in variance in both groups - a prealable F-test could revealed that)\n            df = n1 + n2 - 2;\n            t_st = f_abs(m1-m2)*Math.sqrt(df*n1*n2/((n1+n2)*((n1-1)*v1+(n2-1)*v2)));\n            return tail == 1 ? Tdist_right(t_st, df) : Tdist_2tail(t_st, df);\n        }\n    }\n\n    function confidence_t(alpha, stddev, size) { // CONFIDENCE.T(alpha,standard_dev,size)\n        return -Tdist_inv(alpha/2, size-1)*stddev/Math.sqrt(size);\n    }\n\n    function confidence_norm(alpha, stddev, size) { // CONFIDENCE.NORM(alpha,standard_dev,size)\n        return -NORM_S_INV(alpha/2)*stddev/Math.sqrt(size);\n    }\n\n    function gauss(z) { // GAUSS(z)\n        return NORM_S_DIST(z, true) - 0.5;\n    }\n\n    function phi(x) { // PHI(x)\n        return NORM_S_DIST(x);\n    }\n\n    function lognorm_dist(x, m, s, cumulative) { // LOGNORM.DIST(x,mean,standard_dev,cumulative)\n        if (cumulative) {\n            return 0.5 + 0.5*ERF((Math.log(x)-m)/(s*Math.sqrt(2)));\n        }\n        var t = Math.log(x)-m;\n        return Math.exp(-t*t/(2*s*s))/(x*s*Math.sqrt(2*Math.PI));\n    }\n\n    function lognorm_inv(p, m, s) { //LOGNORM.INV(probability, mean, standard_dev)\n        return Math.exp(NORM_INV(p, m, s));\n    }\n\n    function prob(x_, p_, lw, up) { //PROB(x_range, prob_range, [lower_limit], [upper_limit])\n        var n = x_.length;\n        var s = 0, i;\n        for (i = 0; i < n; i++) {\n            if (p_[i] <= 0 || p_[i] > 1) {\n                throw new CalcError(\"NUM\");\n            }\n            s += p_[i];\n        }\n        if (s != 1) {\n            throw new CalcError(\"NUM\");\n        }\n        var res = 0;\n        for (i = 0; i < n; i++) {\n            var x = x_[i];\n            if (x >= lw && x <= up) {\n                res += p_[i];\n            }\n        }\n        return res;\n    }\n\n    function slope(y_, x_) { // SLOPE(known_y's, known_x's)\n        var mx = _mean(x_), my = _mean(y_), b1 = 0, b2 = 0;\n        for (var i = 0, n = y_.length; i < n; i++) {\n            var t = x_[i] - mx;\n            b1 += t*(y_[i] - my);\n            b2 += t*t;\n        }\n        return b1/b2;\n    }\n\n    function intercept(y_, x_) { // INTERCEPT(known_y's, known_x's)\n        var mx = _mean(x_), my = _mean(y_);\n        // return my - mx*slope(y_, x_);  //but repeating the calls for _mean()\n        var b1 = 0, b2 = 0;\n        for (var i = 0, n = y_.length; i < n; i++) {\n            var t = x_[i] - mx;\n            b1 += t*(y_[i] - my);\n            b2 += t*t;\n        }\n        return my - b1*mx/b2;\n    }\n\n    function pearson(x_, y_) { // PEARSON(array1, array2)\n        whipNumberArrays(x_, y_);\n        var mx = _mean(x_), my = _mean(y_);\n        var s1 = 0, s2 = 0, s3 = 0;\n        for(var i = 0, n = x_.length; i < n; i++) {\n            var t1 = x_[i] - mx, t2 = y_[i] - my;\n            s1 += t1*t2;\n            s2 += t1*t1;\n            s3 += t2*t2;\n        }\n        return s1/Math.sqrt(s2*s3);\n    }\n\n    function rsq(x_, y_) { // RSQ(known_y's,known_x's)\n        var r = pearson(x_, y_);\n        return r*r;\n    }\n\n    function steyx(y_, x_) { //STEYX(known_y's, known_x's)\n        var n = x_.length;\n        var mx = _mean(x_), my = _mean(y_);\n        var s1 = 0, s2 = 0, s3 = 0;\n        for (var i = 0; i < n; i++) {\n            var t1 = x_[i] - mx, t2 = y_[i] - my;\n            s1 += t2*t2;\n            s2 += t1*t2;\n            s3 += t1*t1;\n        }\n        return Math.sqrt((s1 - s2*s2/s3)/(n-2));\n    }\n\n    function forecast(x, y_, x_) { //FORECAST(x, known_y's, known_x's)\n        var mx = _mean(x_), my = _mean(y_);\n        var s1 = 0, s2 = 0;\n        for (var i = 0, n = x_.length; i < n; i++) {\n            var t1 = x_[i] - mx, t2 = y_[i] - my;\n            s1 += t1*t2;\n            s2 += t1*t1;\n        }\n        if (s2 === 0) {\n            throw new CalcError(\"N/A\");\n        }\n        var b = s1/s2, a = my - b*mx;\n        return a + b*x;\n    }\n\n    function _mat_mean(Mat) { // returns the mean value of a Matrix(n, 1)\n        var n = Mat.height, sum = 0;\n        for (var i=0; i < n; i++) {\n            sum += Mat.data[i][0];\n        }\n        return sum/n;\n    }\n\n    function _mat_devsq(Mat, mean) { // returns the sum of squares of deviations for a Matrix(n, 1)\n        var n = Mat.height, sq = 0;\n        for (var i=0; i < n; i++) {\n            var x = Mat.data[i][0] - mean;\n            sq += x*x;\n        }\n        return sq;\n    }\n\n    function linest(Y, X, konst, stats) { // LINEST(known_y's, [known_x's], [const], [stats])\n        var i = 0;\n\n        if (!X) {\n            // if not passed, X should default to array {1, 2, 3, ...} (same size as Y)\n            X = Y.map(function(){ return ++i; });\n        }\n\n        if (konst) { // adding 1's column is unnecessary when const==false (meaning that y_intercept==0)\n            X = X.clone();\n            X.eachRow(function(row){\n                X.data[row].unshift(1);\n            });\n            ++X.width;\n        }\n\n        var Xt = X.transpose();\n        var B = Xt.multiply(X).inverse().multiply(Xt).multiply(Y); // the last square estimate of the coefficients\n        var line_1 = [];\n        for (i = B.height-1; i >= 0; i--) {\n            line_1.push(B.data[i][0]); // regression coefficients ('slopes') and the y_intercept\n        }\n        if (!konst) {\n            line_1.push(0); // display 0 for y_intercept, when const==false\n        }\n        if (!stats) {\n            return this.asMatrix([ line_1 ]); // don't display statistics about the regression, when stats==false\n        }\n\n        var Y1 = X.multiply(B); // the predicted Y values\n        var y_y1 = Y.adds(Y1, true); // the errors of the predictions (= Y - Y1)\n        var mp = !konst? 0 : _mat_mean(Y1);\n        var SSreg = _mat_devsq(Y1, mp); // The regression sum of squares\n        var me = !konst? 0 : _mat_mean(y_y1);\n        var SSresid = _mat_devsq(y_y1, me); // The residual sum of squares\n        var line_5 = [];\n        line_5.push(SSreg, SSresid);\n        var R2 = SSreg / (SSreg + SSresid); // The coefficient of determination\n        var degfre = Y.height - X.width; // The degrees of freedom\n        var err_est = Math.sqrt(SSresid / degfre); // The standard error for the y estimate\n        var line_3 = [];\n        line_3.push(R2, err_est);\n        var F_sta = !konst ? (R2/X.width)/((1-R2)/(degfre)) : (SSreg/(X.width-1))/(SSresid/degfre); // The F statistic\n        var line_4 = [];\n        line_4.push(F_sta, degfre);\n        var SCP = Xt.multiply(X).inverse();\n        var line_2 = [];\n        for (i=SCP.height-1; i >= 0; i--) { // The standard errors (of coefficients an y-intercept)\n            line_2.push(Math.sqrt(SCP.data[i][i]*SSresid/degfre));\n        }\n        return this.asMatrix([line_1, line_2, line_3, line_4, line_5]);\n    }\n\n    function logest(Y, X, konst, stats) { // LOGEST(known_y's, [known_x's], [const], [stats])\n        return linest.call(this, Y.map(Math.log), X, konst, stats).map(Math.exp);\n    }\n\n    function trend(Y, X, W, konst) { // TREND(known_y's, [known_x's], [new_x's], [const])\n        var i = 0;\n\n        if (!X) {\n            // if not passed, X should default to array {1, 2, 3, ...} (same size as Y)\n            X = Y.map(function(){ return ++i; });\n        }\n\n        if (konst) { // adding 1's column is unnecessary when const==false (meaning that y_intercept==0)\n            X = X.clone();\n            X.eachRow(function(row){\n                X.data[row].unshift(1);\n            });\n            ++X.width;\n        }\n\n        var Xt = X.transpose();\n        var B = Xt.multiply(X).inverse().multiply(Xt).multiply(Y); // the last square estimate of the coefficients\n\n        if (!W) {\n            W = X;\n        } else {\n            if (konst) { // for non-zero y_intercept\n                W = W.clone();\n                W.eachRow(function(row){\n                    W.data[row].unshift(1);\n                });\n                ++W.width;\n            }\n        }\n        return W.multiply(B); // the predicted Y values for the W values\n    }\n\n    function growth(Y, X, new_X, konst) { // GROWTH(known_y's, [known_x's], [new_x's], [const])\n        // = EXP(TREND(LN(Y_), X_, new_X, const))\n        return trend.call(this, Y.map(Math.log), X, new_X, konst).map(Math.exp);\n    }\n\n    /*\n      [1] Handbook of Mathematical Functions (NIST, 1964-2010):\n      https://en.wikipedia.org/wiki/Abramowitz_and_Stegun\n      http://dlmf.nist.gov/\n      http://www.aip.de/groups/soe/local/numres/\n\n      [2] https://en.wikibooks.org/wiki/Statistics/Numerical_Methods/Numerics_in_Excel\n    */\n\n    /* -----[ financial functions ]----- */\n\n    //// find the root of a function known an initial guess (Newton's method) ////\n    function root_newton(func, guess, max_it, eps) { // func(x) must return [value_F(x), value_F'(x)]\n        var MAX_IT = max_it || 20, // maximum number of iterations\n            EPS = eps || 1E-7; // accuracy\n        var root = guess;\n        for (var j = 1; j <= MAX_IT; j++) {\n            var f_d = func(root),\n                f = f_d[0], // the value of the function\n                df = f_d[1]; // the value of the derivative\n            var dx = f / df;\n            root -= dx;\n            if (Math.abs(dx) < EPS) {\n                return root;\n            }\n        }\n        return new CalcError(\"NUM\");\n    }\n\n\n    /* https://support.office.com/en-us/article/PV-function-23879d31-0e02-4321-be01-da16e8168cbd\n       if(rate==0):\n       PMT * nper + PV + FV = 0\n       else: //the basic equation (with six variables) implied in financial problems\n       PV * (1+rate)^nper + PMT * (1+rate*type) * ((1+rate)^nper-1) / rate + FV = 0         [1]\n    */\n\n\n\n    //// FV (final or future value) ////\n    /* I initially invest 1000 in a saving scheme and then at the end of each month I invest an\n       extra 50. If the interest rate is 0.5% per month and I continue this process for two year,\n       how much will my saving be worth: =FV(0.005, 24, -50, -1000, 0) */\n    function FV(rate, nper, pmt, pv, type) { // FV(rate,nper,pmt,[pv],[type])\n        var h1 = Math.pow(1+rate, nper);\n        var h2 = rate ? (h1 - 1)/rate : nper;\n        return -(pv * h1 + pmt * h2 * (1 + rate*type));\n    }\n\n    //// PV (present value of investment) ////\n    /* If I wish to accumulate 5000 in four years time by depositing 75 per month in a fixed\n       rate account with interest rate of 0.4% per month, what initial investment must I also\n       make: =PV(0.004, 4*12, -75, 5000, 0) */\n    function PV(rate, nper, pmt, fv, type) { // PV(rate, nper, pmt, [fv], [type])\n        if (!rate) {\n            return -fv - pmt*nper;\n        }\n        var h1 = Math.pow(1+rate, nper);\n        return -(fv + pmt * (h1 - 1)/rate * (1 + rate*type)) / h1;\n    }\n\n    //// PMT monthly payments (= principal part PPMT + interest part IPMT) ////\n    /* How much will the monthly repayments be if I borrow 100,000 over 20 years with an\n       effective monthly interest rate is 0.5%: =PMT(0.005, 12*20, 100000, 0, 0) */\n    function PMT(rate, nper, pv, fv, type) { // PMT(rate, nper, pv, [fv], [type])\n        if (!rate) {\n            return -(fv + pv)/nper;\n        }\n        var h1 = Math.pow(1+rate, nper);\n        return -rate*(fv + pv*h1)/((1 + rate*type)*(h1 - 1));\n    }\n\n    //// NPER (number of periods for an investment) ////\n    /* How long would it take me to pay off a loan of 10,000 at a rate of 0.5% per month if I\n       can afford to pay 100 per month: =NPER(0.5%, -100, 10000, 0, 0) */\n    function NPER(rate, pmt, pv, fv, type) { // NPER(rate,pmt,pv,[fv],[type])\n        if (!rate) {\n            return -(fv + pv) / pmt;\n        }\n        var h1 = pmt*(1 + rate*type);\n        return Math.log((h1 - fv*rate)/(h1 + pv*rate)) / Math.log(1 + rate);\n    }\n\n    //// RATE (the interest rate per period) ////\n    /* I borrow 1000 over 1 year making payments of 100 per month at the end of each\n       month. What is the monthly interest rate: =RATE(12, 100, 1000, 0, 0, 0) */\n\n    function RATE (nper, pmt, pv, fv, type, guess) { // RATE(nper, pmt, pv, [fv], [type], [guess])\n        function xfd(x) { // returns F(x) and F'(x), where F is given by the equation [1]\n            var h2 = Math.pow(1+x, nper-1), h1 = h2*(1+x);\n            return [ pv*h1 + pmt*(1/x + type)*(h1 - 1) + fv,\n                     nper*pv*h2 + pmt*(-(h1 - 1)/(x*x) + (1/x + type)*nper*h2) ];\n        }\n        return root_newton(xfd, guess); // a root of the equation F(x)=0\n    }\n\n    //// IPMT (interest part of a loan or investment) ////\n    //// PPMT (principal part of a loan) ////\n\n    function IPMT(rate, per, nper, pv, fv, type) { // IPMT(rate, per, nper, pv, [fv], [type])\n        if(type==1 && per==1) { // interest before beginnig of the payments... = ZERO\n            return 0;\n        }\n        var pmt = PMT(rate, nper, pv, fv, type);\n        var ipmt = FV(rate, per - 1, pmt, pv, type) * rate;\n        return type ? ipmt/(1 + rate) : ipmt;\n    }\n\n    function PPMT(rate, per, nper, pv, fv, type) { // PPMT(rate, per, nper, pv, [fv], [type])\n        var pmt = PMT(rate, nper, pv, fv, type);\n        return pmt - IPMT(rate, per, nper, pv, fv, type);\n    }\n\n    //// CUMPRINC (cumulative principal paid) ////\n    /* The amount financed is $200,000 at an interest rate of 7.25% for 30 years. How much is the amount of principal\n       and the amount of interest paid in the first year: CUMPRINC(0.0725/12, 12*30, 200000, 1, 12, 0)\n       and CUMIPMT(0.0725/12, 12*30, 200000, 1, 12, 0) */\n    function CUMPRINC(rate, nper, pv, start, end, type) { // CUMPRINC(rate, nper, pv, start_period, end_period, type)\n        if(type == 1) { // start >= 1 (as in Excel), but if pay at beginning of the period (type==1),\n            start --;    // then periods must be counted from Zero (decreasing given start and end parameters)\n            end --;\n        }\n        var tn = Math.pow(1 + rate, nper),\n            ts = Math.pow(1 + rate, start-1),\n            te = Math.pow(1 + rate, end);\n        var monthlyPayment = rate * pv * tn / (tn - 1);\n        var remainingBalanceAtStart = ts * pv - ((ts - 1) / rate) * monthlyPayment;\n        var remainingBalanceAtEnd = te * pv - ((te - 1) / rate) * monthlyPayment;\n        return remainingBalanceAtEnd - remainingBalanceAtStart;\n    }\n\n    //// CUMIPMT (cumulative  interest paid) ////\n    function CUMIPMT(rate, nper, pv, start, end, type) { // CUMIPMT(rate, nper, pv, start_period, end_period, type)\n        var cip = 0;\n        for(var i=start; i<=end; i++) {\n            cip += IPMT(rate, i, nper, pv, 0, type);\n        }\n        return cip;\n    }\n\n    //// NPV (Net Present Value of an investment based on a series of periodic cash flows and a discount rate) ////\n    function NPV(rate, flows) { // NPV(rate,value1,[value2],...)\n        var npv = 0;\n        for(var i=0, n=flows.length; i < n; i++) {\n            npv += flows[i]*Math.pow(1 + rate, -i-1);\n        }\n        return npv;\n    }\n\n    //// IRR (Internal Rate of Return on an investment based on a series of periodic cash flows) ////\n    function IRR(flows, guess) { // IRR(values, [guess])\n        function xfd(x) {\n            var npv = 0, npv1 = 0;\n            for(var j=0, n=flows.length; j < n; j++) {\n                npv += flows[j]*Math.pow(1 + x, -j-1); // construct the NPV(x) value,\n                npv1 += -j*flows[j]*Math.pow(1+x, -j-2); // the value in x of the NPV()-derivative\n            }\n            return [npv, npv1];\n        }\n        return root_newton(xfd, guess);\n    }\n\n    //// EFFECT (effective annual interest rate) ////\n    /* which investment option is better - one that pays 5 percent after one year, or a\n       savings account that pays a monthly interest of 4.75 percent:\n       = (5% - EFFECT(4.75%, 12)) * 10000 */\n    function EFFECT(nominal_rate, npery) { // EFFECT(nominal_rate, npery)\n        return Math.pow(1 + nominal_rate/npery, npery) - 1;\n    }\n\n    //// NOMINAL (nominal annual interest rate) ////\n    function NOMINAL(effect_rate, npery) { // NOMINAL(effect_rate, npery)\n        return npery*(Math.pow(effect_rate + 1, 1/npery) - 1);\n    }\n\n    //// XNPV (Net Present Value of a series of cashflows at irregular intervals) ////\n    function XNPV(rate, values, dates) { // XNPV(rate, values, dates)\n        var npv = 0;\n        for(var i=0, n=values.length; i < n; i++) {\n            npv += values[i]*Math.pow(1 + rate, (dates[0]-dates[i])/365);\n        }\n        return npv;\n    }\n\n    //// XIRR (Internal Rate of Return of a series of cashflows at irregular intervals) ////\n    function XIRR(values, dates, guess) { // XIRR(values, dates, [guess])\n        function xfd(x) {\n            var npv = values[0], npv1 = 0;\n            for(var j=1, n=values.length; j < n; j++) {\n                var delta = (dates[0] - dates[j]) / 365;\n                npv += values[j]*Math.pow(1 + x, delta); // construct the XNPV(x) value,\n                npv1 += delta*values[j]*Math.pow(1+x, delta - 1); // the value in x of the XNPV()-derivative\n            }\n            return [npv, npv1];\n        }\n        return root_newton(xfd, guess); // , 100, 0.1);\n    }\n\n    //// ISPMT (Interest paid during a Specific Period of an investment) ////\n    function ISPMT(rate, per, nper, pv) { // ISPMT(rate, per, nper, pv)\n        var tmp = -pv*rate;\n        return tmp*(1 - per/nper);\n    }\n\n    //// DB (Declining Balance depreciation) ////\n    function DB(cost, salvage, life, period, month) { // DB(cost, salvage, life, period, [month])\n        var rate = 1 - Math.pow(salvage/cost, 1/life);\n        rate = Math.floor(rate*1000 + 0.5) / 1000; // rounded to three decimals\n        var db = cost * rate * month / 12;\n        if(period == 1) {\n            return db;\n        }\n        for(var i=1; i < life; i++) {\n            if(i == period - 1) {\n                return (cost - db) * rate;\n            }\n            db += (cost - db) * rate;\n        }\n        return (cost - db) * rate * (12 - month) / 12;\n    }\n\n    //// DDB (Double Declining Balance depreciation) ////\n    function DDB(cost, salvage, life, period, factor) { // DDB(cost, salvage, life, period, [factor])\n        var f = factor / life;\n        var prior = -cost * (Math.pow(1-f, period-1) - 1);\n        var dep = (cost - prior) * f;\n        /* Depreciation cannot exceed book value.  */\n        dep = Math.min(dep, Math.max(0, cost - prior - salvage));\n        return dep;\n    }\n\n    //// SLN (straight-line depreciation) ////\n    function SLN(cost, salvage, life) { // SLN(cost, salvage, life)\n        return (cost - salvage) / life;\n    }\n\n    //// SYD (Sum-of-Years' digits Depreciation) ////\n    function SYD(cost, salvage, life, per) { // SYD(cost, salvage, life, per)\n        return (cost - salvage) * (life - per + 1) * 2 / (life * (life + 1));\n    }\n\n    //// VDB (Variable Declining Balance) ////\n    //\n    // Code adapted from Gnumeric, which in turn took it from OpenOffice.  The original code is\n    // available under GNU Lesser General Public License (LGPL).\n    // https://github.com/GNOME/gnumeric/blob/master/plugins/fn-financial/sc-fin.c\n    function VDB (cost, salvage, life, start, end, factor, no_switch) {\n        var interest = factor >= life ? 1 : factor / life;\n\n        function _getGDA(value, period) {\n            var gda, oldValue, newValue;\n            if (interest == 1) {\n                oldValue = period == 1 ? value : 0;\n            } else {\n                oldValue = value * Math.pow(1 - interest, period - 1);\n            }\n            newValue = value * Math.pow(1 - interest, period);\n            gda = newValue < salvage ? oldValue - salvage : oldValue - newValue;\n            return gda < 0 ? 0 : gda;\n        }\n\n        function _interVDB(cost, life1, period) {\n            var remValue = cost - salvage;\n            var intEnd = Math.ceil(period);\n            var term, lia = 0, vdb = 0, nowLia = false;\n            for (var i = 1; i <= intEnd; i++) {\n                if (!nowLia) {\n                    var gda = _getGDA(cost, i);\n                    lia = remValue / (life1 - i + 1);\n                    if (lia > gda) {\n                        term = lia;\n                        nowLia = true;\n                    } else {\n                        term = gda;\n                        remValue -= gda;\n                    }\n                } else {\n                    term = lia;\n                }\n                if (i == intEnd) {\n                    term *= period + 1 - intEnd;\n                }\n                vdb += term;\n            }\n            return vdb;\n        }\n\n        var intStart = Math.floor(start), intEnd = Math.ceil(end);\n        var vdb = 0;\n        if (no_switch) {\n            for (var i = intStart + 1; i <= intEnd; i++) {\n                var term = _getGDA(cost, i);\n                if (i == intStart + 1) {\n                    term *= Math.min(end, intStart + 1) - start;\n                } else {\n                    if (i == intEnd) {\n                        term *= end + 1 - intEnd;\n                    }\n                }\n                vdb += term;\n            }\n        } else {\n            var life1 = life;\n            if (start != Math.floor(start)) {\n                if (factor > 1) {\n                    if (start >= life / 2) {\n                        var part = start - life / 2;\n                        start = life / 2;\n                        end -= part;\n                        life1 += 1;\n                    }\n                }\n            }\n            cost -= _interVDB(cost, life1, start);\n            vdb = _interVDB(cost, life - start, end - start);\n        }\n        return vdb;\n    }\n\n    /*************************************************************************************/\n\n    /*   (from  http://beginnersinvest.about.com)\n         an investor agrees to loan money to a company or government in exchange for a predetermined interest rate for a pre-determined length of time.\n\n         If an investor wanted to buy a $25,000 Coca-Cola bond with a 30 year maturity and an 10% coupon, it would work like this: He would send in the $25,000 from his savings account and get a $25,000 engraved bond certificate in exchange. After 30 years, he would be able to get his whole $25,000 back from the Coca-Cola company (of course, he can always sell it before then if he needs the money).\n\n         Every year, hes entitled to receive 10% interest on the money he lent, or $2,500. Since most companies in the United States pay interest semi-annually, he would likely have 60 coupons attached to his bond for $1,250 each.\n         Every June 30th and December 31st, the investor would go down, clip the proper coupon, send it in, and get their money.\n\n         Although the practice is now defunct, the terminology stuck and interest payments on bonds will forever be known as coupons.\n    */\n\n\n    // \"Use EDATE to calculate maturity dates or due dates that fall on the same day of the month as the date of issue.\"\n    // See also: DATEDIF, DAY, DAYS, DAY360, EOMONTH (wich can be useful to determine limits of coupon periods)\n    function _edate(base, months) { // EDATE(start_date, months)\n        var d = unpackDate(base);\n        var m = d.month + months;\n        var y = d.year + Math.floor(m/12);\n        m %= 12;\n        if (m < 0) {\n            m += 12;\n        }\n        d = Math.min(d.date, daysInMonth(y, m));\n        return packDate(y, m, d);\n    }\n\n    function _daysBetween(from, to, basis) {\n        if (basis == 1 || basis == 2 || basis == 3) { // Actual/Actual || Actual/360 || Actual/365\n            return to - from;\n        }\n        return _days_360(from, to, basis);\n    }\n\n    // Find coupon dates that enclose the settlement date, counting backward from the maturity date.\n    /* independent of the 'basis' convention to count days - here we have no need to count days */\n    function _borderCoupons(settlement, maturity, freq) {\n        var sett = unpackDate(settlement), base = unpackDate(maturity);\n        var periods = base.year - sett.year;\n        if (periods > 0) {\n            periods = (periods - 1) * freq;\n        }\n        var prev, next, months = 12/freq;\n        do {\n            periods++;\n            prev = _edate(maturity, - periods*months);\n        } while (settlement < prev);\n        periods--;\n        next = _edate(maturity, - periods*months);\n        return [ prev, next ];\n    }\n\n    // Find coupon dates that enclose the settlement date, counting forward from the first-coupon payment.\n    /* independent of the 'basis' convention to count days - here we have no need to count days */\n    function _borderCoupons_fw(first, settlement, freq) {\n        var sett = unpackDate(settlement), base = unpackDate(first);\n        var periods = sett.year - base.year;\n        if (periods > 0) {\n            periods = (periods - 1) * freq;\n        }\n        var prev = first, next, months = 12/freq;\n        while (settlement > prev) {\n            next = prev;\n            periods++;\n            prev = _edate(first, periods*months);\n        }\n        return [ next, prev ];\n    }\n\n    //// COUPDAYBS (COUPon DAYs Beginning to Settlement) ////\n    /* returns the number of days from the beginning of the coupon period to the settlement date */\n    function COUPDAYBS(settlement, maturity, frequency, basis) { // COUPDAYBS(settlement, maturity, frequency, [basis])\n        var prev = _borderCoupons(settlement, maturity, frequency)[0];\n        return _daysBetween(prev, settlement, basis);\n    }\n\n    //// COUPDAYS (COUPon DAYs containing Settlement) ////\n    /* Returns the number of days in the coupon period that contains the settlement date */\n    function COUPDAYS(settl, matur, freq, basis) { // COUPDAYS(settlement, maturity, frequency, [basis])\n        if (basis == 1) {\n            var borders = _borderCoupons(settl, matur, freq);\n            return _daysBetween(borders[0], borders[1], 1);\n        }\n        if (basis == 3) {\n            return 365/freq;\n        }\n        return 360/freq;\n    }\n\n    //// COUPDAYSNC (COUPon DAYs Settlement to Next Coupon) ////\n    /* Returns the number of days from the settlement date to the next coupon date */\n    function COUPDAYSNC(settl, matur, freq, basis) { // COUPDAYSNC(settlement, maturity, frequency, [basis])\n        var next = _borderCoupons(settl, matur, freq)[1];\n        return _daysBetween(settl, next, basis);\n    }\n\n    //// COUPPCD (COUPon, Previous Coupon Date) ////\n    /* Returns the previous coupon date before the settlement date */\n    function COUPPCD(settl, matur, freq/*, basis*/) { // COUPPCD(settlement, maturity, frequency, [basis])\n        // It is no need to count days, so 'basis' becomes a inutil parameter.\n        return _borderCoupons(settl, matur, freq)[0];\n    }\n\n    //// COUPNCD (COUPon, Next Coupon Date) ////\n    /* Returns the next coupon date after the settlement date */\n    function COUPNCD(settl, matur, freq/*, basis*/) { // COUPNCD(settlement, maturity, frequency, [basis])\n        // It is no need to count days, so 'basis' becomes a inutil parameter.\n        return _borderCoupons(settl, matur, freq)[1];\n    }\n\n    function COUPNUM(settl, matur, freq/*, basis*/) { // COUPNUM(settlement, maturity, frequency, [basis])\n        var sett = unpackDate(settl),\n            mat = unpackDate(matur);\n        var months = 12*(mat.year - sett.year) + mat.month - sett.month;\n        //// Discount the last month if there are not enough days? Finally - we decide to not discount.\n        //// (if this \"last month\" have 2 days, Excel.COUPNUM returns 6 but GoogleSpreads give only 5)\n        //    var res = _edate(matur, -months);\n        //    if (sett.date >= unpackDate(res).date) {\n        //        months--; // an incomplete last month correspond to a qvasi-coupon period\n        //    }\n        return 1 + (months * freq / 12 | 0);\n    }\n\n    function daysInYear(yr, basis) {\n        if (basis == 3) { return 365; }\n        if (basis == 1) { return isLeapYear(yr) ? 366 : 365; }\n        return 360;\n    }\n\n    //// ACCRINTM  the accrued interest for a security that pays interest at maturity ////\n    function ACCRINTM(issue, maturity, rate, par, basis) { // ACCRINTM(issue, settlement, rate, par, [basis])\n        var year_days = daysInYear(unpackDate(maturity).year, basis); // 360;\n        return rate*par * _daysBetween(issue, maturity, basis) / year_days;\n    }\n\n    function ACCRINT(issue, first, settl, rate, par, freq, basis, calc) {\n        var accr = 0, cost = par * rate / freq;\n        var brace, prev, next, prev1, next1, nrc;\n\n        var annual = basis % 2 === 0 ? 360 : 365; // only if to >> from, we eventually need to count leap years\n        function _numCoupons(from, to) { // better than COUPNUM(from, to, freq, basis)-1\n            return (to - from)*freq/annual | 0;\n        }\n\n        if (settl <= first) {\n            brace = _borderCoupons(settl, first, freq);\n            prev = brace[0];\n            next = brace[1];\n            if (prev <= issue) {\n                return cost * _daysBetween(issue, settl, basis) / _daysBetween(prev, next, basis);\n            }\n            brace = _borderCoupons(issue, prev, freq);\n            prev1 = brace[0];\n            next1 = brace[1];\n            nrc = _numCoupons(next1, settl); // when settl==next, days are counted implicitly by nrc\n            return cost *\n                (nrc +\n                 _daysBetween(issue, next1, basis) / _daysBetween(prev1, next1, basis) +\n                 (settl < next? _daysBetween(prev, settl, basis) / _daysBetween(prev, next, basis) : 0));\n        } else {\n            brace = _borderCoupons_fw(first, settl, freq);\n            prev = brace[0];\n            next = brace[1];\n            nrc = _numCoupons(first, settl); // COUPNUM(first, settl, freq, basis) - 1;\n            if (next == settl) {\n                accr = cost * nrc;\n            } else {\n                accr = cost * (nrc + _daysBetween(prev, settl, basis) / _daysBetween(prev, next, basis));\n            }\n            if (!calc) { return accr; } // Only the accrued interest between first and settlement dates.\n            brace = _borderCoupons(issue, first, freq); // Add the accrued interest between issue and first dates.\n            prev = brace[0];\n            next = brace[1];\n            nrc = _numCoupons(issue, first);\n            accr += cost * (nrc + _daysBetween(issue, next, basis) / _daysBetween(prev, next, basis));\n            return accr; // accrued interest between issue and settlement dates\n        }\n    }\n\n    //// DISC  the discount rate for a security (given price and redemption values per 100$ face value) ////\n    function DISC(settl, matur, pr, redemption, basis) { // DISC(settlement, maturity, pr, redemption, [basis])\n        var annual = basis % 2 === 0 ? 360 : (isLeapYear(unpackDate(settl).year) ? 366 : 365);\n        return (redemption - pr)/redemption*annual/_daysBetween(settl, matur, basis);\n    }\n\n    //// INTRATE  the interest rate for a fully invested security ////\n    function INTRATE(settl, matur, investment, redemption, basis) { // INTRATE(settlement, maturity, investment, redemption, [basis])\n        var annual = basis % 2 === 0 ? 360 : (isLeapYear(unpackDate(settl).year) ? 366 : 365);\n        return (redemption - investment)/investment*annual/_daysBetween(settl, matur, basis);\n    }\n\n    //// RECEIVED  the amount received at maturity for a fully invested security ////\n    function RECEIVED(settl, matur, investment, discount, basis) { // RECEIVED(settlement, maturity, investment, discount, [basis])\n        var annual = basis % 2 === 0 ? 360 : (isLeapYear(unpackDate(settl).year) ? 366 : 365);\n        return investment/(1 - discount*_daysBetween(settl, matur, basis)/annual);\n    }\n\n    //// PRICE  the price per $100 face value of a security that pays periodic interest ////\n    function PRICE(settl, matur, rate, yld, redemption, freq, basis) { // PRICE(settlement, maturity, rate, yld, redemption, frequency, [basis])\n        var N = 1 + ((matur - settl)*freq/(basis % 2 === 0 ? 360 : 365) | 0); // coupons playable between settlement and maturity dates\n        var brace = _borderCoupons(settl, matur, freq),\n            prev = brace[0], next = brace[1];\n        var beg_settl = _daysBetween(prev, settl, basis),\n            settl_end = _daysBetween(settl, next, basis),\n            beg_end = _daysBetween(prev, next, basis);\n        var den = 100*rate/freq,\n            yf = yld/freq,\n            frac = settl_end / beg_end;\n        if (N == 1) {\n            return (redemption + den)/(1 + frac*yf) - beg_settl / beg_end * den;\n        }\n        return redemption / Math.pow(1 + yf, N-1+frac)\n            + den * Math.pow(1 + yf, 1-N-frac) * (Math.pow(1+yf, N) - 1) / yf\n            - beg_settl / beg_end * den;\n    }\n\n    //// PRICEDISC  the price per $100 face value of a discounted security ////\n    function PRICEDISC(settl, matur, discount, redemption, basis) { // PRICEDISC(settlement, maturity, discount, redemption, [basis])\n        var dsm = _daysBetween(settl, matur, basis),\n            dy = daysInYear(unpackDate(matur).year, basis);\n        return redemption - discount*redemption*dsm/dy;\n    }\n\n    // Used in PEARSON, more could follow.  In some situations Excel appears to silently ignore\n    // missing or non-numeric values, for example if some value in a is missing a corresponding\n    // value in b, then the one in a is going to be ignored as if not present.  Arrays must have the\n    // same number of elements.  I couldn't come up with a good name for this function.\n    function whipNumberArrays(a, b) {\n        for (var i = a.length; --i >= 0;) {\n            if (typeof a[i] != \"number\" || typeof b[i] != \"number\") {\n                a.splice(i, 1);\n                b.splice(i, 1);\n            }\n        }\n    }\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/borderpalette',[ \"kendo.core\", \"kendo.colorpicker\", \"kendo.popup\" ], f);\n})(function(){\n\n    (function(kendo) {\n\n        var $ = kendo.jQuery;\n        var BORDER_TYPES = [\n            \"allBorders\",\n            \"insideBorders\",\n            \"insideHorizontalBorders\",\n            \"insideVerticalBorders\",\n            \"outsideBorders\",\n            \"leftBorder\",\n            \"topBorder\",\n            \"rightBorder\",\n            \"bottomBorder\",\n            \"noBorders\"\n        ];\n\n        var BORDER_PALETTE_MESSAGES = kendo.spreadsheet.messages.borderPalette = {\n            allBorders: \"All borders\",\n            insideBorders: \"Inside borders\",\n            insideHorizontalBorders: \"Inside horizontal borders\",\n            insideVerticalBorders: \"Inside vertical borders\",\n            outsideBorders: \"Outside borders\",\n            leftBorder: \"Left border\",\n            topBorder: \"Top border\",\n            rightBorder: \"Right border\",\n            bottomBorder: \"Bottom border\",\n            noBorders: \"No border\"\n        };\n\n        var COLOR_PICKER_MESSAGES = kendo.spreadsheet.messages.colorPicker = {\n            reset: \"Reset color\",\n            customColor: \"Custom color...\",\n            apply: \"Apply\",\n            cancel: \"Cancel\"\n        };\n\n        function withPreventDefault(f) {\n            return function(e) {\n                e.preventDefault();\n                return f.apply(this, arguments);\n            };\n        }\n\n        var ColorChooser = kendo.ui.Widget.extend({\n            init: function(element, options) {\n                kendo.ui.Widget.call(this, element, options);\n\n                this.element = element;\n                this.color = options.color;\n\n                this._resetButton();\n                this._colorPalette();\n                this._customColorPalette();\n                this._customColorButton();\n\n                this.resetButton.on(\"click\", withPreventDefault(this.resetColor.bind(this)));\n                this.customColorButton.on(\"click\", withPreventDefault(this.customColor.bind(this)));\n            },\n\n            options: {\n                name: \"ColorChooser\"\n            },\n\n            events: [\n                \"change\"\n            ],\n\n            destroy: function() {\n                kendo.unbind(this.dialog.element.find(\".k-action-buttons\"));\n                this.dialog.destroy();\n                this.colorPalette.destroy();\n                this.resetButton.off(\"click\");\n                this.customColorButton.off(\"click\");\n            },\n\n            value: function(value) {\n                if (value !== undefined) {\n                    this.color = value;\n                    this.customColorButton.find(\".k-icon\").css(\"background-color\", this.color);\n                    this.colorPalette.value(null);\n                    this.flatColorPicker.value(this.color);\n                } else {\n                    return this.color;\n                }\n            },\n\n            _change: function(value) {\n                this.color = value;\n                this.trigger(\"change\", { value: value });\n            },\n\n            _colorPalette: function() {\n                var element = $(\"<div />\", {\n                    \"class\": \"k-spreadsheet-color-palette\"\n                });\n\n                var colorPalette = this.colorPalette = $(\"<div />\").kendoColorPalette({\n                    palette: [ //metro palette\n                        \"#ffffff\", \"#000000\", \"#d6ecff\", \"#4e5b6f\", \"#7fd13b\", \"#ea157a\", \"#feb80a\", \"#00addc\", \"#738ac8\", \"#1ab39f\",\n                        \"#f2f2f2\", \"#7f7f7f\", \"#a7d6ff\", \"#d9dde4\", \"#e5f5d7\", \"#fad0e4\", \"#fef0cd\", \"#c5f2ff\", \"#e2e7f4\", \"#c9f7f1\",\n                        \"#d8d8d8\", \"#595959\", \"#60b5ff\", \"#b3bcca\", \"#cbecb0\", \"#f6a1c9\", \"#fee29c\", \"#8be6ff\", \"#c7d0e9\", \"#94efe3\",\n                        \"#bfbfbf\", \"#3f3f3f\", \"#007dea\", \"#8d9baf\", \"#b2e389\", \"#f272af\", \"#fed46b\", \"#51d9ff\", \"#aab8de\", \"#5fe7d5\",\n                        \"#a5a5a5\", \"#262626\", \"#003e75\", \"#3a4453\", \"#5ea226\", \"#af0f5b\", \"#c58c00\", \"#0081a5\", \"#425ea9\", \"#138677\",\n                        \"#7f7f7f\", \"#0c0c0c\", \"#00192e\", \"#272d37\", \"#3f6c19\", \"#750a3d\", \"#835d00\", \"#00566e\", \"#2c3f71\", \"#0c594f\"\n                    ],\n                    value: this.color,\n                    change: function(e) {\n                        this.customColorButton.find(\".k-icon\").css(\"background-color\", \"transparent\");\n                        this.flatColorPicker.value(null);\n                        this._change(e.value);\n                    }.bind(this)\n                }).data(\"kendoColorPalette\");\n\n                element\n                    .append(colorPalette.wrapper)\n                    .appendTo(this.element);\n            },\n\n            _customColorPalette: function() {\n                var element = $(\"<div />\", {\n                    \"class\": \"k-spreadsheet-window\",\n                    \"html\": \"<div></div>\" +\n                            \"<div class='k-action-buttons'>\" +\n                                \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-\" + kendo.ns + \"bind='click: apply'><span class='k-button-text'>\" + COLOR_PICKER_MESSAGES.apply + \"</span></button>\" +\n                                \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base' data-\" + kendo.ns + \"bind='click: close'><span class='k-button-text'>\" + COLOR_PICKER_MESSAGES.cancel + \"</span></button>\" +\n                            \"</div>\"\n                });\n\n                var dialog = this.dialog = element.appendTo(document.body).kendoWindow({\n                    animation: false,\n                    scrollable: false,\n                    resizable: false,\n                    maximizable: false,\n                    modal: true,\n                    visible: false,\n                    width: \"auto\",\n                    open: function() {\n                        this.center();\n                    }\n                }).data(\"kendoWindow\");\n\n                dialog.one(\"activate\", function() {\n                    this.element.find(\"[\" + kendo.attr(\"role\") + \"=flatcolorpicker]\").data(\"kendoFlatColorPicker\")._view._hueSlider.resize();\n                });\n\n                var flatColorPicker = this.flatColorPicker = dialog.element.children().first().kendoFlatColorPicker().data(\"kendoFlatColorPicker\");\n\n                var viewModel = kendo.observable({\n                    apply: function() {\n                        this.customColorButton.find(\".k-icon\").css(\"background-color\", flatColorPicker.value());\n                        this.colorPalette.value(null);\n                        this._change(flatColorPicker.value());\n                        dialog.close();\n                    }.bind(this),\n                    close: function() {\n                        flatColorPicker.value(null);\n                        dialog.close();\n                    }\n                });\n\n                kendo.bind(dialog.element.find(\".k-action-buttons\"), viewModel);\n            },\n\n            _resetButton: function() {\n                this.resetButton = $(\"<a role='button' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-reset-color' href='#'>\" +\n                                    \"<span class='k-button-icon k-icon k-i-reset-color'></span>\" +\n                                    '<span class=\"k-button-text\">' + COLOR_PICKER_MESSAGES.reset + '</span>' +\n                                   \"</a>\").appendTo(this.element);\n            },\n\n            _customColorButton: function() {\n                this.customColorButton = $(\"<a role='button' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-custom-color' href='#'>\" +\n                                            \"<span class='k-button-icon k-icon'></span>\" +\n                                            '<span class=\"k-button-text\">' + COLOR_PICKER_MESSAGES.customColor + '</span>' +\n                                           \"</a>\").appendTo(this.element);\n            },\n\n            resetColor: function() {\n                this.colorPalette.value(null);\n                this.flatColorPicker.value(null);\n                this._change(null);\n            },\n\n            customColor: function() {\n                this.dialog.open();\n            }\n\n        });\n\n        var BorderPalette = kendo.ui.Widget.extend({\n            init: function(element, options) {\n                kendo.ui.Widget.call(this, element, options);\n\n                this.element = element;\n                this.color = \"#000\";\n\n                this.element.addClass(\"k-spreadsheet-border-palette\");\n\n                this._borderTypePalette();\n                this._borderColorPalette();\n\n                this.element.on(\"click\", \".k-spreadsheet-border-type-palette .k-button\", withPreventDefault(this._click.bind(this)));\n            },\n\n            options: {\n                name: \"BorderPalette\"\n            },\n\n            events: [\n                \"change\"\n            ],\n\n            destroy: function() {\n                this.colorChooser.destroy();\n                this.element.off(\"click\");\n            },\n\n            _borderTypePalette: function() {\n                var messages = BORDER_PALETTE_MESSAGES;\n                var buttons = BORDER_TYPES.map(function(type) {\n                    return '<a role=\"button\" title=\"' + messages[type] + '\" aria-label=\"' + messages[type] + '\" href=\"#\" data-border-type=\"' + type + '\" class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-icon-button\">' +\n                                '<span class=\"k-button-icon k-icon k-i-' + kendo.toHyphens(type) + '\"></span>' +\n                           '</a>';\n                }).join(\"\");\n\n                var element = $(\"<div />\", {\n                    \"class\": \"k-spreadsheet-border-type-palette\",\n                    \"html\": buttons\n                });\n\n                element.appendTo(this.element);\n            },\n\n            _borderColorPalette: function() {\n                var element = $(\"<div />\", {\n                    \"class\": \"k-spreadsheet-border-color-palette\"\n                });\n\n                element.appendTo(this.element);\n\n                this.colorChooser = new ColorChooser(element, {\n                    color: this.color,\n                    change: this._colorChange.bind(this)\n                });\n            },\n\n            _click: function(e) {\n                this.type = $(e.currentTarget).data(\"borderType\");\n                this.trigger(\"change\", { type: this.type, color: this.color });\n            },\n\n            _colorChange: function(e) {\n                this.color = e.value;\n                if (this.type) {\n                    this.trigger(\"change\", { type: this.type, color: this.color });\n                }\n            }\n        });\n\n        kendo.spreadsheet.ColorChooser = ColorChooser;\n        kendo.spreadsheet.BorderPalette = BorderPalette;\n\n    })(window.kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/toolbar',[ \"kendo.toolbar\", \"kendo.colorpicker\", \"kendo.combobox\", \"kendo.dropdownlist\", \"kendo.popup\", \"./borderpalette\" ], f);\n})(function(){\n\n(function(kendo) {\n\n\n\n    var $ = kendo.jQuery;\n\n    var ToolBar = kendo.ui.ToolBar;\n\n    var MESSAGES = kendo.spreadsheet.messages.toolbar = {\n        addColumnLeft: \"Add column left\",\n        addColumnRight: \"Add column right\",\n        addRowAbove: \"Add row above\",\n        addRowBelow: \"Add row below\",\n        alignment: \"Alignment\",\n        alignmentButtons: {\n            justtifyLeft: \"Align left\",\n            justifyCenter: \"Center\",\n            justifyRight: \"Align right\",\n            justifyFull: \"Justify\",\n            alignTop: \"Align top\",\n            alignMiddle: \"Align middle\",\n            alignBottom: \"Align bottom\"\n        },\n        backgroundColor: \"Background\",\n        bold: \"Bold\",\n        borders: \"Borders\",\n        copy: \"Copy\",\n        cut: \"Cut\",\n        deleteColumn: \"Delete column\",\n        deleteRow: \"Delete row\",\n        filter: \"Filter\",\n        fontFamily: \"Font\",\n        fontSize: \"Font size\",\n        format: \"Custom format...\",\n        formatTypes: {\n            automatic: \"Automatic\",\n            text: \"Text\",\n            number: \"Number\",\n            percent: \"Percent\",\n            financial: \"Financial\",\n            currency: \"Currency\",\n            date: \"Date\",\n            time: \"Time\",\n            dateTime: \"Date time\",\n            duration: \"Duration\",\n            moreFormats: \"More formats...\"\n        },\n        formatDecreaseDecimal: \"Decrease decimal\",\n        formatIncreaseDecimal: \"Increase decimal\",\n        freeze: \"Freeze panes\",\n        freezeButtons: {\n            freezePanes: \"Freeze panes\",\n            freezeRows: \"Freeze rows\",\n            freezeColumns: \"Freeze columns\",\n            unfreeze: \"Unfreeze panes\"\n        },\n        insertComment: \"Insert comment\",\n        insertImage: \"Insert image\",\n        italic: \"Italic\",\n        merge: \"Merge cells\",\n        mergeButtons: {\n            mergeCells: \"Merge all\",\n            mergeHorizontally: \"Merge horizontally\",\n            mergeVertically: \"Merge vertically\",\n            unmerge: \"Unmerge\"\n        },\n        open: \"Open...\",\n        paste: \"Paste\",\n        quickAccess: {\n            redo: \"Redo\",\n            undo: \"Undo\"\n        },\n        exportAs: \"Export...\",\n        toggleGridlines: \"Toggle gridlines\",\n        sort: \"Sort\",\n        sortButtons: {\n            // sortSheetAsc: \"Sort sheet A to Z\",\n            // sortSheetDesc: \"Sort sheet Z to A\",\n            sortRangeAsc: \"Sort range A to Z\",\n            sortRangeDesc: \"Sort range Z to A\"\n        },\n        textColor: \"Text Color\",\n        textWrap: \"Wrap text\",\n        underline: \"Underline\",\n        validation: \"Data validation...\",\n        hyperlink: \"Link\"\n    };\n\n    var defaultTools = {\n        home: [\n            \"open\",\n            \"exportAs\",\n            [ \"cut\", \"copy\", \"paste\" ],\n            [ \"bold\", \"italic\", \"underline\" ], \"hyperlink\", \"insertComment\", \"insertImage\",\n            \"backgroundColor\", \"textColor\",\n            \"borders\",\n            \"fontSize\", \"fontFamily\",\n            \"alignment\",\n            \"textWrap\",\n            [ \"formatDecreaseDecimal\", \"formatIncreaseDecimal\" ],\n            \"format\",\n            \"merge\",\n            \"freeze\",\n            \"filter\",\n            \"toggleGridlines\"\n        ],\n        insert: [\n            [ \"addColumnLeft\", \"addColumnRight\", \"addRowBelow\", \"addRowAbove\" ],\n            [ \"deleteColumn\", \"deleteRow\" ]\n        ],\n        data: [\n            \"sort\",\n            \"filter\",\n            \"validation\"\n        ]\n    };\n\n    var toolDefaults = {\n        //home tab\n        open:                  { type: \"open\",                                     overflow: \"never\",                          iconClass: \"file-excel\" },\n        exportAs:              { type: \"exportAsDialog\", dialogName: \"exportAs\",   overflow: \"never\",       text: \"\",        iconClass: \"file-excel\" },\n        bold:                  { type: \"button\", command: \"PropertyChangeCommand\", property: \"bold\",          value: true,     iconClass: \"bold\", togglable: true },\n        italic:                { type: \"button\", command: \"PropertyChangeCommand\", property: \"italic\",        value: true,     iconClass: \"italic\", togglable: true },\n        underline:             { type: \"button\", command: \"PropertyChangeCommand\", property: \"underline\",     value: true,     iconClass: \"underline\", togglable: true },\n        formatDecreaseDecimal: { type: \"button\", command: \"AdjustDecimalsCommand\",                            value: -1,       iconClass: \"decimal-decrease\" },\n        formatIncreaseDecimal: { type: \"button\", command: \"AdjustDecimalsCommand\",                            value: +1,       iconClass: \"decimal-increase\" },\n        textWrap:              { type: \"button\", command: \"TextWrapCommand\",       property: \"wrap\",          value: true,     iconClass: \"text-wrap\", togglable: true },\n        cut:                   { type: \"button\", command: \"ToolbarCutCommand\",                                                 iconClass: \"cut\" },\n        copy:                  { type: \"button\", command: \"ToolbarCopyCommand\",                                                iconClass: \"copy\" },\n        paste:                 { type: \"button\", command: \"ToolbarPasteCommand\",                                               iconClass: \"paste\" },\n        separator:             { type: \"separator\" },\n        alignment:             { type: \"alignment\",                           iconClass: \"align-left\" },\n        backgroundColor:       { type: \"colorPicker\", property: \"background\", iconClass: \"paint\" },\n        textColor:             { type: \"colorPicker\", property: \"color\",      iconClass: \"foreground-color\" },\n        fontFamily:            { type: \"fontFamily\",  property: \"fontFamily\", iconClass: \"font-family\" },\n        fontSize:              { type: \"fontSize\",    property: \"fontSize\",   iconClass: \"font-size\" },\n        format:                { type: \"format\",      property: \"format\",     iconClass: \"custom-format\" },\n        filter:                { type: \"filter\",      property: \"hasFilter\",  iconClass: \"filter\" },\n        merge:                 { type: \"merge\",                               iconClass: \"cells-merge\" },\n        freeze:                { type: \"freeze\",                              iconClass: \"pane-freeze\" },\n        borders:               { type: \"borders\",                             iconClass: \"borders-all\" },\n        formatCells:           { type: \"dialog\", dialogName: \"formatCells\", overflow: \"never\" },\n        hyperlink:             { type: \"dialog\", dialogName: \"hyperlink\", iconClass: \"link-horizontal\", overflow: \"never\", text: \"\" },\n        toggleGridlines:       { type: \"button\", command: \"GridLinesChangeCommand\", property: \"gridLines\", value: true, iconClass: \"border-no\", togglable: true },\n        insertComment:         { type: \"dialog\", dialogName: \"insertComment\", property: \"comment\", togglable: true, overflow: \"never\", iconClass: \"comment\", text: \"\" },\n        insertImage:           { type: \"dialog\", dialogName: \"insertImage\", overflow: \"never\", iconClass: \"image\", text: \"\" },\n\n        //insert tab\n        addColumnLeft:         { type: \"button\", command: \"AddColumnCommand\",    value: \"left\",  iconClass: \"table-column-insert-left\"  },\n        addColumnRight:        { type: \"button\", command: \"AddColumnCommand\",    value: \"right\", iconClass: \"table-column-insert-right\" },\n        addRowBelow:           { type: \"button\", command: \"AddRowCommand\",       value: \"below\", iconClass: \"table-row-insert-below\"    },\n        addRowAbove:           { type: \"button\", command: \"AddRowCommand\",       value: \"above\", iconClass: \"table-row-insert-above\"    },\n        deleteColumn:          { type: \"button\", command: \"DeleteColumnCommand\",                 iconClass: \"table-column-delete\"    },\n        deleteRow:             { type: \"button\", command: \"DeleteRowCommand\",                    iconClass: \"table-row-delete\"       },\n\n        //data tab\n        sort:                  { type: \"sort\", iconClass: \"sort-desc\" },\n        validation:            { type: \"dialog\", dialogName: \"validation\", iconClass: \"exception\", overflow: \"never\" }\n    };\n\n    var SpreadsheetToolBar = ToolBar.extend({\n        init: function(element, options) {\n            options.items = this._expandTools(options.tools || SpreadsheetToolBar.prototype.options.tools[options.toolbarName]);\n\n            ToolBar.fn.init.call(this, element, options);\n            var handleClick = this._click.bind(this);\n\n            this.element.addClass(\"k-spreadsheet-toolbar\");\n\n            this._addSeparators(this.element);\n\n            this.element.on(\"focusout\", function () {\n                $(this).find(\".k-toolbar-first-visible\").removeClass(\"k-focus\");\n            });\n\n            this.bind({\n                click: handleClick,\n                toggle: handleClick\n            });\n        },\n        _nextTool: function (direction) {\n            var that = this;\n            var tools = that.element.find(\".k-dropdownlist, .k-combobox, .k-button, .k-button-group > a\").not(\"[tabindex=-1]\");\n            var activeIndex = tools.index($(document.activeElement).closest(\".k-dropdownlist, .k-combobox, .k-button, .k-button-group > a\").not(\"[tabindex=-1]\"));\n            if (activeIndex > 0) {\n                return tools[activeIndex + direction];\n            }\n        },\n        _addSeparators: function(element) {\n            var groups = element.children(\".k-dropdownlist, .k-combobox, a.k-button, .k-button-group\");\n\n            groups.before(\"<span class='k-separator'></span>\");\n        },\n        _expandTools: function(tools) {\n            function expandTool(toolName) {\n                // expand string to object, add missing tool properties\n                var options = $.isPlainObject(toolName) ? toolName : toolDefaults[toolName] || {};\n                var spriteCssClass = \"k-icon k-i-\" + options.iconClass;\n                var type = options.type;\n                var typeDefaults = {\n                    button: {\n                        showText: \"overflow\"\n                    },\n                    colorPicker: {\n                        toolIcon: spriteCssClass,\n                        spriteCssClass: spriteCssClass\n                    },\n                    borders: { spriteCssClass: spriteCssClass },\n                    alignment:  { spriteCssClass: spriteCssClass },\n                    merge:  { spriteCssClass: spriteCssClass },\n                    freeze:  { spriteCssClass: spriteCssClass }\n                };\n\n                var tool = kendo.deepExtend({\n                    name: options.name || toolName,\n                    text: MESSAGES[options.name || toolName],\n                    icon: options.iconClass,\n                    attributes: {\n                        title: MESSAGES[options.name || toolName],\n                        \"aria-label\":   MESSAGES[options.name || toolName]\n                    }\n                }, typeDefaults[type], options);\n\n                if (type == \"splitButton\") {\n                    tool.menuButtons = tool.menuButtons.map(expandTool);\n                }\n\n                if(tool.name === \"fontSize\" || toolName === \"fontSize\") {\n                    tool.attributes[\"aria-label\"] = null;\n                }\n\n                tool.attributes[\"data-tool\"] = toolName;\n\n                if (options.property) {\n                    tool.attributes[\"data-property\"] = options.property;\n                }\n\n                return tool;\n            }\n\n            return tools.reduce(function(tools, tool) {\n                if (Array.isArray(tool)) {\n                    tools.push({ type: \"buttonGroup\", buttons: tool.map(expandTool) });\n                } else {\n                    tools.push(expandTool.call(this, tool));\n                }\n\n                return tools;\n            }, []);\n        },\n        _click: function(e) {\n            var toolName = e.target.attr(\"data-tool\");\n            var tool = toolDefaults[toolName] || {};\n            var commandType = tool.command;\n\n            if (!commandType) {\n                return;\n            }\n\n            var args = {\n                command: commandType,\n                options: {\n                    property: tool.property || null,\n                    value: tool.value || null\n                }\n            };\n\n            if (typeof args.options.value === \"boolean\") {\n                args.options.value = e.checked ? true : null;\n            }\n\n            this.action(args);\n        },\n        events: [\n            \"click\",\n            \"toggle\",\n            \"open\",\n            \"close\",\n            \"overflowOpen\",\n            \"overflowClose\",\n\n            \"action\",\n            \"dialog\"\n        ],\n        options: {\n            name: \"SpreadsheetToolBar\",\n            resizable: true,\n            tools: defaultTools\n        },\n        action: function(args) {\n            this.trigger(\"action\", args);\n        },\n        dialog: function(args) {\n            this.trigger(\"dialog\", args);\n        },\n        refresh: function(activeCell) {\n            var range = activeCell;\n            var tools = this._tools();\n\n            function setToggle(tool, value) {\n                var toolbar = tool.toolbar;\n                var overflow = tool.overflow;\n                var togglable = (toolbar && toolbar.options.togglable) ||\n                                 (overflow && overflow.options.togglable);\n\n                if (!togglable) {\n                    return;\n                }\n\n                var toggle = false;\n\n                if (typeof value === \"boolean\") {\n                    toggle = value;\n                } else if (typeof value === \"string\") {\n                    if (toolbar.options.hasOwnProperty(\"value\")) {\n                        toggle = toolbar.options.value === value;\n                    } else {\n                        // if no value is specified in the tool\n                        // options, assume it should be ON if the\n                        // range value is not null, and OFF otherwise.\n                        toggle = value != null;\n                    }\n                }\n\n                toolbar.toggle(toggle);\n\n                if (overflow) {\n                    overflow.toggle(toggle);\n                }\n            }\n\n            function update(tool, value) {\n                var toolbar = tool.toolbar;\n                var overflow = tool.overflow;\n                var selection, enabled;\n\n                if (toolbar && toolbar.update) {\n                    toolbar.update(value);\n                }\n\n                if (overflow && overflow.update) {\n                    overflow.update(value);\n                }\n\n                if (tool.type == \"filter\") {\n                    selection = range.sheet().selection();\n\n                    if (selection && selection._ref && selection._ref.height) {\n                        enabled = value || selection._ref.height() > 1;\n                        toolbar.enable(enabled);\n                        overflow.enable(enabled);\n                    }\n                }\n            }\n\n            for (var i = 0; i < tools.length; i++) {\n                var property = tools[i].property;\n                var tool = tools[i].tool;\n                var value = kendo.isFunction(range[property]) ? range[property]() : range;\n\n                if (property == \"gridLines\") {\n                    // the law of leaky abstractions kicks in.  this\n                    // isn't really a property of the range, it's\n                    // per-sheet.\n                    value = range.sheet().showGridLines();\n                }\n\n                if (tool.type === \"button\") {\n                    setToggle(tool, value);\n                } else {\n                    update(tool, value);\n                }\n            }\n            this.resize();\n        },\n        _tools: function() {\n            return this.element.find(\"[data-property]\").toArray().map(function(element) {\n                element = $(element);\n                return {\n                    property: element.attr(\"data-property\"),\n                    tool: this._getItem(element)\n                };\n            }.bind(this));\n        },\n        destroy: function() {\n            // TODO: move to ToolBar.destroy to take care of these\n            this.element.find(\"[data-command],.k-button\").each(function() {\n                var element = $(this);\n                var instance = element.data(\"instance\");\n                if (instance && instance.destroy) {\n                    instance.destroy();\n                }\n            });\n\n            ToolBar.fn.destroy.call(this);\n        }\n    });\n    kendo.spreadsheet.ToolBar = SpreadsheetToolBar;\n\n    var DropDownTool = kendo.toolbar.TemplateItem.extend({\n        init: function(options, toolbar) {\n            var dropDownList = $(\"<select />\")\n                .attr(\"title\", options.attributes.title)\n                .attr(\"aria-label\", options.attributes.title)\n                .kendoDropDownList({\n                    height: \"auto\",\n                    autoWidth: true\n                }).data(\"kendoDropDownList\");\n\n            this.dropDownList = dropDownList;\n\n            delete options.attributes[\"aria-label\"];\n\n            kendo.toolbar.TemplateItem.fn.init.call(this, dropDownList.wrapper, options, toolbar);\n\n            dropDownList.bind(\"open\", this._open.bind(this));\n            dropDownList.bind(\"change\", this._change.bind(this));\n\n            this.element.parent(\".k-toolbar-item\").width(options.width).attr({\n                \"data-command\": \"PropertyChangeCommand\",\n                \"data-property\": options.property\n            });\n        },\n        _open: function() {\n            var ddl = this.dropDownList;\n            var list = ddl.list;\n            var listWidth;\n\n            list.css({\n                whiteSpace: \"nowrap\",\n                width: \"auto\"\n            });\n\n            listWidth = list.width();\n\n            if (listWidth > 0) {\n                listWidth += 20;\n            } else {\n                listWidth = ddl._listWidth;\n            }\n\n            list.css(\"width\", listWidth + kendo.support.scrollbar());\n\n            ddl._listWidth = listWidth;\n        },\n        _change: function(e) {\n            var that = this;\n            var instance = e.sender;\n            var value = instance.value();\n            var dataItem = instance.dataItem();\n            var popupName = dataItem ? dataItem.popup : undefined;\n\n            if (popupName) {\n                setTimeout(function () {\n                    that.toolbar.dialog({ name: popupName });\n                });\n            } else {\n                that.toolbar.action({\n                    command: \"PropertyChangeCommand\",\n                    options: {\n                        property: this.options.property,\n                        value: value == \"null\" ? null : value\n                    }\n                });\n            }\n        },\n        value: function(value) {\n            if (value !== undefined) {\n                this.dropDownList.value(value);\n            } else {\n                return this.dropDownList.value();\n            }\n        }\n    });\n\n    var PopupTool = kendo.toolbar.Item.extend({\n        init: function(options, toolbar) {\n            this.element = $(\"<a role='button' href='#' class='k-button k-button-md k-rounded-md  k-button-solid k-button-solid-base'>\" +\n                                \"<span class='k-button-icon k-icon \" + options.spriteCssClass + \"'></span>\" +\n                                \"<span class='k-button-text'><span class='k-icon k-i-arrow-s'></span></span>\" +\n                            \"</a>\");\n\n            this.element\n                .on(\"click touchend\", this.open.bind(this))\n                .attr(\"data-command\", options.command);\n\n            this.options = options;\n            this.toolbar = toolbar;\n\n            this.attributes();\n            this.addUidAttr();\n            this.addOverflowAttr();\n\n            this._popup();\n        },\n        destroy: function() {\n            this.popup.destroy();\n        },\n        open: function(ev) {\n            ev.preventDefault();\n            this.popup.toggle();\n        },\n        _popup: function() {\n            var element = this.element;\n\n            this.popup = $(\"<div class='k-spreadsheet-popup' />\").appendTo(element).kendoPopup({\n                anchor: element\n            }).data(\"kendoPopup\");\n        }\n    });\n\n    kendo.toolbar.registerComponent(\"dialog\", kendo.toolbar.ToolBarButton.extend({\n        init: function(options, toolbar) {\n            kendo.toolbar.ToolBarButton.fn.init.call(this, options, toolbar);\n\n            this._dialogName = options.dialogName;\n\n            this.element.on(\"click touchend\", this.open.bind(this))\n                        .data(\"instance\", this);\n        },\n        open: function() {\n            this.toolbar.dialog({ name: this._dialogName });\n        }\n    }));\n\n    kendo.toolbar.registerComponent(\"exportAsDialog\", kendo.toolbar.Item.extend({\n        init: function(options, toolbar) {\n            this._dialogName = options.dialogName;\n\n            this.toolbar = toolbar;\n            this._title = options.attributes.title;\n            this.element = $(\"<button type='button' role='button' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-icon-button'>\" +\n                                 \"<span class='k-button-icon k-icon k-i-download'></span>\" +\n                             \"</button>\")\n                             .attr(\"title\", this._title)\n                             .attr(\"aria-label\", this._title)\n                             .data(\"instance\", this);\n\n            this.element.on(\"click\", this.open.bind(this))\n                        .data(\"instance\", this);\n        },\n        open: function() {\n            this.toolbar.dialog({ name: this._dialogName });\n        }\n    }));\n\n    var OverflowDialogButton = kendo.toolbar.OverflowButton.extend({\n        init: function(options, toolbar) {\n            kendo.toolbar.OverflowButton.fn.init.call(this, options, toolbar);\n\n            this.element.on(\"click touchend\", this._click.bind(this));\n\n            this.message = this.options.text;\n\n            var instance = this.element.data(\"button\");\n            this.element.data(this.options.type, instance);\n        },\n        _click: $.noop\n    });\n\n    var ColorPicker = PopupTool.extend({\n        init: function(options, toolbar) {\n            PopupTool.fn.init.call(this, options, toolbar);\n            this.popup.element.addClass(\"k-spreadsheet-colorpicker\");\n\n            this.colorChooser = new kendo.spreadsheet.ColorChooser(this.popup.element, {\n                change: this._colorChange.bind(this)\n            });\n\n            this.element.attr({\n                \"data-property\": options.property\n            });\n\n            this.element.data({\n                type: \"colorPicker\",\n                colorPicker: this,\n                instance: this\n            });\n        },\n        destroy: function() {\n            this.colorChooser.destroy();\n            PopupTool.fn.destroy.call(this);\n        },\n        update: function(value) {\n            this.value(value);\n        },\n        value: function(value) {\n            this.colorChooser.value(value);\n        },\n        _colorChange: function(e) {\n            this.toolbar.action({\n                command: \"PropertyChangeCommand\",\n                options: {\n                    property: this.options.property,\n                    value: e.sender.value()\n                }\n            });\n            this.popup.close();\n        }\n    });\n\n    var ColorPickerButton = OverflowDialogButton.extend({\n        init: function(options, toolbar) {\n            options.iconName = \"text\";\n            OverflowDialogButton.fn.init.call(this, options, toolbar);\n        },\n        _click: function() {\n            this.toolbar.dialog({\n                name: \"colorPicker\",\n                options: {\n                    title: this.options.property, property: this.options.property\n                }\n            });\n        }\n    });\n\n    kendo.toolbar.registerComponent(\"colorPicker\", ColorPicker, ColorPickerButton);\n\n    var FONT_SIZES = [8, 9, 10, 11, 12, 13, 14, 16, 18, 20, 22, 24, 26, 28, 36, 48, 72];\n    var DEFAULT_FONT_SIZE = 12;\n\n    var FontSize = kendo.toolbar.TemplateItem.extend({\n        init: function(options, toolbar) {\n            var comboBox = $(\"<input />\")\n                .attr(\"aria-label\", options.attributes.title)\n                .attr(\"title\", options.attributes.title)\n                .kendoComboBox({\n                    change: this._valueChange.bind(this),\n                    clearButton: false,\n                    dataSource: options.fontSizes || FONT_SIZES,\n                    value: DEFAULT_FONT_SIZE\n                }).data(\"kendoComboBox\");\n\n            this.comboBox = comboBox;\n\n            kendo.toolbar.TemplateItem.fn.init.call(this, comboBox.wrapper, options, toolbar);\n\n            this.element.width(options.width).attr({\n                \"data-command\": \"PropertyChangeCommand\",\n                \"data-property\": options.property\n            });\n\n            this.element.data({\n                type: \"fontSize\",\n                fontSize: this\n            });\n        },\n\n        _valueChange: function(e) {\n            this.toolbar.action({\n                command: \"PropertyChangeCommand\",\n                options: {\n                    property: this.options.property,\n                    value: kendo.parseInt(e.sender.value())\n                }\n            });\n        },\n\n        update: function(value) {\n            this.value(kendo.parseInt(value) || DEFAULT_FONT_SIZE);\n        },\n\n        value: function(value) {\n            if (value !== undefined) {\n                this.comboBox.value(value);\n            } else {\n                return this.comboBox.value();\n            }\n        }\n    });\n\n    var FontSizeButton = OverflowDialogButton.extend({\n        _click: function() {\n            this.toolbar.dialog({\n                name: \"fontSize\",\n                options: {\n                    sizes: FONT_SIZES,\n                    defaultSize: DEFAULT_FONT_SIZE\n                }\n            });\n        },\n        update: function(value) {\n            this._value = value || DEFAULT_FONT_SIZE;\n            this.element.find(\".k-button-text\").text(this.message + \" (\" + this._value + \") ...\");\n        }\n    });\n\n    kendo.toolbar.registerComponent(\"fontSize\", FontSize, FontSizeButton);\n\n    var FONT_FAMILIES = [\"Arial\", \"Courier New\", \"Georgia\", \"Times New Roman\", \"Trebuchet MS\", \"Verdana\"];\n    var DEFAULT_FONT_FAMILY = \"Arial\";\n\n    var FontFamily = DropDownTool.extend({\n        init: function(options, toolbar) {\n            DropDownTool.fn.init.call(this, options, toolbar);\n\n            var ddl = this.dropDownList;\n            ddl.setDataSource(options.fontFamilies || FONT_FAMILIES);\n            ddl.value(DEFAULT_FONT_FAMILY);\n\n            this.element.data({\n                type: \"fontFamily\",\n                fontFamily: this\n            });\n        },\n        update: function(value) {\n            this.value(value || DEFAULT_FONT_FAMILY);\n        }\n    });\n\n    var FontFamilyButton = OverflowDialogButton.extend({\n        _click: function() {\n            this.toolbar.dialog({\n                name: \"fontFamily\",\n                options: {\n                    fonts: FONT_FAMILIES,\n                    defaultFont: DEFAULT_FONT_FAMILY\n                }\n            });\n        },\n        update: function(value) {\n            this._value = value || DEFAULT_FONT_FAMILY;\n            this.element.find(\".k-button-text\").text(this.message + \" (\" + this._value + \") ...\");\n        }\n    });\n\n    kendo.toolbar.registerComponent(\"fontFamily\", FontFamily, FontFamilyButton);\n\n    var defaultFormats = kendo.spreadsheet.formats = {\n        automatic: null,\n        text: \"@\",\n        number: \"#,0.00\",\n        percent: \"0.00%\",\n        financial: '_(\"$\"* #,##0.00_);_(\"$\"* (#,##0.00);_(\"$\"* \"-\"??_);_(@_)',\n        currency: \"$#,##0.00;[Red]$#,##0.00\",\n        date: \"m/d/yyyy\",\n        time: \"h:mm:ss AM/PM\",\n        dateTime: \"m/d/yyyy h:mm\",\n        duration: \"[h]:mm:ss\"\n    };\n\n    var Format = DropDownTool.extend({\n        _revertTitle: function(e) {\n            e.sender.value(\"\");\n            e.sender.wrapper.width(\"auto\");\n        },\n        init: function(options, toolbar) {\n            DropDownTool.fn.init.call(this, options, toolbar);\n\n            var ddl = this.dropDownList;\n            var icon = \"<span class='k-icon k-i-\" + options.iconClass + \"' style='line-height: 1em; width: 1.35em;'></span>\";\n            ddl.bind(\"change\", this._revertTitle.bind(this));\n            ddl.bind(\"dataBound\", this._revertTitle.bind(this));\n            ddl.setOptions({\n                dataValueField: \"format\",\n                dataTextField: \"name\",\n                dataValuePrimitive: true,\n                valueTemplate: icon,\n                template:\n                    \"# if (data.sample) { #\" +\n                        \"<span class='k-spreadsheet-sample'>#: data.sample #</span>\" +\n                    \"# } #\" +\n                    \"#: data.name #\"\n            });\n            ddl.text(icon);\n            ddl.setDataSource([\n                { format: defaultFormats.automatic, name: MESSAGES.formatTypes.automatic },\n                { format: defaultFormats.text, name: MESSAGES.formatTypes.text },\n                { format: defaultFormats.number, name: MESSAGES.formatTypes.number , sample: \"1,499.99\" },\n                { format: defaultFormats.percent, name: MESSAGES.formatTypes.percent , sample: \"14.50%\" },\n                { format: defaultFormats.financial, name: MESSAGES.formatTypes.financial , sample: \"(1,000.12)\" },\n                { format: defaultFormats.currency, name: MESSAGES.formatTypes.currency , sample: \"$1,499.99\" },\n                { format: defaultFormats.date, name: MESSAGES.formatTypes.date , sample: \"4/21/2012\" },\n                { format: defaultFormats.time, name: MESSAGES.formatTypes.time , sample: \"5:49:00 PM\" },\n                { format: defaultFormats.dateTime, name: MESSAGES.formatTypes.dateTime , sample: \"4/21/2012 5:49:00\" },\n                { format: defaultFormats.duration, name: MESSAGES.formatTypes.duration , sample: \"168:05:00\" },\n                { popup: \"formatCells\", name: MESSAGES.formatTypes.moreFormats }\n            ]);\n\n            this.element.data({\n                type: \"format\",\n                format: this\n            });\n\n            ddl.wrapper.find(\"[role='option']\").attr(\"aria-label\", \"Select format\");\n        }\n    });\n\n    var FormatButton = OverflowDialogButton.extend({\n        _click: function() {\n            this.toolbar.dialog({ name: \"formatCells\" });\n        }\n    });\n\n    kendo.toolbar.registerComponent(\"format\", Format, FormatButton);\n\n    var BorderChangeTool = PopupTool.extend({\n        init: function(options, toolbar) {\n            PopupTool.fn.init.call(this, options, toolbar);\n            this._borderPalette();\n\n            this.element.data({\n                type: \"borders\",\n                instance: this\n            });\n        },\n        destroy: function() {\n            this.borderPalette.destroy();\n            PopupTool.fn.destroy.call(this);\n        },\n        _borderPalette: function() {\n            var element = $(\"<div />\").appendTo(this.popup.element);\n            this.borderPalette = new kendo.spreadsheet.BorderPalette(element, {\n                change: this._action.bind(this)\n            });\n        },\n        _action: function(e) {\n            this.toolbar.action({\n                command: \"BorderChangeCommand\",\n                options: {\n                    border: e.type,\n                    style: { size: 1, color: e.color }\n                }\n            });\n        }\n    });\n\n    var BorderChangeButton = OverflowDialogButton.extend({\n        _click: function() {\n            this.toolbar.dialog({ name: \"borders\" });\n        }\n    });\n\n    kendo.toolbar.registerComponent(\"borders\", BorderChangeTool, BorderChangeButton);\n\n    var AlignmentTool = PopupTool.extend({\n        init: function(options, toolbar) {\n            PopupTool.fn.init.call(this, options, toolbar);\n\n            this.element.attr({ \"data-property\": \"alignment\" });\n            this._defineButtons();\n            this._commandPalette();\n            this.popup.element.on(\"click\", \".k-button\", function(e) {\n                this._action($(e.currentTarget));\n            }.bind(this));\n\n            this.element.data({\n                type: \"alignment\",\n                alignment: this,\n                instance: this\n            });\n        },\n        _defineButtons: function() {\n            this.buttons = [\n                { property: \"textAlign\",     value: \"left\",    iconClass: \"align-left\",   text: MESSAGES.alignmentButtons.justtifyLeft },\n                { property: \"textAlign\",     value: \"center\",  iconClass: \"align-center\", text: MESSAGES.alignmentButtons.justifyCenter },\n                { property: \"textAlign\",     value: \"right\",   iconClass: \"align-right\",  text: MESSAGES.alignmentButtons.justifyRight },\n                { property: \"textAlign\",     value: \"justify\", iconClass: \"align-justify\",   text: MESSAGES.alignmentButtons.justifyFull },\n                { property: \"verticalAlign\", value: \"top\",     iconClass: \"align-top\",      text: MESSAGES.alignmentButtons.alignTop },\n                { property: \"verticalAlign\", value: \"center\",  iconClass: \"align-middle\",   text: MESSAGES.alignmentButtons.alignMiddle },\n                { property: \"verticalAlign\", value: \"bottom\",  iconClass: \"align-bottom\",   text: MESSAGES.alignmentButtons.alignBottom }\n            ];\n        },\n        destroy: function() {\n            this.popup.element.off();\n            PopupTool.fn.destroy.call(this);\n        },\n        update: function(range) {\n            var textAlign = range.textAlign();\n            var verticalAlign = range.verticalAlign();\n            var element = this.popup.element;\n\n            element.find(\".k-button\").removeClass(\"k-selected\");\n\n            if (textAlign) {\n                element.find(\"[data-property=textAlign][data-value=\" + textAlign + \"]\").addClass(\"k-selected\");\n            }\n\n            if (verticalAlign) {\n                element.find(\"[data-property=verticalAlign][data-value=\" + verticalAlign + \"]\").addClass(\"k-selected\");\n            }\n        },\n        _commandPalette: function() {\n            var buttons = this.buttons;\n            var element = $(\"<div />\").appendTo(this.popup.element);\n            buttons.forEach(function(options, index) {\n                var button = \"<a role='button' title='\" + options.text + \"' data-property='\" + options.property + \"' data-value='\" + options.value + \"' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-icon-button'>\" +\n                                \"<span class='k-button-icon k-icon k-i-\" + options.iconClass + \"'></span>\" +\n                             \"</a>\";\n                if (index !== 0 && buttons[index - 1].property !== options.property) {\n                    element.append($(\"<span class='k-separator' />\"));\n                }\n                element.append(button);\n            });\n        },\n        _action: function(button) {\n            var property = button.attr(\"data-property\");\n            var value = button.attr(\"data-value\");\n\n            this.toolbar.action({\n                command: \"PropertyChangeCommand\",\n                options: {\n                    property: property,\n                    value: value\n                }\n            });\n        }\n    });\n\n    var AlignmentButton = OverflowDialogButton.extend({\n        _click: function() {\n            this.toolbar.dialog({ name: \"alignment\" });\n        }\n    });\n\n    kendo.toolbar.registerComponent(\"alignment\", AlignmentTool, AlignmentButton);\n\n    var MergeTool = PopupTool.extend({\n        init: function(options, toolbar) {\n            PopupTool.fn.init.call(this, options, toolbar);\n\n            this.popup.element.addClass(\"k-menu-popup\");\n\n            this._defineButtons();\n            this._commandPalette();\n            this.popup.element.on(\"click\", \".k-menu-item\", function(e) {\n                this._action($(e.currentTarget));\n            }.bind(this));\n\n            this.element.data({\n                type: \"merge\",\n                merge: this,\n                instance: this\n            });\n        },\n        _defineButtons: function() {\n            this.buttons = [\n                { value: \"cells\",        iconClass: \"cells-merge\",        text: MESSAGES.mergeButtons.mergeCells },\n                { value: \"horizontally\", iconClass: \"cells-merge-horizontally\", text: MESSAGES.mergeButtons.mergeHorizontally },\n                { value: \"vertically\",   iconClass: \"cells-merge-vertically\",   text: MESSAGES.mergeButtons.mergeVertically },\n                { value: \"unmerge\",      iconClass: \"table-unmerge\",      text: MESSAGES.mergeButtons.unmerge }\n            ];\n        },\n        destroy: function() {\n            this.popup.element.off();\n            PopupTool.fn.destroy.call(this);\n        },\n        _commandPalette: function() {\n            var element = $(\"<ul class='k-group k-menu-group k-reset k-menu-group-md'>\").appendTo(this.popup.element);\n\n            this.buttons.forEach(function(options) {\n                var item = \"<li class='k-item k-menu-item' data-value='\" + options.value + \"'>\" +\n                    \"<span class='k-link k-menu-link'>\" +\n                        \"<span class='k-icon k-i-\" + options.iconClass + \"'></span>\" +\n                        \"<span class='k-menu-link-text'>\" + options.text + \"</span>\" +\n                    \"</span>\" +\n                \"</li>\";\n\n                element.append(item);\n            });\n        },\n        _action: function(button) {\n            var value = button.attr(\"data-value\");\n\n            this.toolbar.action({\n                command: \"MergeCellCommand\",\n                options: {\n                    value: value\n                }\n            });\n        }\n    });\n\n    var MergeButton = OverflowDialogButton.extend({\n        _click: function() {\n            this.toolbar.dialog({ name: \"merge\" });\n        }\n    });\n\n    kendo.toolbar.registerComponent(\"merge\", MergeTool, MergeButton);\n\n    var FreezeTool = PopupTool.extend({\n        init: function(options, toolbar) {\n            PopupTool.fn.init.call(this, options, toolbar);\n\n            this.popup.element.addClass(\"k-menu-popup\");\n            this._defineButtons();\n            this._commandPalette();\n            this.popup.element.on(\"click\", \".k-menu-item\", function(e) {\n                this._action($(e.currentTarget));\n            }.bind(this));\n\n            this.element.data({\n                type: \"freeze\",\n                freeze: this,\n                instance: this\n            });\n        },\n        _defineButtons: function() {\n            this.buttons = [\n                { value: \"panes\",    iconClass: \"pane-freeze\",  text: MESSAGES.freezeButtons.freezePanes },\n                { value: \"rows\",     iconClass: \"row-freeze\",    text: MESSAGES.freezeButtons.freezeRows },\n                { value: \"columns\",  iconClass: \"column-freeze\",    text: MESSAGES.freezeButtons.freezeColumns },\n                { value: \"unfreeze\", iconClass: \"table-unmerge\", text: MESSAGES.freezeButtons.unfreeze }\n            ];\n        },\n        destroy: function() {\n            this.popup.element.off();\n            PopupTool.fn.destroy.call(this);\n        },\n        _commandPalette: function() {\n            var element = $(\"<ul class='k-group k-menu-group k-reset k-menu-group-md'>\").appendTo(this.popup.element);\n            this.buttons.forEach(function(options) {\n                var item = \"<li class='k-item k-menu-item' data-value='\" + options.value + \"'>\" +\n                    \"<span class='k-link k-menu-link'>\" +\n                        \"<span class='k-icon k-i-\" + options.iconClass + \"'></span>\" +\n                        \"<span class='k-menu-link-text'>\" + options.text + \"</span>\" +\n                    \"</span>\" +\n                \"</li>\";\n                element.append(item);\n            });\n        },\n        _action: function(button) {\n            var value = button.attr(\"data-value\");\n\n            this.toolbar.action({\n                command: \"FreezePanesCommand\",\n                options: {\n                    value: value\n                }\n            });\n        }\n    });\n\n    var FreezeButton = OverflowDialogButton.extend({\n        _click: function() {\n            this.toolbar.dialog({ name: \"freeze\" });\n        }\n    });\n\n    kendo.toolbar.registerComponent(\"freeze\", FreezeTool, FreezeButton);\n\n    var Sort = DropDownTool.extend({\n        _revertTitle: function(e) {\n            e.sender.wrapper.find('[role=\"option\"]').attr(\"aria-label\", e.sender.value());\n            e.sender.value(\"\");\n            e.sender.wrapper.width(\"auto\");\n        },\n        init: function(options, toolbar) {\n            DropDownTool.fn.init.call(this, options, toolbar);\n\n            var ddl = this.dropDownList;\n            ddl.bind(\"change\", this._revertTitle.bind(this));\n            ddl.bind(\"dataBound\", this._revertTitle.bind(this));\n            ddl.setOptions({\n                valueTemplate: \"<span class='k-icon k-i-\" + options.iconClass + \"' style='line-height: 1em; width: 1.35em;'></span>\",\n                template: \"<span class='k-icon k-i-#= iconClass #' style='line-height: 1em; width: 1.35em;'></span>#=text#\",\n                dataTextField: \"text\",\n                dataValueField: \"value\"\n            });\n            ddl.setDataSource([\n                // { value: \"asc\", sheet: true, asc: true,  text: MESSAGES.sortButtons.sortSheetAsc,  iconClass: \"sort-asc\" },\n                // { value: \"desc\", sheet: true, asc: false, text: MESSAGES.sortButtons.sortSheetDesc,  , iconClass: \"sort-desc\" },\n                { value: \"asc\", sheet: false, text: MESSAGES.sortButtons.sortRangeAsc, iconClass: \"sort-asc\" },\n                { value: \"desc\", sheet: false, text: MESSAGES.sortButtons.sortRangeDesc, iconClass: \"sort-desc\" }\n            ]);\n            ddl.select(0);\n            ddl.wrapper.find('[role=\"option\"]').attr(\"aria-label\", \"asc\");\n\n            this.element.data({\n                type: \"sort\",\n                sort: this\n            });\n        },\n        _change: function(e) {\n            var instance = e.sender;\n            var dataItem = instance.dataItem();\n\n            if (dataItem) {\n                this.toolbar.action({\n                    command: \"SortCommand\",\n                    options: {\n                        value: dataItem.value,\n                        sheet: dataItem.sheet\n                    }\n                });\n            }\n        },\n        value: $.noop\n    });\n\n    var SortButton = OverflowDialogButton.extend({\n        _click: function() {\n            this.toolbar.dialog({ name: \"sort\" });\n        }\n    });\n\n    kendo.toolbar.registerComponent(\"sort\", Sort, SortButton);\n\n    var Filter = kendo.toolbar.ToolBarButton.extend({\n        init: function(options, toolbar) {\n            options.showText = \"overflow\";\n            kendo.toolbar.ToolBarButton.fn.init.call(this, options, toolbar);\n\n            this.element.on(\"click\", this._click.bind(this));\n\n            this.element.data({\n                type: \"filter\",\n                filter: this\n            });\n        },\n        _click: function() {\n            this.toolbar.action({ command: \"FilterCommand\" });\n        },\n        update: function(value) {\n            this.toggle(value);\n        }\n    });\n\n    var FilterButton = OverflowDialogButton.extend({\n        init: function(options, toolbar) {\n            OverflowDialogButton.fn.init.call(this, options, toolbar);\n\n            this.element.data({\n                type: \"filter\",\n                filter: this\n            });\n        },\n        _click: function() {\n            this.toolbar.action({ command: \"FilterCommand\" });\n        },\n        update: function(value) {\n            this.toggle(value);\n        }\n    });\n\n    kendo.toolbar.registerComponent(\"filter\", Filter, FilterButton);\n\n    var Open = kendo.toolbar.Item.extend({\n        init: function(options, toolbar) {\n            this.toolbar = toolbar;\n            this.element = $(\"<div class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-upload-button k-icon-button'>\" +\n                                 \"<span class='k-button-icon k-icon k-i-folder-open'></span>\" +\n                             \"</div>\").data(\"instance\", this);\n\n            this._title = options.attributes.title;\n            this._reset();\n        },\n        _reset: function() {\n            this.element.find(\"input\").remove();\n\n            $(\"<input type='file' autocomplete='off' accept='.xlsx'/>\")\n                .attr(\"title\", this._title)\n                .attr(\"aria-label\", this._title)\n                .one(\"change\", this._change.bind(this))\n                .appendTo(this.element);\n        },\n        _change: function(e) {\n            this.toolbar.action({\n                command: \"OpenCommand\",\n                options: {\n                    file: e.target.files[0]\n                }\n            });\n\n            this._reset();\n        }\n    });\n    kendo.toolbar.registerComponent(\"open\", Open);\n\n    kendo.spreadsheet.TabStrip = kendo.ui.TabStrip.extend({\n        init: function(element, options) {\n            kendo.ui.TabStrip.fn.init.call(this, element, options);\n            element.addClass(\"k-spreadsheet-tabstrip\");\n            this._quickAccessButtons();\n\n            this.toolbars = {};\n\n            var tabs = options.dataSource;\n\n            this.contentElements.each(function(idx, element) {\n                this._toolbar($(element), tabs[idx].id, options.toolbarOptions[tabs[idx].id]);\n            }.bind(this));\n\n            this.one(\"activate\", function() { //force resize of the tabstrip after TabStrip tab is opened\n                var toolbar = this.toolbars[this.options.dataSource[0].id];\n                toolbar.resize();\n            });\n\n            this.bind(\"activate\", function(e) { //force resize of the tabstrip after TabStrip tab is opened\n                var toolbar = $(e.contentElement).find(\".k-toolbar\").data(\"kendoSpreadsheetToolBar\");\n\n                toolbar._tabIndex();\n                this.wrapper.removeAttr(\"tabindex\");\n                this.wrapper.find(\".k-tabstrip-content\").removeAttr(\"tabindex\");\n            });\n        },\n\n        events: kendo.ui.TabStrip.fn.events.concat([ \"action\", \"dialog\" ]),\n\n        destroy: function() {\n            this.quickAccessToolBar.off(\"click\");\n            kendo.ui.TabStrip.fn.destroy.call(this);\n            for (var name in this.toolbars) {\n                this.toolbars[name].destroy();\n            }\n        },\n\n        action: function(args) {\n            this.trigger(\"action\", args);\n        },\n\n        dialog: function(args) {\n            this.trigger(\"dialog\", args);\n        },\n\n        refreshTools: function(range) {\n            var toolbars = this.toolbars;\n            for (var name in toolbars) {\n                if (toolbars.hasOwnProperty(name)) {\n                    toolbars[name].refresh(range);\n                }\n            }\n        },\n\n        _quickAccessButtons: function() {\n            var buttons = [\n                { title: MESSAGES.quickAccess.undo, iconClass: \"undo\", action: \"undo\" },\n                { title: MESSAGES.quickAccess.redo, iconClass: \"redo\", action: \"redo\" }\n            ];\n            var buttonTemplate = kendo.template(\"<a role='button' href='\\\\#' title='#= title #' data-action='#= action #' class='k-button k-button-md k-rounded-md k-button-flat k-button-flat-base k-icon-button' aria-label='#= title #'><span class='k-button-icon k-icon k-i-#=iconClass#'></span></a>\");\n\n            this.quickAccessToolBar = $(\"<div />\", {\n                \"class\": \"k-spreadsheet-quick-access-toolbar\",\n                \"html\": kendo.render(buttonTemplate, buttons)\n            }).insertBefore(this.wrapper);\n\n            this.quickAccessToolBar.on(\"click\", \".k-button\", function(e) {\n                e.preventDefault();\n\n                var action = $(e.currentTarget).attr(\"data-action\");\n                this.action({ action: action });\n            }.bind(this));\n\n            this.quickAccessAdjust();\n        },\n\n        quickAccessAdjust: function() {\n            this.tabGroup.css(\"padding-left\", kendo._outerWidth(this.quickAccessToolBar));\n        },\n\n        _toolbar: function(container, name, tools) {\n            var element;\n            var options;\n\n            if (this.toolbars[name]) {\n                this.toolbars[name].destroy();\n                container.children(\".k-toolbar\").remove();\n            }\n\n            if (tools) {\n                element = container.html(\"<div></div>\").children(\"div\");\n\n                options = {\n                    tools: typeof tools === \"boolean\" ? undefined : tools,\n                    toolbarName: name,\n                    action: this.action.bind(this),\n                    dialog: this.dialog.bind(this)\n                };\n\n                this.toolbars[name] = new kendo.spreadsheet.ToolBar(element, options);\n            }\n        }\n\n    });\n\n})(window.kendo);\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/dialogs',[ \"kendo.core\", \"kendo.binder\", \"kendo.validator\" ], f);\n})(function(){\n\n(function(kendo) {\n\n\n\n\n\n    var $ = kendo.jQuery;\n    var ObservableObject = kendo.data.ObservableObject;\n\n    var MESSAGES = kendo.spreadsheet.messages.dialogs = {\n        apply: \"Apply\",\n        save: \"Save\",\n        cancel: \"Cancel\",\n        remove: \"Remove\",\n        retry: \"Retry\",\n        revert: \"Revert\",\n        okText: \"OK\",\n        formatCellsDialog: {\n            title: \"Format\",\n            categories: {\n                number: \"Number\",\n                currency: \"Currency\",\n                date: \"Date\"\n            }\n        },\n        fontFamilyDialog: {\n            title: \"Font\"\n        },\n        fontSizeDialog: {\n            title: \"Font size\"\n        },\n        bordersDialog: {\n            title: \"Borders\"\n        },\n        alignmentDialog: {\n            title: \"Alignment\",\n            buttons: {\n                justtifyLeft: \"Align left\",\n                justifyCenter: \"Center\",\n                justifyRight: \"Align right\",\n                justifyFull: \"Justify\",\n                alignTop: \"Align top\",\n                alignMiddle: \"Align middle\",\n                alignBottom: \"Align bottom\"\n            }\n        },\n        mergeDialog: {\n            title: \"Merge cells\",\n            buttons: {\n                mergeCells: \"Merge all\",\n                mergeHorizontally: \"Merge horizontally\",\n                mergeVertically: \"Merge vertically\",\n                unmerge: \"Unmerge\"\n            }\n        },\n        freezeDialog: {\n            title: \"Freeze panes\",\n            buttons: {\n                freezePanes: \"Freeze panes\",\n                freezeRows: \"Freeze rows\",\n                freezeColumns: \"Freeze columns\",\n                unfreeze: \"Unfreeze panes\"\n            }\n        },\n        confirmationDialog: {\n            text: \"Are you sure you want to remove this sheet?\",\n            title: \"Sheet remove\"\n        },\n        validationDialog: {\n            title: \"Data Validation\",\n            hintMessage: \"Please enter a valid {0} value {1}.\",\n            hintTitle: \"Validation {0}\",\n            criteria: {\n                any: \"Any value\",\n                number: \"Number\",\n                text: \"Text\",\n                date: \"Date\",\n                custom: \"Custom Formula\",\n                list: \"List\"\n            },\n            comparers: {\n                greaterThan: \"greater than\",\n                lessThan: \"less than\",\n                between: \"between\",\n                notBetween: \"not between\",\n                equalTo: \"equal to\",\n                notEqualTo: \"not equal to\",\n                greaterThanOrEqualTo: \"greater than or equal to\",\n                lessThanOrEqualTo: \"less than or equal to\"\n            },\n            comparerMessages: {\n                greaterThan: \"greater than {0}\",\n                lessThan: \"less than {0}\",\n                between: \"between {0} and {1}\",\n                notBetween: \"not between {0} and {1}\",\n                equalTo: \"equal to {0}\",\n                notEqualTo: \"not equal to {0}\",\n                greaterThanOrEqualTo: \"greater than or equal to {0}\",\n                lessThanOrEqualTo: \"less than or equal to {0}\",\n                custom: \"that satisfies the formula: {0}\"\n            },\n            labels: {\n                criteria: \"Criteria\",\n                comparer: \"Comparer\",\n                min: \"Min\",\n                max: \"Max\",\n                value: \"Value\",\n                start: \"Start\",\n                end: \"End\",\n                onInvalidData: \"On invalid data\",\n                rejectInput: \"Reject input\",\n                showWarning: \"Show warning\",\n                showHint: \"Show hint\",\n                hintTitle: \"Hint title\",\n                hintMessage: \"Hint message\",\n                ignoreBlank: \"Ignore blank\",\n                showListButton: \"Display button to show list\",\n                showCalendarButton: \"Display button to show calendar\"\n            },\n            placeholders: {\n                typeTitle: \"Type title\",\n                typeMessage: \"Type message\"\n            }\n        },\n        exportAsDialog: {\n            title: \"Export...\",\n            defaultFileName: \"Workbook\",\n            xlsx: {\n                description: \"Excel Workbook (.xlsx)\"\n            },\n            pdf: {\n                description: \"Portable Document Format (.pdf)\",\n                area: {\n                    workbook: \"Entire Workbook\",\n                    sheet: \"Active Sheet\",\n                    selection: \"Selection\"\n                },\n                paper: {\n                    a2        : \"A2 (420 mm  594 mm)\",\n                    a3        : \"A3 (297 mm x 420 mm)\",\n                    a4        : \"A4 (210 mm x 297 mm)\",\n                    a5        : \"A5 (148 mm x 210 mm)\",\n                    b3        : \"B3 (353 mm  500 mm)\",\n                    b4        : \"B4 (250 mm x 353 mm)\",\n                    b5        : \"B5 (176 mm x 250 mm)\",\n                    folio     : 'Folio (8.5\" x 13\")',\n                    legal     : 'Legal (8.5\" x 14\")',\n                    letter    : 'Letter (8.5\" x 11\")',\n                    tabloid   : 'Tabloid (11\" x 17\")',\n                    executive : 'Executive (7.25\" x 10.5\")'\n                },\n                margin: {\n                    normal: \"Normal\",\n                    narrow: \"Narrow\",\n                    wide: \"Wide\"\n                }\n            },\n            labels: {\n                scale: \"Scale\",\n                fit: \"Fit to page\",\n                fileName: \"File name\",\n                saveAsType: \"Save as type\",\n                exportArea: \"Export\",\n                paperSize: \"Paper size\",\n                margins: \"Margins\",\n                orientation: \"Orientation\",\n                print: \"Print\",\n                guidelines: \"Guidelines\",\n                center: \"Center\",\n                horizontally: \"Horizontally\",\n                vertically: \"Vertically\"\n            }\n        },\n        modifyMergedDialog: {\n            errorMessage: \"Cannot change part of a merged cell.\"\n        },\n        rangeDisabledDialog: {\n            errorMessage: \"Destination range contains disabled cells.\"\n        },\n        intersectsArrayDialog: {\n            errorMessage: \"You cannot alter part of an array\"\n        },\n        incompatibleRangesDialog: {\n            errorMessage: \"Incompatible ranges\"\n        },\n        noFillDirectionDialog: {\n            errorMessage: \"Cannot determine fill direction\"\n        },\n        duplicateSheetNameDialog: {\n            errorMessage: \"Duplicate sheet name\"\n        },\n        overflowDialog: {\n            errorMessage: \"Cannot paste, because the copy area and the paste area are not the same size and shape.\"\n        },\n        useKeyboardDialog: {\n            title: \"Copying and pasting\",\n            errorMessage: \"These actions cannot be invoked through the menu. Please use the keyboard shortcuts instead:\",\n            labels: {\n                forCopy: \"for copy\",\n                forCut: \"for cut\",\n                forPaste: \"for paste\"\n            }\n        },\n        unsupportedSelectionDialog: {\n            errorMessage: \"That action cannot be performed on multiple selection.\"\n        },\n        linkDialog: {\n            title: \"Hyperlink\",\n            labels: {\n                text: \"Text\",\n                url: \"Address\",\n                removeLink: \"Remove link\"\n            }\n        },\n        insertCommentDialog: {\n            title: \"Insert comment\",\n            labels: {\n                comment: \"Comment\",\n                removeComment: \"Remove comment\"\n            }\n        },\n        insertImageDialog: {\n            title: \"Insert image\",\n            info: \"Drag an image here, or click to select\",\n            typeError: \"Please select a JPEG, PNG or GIF image\"\n        }\n    };\n\n    var registry = {};\n    kendo.spreadsheet.dialogs = {\n        register: function(name, dialogClass) {\n            registry[name] = dialogClass;\n        },\n        registered: function(name) {\n            return !!registry[name];\n        },\n        create: function(name, options) {\n            var dialogClass = registry[name];\n\n            if (dialogClass) {\n                return new dialogClass(options);\n            }\n        }\n    };\n\n    var SpreadsheetDialog = kendo.spreadsheet.SpreadsheetDialog = kendo.Observable.extend({\n        init: function(options) {\n            kendo.Observable.fn.init.call(this, options);\n\n            this.options = translate($.extend(true, {}, this.options, options));\n\n            this.bind(this.events, options);\n        },\n        events: [\n            \"close\",\n            \"activate\"\n        ],\n        options: {\n            autoFocus: true\n        },\n        dialog: function() {\n            if (!this._dialog) {\n                var options = {\n                    autoFocus: false,\n                    scrollable: false,\n                    resizable: false,\n                    modal: true,\n                    visible: false,\n                    width: this.options.width || 320,\n                    title: this.options.title,\n                    open: function() {\n                        this.center();\n                    },\n                    close: this._onDialogClose.bind(this),\n                    activate: this._onDialogActivate.bind(this),\n                    deactivate: this._onDialogDeactivate.bind(this)\n                };\n                this._dialog = $(\"<div class='k-spreadsheet-window k-action-window k-popup-edit-form' />\")\n                    .addClass(this.options.className || \"\")\n                    .append(kendo.template(this.options.template)({\n                        messages: kendo.spreadsheet.messages.dialogs || MESSAGES,\n                        ns: kendo.ns,\n\n                        // this is for ImportErrorDialog.  ugly that\n                        // we need this line here, but I couldn't\n                        // figure out a better way\n                        errors: this.options.errors\n                    }))\n                    .kendoWindow(options)\n                    .data(\"kendoWindow\");\n            }\n\n            return this._dialog;\n        },\n        _onDialogClose: function() {\n            this.trigger(\"close\", {\n                action: this._action\n            });\n        },\n        _onDialogActivate: function() {\n            this.trigger(\"activate\");\n        },\n        _onDialogDeactivate: function() {\n            this.trigger(\"deactivate\");\n            this.destroy();\n        },\n        destroy: function() {\n            if (this._dialog) {\n                this._dialog.destroy();\n                this._dialog = null;\n            }\n        },\n        open: function() {\n            this.dialog().open();\n            this.dialog().element.find(\".k-button-solid-primary\").trigger(\"focus\");\n        },\n        apply: function() {\n            this.close();\n        },\n        close: function() {\n            this._action = \"close\";\n\n            this.dialog().close();\n        }\n    });\n\n    function formattedValue(value, format) {\n        return kendo.spreadsheet.formatting.text(value, format);\n    }\n\n    var FormatCellsViewModel = kendo.spreadsheet.FormatCellsViewModel = ObservableObject.extend({\n        init: function(options) {\n            ObservableObject.fn.init.call(this, options);\n\n            this.useCategory(this.category);\n        },\n        useCategory: function(category) {\n            var type = category && category.type || \"number\";\n            var formatCurrency = type == \"currency\";\n\n            this.category = category;\n\n            this.set(\"showCurrencyFilter\", formatCurrency && this.currencies.length > 1);\n\n            if (!formatCurrency) {\n                this.set(\"formats\", this.allFormats[type + \"Formats\"]);\n            } else {\n                this.currency(this.currencies[0]);\n            }\n\n            this.useFirstFormat();\n        },\n        useFirstFormat: function() {\n            if (this.formats.length) {\n                this.set(\"format\", this.formats[0].value);\n            }\n        },\n        currency: function(currency) {\n            if (currency !== undefined) {\n                this._currency = currency;\n\n                var info = currency.value;\n                var formats = [\n                    { currency: info, decimals: true },\n                    { currency: info, decimals: true, iso: true },\n                    { currency: info, decimals: false }\n                ];\n\n                formats = formats.map(function(format) {\n                    format = FormatCellsViewModel.convert.currency(format);\n\n                    return { value: format, name: formattedValue(1000, format) };\n                });\n\n                this.set(\"formats\", formats);\n\n                this.useFirstFormat();\n            }\n\n            return this._currency || this.currencies[0];\n        },\n        categoryFilter: function(category) {\n            if (category !== undefined) {\n                this.useCategory(category);\n            }\n\n            return this.category;\n        },\n        preview: function() {\n            var format = this.get(\"format\");\n            var value = this.value || 0;\n\n            if (format && format.length) {\n                return formattedValue(value, format);\n            } else {\n                return value;\n            }\n        }\n    });\n\n    FormatCellsViewModel.convert = {\n        currency: function(options) {\n            function repeat(token, n) {\n                return new Array(n+1).join(token);\n            }\n\n            // convert culture info to spreadsheet format\n            var info = options.currency;\n            var format = info.pattern[1];\n\n            if (options.decimals) {\n                format = format.replace(/n/g, \"n\" + info[\".\"] + repeat(\"0\", info.decimals));\n            }\n\n            if (options.iso) {\n                format = '\"' + info.abbr + '\" ' + format.replace(/\\s*\\$\\s*/g, \"\");\n            } else {\n                format = format.replace(/\\$/g, JSON.stringify(info.symbol));\n            }\n\n            format = format.replace(/n/g, \"?\");\n\n            return format;\n        },\n        date: function(format) {\n            if ((/T|Z/).test(format)) {\n                return \"\";\n            }\n\n            return format.toLowerCase().replace(/tt/g, \"AM/PM\").replace(/'/g, '\"');\n        }\n    };\n\n    function uniqueBy(field, array) {\n        var result = [];\n        var values = [];\n\n        for (var i = 0; i < array.length; i++) {\n            if ($.inArray(array[i][field], values) == -1) {\n                result.push(array[i]);\n                values.push(array[i][field]);\n            }\n        }\n\n        return result;\n    }\n\n    var FormatCellsDialog = SpreadsheetDialog.extend({\n        init: function(options) {\n            var messages = kendo.spreadsheet.messages.dialogs.formatCellsDialog || MESSAGES;\n            var defaultOptions = {\n                title: messages.title,\n                categories: [\n                    { type: \"number\", name: messages.categories.number },\n                    { type: \"currency\", name: messages.categories.currency },\n                    { type: \"date\", name: messages.categories.date }\n                ]\n            };\n\n            SpreadsheetDialog.fn.init.call(this, $.extend(defaultOptions, options));\n\n            this._generateFormats();\n        },\n        options: {\n            className: \"k-spreadsheet-format-cells\",\n            template:\n                \"<div class='k-edit-form-container'>\" +\n\n                    \"<div class='k-root-tabs' data-#:ns#role='tabstrip' \" +\n                        \"data-#:ns#text-field='name' \" +\n                        \"data-#:ns#bind='source: categories, value: categoryFilter' \" +\n                        \"data-#:ns#animation='false'></div>\" +\n\n                    \"<div class='k-spreadsheet-preview' data-#:ns#bind='text: preview'></div>\" +\n\n                    \"<script type='text/x-kendo-template' id='format-item-template'>\" +\n                        \"\\\\#: data.name \\\\#\" +\n                    \"</script>\" +\n\n                    \"<select data-#:ns#role='dropdownlist' class='k-format-filter' \" +\n                        \"data-#:ns#text-field='description' \" +\n                        \"data-#:ns#value-field='value.name' \" +\n                        \"data-#:ns#bind='visible: showCurrencyFilter, value: currency, source: currencies'></select>\" +\n\n                    \"<ul data-#:ns#role='staticlist' tabindex='0' \" +\n                        \"id='formats-list' \" +\n                        \"aria-label='formats list' \" +\n                        \"class='k-list k-reset' \" +\n                        \"data-#:ns#template='format-item-template' \" +\n                        \"data-#:ns#value-primitive='true' \" +\n                        \"data-#:ns#value-field='value' \" +\n                        \"data-#:ns#bind='source: formats, value: format'></ul>\" +\n\n                    \"<div class='k-action-buttons'>\" +\n                        \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-#:ns#bind='click: apply'><span class='k-button-text'>#: messages.apply #</span></button>\" +\n                        \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base' data-#:ns#bind='click: close'><span class='k-button-text'>#: messages.cancel #</span></button>\" +\n                    \"</div>\"+\n\n                \"</div>\"\n        },\n        _generateFormats: function() {\n            var options = this.options;\n\n            if (!options.currencies) {\n                options.currencies = FormatCellsDialog.currenciesFrom(kendo.cultures);\n            }\n\n            if (!options.numberFormats) {\n                options.numberFormats = [\n                    { value: \"#.00%\", name: \"100.00%\" },\n                    { value: \"#%\", name: \"100%\" },\n                    { value: \"#.00\", name: \"1024.00\" },\n                    { value: \"#,###.00\", name: \"1,024.00\" }\n                ];\n            }\n\n            if (!options.dateFormats) {\n                var calendarPatterns = kendo.cultures.current.calendars.standard.patterns;\n\n                options.dateFormats = uniqueBy(\"value\", $.map(calendarPatterns, function(format) {\n                    format = FormatCellsViewModel.convert.date(format);\n\n                    if (!format) {\n                        return;\n                    }\n\n                    return { value: format, name: formattedValue(34567.7678, format) };\n                }));\n            }\n        },\n        open: function(range) {\n            var options = this.options;\n            var value = range.value();\n            var categories = options.categories.slice(0);\n            var element;\n\n            this.viewModel = new FormatCellsViewModel({\n                currencies: options.currencies.slice(0),\n                allFormats: {\n                    numberFormats: options.numberFormats.slice(0),\n                    dateFormats: options.dateFormats.slice(0)\n                },\n                categories: categories,\n                format: range.format(),\n                category: value instanceof Date ? categories[2] : categories[0],\n                apply: this.apply.bind(this),\n                close: this.close.bind(this),\n                value: value\n            });\n\n            SpreadsheetDialog.fn.open.call(this);\n\n            element = this.dialog().element;\n\n            kendo.bind(element, this.viewModel);\n\n            var currencyFilter = element.find(\"select.k-format-filter\").data(\"kendoDropDownList\");\n\n            if (options.currencies.length > 10) {\n                currencyFilter.setOptions({ filter: \"contains\" });\n            }\n\n            element.find(kendo.roleSelector(\"staticlist\")).parent().addClass(\"k-list-wrapper\");\n\n            element.find(\".k-tabstrip-item\").attr(\"aria-controls\", \"formats-list\");\n        },\n        apply: function() {\n            var format = this.viewModel.format;\n\n            SpreadsheetDialog.fn.apply.call(this);\n\n            this.trigger(\"action\", {\n                command: \"PropertyChangeCommand\",\n                options: {\n                    property: \"format\",\n                    value: format\n                }\n            });\n        }\n    });\n\n    FormatCellsDialog.currenciesFrom = function (cultures) {\n        return uniqueBy(\"description\", $.map(cultures, function(culture, name) {\n            if (!(/-/).test(name)) {\n                return;\n            }\n\n            var currency = culture.numberFormat.currency;\n            var description = kendo.format(\n                \"{0} ({1}, {2})\",\n                currency.name,\n                currency.abbr,\n                currency.symbol\n            );\n\n            return { description: description, value: currency };\n        }));\n    };\n\n    kendo.spreadsheet.dialogs.register(\"formatCells\", FormatCellsDialog);\n\n    kendo.spreadsheet.dialogs.FormatCellsDialog = FormatCellsDialog;\n\n    var MessageDialog = SpreadsheetDialog.extend({\n        options: {\n            className: \"k-spreadsheet-message\",\n            title: \"\",\n            messageId: \"\",\n            text: \"\",\n            template:\n                \"<div class='k-spreadsheet-message-content' data-#:ns#bind='text: text'></div>\" +\n                \"<div class='k-action-buttons'>\" +\n                    \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-#:ns#bind='click: close'>\" +\n                        \"<span class='k-button-text'>#= messages.okText #</span>\" +\n                    \"</button>\" +\n                \"</div>\"\n        },\n        open: function() {\n            SpreadsheetDialog.fn.open.call(this);\n\n            var options = this.options;\n            var text = options.text;\n\n            if (options.messageId) {\n                text = kendo.getter(options.messageId, true)(kendo.spreadsheet.messages.dialogs);\n            }\n\n            kendo.bind(this.dialog().element, {\n                text: text,\n                close: this.close.bind(this)\n            });\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"message\", MessageDialog);\n\n    var ConfirmationDialog = SpreadsheetDialog.extend({\n        init: function(options) {\n            var messages = kendo.spreadsheet.messages.dialogs.confirmationDialog || MESSAGES;\n            var defaultOptions = {\n                title: messages.title,\n                text: messages.text\n            };\n\n            SpreadsheetDialog.fn.init.call(this, $.extend(defaultOptions, options));\n        },\n        options: {\n            className: \"k-spreadsheet-message\",\n            messageId: \"\",\n            template:\n                \"<div class='k-spreadsheet-message-content' data-#:ns#bind='text: text'></div>\" +\n                \"<div class='k-action-buttons'>\" +\n                    \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-#:ns#bind='click: confirm'>\" +\n                        \"<span class='k-button-text'>#= messages.okText #</span>\" +\n                    \"</button>\" +\n                    \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base' data-#:ns#bind='click: cancel'>\" +\n                        \"<span class='k-button-text'>#= messages.cancel #</span>\" +\n                    \"</button>\" +\n                \"</div>\"\n        },\n        open: function() {\n            SpreadsheetDialog.fn.open.call(this);\n\n            var options = this.options;\n            var text = options.text;\n\n            if (options.messageId) {\n                text = kendo.getter(options.messageId, true)(kendo.spreadsheet.messages.dialogs);\n            }\n\n            kendo.bind(this.dialog().element, {\n                text: text,\n                confirm: this.confirm.bind(this),\n                cancel: this.close.bind(this)\n            });\n        },\n        isConfirmed: function() {\n            return this._confirmed;\n        },\n        confirm: function() {\n            this._confirmed = true;\n            this.close();\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"confirmation\", ConfirmationDialog);\n\n    var ValidationErrorDialog = SpreadsheetDialog.extend({\n        options: {\n            className: \"k-spreadsheet-message\",\n            title: \"\",\n            messageId: \"\",\n            text: \"\",\n            template:\n            \"<div class='k-spreadsheet-message-content' data-#:ns#bind='text: text'></div>\" +\n            \"<div class='k-action-buttons'>\" +\n                \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-#:ns#bind='click: retry'>\" +\n                    \"<span class='k-button-text'>#= messages.retry #</span>\" +\n                \"</button>\" +\n                \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base' data-#:ns#bind='click: cancel'>\" +\n                    \"<span class='k-button-text'>#= messages.cancel #</span>\" +\n                \"</button>\" +\n            \"</div>\"\n        },\n        open: function() {\n            SpreadsheetDialog.fn.open.call(this);\n\n            var options = this.options;\n            var text = options.text;\n\n            if (options.messageId) {\n                text = kendo.getter(options.messageId, true)(kendo.spreadsheet.messages.dialogs);\n            }\n\n            kendo.bind(this.dialog().element, {\n                text: text,\n                retry: this.retry.bind(this),\n                cancel: this.close.bind(this)\n            });\n        },\n        retry: function() {\n            this._retry = true;\n            this.close();\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"validationError\", ValidationErrorDialog);\n\n    var FontFamilyDialog = SpreadsheetDialog.extend({\n        init: function(options) {\n            var messages = kendo.spreadsheet.messages.dialogs.fontFamilyDialog || MESSAGES;\n\n            SpreadsheetDialog.fn.init.call(this, $.extend({ title: messages.title }, options));\n\n            this._list();\n        },\n        options: {\n            template: \"<ul class='k-list k-reset'></ul>\"\n        },\n        _list: function() {\n            var ul = this.dialog().element.find(\"ul\");\n            var fonts = this.options.fonts;\n            var defaultFont = this.options.defaultFont;\n\n            this.list = new kendo.ui.StaticList(ul, {\n                dataSource: new kendo.data.DataSource({ data: fonts }),\n                template: \"#: data #\",\n                value: defaultFont,\n                change: this.apply.bind(this)\n            });\n\n            this.list.dataSource.fetch();\n        },\n        apply: function(e) {\n            SpreadsheetDialog.fn.apply.call(this);\n\n            this.trigger(\"action\", {\n                command: \"PropertyChangeCommand\",\n                options: {\n                    property: \"fontFamily\",\n                    value: e.sender.value()[0]\n                }\n            });\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"fontFamily\", FontFamilyDialog);\n\n    var FontSizeDialog = SpreadsheetDialog.extend({\n        init: function(options) {\n            var messages = kendo.spreadsheet.messages.dialogs.fontSizeDialog || MESSAGES;\n\n            SpreadsheetDialog.fn.init.call(this, $.extend({ title: messages.title }, options));\n\n            this._list();\n        },\n        options: {\n            template: \"<ul class='k-list k-reset'></ul>\"\n        },\n        _list: function() {\n            var ul = this.dialog().element.find(\"ul\");\n            var sizes = this.options.sizes;\n            var defaultSize = this.options.defaultSize;\n\n            this.list = new kendo.ui.StaticList(ul, {\n                dataSource: new kendo.data.DataSource({ data: sizes }),\n                template: \"#: data #\",\n                value: defaultSize,\n                change: this.apply.bind(this)\n            });\n\n            this.list.dataSource.fetch();\n        },\n        apply: function(e) {\n            SpreadsheetDialog.fn.apply.call(this);\n\n            this.trigger(\"action\", {\n                command: \"PropertyChangeCommand\",\n                options: {\n                    property: \"fontSize\",\n                    value: kendo.parseInt(e.sender.value()[0])\n                }\n            });\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"fontSize\", FontSizeDialog);\n\n    var BordersDialog = SpreadsheetDialog.extend({\n        init: function(options) {\n            var messages = kendo.spreadsheet.messages.dialogs.bordersDialog || MESSAGES;\n\n            SpreadsheetDialog.fn.init.call(this, $.extend({ title: messages.title }, options));\n\n            this.element = this.dialog().element;\n            this._borderPalette();\n\n            this.viewModel = kendo.observable({\n                apply: this.apply.bind(this),\n                close: this.close.bind(this)\n            });\n\n            kendo.bind(this.element.find(\".k-action-buttons\"), this.viewModel);\n        },\n        options: {\n            width: 177,\n            template:   \"<div></div>\" +\n                        \"<div class='k-action-buttons'>\" +\n                            \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-#:ns#bind='click: apply'><span class='k-button-text'>#: messages.apply #</span></button>\" +\n                            \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base' data-#:ns#bind='click: close'><span class='k-button-text'>#: messages.cancel #</span></button>\" +\n                        \"</div>\"\n        },\n        apply: function() {\n            SpreadsheetDialog.fn.apply.call(this);\n\n            var state = this.value();\n\n            this.trigger(\"action\", {\n                command: \"BorderChangeCommand\",\n                options: {\n                    border: state.type,\n                    style: { size: 1, color: state.color }\n                }\n            });\n        },\n        _borderPalette: function() {\n            var element = this.dialog().element.find(\"div\").first();\n\n            this.borderPalette = new kendo.spreadsheet.BorderPalette(element, {\n                change: this.value.bind(this)\n            });\n        },\n        value: function(state) {\n            if (state === undefined) {\n                return this._state;\n            } else {\n                this._state = state;\n            }\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"borders\", BordersDialog);\n\n    var ColorChooser = SpreadsheetDialog.extend({\n        init: function(options) {\n            SpreadsheetDialog.fn.init.call(this, options);\n\n            this.element = this.dialog().element;\n            this.property = options.property;\n            this.options.title = options.title;\n\n            this.viewModel = kendo.observable({\n                apply: this.apply.bind(this),\n                close: this.close.bind(this)\n            });\n\n            kendo.bind(this.element.find(\".k-action-buttons\"), this.viewModel);\n        },\n        options: {\n            template:   \"<div></div>\" +\n                        \"<div class='k-action-buttons'>\" +\n                            \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-#:ns#bind='click: apply'><span class='k-button-text'>#: messages.apply #</span></button>\" +\n                            \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base' data-#:ns#bind='click: close'><span class='k-button-text'>#: messages.cancel #</span></button>\" +\n                        \"</div>\"\n        },\n        apply: function() {\n            SpreadsheetDialog.fn.apply.call(this);\n\n            this.trigger(\"action\", {\n                command: \"PropertyChangeCommand\",\n                options: {\n                    property: this.property,\n                    value: this.value()\n                }\n            });\n        },\n        value: function(e) {\n            if (e === undefined) {\n                return this._value;\n            } else {\n                this._value = e.value;\n            }\n        }\n    });\n\n    var ColorPickerDialog = ColorChooser.extend({\n        init: function(options) {\n            options.width = 177;\n            ColorChooser.fn.init.call(this, options);\n            this._colorPalette();\n        },\n        _colorPalette: function() {\n            var element = this.dialog().element.find(\"div\").first();\n            this.colorPalette = element.kendoColorPalette({\n                palette: [ //metro palette\n                    \"#ffffff\", \"#000000\", \"#d6ecff\", \"#4e5b6f\", \"#7fd13b\", \"#ea157a\", \"#feb80a\", \"#00addc\", \"#738ac8\", \"#1ab39f\",\n                    \"#f2f2f2\", \"#7f7f7f\", \"#a7d6ff\", \"#d9dde4\", \"#e5f5d7\", \"#fad0e4\", \"#fef0cd\", \"#c5f2ff\", \"#e2e7f4\", \"#c9f7f1\",\n                    \"#d8d8d8\", \"#595959\", \"#60b5ff\", \"#b3bcca\", \"#cbecb0\", \"#f6a1c9\", \"#fee29c\", \"#8be6ff\", \"#c7d0e9\", \"#94efe3\",\n                    \"#bfbfbf\", \"#3f3f3f\", \"#007dea\", \"#8d9baf\", \"#b2e389\", \"#f272af\", \"#fed46b\", \"#51d9ff\", \"#aab8de\", \"#5fe7d5\",\n                    \"#a5a5a5\", \"#262626\", \"#003e75\", \"#3a4453\", \"#5ea226\", \"#af0f5b\", \"#c58c00\", \"#0081a5\", \"#425ea9\", \"#138677\",\n                    \"#7f7f7f\", \"#0c0c0c\", \"#00192e\", \"#272d37\", \"#3f6c19\", \"#750a3d\", \"#835d00\", \"#00566e\", \"#2c3f71\", \"#0c594f\"\n                ],\n                change: this.value.bind(this)\n            }).data(\"kendoColorPalette\");\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"colorPicker\", ColorPickerDialog);\n\n    var CustomColorDialog = ColorChooser.extend({\n        init: function(options) {\n            options.width = 268;\n            ColorChooser.fn.init.call(this, options);\n            this.dialog().setOptions({ animation: false });\n            this.dialog().one(\"activate\", this._colorPicker.bind(this));\n        },\n        _colorPicker: function() {\n            var element = this.dialog().element.find(\"div\").first();\n            this.colorPicker = element.kendoFlatColorPicker({\n                change: this.value.bind(this)\n            }).data(\"kendoFlatColorPicker\");\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"customColor\", CustomColorDialog);\n\n    var AlignmentDialog = SpreadsheetDialog.extend({\n        init: function(options) {\n            var messages = kendo.spreadsheet.messages.dialogs.alignmentDialog || MESSAGES;\n            var defaultOptions = {\n                title: messages.title,\n                buttons: [\n                    { property: \"textAlign\",     value: \"left\",    iconClass: \"align-left\",   text: messages.buttons.justtifyLeft },\n                    { property: \"textAlign\",     value: \"center\",  iconClass: \"align-center\", text: messages.buttons.justifyCenter },\n                    { property: \"textAlign\",     value: \"right\",   iconClass: \"align-right\",  text: messages.buttons.justifyRight },\n                    { property: \"textAlign\",     value: \"justify\", iconClass: \"align-justify\",   text: messages.buttons.justifyFull },\n                    { property: \"verticalAlign\", value: \"top\",     iconClass: \"align-top\",      text: messages.buttons.alignTop },\n                    { property: \"verticalAlign\", value: \"center\",  iconClass: \"align-middle\",   text: messages.buttons.alignMiddle },\n                    { property: \"verticalAlign\", value: \"bottom\",  iconClass: \"align-bottom\",   text: messages.buttons.alignBottom }\n                ]\n            };\n\n            SpreadsheetDialog.fn.init.call(this, $.extend(defaultOptions, options));\n\n            this._list();\n        },\n        options: {\n            template: \"<ul class='k-list k-reset'></ul>\"\n        },\n        _list: function() {\n            var ul = this.dialog().element.find(\"ul\");\n\n            this.list = new kendo.ui.StaticList(ul, {\n                dataSource: new kendo.data.DataSource({ data: this.options.buttons }),\n                template: \"<a role='button' title='#=text#' data-property='#=property#' data-value='#=value#'>\" +\n                                \"<span class='k-icon k-i-#=iconClass#'></span>\" +\n                                \"#=text#\" +\n                           \"</a>\",\n                change: this.apply.bind(this)\n            });\n\n            this.list.dataSource.fetch();\n        },\n        apply: function(e) {\n            var dataItem = e.sender.value()[0];\n            SpreadsheetDialog.fn.apply.call(this);\n\n            this.trigger(\"action\", {\n                command: \"PropertyChangeCommand\",\n                options: {\n                    property: dataItem.property,\n                    value: dataItem.value\n                }\n            });\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"alignment\", AlignmentDialog);\n\n    var MergeDialog = SpreadsheetDialog.extend({\n        init: function(options) {\n            var messages = kendo.spreadsheet.messages.dialogs.mergeDialog || MESSAGES;\n            var defaultOptions = {\n                title: messages.title,\n                buttons: [\n                    { value: \"cells\",        iconClass: \"cells-merge\",        text: messages.buttons.mergeCells },\n                    { value: \"horizontally\", iconClass: \"cells-merge-horizontally\", text: messages.buttons.mergeHorizontally },\n                    { value: \"vertically\",   iconClass: \"cells-merge-vertically\",   text: messages.buttons.mergeVertically },\n                    { value: \"unmerge\",      iconClass: \"table-unmerge\",      text: messages.buttons.unmerge }\n                ]\n            };\n\n            SpreadsheetDialog.fn.init.call(this, $.extend(defaultOptions, options));\n\n            this._list();\n        },\n        options: {\n            template: \"<ul class='k-list k-reset'></ul>\"\n        },\n        _list: function() {\n            var ul = this.dialog().element.find(\"ul\");\n\n            this.list = new kendo.ui.StaticList(ul, {\n                dataSource: new kendo.data.DataSource({ data: this.options.buttons }),\n                template: \"<a role='button' title='#=text#' data-value='#=value#'>\" +\n                            \"<span class='k-icon k-icon k-i-#=iconClass#'></span>#=text#\" +\n                          \"</a>\",\n                change: this.apply.bind(this)\n            });\n\n            this.list.dataSource.fetch();\n        },\n        apply: function(e) {\n            var dataItem = e.sender.value()[0];\n            SpreadsheetDialog.fn.apply.call(this);\n\n            this.trigger(\"action\", {\n                command: \"MergeCellCommand\",\n                options: {\n                    value: dataItem.value\n                }\n            });\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"merge\", MergeDialog);\n\n    var FreezeDialog = SpreadsheetDialog.extend({\n        init: function(options) {\n            var messages = kendo.spreadsheet.messages.dialogs.freezeDialog || MESSAGES;\n            var defaultOptions = {\n                title: messages.title,\n                buttons: [\n                    { value: \"panes\",    iconClass: \"pane-freeze\",  text: messages.buttons.freezePanes },\n                    { value: \"rows\",     iconClass: \"row-freeze\",    text: messages.buttons.freezeRows },\n                    { value: \"columns\",  iconClass: \"column-freeze\",    text: messages.buttons.freezeColumns },\n                    { value: \"unfreeze\", iconClass: \"table-unmerge\", text: messages.buttons.unfreeze }\n                ]\n            };\n\n            SpreadsheetDialog.fn.init.call(this, $.extend(defaultOptions, options));\n\n            this._list();\n        },\n        options: {\n            template: \"<ul class='k-list k-reset'></ul>\"\n        },\n        _list: function() {\n            var ul = this.dialog().element.find(\"ul\");\n\n            this.list = new kendo.ui.StaticList(ul, {\n                dataSource: new kendo.data.DataSource({ data: this.options.buttons }),\n                template: \"<a role='button' title='#=text#' data-value='#=value#'>\" +\n                            \"<span class='k-icon k-icon k-i-#=iconClass#'></span>#=text#\" +\n                          \"</a>\",\n                change: this.apply.bind(this)\n            });\n\n            this.list.dataSource.fetch();\n        },\n        apply: function(e) {\n            var dataItem = e.sender.value()[0];\n            SpreadsheetDialog.fn.apply.call(this);\n\n            this.trigger(\"action\", {\n                command: \"FreezePanesCommand\",\n                options: {\n                    value: dataItem.value\n                }\n            });\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"freeze\", FreezeDialog);\n\n    var ValidationViewModel = kendo.spreadsheet.ValidationCellsViewModel = ObservableObject.extend({\n        init: function(options) {\n            ObservableObject.fn.init.call(this, options);\n\n            this.bind(\"change\", (function(e) {\n\n                if (e.field === \"criterion\") {\n                    this.reset();\n\n                    if (this.criterion === \"custom\" || this.criterion === \"list\") {\n                        this.setHintMessageTemplate();\n                    }\n                }\n\n                if (e.field === \"comparer\") {\n                    this.setHintMessageTemplate();\n                }\n\n                if ((e.field == \"hintMessage\" || e.field == \"hintTitle\") && !this._mute) {\n                    this.shouldBuild = false;\n                }\n\n                if ((e.field == \"from\" || e.field == \"to\" || e.field == \"hintMessageTemplate\" || e.field == \"type\") && this.shouldBuild) {\n                    this.buildMessages();\n                }\n            }).bind(this));\n\n            this.reset();\n        },\n        buildMessages: function() {\n            this._mute = true;\n            this.set(\"hintTitle\", this.hintTitleTemplate ? kendo.format(this.hintTitleTemplate, this.type) : \"\");\n            this.set(\"hintMessage\", this.hintMessageTemplate ? kendo.format(this.hintMessageTemplate, this.from, this.to) : \"\");\n            this._mute = false;\n        },\n        reset: function() {\n            this.setComparers();\n            this.set(\"comparer\", this.comparers[0].type);\n            this.set(\"from\", null);\n            this.set(\"to\", null);\n\n            this.set(\"useCustomMessages\", false);\n\n            this.shouldBuild = true;\n\n            this.hintTitleTemplate = this.defaultHintTitle;\n            this.buildMessages();\n        },\n        //TODO: refactor\n        setComparers: function() {\n            var all = this.defaultComparers;\n            var comparers = [];\n\n            if (this.criterion === \"text\") {\n                var text_comparers = [\"equalTo\", \"notEqualTo\"];\n                for (var idx = 0; idx < all.length; idx++) {\n                    if (text_comparers[0] == all[idx].type) {\n                        comparers.push(all[idx]);\n                        text_comparers.shift();\n                    }\n                }\n            } else {\n                comparers = all.slice();\n            }\n\n            this.set(\"comparers\", comparers);\n        },\n        setHintMessageTemplate: function() {\n           if (this.criterion !== \"custom\" && this.criterion !== \"list\") {\n               this.set(\"hintMessageTemplate\", kendo.format(this.defaultHintMessage, this.criterion, this.comparerMessages[this.comparer]));\n           } else {\n               this.set(\"hintMessageTemplate\", \"\");\n               this.set(\"hintMessage\", \"\");\n           }\n        },\n        isAny: function() {\n            return this.get(\"criterion\") === \"any\";\n        },\n        isNumber: function() {\n            return this.get(\"criterion\") === \"number\";\n        },\n        showToForNumber: function() {\n            return this.showTo() && this.isNumber();\n        },\n        showToForDate: function() {\n            return this.showTo() && this.isDate();\n        },\n        isText: function() {\n            return this.get(\"criterion\") === \"text\";\n        },\n        isDate: function() {\n            return this.get(\"criterion\") === \"date\";\n        },\n        isList: function() {\n            return this.get(\"criterion\") === \"list\";\n        },\n        isCustom: function() {\n            return this.get(\"criterion\") === \"custom\";\n        },\n        showRemove: function() {\n            return this.get(\"hasValidation\");\n        },\n        showTo: function() {\n            return this.get(\"comparer\") == \"between\" || this.get(\"comparer\") == \"notBetween\";\n        },\n        update: function(validation) {\n            this.set(\"hasValidation\", !!validation);\n\n            if (validation) {\n                this.fromValidationObject(validation);\n            }\n        },\n        fromValidationObject: function(validation) {\n            this.set(\"criterion\", validation.dataType);\n            this.set(\"comparer\", validation.comparerType);\n            this.set(\"from\", validation.from);\n            this.set(\"to\", validation.to);\n            this.set(\"type\", validation.type);\n            this.set(\"ignoreBlank\", validation.allowNulls);\n            this.set(\"showButton\", validation.showButton);\n\n            if (validation.messageTemplate || validation.titleTemplate) {\n                this.hintMessageTemplate = validation.messageTemplate;\n                this.hintMessage = validation.messageTemplate;\n                this.hintTitleTemplate = validation.titleTemplate;\n                this.hintTitle = validation.titleTemplate;\n                this.useCustomMessages = true;\n                this.buildMessages();\n            } else {\n                this.useCustomMessages = false;\n            }\n        },\n        toValidationObject: function() {\n            if (this.criterion === \"any\") {\n                return null;\n            }\n\n            var options = {\n                type: this.type,\n                dataType: this.criterion,\n                comparerType: this.comparer,\n                from: this.from,\n                to: this.to,\n                allowNulls: this.ignoreBlank,\n                showButton: this.showButton\n            };\n\n            if (this.useCustomMessages) {\n                options.messageTemplate = this.shouldBuild ? this.hintMessageTemplate : this.hintMessage;\n                options.titleTemplate = this.hintTitle;\n            }\n\n            return options;\n        }\n    });\n\n    var ValidationDialog = SpreadsheetDialog.extend({\n        init: function(options) {\n            var messages = kendo.spreadsheet.messages.dialogs.validationDialog || MESSAGES;\n            var defaultOptions = {\n                title: messages.title,\n                hintMessage: messages.hintMessage,\n                hintTitle: messages.hintTitle,\n                criteria: [\n                    { type: \"any\", name: messages.criteria.any },\n                    { type: \"number\", name: messages.criteria.number },\n                    { type: \"text\", name: messages.criteria.text },\n                    { type: \"date\", name: messages.criteria.date },\n                    { type: \"custom\", name: messages.criteria.custom },\n                    { type: \"list\", name: messages.criteria.list }\n                ],\n                comparers: [\n                    { type: \"greaterThan\", name: messages.comparers.greaterThan },\n                    { type: \"lessThan\",    name: messages.comparers.lessThan },\n                    { type: \"between\",     name: messages.comparers.between },\n                    { type: \"notBetween\",  name: messages.comparers.notBetween },\n                    { type: \"equalTo\",     name: messages.comparers.equalTo },\n                    { type: \"notEqualTo\",  name: messages.comparers.notEqualTo },\n                    { type: \"greaterThanOrEqualTo\", name: messages.comparers.greaterThanOrEqualTo },\n                    { type: \"lessThanOrEqualTo\",    name: messages.comparers.lessThanOrEqualTo }\n                ],\n                comparerMessages: messages.comparerMessages\n            };\n\n            SpreadsheetDialog.fn.init.call(this, $.extend(defaultOptions, options));\n        },\n        options: {\n            width: 450,\n            criterion: \"any\",\n            type: \"reject\",\n            ignoreBlank: true,\n            showButton: true,\n            useCustomMessages: false,\n            errorTemplate:\n                '<div class=\"k-tooltip k-tooltip-error k-validator-tooltip\">' +\n                    '<span class=\"k-tooltip-icon k-icon k-i-warning\"></span>' +\n                    '<span class=\"k-tooltip-content\">#= message #</span>' +\n                    '<span class=\"k-callout k-callout-n\"></span>' +\n                '</div>',\n            template:\n                '<div class=\"k-edit-form-container\">' +\n                    '<div class=\"k-edit-label\"><label for=\"criteria\">#: messages.validationDialog.labels.criteria #:</label></div>' +\n                    '<div class=\"k-edit-field\">' +\n                        '<select id=\"criteria\" data-#:ns#role=\"dropdownlist\" ' +\n                            'title=\"#: messages.validationDialog.labels.criteria #\"' +\n                            'data-#:ns#text-field=\"name\" ' +\n                            'data-#:ns#value-field=\"type\" ' +\n                            'data-#:ns#bind=\"value: criterion, source: criteria\"></select>' +\n                    '</div>' +\n\n                    '<div data-#:ns#bind=\"visible: isNumber\">' +\n                        '<div class=\"k-edit-label\"><label for=\"number-comparer\">#: messages.validationDialog.labels.comparer #:</label></div>' +\n                        '<div class=\"k-edit-field\">' +\n                            '<select id=\"number-comparer\" data-#:ns#role=\"dropdownlist\" ' +\n                                'title=\"#: messages.validationDialog.labels.comparer #\"' +\n                                'data-#:ns#text-field=\"name\" ' +\n                                'data-#:ns#value-field=\"type\" ' +\n                                'data-#:ns#bind=\"value: comparer, source: comparers\"></select>' +\n                        '</div>' +\n                        '<div class=\"k-edit-label\"><label for=\"comparer-min\">#: messages.validationDialog.labels.min #:</label></div>' +\n                        '<div class=\"k-edit-field\">' +\n                            '<span class=\"k-textbox k-input k-input-md k-rounded-md k-input-solid\"><input id=\"comparer-min\" name=\"#: messages.validationDialog.labels.min #\" title=\"#: messages.validationDialog.labels.min #\" placeholder=\"e.g. 10\" class=\"k-input-inner\" data-#:ns#bind=\"value: from, enabled: isNumber\" required=\"required\" /></span>' +\n                        '</div>' +\n                        '<div data-#:ns#bind=\"visible: showTo\">' +\n                            '<div class=\"k-edit-label\"><label for=\"comparer-max\">#: messages.validationDialog.labels.max #:</label></div>' +\n                            '<div class=\"k-edit-field\">' +\n                                '<span class=\"k-textbox k-input k-input-md k-rounded-md k-input-solid\"><input id=\"comparer-max\" name=\"#: messages.validationDialog.labels.max #\" title=\"#: messages.validationDialog.labels.max #\" placeholder=\"e.g. 100\" class=\"k-input-inner\" data-#:ns#bind=\"value: to, enabled: showToForNumber\" required=\"required\" /></span>' +\n                            '</div>' +\n                        '</div>' +\n                    '</div>' +\n\n                    '<div data-#:ns#bind=\"visible: isText\">' +\n                        '<div class=\"k-edit-label\"><label for=\"text-comparer\">#: messages.validationDialog.labels.comparer #:</label></div>' +\n                        '<div class=\"k-edit-field\">' +\n                            '<select id=\"text-comparer\" data-#:ns#role=\"dropdownlist\" ' +\n                                'title=\"#: messages.validationDialog.labels.comparer #\"' +\n                                'data-#:ns#text-field=\"name\" ' +\n                                'data-#:ns#value-field=\"type\" ' +\n                                'data-#:ns#bind=\"value: comparer, source: comparers\"></select>' +\n                        '</div>' +\n                        '<div class=\"k-edit-label\"><label for=\"text-comparer-value\">#: messages.validationDialog.labels.value #:</label></div>' +\n                        '<div class=\"k-edit-field\">' +\n                            '<span class=\"k-textbox k-input k-input-md k-rounded-md k-input-solid\"><input id=\"text-comparer-value\" name=\"#: messages.validationDialog.labels.value #\" title=\"#: messages.validationDialog.labels.value #\" class=\"k-input-inner\" data-#:ns#bind=\"value: from, enabled: isText\" required=\"required\" /></span>' +\n                        '</div>' +\n                    '</div>' +\n\n                    '<div data-#:ns#bind=\"visible: isDate\">' +\n                        '<div class=\"k-edit-label\"><label for=\"date-comparer\">#: messages.validationDialog.labels.comparer #:</label></div>' +\n                        '<div class=\"k-edit-field\">' +\n                            '<select id=\"date-comparer\" data-#:ns#role=\"dropdownlist\" ' +\n                                'title=\"#: messages.validationDialog.labels.comparer #\"' +\n                                'data-#:ns#text-field=\"name\" ' +\n                                'data-#:ns#value-field=\"type\" ' +\n                                'data-#:ns#bind=\"value: comparer, source: comparers\"></select>' +\n                        '</div>' +\n                        '<div class=\"k-edit-label\"><label for=\"date-comparer-start\">#: messages.validationDialog.labels.start #:</label></div>' +\n                        '<div class=\"k-edit-field\">' +\n                            '<span class=\"k-textbox k-input k-input-md k-rounded-md k-input-solid\"><input id=\"date-comparer-start\" name=\"#: messages.validationDialog.labels.start #\" title=\"#: messages.validationDialog.labels.start #\" class=\"k-input-inner\" data-#:ns#bind=\"value: from, enabled: isDate\" required=\"required\" /></span>' +\n                        '</div>' +\n                        '<div data-#:ns#bind=\"visible: showTo\">' +\n                            '<div class=\"k-edit-label\"><label for=\"date-comparer-end\">#: messages.validationDialog.labels.end #:</label></div>' +\n                            '<div class=\"k-edit-field\">' +\n                                '<span class=\"k-textbox k-input k-input-md k-rounded-md k-input-solid\"><input id=\"date-comparer-end\" name=\"#: messages.validationDialog.labels.end #\" title=\"#: messages.validationDialog.labels.end #\" class=\"k-input-inner\" data-#:ns#bind=\"value: to, enabled: showToForDate\" required=\"required\" /></span>' +\n                            '</div>' +\n                        '</div>' +\n                    '</div>' +\n\n                    '<div data-#:ns#bind=\"visible: isCustom\">' +\n                        '<div class=\"k-edit-label\"><label for=\"custom-comparer-value\">#: messages.validationDialog.labels.value #:</label></div>' +\n                        '<div class=\"k-edit-field\">' +\n                            '<span class=\"k-textbox k-input k-input-md k-rounded-md k-input-solid\"><input id=\"custom-comparer-value\" name=\"#: messages.validationDialog.labels.value #\" title=\"#: messages.validationDialog.labels.value #\" class=\"k-input-inner\" data-#:ns#bind=\"value: from, enabled: isCustom\" required=\"required\" /></span>' +\n                        '</div>' +\n                    '</div>' +\n\n                    '<div data-#:ns#bind=\"visible: isList\">' +\n                        '<div class=\"k-edit-label\"><label for=\"list-comparer-value\">#: messages.validationDialog.labels.value #:</label></div>' +\n                        '<div class=\"k-edit-field\">' +\n                            '<span class=\"k-textbox k-input k-input-md k-rounded-md k-input-solid\"><input id=\"list-comparer-value\" name=\"#: messages.validationDialog.labels.value #\" title=\"#: messages.validationDialog.labels.value #\" class=\"k-input-inner\" data-#:ns#bind=\"value: from, enabled: isList\" required=\"required\" /></span>' +\n                        '</div>' +\n                    '</div>' +\n\n                    '<div data-#:ns#bind=\"visible: isList\">' +\n                        '<div class=\"k-edit-field\">' +\n                            '<input type=\"checkbox\" name=\"showButton\" id=\"listShowButton\" class=\"k-checkbox k-checkbox-md k-rounded-md\" data-#:ns#bind=\"checked: showButton\"/>' +\n                            '<label for=\"listShowButton\" class=\"k-checkbox-label\">' +\n                                ' #: messages.validationDialog.labels.showListButton #' +\n                            '</label>' +\n                        '</div>' +\n                    \"</div>\" +\n\n                    '<div data-#:ns#bind=\"visible: isDate\">' +\n                        '<div class=\"k-edit-field\">' +\n                            '<input type=\"checkbox\" name=\"showButton\" id=\"dateShowButton\" class=\"k-checkbox k-checkbox-md k-rounded-md\" data-#:ns#bind=\"checked: showButton\"/>' +\n                            '<label for=\"dateShowButton\" class=\"k-checkbox-label\">' +\n                                ' #: messages.validationDialog.labels.showCalendarButton #' +\n                            '</label>' +\n                        '</div>' +\n                    \"</div>\" +\n\n                    '<div data-#:ns#bind=\"invisible: isAny\">' +\n                        '<div class=\"k-edit-field\">' +\n                            '<input type=\"checkbox\" title=\"#: messages.validationDialog.labels.ignoreBlank #\" name=\"ignoreBlank\" id=\"ignoreBlank\" class=\"k-checkbox k-checkbox-md k-rounded-md\" data-#:ns#bind=\"checked: ignoreBlank\"/>' +\n                            '<label for=\"ignoreBlank\" class=\"k-checkbox-label\">' +\n                                ' #: messages.validationDialog.labels.ignoreBlank #' +\n                            '</label>' +\n                        '</div>' +\n                    '</div>' +\n\n                    '<div data-#:ns#bind=\"invisible: isAny\">' +\n                        '<div class=\"k-hr\"></div>' +\n                        '<div class=\"k-edit-label\"><label>#: messages.validationDialog.labels.onInvalidData #:</label></div>' +\n                        '<div class=\"k-edit-field\">' +\n                            '<input type=\"radio\" title=\"#: messages.validationDialog.labels.rejectInput #\" id=\"validationTypeReject\" name=\"validationType\" value=\"reject\" data-#:ns#bind=\"checked: type\" class=\"k-radio k-radio-md\" />' +\n                            '<label for=\"validationTypeReject\" class=\"k-radio-label\">' +\n                                 \"#: messages.validationDialog.labels.rejectInput #\" +\n                            '</label> ' +\n                            '<input type=\"radio\" title=\"#: messages.validationDialog.labels.showWarning #\" id=\"validationTypeWarning\"  name=\"validationType\" value=\"warning\" data-#:ns#bind=\"checked: type\" class=\"k-radio k-radio-md\" />' +\n                            '<label for=\"validationTypeWarning\" class=\"k-radio-label\">' +\n                                 \"#: messages.validationDialog.labels.showWarning #\" +\n                            '</label>' +\n                        '</div>' +\n                    '</div>' +\n\n                    '<div data-#:ns#bind=\"invisible: isAny\" class=\"hint-wrapper\">' +\n                        '<div class=\"k-edit-field\">' +\n                            '<input type=\"checkbox\" title=\"#: messages.validationDialog.labels.showHint #\" name=\"useCustomMessages\" id=\"useCustomMessages\" class=\"k-checkbox k-checkbox-md k-rounded-md\" data-#:ns#bind=\"checked: useCustomMessages\" />' +\n                            '<label class=\"k-checkbox-label\" for=\"useCustomMessages\">'+\n                                ' #: messages.validationDialog.labels.showHint #' +\n                            '</label>' +\n                        '</div>' +\n                        '<div data-#:ns#bind=\"visible: useCustomMessages\">' +\n                            '<div class=\"k-edit-label\"><label for=\"hint-title\">#: messages.validationDialog.labels.hintTitle #:</label></div>' +\n                            '<div class=\"k-edit-field\">' +\n                                '<span class=\"k-textbox k-input k-input-md k-rounded-md k-input-solid\"><input id=\"hint-title\" name=\"hint-title\" class=\"k-input-inner\" title=\"#: messages.validationDialog.labels.hintTitle #\" placeholder=\"#: messages.validationDialog.placeholders.typeTitle #\" data-#:ns#bind=\"value: hintTitle\" /></span>' +\n                            '</div>' +\n                            '<div class=\"k-edit-label\"><label for=\"hint-message\">#: messages.validationDialog.labels.hintMessage #:</label></div>' +\n                            '<div class=\"k-edit-field\">' +\n                                '<span class=\"k-textbox k-input k-input-md k-rounded-md k-input-solid\"><input id=\"hint-message\" class=\"k-input-inner\" title=\"#: messages.validationDialog.labels.hintMessage #\" placeholder=\"#: messages.validationDialog.placeholders.typeMessage #\" data-#:ns#bind=\"value: hintMessage\" /></span>' +\n                            '</div>' +\n                        '</div>' +\n                    '</div>' +\n\n                    '<div class=\"k-action-buttons\">' +\n                        '<button class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base\" data-#:ns#bind=\"visible: showRemove, click: remove\"><span class=\"k-button-text\">#: messages.remove #</span></button>' +\n                        '<button class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary\" data-#:ns#bind=\"click: apply\"><span class=\"k-button-text\">#: messages.apply #</span></button>' +\n                        '<button class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base\" data-#:ns#bind=\"click: close\"><span class=\"k-button-text\">#: messages.cancel #</span></button>' +\n                    \"</div>\" +\n                \"</div>\"\n        },\n        open: function(range) {\n            var options = this.options;\n            var element;\n\n            this.viewModel = new ValidationViewModel({\n                type: options.type,\n                defaultHintMessage: options.hintMessage,\n                defaultHintTitle: options.hintTitle,\n                defaultComparers: options.comparers.slice(0),\n                comparerMessages: options.comparerMessages,\n                criteria: options.criteria.slice(0),\n                criterion: options.criterion,\n                ignoreBlank: options.ignoreBlank,\n                showButton: options.showButton,\n                apply: this.apply.bind(this),\n                close: this.close.bind(this),\n                remove: this.remove.bind(this)\n            });\n\n            this.viewModel.update(range.validation());\n\n            SpreadsheetDialog.fn.open.call(this);\n\n            element = this.dialog().element;\n\n            if (this.validatable) {\n                this.validatable.destroy();\n            }\n\n            kendo.bind(element, this.viewModel);\n\n            this.validatable = new kendo.ui.Validator(element.find(\".k-edit-form-container\"), {\n                validateOnBlur: false,\n                errorTemplate: this.options.errorTemplate || undefined\n            });\n        },\n        apply: function() {\n\n            if (this.validatable.validate()) {\n                SpreadsheetDialog.fn.apply.call(this);\n\n                this.trigger(\"action\", {\n                    command: \"EditValidationCommand\",\n                    options: {\n                        value: this.viewModel.toValidationObject()\n                    }\n                });\n            }\n        },\n        remove: function() {\n            this.viewModel.set(\"criterion\", \"any\");\n            this.apply();\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"validation\", ValidationDialog);\n    kendo.spreadsheet.dialogs.ValidationDialog = ValidationDialog;\n\n    function PDF_PAPER_SIZE(size) {\n        return {\n            value: size,\n            text: TEXT(\"exportAsDialog.pdf.paper.\" + size)\n        };\n    }\n\n    var ExportAsDialog = SpreadsheetDialog.extend({\n        init: function(options) {\n            SpreadsheetDialog.fn.init.call(this, options);\n            options = this.options;\n\n            this.viewModel = kendo.observable({\n                title: options.title,\n                name: options.name,\n                extension: options.extension,\n                fileFormats:options.fileFormats,\n                excel: options.excelExport,\n                pdf: {\n                    proxyURL: options.pdfExport.proxyURL,\n                    forceProxy: options.pdfExport.forceProxy,\n                    title: options.pdfExport.title,\n                    author: options.pdfExport.author,\n                    autoPrint: options.pdfExport.autoPrint,\n                    subject: options.pdfExport.subject,\n                    keywords: options.pdfExport.keywords,\n                    creator: options.pdfExport.creator,\n                    date: options.pdfExport.date,\n\n                    fitWidth: options.pdf.fitWidth,\n                    area: options.pdf.area,\n                    areas: options.pdf.areas,\n                    paperSize: options.pdf.paperSize,\n                    paperSizes: options.pdf.paperSizes,\n                    margin: options.pdf.margin,\n                    margins: options.pdf.margins,\n                    landscape: options.pdf.landscape,\n                    guidelines: options.pdf.guidelines,\n                    hCenter: options.pdf.hCenter,\n                    vCenter: options.pdf.vCenter\n                },\n                apply: this.apply.bind(this),\n                close: this.close.bind(this)\n            });\n\n            var dialog = this.dialog();\n            this.viewModel.bind(\"change\", function(e) {\n                if (e.field === \"extension\") {\n                    this.set(\"showPdfOptions\", this.extension === \".pdf\" ? true : false);\n                    dialog.center();\n                }\n            });\n\n            kendo.bind(dialog.element, this.viewModel);\n        },\n        options: {\n            title: TEXT(\"exportAsDialog.title\", \"Export...\"),\n            name: TEXT(\"exportAsDialog.defaultFileName\", \"Workbook\"),\n            extension: \".xlsx\",\n            fileFormats: [{\n                description: TEXT(\"exportAsDialog.xlsx.description\", \"Excel Workbook (.xlsx)\"),\n                extension: \".xlsx\"\n            }, {\n                description: TEXT(\"exportAsDialog.pdf.description\", \"Portable Document Format (.pdf)\"),\n                extension: \".pdf\"\n            }],\n            pdf: {\n                fitWidth: true,\n                area: \"workbook\",\n                areas: [{\n                    area: \"workbook\",\n                    text: TEXT(\"exportAsDialog.pdf.area.workbook\", \"Entire Workbook\")\n                },{\n                    area: \"sheet\",\n                    text: TEXT(\"exportAsDialog.pdf.area.sheet\", \"Active Sheet\")\n                },{\n                    area: \"selection\",\n                    text: TEXT(\"exportAsDialog.pdf.area.selection\", \"Selection\")\n                }],\n                paperSize: \"a4\",\n                paperSizes: [\n                    \"a2\", \"a3\", \"a4\", \"a5\", \"b3\", \"b4\", \"b5\", \"folio\", \"legal\", \"letter\", \"tabloid\", \"executive\"\n                ].map(PDF_PAPER_SIZE),\n                margin: {bottom: \"0.75in\", left: \"0.7in\", right: \"0.7in\", top: \"0.75in\"},\n                margins: [\n                    { value: { bottom: \"0.75in\", left: \"0.7in\", right: \"0.7in\", top: \"0.75in\" },\n                      text: TEXT(\"exportAsDialog.pdf.margin.normal\", \"Normal\")\n                    },\n                    { value: { bottom: \"0.75in\", left: \"0.25in\", right: \"0.25in\", top: \"0.75in\" },\n                      text: TEXT(\"exportAsDialog.pdf.margin.narrow\", \"Narrow\")\n                    },\n                    { value: { bottom: \"1in\", left: \"1in\", right: \"1in\", top: \"1in\" },\n                      text: TEXT(\"exportAsDialog.pdf.margin.wide\", \"Wide\")\n                    }\n                ],\n                landscape: true,\n                guidelines: true,\n                hCenter: true,\n                vCenter: true\n            },\n            width: 520,\n            template:\n                \"<div class='k-edit-label'><label id='name-label'>#: messages.exportAsDialog.labels.fileName #:</label></div>\" +\n                \"<div class='k-edit-field'>\" +\n                    \"<span class='k-textbox k-input k-input-md k-rounded-md k-input-solid'><input aria-labelledby='name-label' class='k-input-inner' data-#:ns#bind='value: name' /></span>\" +\n                \"</div>\" +\n                \"<div >\" +\n                    \"<div class='k-edit-label'><label id='file-format-label'>#: messages.exportAsDialog.labels.saveAsType #:</label></div>\" +\n                    \"<div class='k-edit-field'>\" +\n                    \"<select aria-labelledby='file-format-label' data-#:ns#role='dropdownlist' class='k-file-format' \" +\n                        \"data-#:ns#text-field='description' \" +\n                        \"data-#:ns#value-field='extension' \" +\n                        \"data-#:ns#bind='value: extension, source: fileFormats'></select>\" +\n                    \"</div>\" +\n                \"</div>\" +\n                \"<div class='k-export-config' data-#:ns#bind='visible: showPdfOptions'>\" +\n                    \"<hr class='k-hr' />\" +\n                    \"<div class='k-edit-label'><label id='export-area-label'>#: messages.exportAsDialog.labels.exportArea #:</label></div>\" +\n                    \"<div class='k-edit-field'>\" +\n                        \"<select aria-labelledby='export-area-label' data-#:ns#role='dropdownlist' class='k-file-format' \" +\n                            \"data-#:ns#text-field='text' \" +\n                            \"data-#:ns#value-field='area' \" +\n                            \"data-#:ns#bind='value: pdf.area, source: pdf.areas'></select>\" +\n                    \"</div>\" +\n                    \"<div class='k-edit-label'><label id='paper-size-label'>#: messages.exportAsDialog.labels.paperSize#:</label></div>\" +\n                    \"<div class='k-edit-field'>\" +\n                        \"<select aria-labelledby='paper-size-label' data-#:ns#role='dropdownlist' class='k-file-format' \" +\n                            \"data-#:ns#text-field='text' \" +\n                            \"data-#:ns#value-field='value' \" +\n                            \"data-#:ns#bind='value: pdf.paperSize, source: pdf.paperSizes'></select>\" +\n                    \"</div>\" +\n                    \"<div class='k-edit-label'><label id='margins-label'>#: messages.exportAsDialog.labels.margins #:</label></div>\" +\n                    \"<div class='k-edit-field'>\" +\n                        \"<select aria-labelledby='margins-label' data-#:ns#role='dropdownlist' class='k-file-format' \" +\n                            \"data-#:ns#value-primitive='true'\" +\n                            \"data-#:ns#text-field='text' \" +\n                            \"data-#:ns#value-field='value' \" +\n                            \"data-#:ns#bind='value: pdf.margin, source: pdf.margins'></select>\" +\n                    \"</div>\" +\n                    \"<div class='k-edit-label'><label>#: messages.exportAsDialog.labels.orientation #:</label></div>\" +\n                    \"<div class='k-edit-field'>\" +\n                        \"<div class='k-button-group'>\" +\n                            \"<input type='radio' id='k-orientation-portrait' aria-label='orientation portrait' name='orientation' data-#:ns#type='boolean' data-#:ns#bind='checked: pdf.landscape' value='false' />\" +\n                            \"<label class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-icon-button k-group-start k-orientation-button' for='k-orientation-portrait'><span class='k-button-icon k-icon k-i-page-portrait'></span></label>\" +\n                            \"<input type='radio' id='k-orientation-landscape' aria-label='orientation landscape' name='orientation' data-#:ns#type='boolean' data-#:ns#bind='checked: pdf.landscape' value='true' />\" +\n                            \"<label class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-icon-button k-group-end k-orientation-button' for='k-orientation-landscape'><span class='k-button-icon k-icon k-i-page-landscape'></span></label>\" +\n                        \"</div>\" +\n                    \"</div>\" +\n                    \"<div class='k-edit-label'><label>#: messages.exportAsDialog.labels.print #:</label></div>\" +\n                    \"<div class='k-edit-field'>\" +\n                        \"<input class='k-checkbox k-checkbox-md k-rounded-md' id='guidelines' type='checkbox' data-#:ns#bind='checked: pdf.guidelines'/><label class='k-checkbox-label' for='guidelines'>#: messages.exportAsDialog.labels.guidelines#</label>\" +\n                    \"</div>\" +\n                    \"<div class='k-edit-label'><label>#: messages.exportAsDialog.labels.scale #:</label></div>\" +\n                    \"<div class='k-edit-field'>\" +\n                        \"<input class='k-checkbox k-checkbox-md k-rounded-md' id='fitWidth' type='checkbox' data-#:ns#bind='checked: pdf.fitWidth'/><label class='k-checkbox-label' for='fitWidth'>#: messages.exportAsDialog.labels.fit #</label>\" +\n                    \"</div>\" +\n                    \"<div class='k-edit-label'><label>#: messages.exportAsDialog.labels.center #:</label></div>\" +\n                    \"<div class='k-edit-field'>\" +\n                        \"<input class='k-checkbox k-checkbox-md k-rounded-md' id='hCenter' type='checkbox' data-#:ns#bind='checked: pdf.hCenter'/><label class='k-checkbox-label' for='hCenter'>#: messages.exportAsDialog.labels.horizontally #</label>\" +\n                        \"<input class='k-checkbox k-checkbox-md k-rounded-md' id='vCenter' type='checkbox' data-#:ns#bind='checked: pdf.vCenter'/><label class='k-checkbox-label' for='vCenter'>#: messages.exportAsDialog.labels.vertically #</label>\" +\n                    \"</div>\" +\n                    \"<div class='k-page-orientation'>\" +\n                        \"<span class='k-icon k-i-page-portrait' data-#:ns#bind='invisible: pdf.landscape'></span>\" +\n                        \"<span class='k-icon k-i-page-landscape' data-#:ns#bind='visible: pdf.landscape'></span>\" +\n                    \"</div>\" +\n                \"</div>\" +\n                \"<div class='k-action-buttons'>\" +\n                    \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-#:ns#bind='click: apply'><span class='k-button-text'>#: messages.save #</span></button>\" +\n                    \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base' data-#:ns#bind='click: close'><span class='k-button-text'>#: messages.cancel #</span></button>\" +\n                \"</div>\"\n        },\n        apply: function() {\n            SpreadsheetDialog.fn.apply.call(this);\n\n            this.trigger(\"action\", {\n                command: \"SaveAsCommand\",\n                options: this.viewModel\n            });\n        }\n    });\n    kendo.spreadsheet.dialogs.register(\"exportAs\", ExportAsDialog);\n\n    function basicErrorDialog(id, msg) {\n        kendo.spreadsheet.dialogs.register(\n            id,\n            MessageDialog.extend({\n                options: { messageId: msg }\n            })\n        );\n    }\n\n    basicErrorDialog(\"modifyMerged\", \"modifyMergedDialog.errorMessage\");\n    basicErrorDialog(\"rangeDisabled\", \"rangeDisabledDialog.errorMessage\");\n    basicErrorDialog(\"intersectsArray\", \"intersectsArrayDialog.errorMessage\");\n    basicErrorDialog(\"overflow\", \"overflowDialog.errorMessage\");\n    basicErrorDialog(\"unsupportedSelection\", \"unsupportedSelectionDialog.errorMessage\");\n    basicErrorDialog(\"incompatibleRanges\", \"incompatibleRangesDialog.errorMessage\");\n    basicErrorDialog(\"noFillDirection\", \"noFillDirectionDialog.errorMessage\");\n    basicErrorDialog(\"duplicateSheetName\", \"duplicateSheetNameDialog.errorMessage\");\n\n    var ImportErrorDialog = MessageDialog.extend({\n        options: {\n            width: 640,\n            title: \"Errors in import\",\n            template:\n                \"<div class='k-spreadsheet-message-content k-spreadsheet-import-errors'>\" +\n                  \"<div class='k--header-message'>We encountered #= errors.length # errors while reading this file.  Please be aware that some formulas might be missing, or contain invalid results.</div>\" +\n                  \"<div class='k--errors'>\" +\n                    \"<table>\" +\n                      \"<thead>\" +\n                        \"<tr><th>Context</th><th>Error message</th></tr>\" +\n                      \"</thead>\" +\n                      \"# for (var i = 0; i < errors.length; ++i) { #\" +\n                        \"# var err = errors[i]; #\" +\n                        \"<tr><td>#: err.context #</td><td>#: err.error #</td></tr>\" +\n                      \"# } #\" +\n                    \"</table>\" +\n                  \"</div>\" +\n                \"</div>\" +\n                \"<div class='k-action-buttons'>\" +\n                  \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-#:ns#bind='click: close'>\" +\n                    \"<span class='k-button-text'>#: messages.okText #</span>\" +\n                  \"</button>\" +\n                \"</div>\"\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"importError\", ImportErrorDialog);\n\n    var UseKeyboardDialog = MessageDialog.extend({\n        options: {\n            title: TEXT(\"useKeyboardDialog.title\", \"Copying and pasting\"),\n            template:\n                \"#: messages.useKeyboardDialog.errorMessage #\" +\n                \"<div>Ctrl+C #: messages.useKeyboardDialog.labels.forCopy #</div>\" +\n                \"<div>Ctrl+X #: messages.useKeyboardDialog.labels.forCut #</div>\" +\n                \"<div>Ctrl+V #: messages.useKeyboardDialog.labels.forPaste #</div>\" +\n                '<div class=\"k-action-buttons\">' +\n                    \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-#:ns#bind='click: close'>\" +\n                        \"<span class='k-button-text'>#= messages.okText #</span>\" +\n                    \"</button>\" +\n                \"</div>\"\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"useKeyboard\", UseKeyboardDialog);\n\n    var HyperlinkDialog = SpreadsheetDialog.extend({\n        options: {\n            title: TEXT(\"linkDialog.title\", \"Hyperlink\"),\n            template:\n            (\"<div class='k-edit-label'><label id='url-label'>#: messages.linkDialog.labels.url #:</label></div>\" +\n             \"<div class='k-edit-field'><span class='k-textbox k-input k-input-md k-rounded-md k-input-solid'><input class='k-input-inner' data-#:ns#bind='value: url' title='#: messages.linkDialog.labels.url #' aria-labelledby='url-label'/></span></div>\" +\n             \"<div class='k-action-buttons'>\" + (\n                 (\"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-left' data-#:ns#bind='click: remove'><span class='k-button-text'>#= messages.linkDialog.labels.removeLink #</span></button>\" +\n                  \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-#:ns#bind='click: apply'><span class='k-button-text'>#= messages.okText #</span></button>\" +\n                  \"<button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base' data-#:ns#bind='click: cancel'><span class='k-button-text'>#= messages.cancel #</span></button>\")\n             ) + \"</div>\"\n            ),\n            autoFocus: false\n        },\n        open: function(range) {\n            var self = this;\n            SpreadsheetDialog.fn.open.apply(self, arguments);\n            var element = self.dialog().element;\n            var model = kendo.observable({\n                url: range.link(),\n                apply: function() {\n                    if (!/\\S/.test(model.url)) {\n                        model.url = null;\n                    }\n                    self.trigger(\"action\", {\n                        command: \"HyperlinkCommand\",\n                        options: {\n                            link: model.url\n                        }\n                    });\n                    self.close();\n                },\n                remove: function() {\n                    model.url = null;\n                    model.apply();\n                },\n                cancel: self.close.bind(self)\n            });\n            kendo.bind(element, model);\n\n            // it would be nice if we could easily handle that in one\n            // place for all dialogs, but it doesn't seem easily\n            // doable.\n            element.find(\"input\")\n                .trigger(\"focus\")\n                .on(\"keydown\", function(ev){\n                    if (ev.keyCode == 13 /*ENTER*/) {\n                        model.url = $(this).val(); // there won't be a \"change\" event and the model wouldn't update :-\\\n                        ev.stopPropagation();\n                        ev.preventDefault();\n                        model.apply();\n                    } else if (ev.keyCode == 27 /*ESC*/) {\n                        ev.stopPropagation();\n                        ev.preventDefault();\n                        model.cancel();\n                    }\n                });\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"hyperlink\", HyperlinkDialog);\n\n    var InsertCommentDialog = SpreadsheetDialog.extend({\n        options: {\n            className: \"k-spreadsheet-insert-comment\",\n            template: \"\\\n<div class='k-edit-label'><label id='comment-label'>#: messages.insertCommentDialog.labels.comment #:</label></div>\\\n<div class='k-edit-field'><span class='k-input k-textarea k-input-solid k-input-md k-rounded-md'><textarea aria-labelledby='comment-label' rows='5' class='k-input-inner' data-#:ns#bind='value: comment'></textarea></span></div>\\\n<div class='k-action-buttons'>\\\n  <button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-left' data-#:ns#bind='click: remove'><span class='k-button-text'>#: messages.insertCommentDialog.labels.removeComment #</span></button>\\\n  <button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-#:ns#bind='click: apply'><span class='k-button-text'>#: messages.okText #</span></button>\\\n  <button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base' data-#:ns#bind='click: cancel'><span class='k-button-text'>#= messages.cancel #</span></button>\\\n</div>\\\n\",\n            title: TEXT(\"insertCommentDialog.title\", \"Insert comment\"),\n            autoFocus: false,\n            width: 450\n        },\n        open: function(range) {\n            var self = this;\n            SpreadsheetDialog.fn.open.apply(self, arguments);\n            var element = self.dialog().element;\n            var model = kendo.observable({\n                comment: range.comment(),\n                apply: function() {\n                    if (!/\\S/.test(model.comment)) {\n                        model.comment = null;\n                    }\n                    self.trigger(\"action\", {\n                        command: \"InsertCommentCommand\",\n                        options: {\n                            value: model.comment\n                        }\n                    });\n                    self.close();\n                },\n                remove: function() {\n                    model.comment = null;\n                    model.apply();\n                },\n                cancel: self.close.bind(self)\n            });\n            kendo.bind(element, model);\n\n            element.find(\"textarea\").trigger(\"focus\");\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"insertComment\", InsertCommentDialog);\n\n    var InsertImageDialog = SpreadsheetDialog.extend({\n        options: {\n            template: \"\\\n<div class='k-spreadsheet-insert-image-dialog'>\\\n  <label data-#:ns#bind='style: { background-image: imageUrl },\\\n                    css: { k-spreadsheet-has-image: hasImage, k-hover: isHovered },\\\n                    events: { dragenter: dragEnter, dragover: stopEvent, dragleave: dragLeave, drop: drop }'>\\\n    <div data-#:ns#bind='text: info'></div>\\\n    <input type='file' data-#:ns#bind='events: { change: change }'\\\n           accept='image/png, image/jpeg, image/gif' />\\\n  </label>\\\n</div>\\\n<div class='k-action-buttons'>\\\n  <button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-#:ns#bind='enabled: okEnabled, click: apply'><span class='k-button-text'>#: messages.okText #</span></button>\\\n  <button class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base' data-#:ns#bind='click: cancel'><span class='k-button-text'>#= messages.cancel #</span></button>\\\n</div>\",\n            title: TEXT(\"insertImageDialog.title\", \"Insert image\"),\n            width: \"auto\"\n        },\n        open: function() {\n            var self = this;\n            SpreadsheetDialog.fn.open.apply(self, arguments);\n            var element = self.dialog().element;\n            var model = kendo.observable({\n                okEnabled: false,\n                info: kendo.spreadsheet.messages.dialogs.insertImageDialog.info,\n                imageUrl: \"\",\n                hasImage: false,\n                isHovered: false,\n                _url: null,\n                _image: null,\n                apply: function() {\n                    window.URL.revokeObjectURL(model._url);\n                    self.trigger(\"action\", {\n                        command: \"InsertImageCommand\",\n                        options: {\n                            blob   : model._image,\n                            width  : model._width,\n                            height : model._height\n                        }\n                    });\n                    self.close();\n                },\n                cancel: self.close.bind(self),\n                stopEvent: function(ev) {\n                    ev.stopPropagation();\n                    ev.preventDefault();\n                },\n                drop: function(ev) {\n                    model.stopEvent(ev);\n                    model.selectFile(ev.originalEvent.dataTransfer.files);\n                    model.set(\"isHovered\", false);\n                },\n                dragEnter: function(ev) {\n                    model.stopEvent(ev);\n                    model.set(\"isHovered\", true);\n                },\n                dragLeave: function(ev) {\n                    model.stopEvent(ev);\n                    model.set(\"isHovered\", false);\n                },\n                change: function(ev) {\n                    model.selectFile(ev.target.files);\n                },\n                selectFile: function(files) {\n                    var image;\n                    for (var i = 0; i < files.length; ++i) {\n                        if (/^image\\//i.test(files[i].type)) {\n                            image = files[i];\n                            break;\n                        }\n                    }\n                    if (model._url) {\n                        window.URL.revokeObjectURL(model._url);\n                    }\n                    if (image) {\n                        model._image = image;\n                        model._url = window.URL.createObjectURL(image);\n                        var img = new Image();\n                        img.src = model._url;\n                        img.onload = function() {\n                            model._width = img.width;\n                            model._height = img.height;\n                            model.set(\"info\", kendo.spreadsheet.messages.dialogs.insertImageDialog.info);\n                            model.set(\"okEnabled\", true);\n                            model.set(\"imageUrl\", \"url('\" + model._url + \"')\");\n                            model.set(\"hasImage\", true);\n                        };\n                    } else {\n                        model._image = null;\n                        model.set(\"info\", kendo.spreadsheet.messages.dialogs.insertImageDialog.typeError);\n                        model.set(\"okEnabled\", false);\n                        model.set(\"imageUrl\", \"\");\n                        model.set(\"hasImage\", false);\n                    }\n                }\n            });\n            kendo.bind(element, model);\n        }\n    });\n\n    kendo.spreadsheet.dialogs.register(\"insertImage\", InsertImageDialog);\n\n    function Localizable(path, def) {\n        this.path = path.split(\".\");\n        this.def = def;\n    }\n\n    Localizable.prototype.trans = function() {\n        var msg = kendo.spreadsheet.messages.dialogs;\n        for (var i = 0; i < this.path.length; ++i) {\n            msg = msg[this.path[i]];\n            if (!msg) {\n                return this.def;\n            }\n        }\n        return msg;\n    };\n\n    function TEXT(path, def) {\n        return new Localizable(path, def);\n    }\n\n    function translate(thing) {\n        if (thing instanceof Localizable) {\n            return thing.trans();\n        }\n        else if (Array.isArray(thing)) {\n            return thing.map(translate);\n        }\n        else if (thing != null && typeof thing == \"object\") {\n            return Object.keys(thing).reduce(function(ret, key){\n                ret[key] = translate(thing[key]);\n                return ret;\n            }, {});\n        }\n        return thing;\n    }\n\n})(window.kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/sheetbinder',[ \"kendo.core\", \"kendo.data\", \"./sheet\" ], f);\n})(function(){\n\n(function(kendo) {\n\n\n\n    var identity = function(o) { return o; };\n\n    var SheetDataSourceBinder = kendo.Class.extend({\n        init: function(options) {\n\n            this.options = kendo.jQuery.extend({}, this.options, options);\n\n            this.columns = this._normalizeColumns(this.options.columns);\n\n            this._sheet();\n            this._dataSource();\n\n            this._header();\n\n            this._boundRowsCount = 0;\n\n            this.dataSource.fetch();\n        },\n\n        _sheet: function() {\n            this.sheet = this.options.sheet;\n\n            this._sheetChangeHandler = this._sheetChange.bind(this);\n            this._sheetDeleteRowHandler = this._sheetDeleteRow.bind(this);\n            this._sheetInsertRowHandler = this._sheetInsertRow.bind(this);\n\n            this.sheet.bind(\"change\", this._sheetChangeHandler)\n                .bind(\"afterDeleteRow\", this._sheetDeleteRowHandler)\n                .bind(\"afterInsertRow\", this._sheetInsertRowHandler);\n        },\n\n        _sheetInsertRow: function(e) {\n            if (e.index !== undefined) {\n                this.dataSource.insert(Math.max(e.index - 1, 0), {});\n            }\n        },\n\n        _sheetDeleteRow: function(e) {\n            if (e.index !== undefined) {\n                var dataSource = this.dataSource;\n                var model = dataSource.view()[e.index - 1];\n\n                if (model) {\n                    dataSource.remove(model);\n                }\n            }\n        },\n\n        _header: function() {\n            this.sheet.batch(function() {\n                this.columns.forEach(function(column, index) {\n                    this.sheet.range(0,index).value(column.title);\n                }.bind(this));\n            }.bind(this));\n        },\n\n        _sheetChange: function(e) {\n            if (e.insertRow || e.deleteRow) {\n                // these actions are handled via custom events\n                return;\n            }\n\n            if (e.recalc && e.ref && e.isValue) {\n                var UnionRef = kendo.spreadsheet.UnionRef;\n                var dataSource = this.dataSource;\n                var data = dataSource.view();\n                var columns = this.columns;\n                var values = [];\n                var sheet = this.sheet;\n                var fields, getters, normalizedRef, i, rangeRef, normalizedRefs;\n                var setValues = function(ref) {\n                    ref = ref.toRangeRef();\n                    var record;\n                    var valueIndex = 0;\n                    for (var ri = ref.topLeft.row; ri <= ref.bottomRight.row; ri++) {\n                        record = data[ri - 1]; // skip header row\n\n                        if (!record) {\n                            record = dataSource.insert(ri - 1, {});\n                            data = dataSource.view();\n                        }\n\n                        var colValueIndex = 0;\n                        for (var ci = ref.topLeft.col; ci <= ref.bottomRight.col && ci < columns.length; ci++) {\n                            var currentValue = values[i][valueIndex][colValueIndex++];\n                            record.set(columns[ci].field, getters[ci](currentValue));\n                        }\n                        valueIndex++;\n                    }\n                };\n\n                if (dataSource.reader.model) {\n                    fields = dataSource.reader.model.fields;\n                }\n\n                if (!columns.length && data.length) {\n                    columns = Object.keys(data[0].toJSON());\n                }\n\n                getters = columns.map(function(column) {\n                    var field = column.field;\n                    if (field && fields && fields[field] && fields[field].type == \"date\") {\n                        return numberToDate;\n                    }\n                    return identity;\n                });\n\n                this._skipRebind = true;\n                normalizedRef = sheet._grid.normalize(e.ref);\n\n                if(!(normalizedRef instanceof UnionRef)) {\n                    normalizedRef = new UnionRef([normalizedRef]);\n                }\n\n                normalizedRefs = normalizedRef.refs;\n\n                normalizedRefs.forEach(function(ref) {\n                    values.push(sheet.range(ref).values());\n                });\n\n                for(i = 0; i < normalizedRefs.length; i++) {\n                    rangeRef = normalizedRefs[i];\n                    rangeRef.forEach(setValues);\n                }\n\n                this._boundRowsCount = dataSource.view().length;\n\n                this._skipRebind = false;\n            }\n        },\n\n        _normalizeColumns: function(columns) {\n            return columns.map(function(column) {\n                var field = column.field || column;\n                return {\n                    field: field,\n                    title: column.title || field\n                };\n            });\n        },\n\n        _dataSource: function() {\n            var options = this.options;\n            var dataSource = options.dataSource;\n\n            dataSource = Array.isArray(dataSource) ? { data: dataSource } : dataSource;\n\n            if (this.dataSource && this._changeHandler) {\n                this.dataSource.unbind(\"change\", this._changeHandler)\n                    .unbind(\"progress\", this._progressHandler)\n                    .unbind(\"error\", this._errorHandler);\n            } else {\n                this._changeHandler = this._change.bind(this);\n                this._progressHandler = this._requestStart.bind(this);\n                this._errorHandler = this._error.bind(this);\n            }\n\n            this.dataSource = kendo.data.DataSource.create(dataSource)\n                .bind(\"change\", this._changeHandler)\n                .bind(\"progress\", this._progressHandler)\n                .bind(\"error\", this._errorHandler);\n        },\n\n        _error: function() {\n            this._progress(false);\n        },\n\n        _requestStart: function() {\n            this._progress(true);\n        },\n\n        _progress: function(toggle) {\n            this.sheet.trigger(\"progress\", {\n                toggle: toggle\n            });\n        },\n\n        _change: function() {\n            if (this._skipRebind) {\n                return;\n            }\n\n            if (this.sheet.trigger(\"dataBinding\")) {\n                return;\n            }\n\n            var data = this.dataSource.view();\n            var columns = this.columns;\n\n            if (!columns.length && data.length) {\n                this.columns = columns = this._normalizeColumns(Object.keys(data[0].toJSON()));\n                this._header();\n            }\n\n            var getters = columns.map(function(column) {\n                return kendo.getter(column.field);\n            });\n\n            this.sheet.batch(function() {\n                var length = Math.max(data.length, this._boundRowsCount, this.sheet._grid.rowCount - 1);\n\n                for (var idx = 0; idx < length; idx++) {\n                    for (var getterIdx = 0; getterIdx < getters.length; getterIdx++) {\n                        var value = data[idx] ? getters[getterIdx](data[idx]) : null;\n\n                        //skip header row\n                        this.sheet.range(idx + 1, getterIdx).value(value);\n                    }\n                }\n            }.bind(this));\n\n            this._boundRowsCount = data.length;\n\n            this._progress(false);\n            this.sheet.trigger(\"dataBound\");\n        },\n\n        destroy: function() {\n            this.dataSource.unbind(\"change\", this._changeHandler)\n                .unbind(\"progress\", this._progressHandler)\n                .unbind(\"error\", this._errorHandler);\n\n            this.sheet.unbind(\"change\", this._sheetChangeHandler)\n                .unbind(\"deleteRow\", this._sheetDeleteRowHandler)\n                .unbind(\"insertRow\", this._sheetInsertRowHandler);\n        },\n\n        options: {\n            columns: []\n        }\n    });\n\n    function numberToDate(val) {\n        return val == null ? null : kendo.spreadsheet.numberToDate(val);\n    }\n\n    kendo.spreadsheet.SheetDataSourceBinder = SheetDataSourceBinder;\n})(kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/filtermenu',[ \"kendo.core\", \"kendo.popup\", \"kendo.treeview\", \"kendo.numerictextbox\", \"kendo.datepicker\", \"kendo.datetimepicker\" ], f);\n})(function(){\n\n    (function(kendo) {\n\n        var $ = kendo.jQuery;\n        var Widget = kendo.ui.Widget;\n        var classNames = {\n            details: \"k-details\",\n            button: \"k-button\",\n            detailsSummary: \"k-details-summary\",\n            detailsContent: \"k-details-content\",\n            icon: \"k-icon\",\n            iconCollapse: \"k-i-arrow-45-down-right\",\n            iconExpand: \"k-i-arrow-60-right\",\n            iconSearch: \"k-i-zoom\",\n            textbox: \"k-textbox\",\n            wrapper: \"k-spreadsheet-filter-menu\",\n            filterByCondition: \"k-spreadsheet-condition-filter\",\n            filterByValue: \"k-spreadsheet-value-filter\",\n            valuesTreeViewWrapper: \"k-spreadsheet-value-treeview-wrapper\",\n            actionButtons: \"k-action-buttons\"\n        };\n\n        kendo.spreadsheet.messages.filterMenu = {\n            all: \"All\",\n            sortAscending: \"Sort range A to Z\",\n            sortDescending: \"Sort range Z to A\",\n            filterByValue: \"Filter by value\",\n            filterByCondition: \"Filter by condition\",\n            apply: \"Apply\",\n            search: \"Search\",\n            addToCurrent: \"Add to current selection\",\n            clear: \"Clear\",\n            blanks: \"(Blanks)\",\n            operatorNone: \"None\",\n            and: \"AND\",\n            or: \"OR\",\n            operators: {\n                string: {\n                    contains: \"Text contains\",\n                    doesnotcontain: \"Text does not contain\",\n                    startswith: \"Text starts with\",\n                    endswith: \"Text ends with\",\n                    matches: \"Text matches\",\n                    doesnotmatch: \"Text does not match\"\n                },\n                date: {\n                    eq:  \"Date is\",\n                    neq: \"Date is not\",\n                    lt:  \"Date is before\",\n                    gt:  \"Date is after\"\n                },\n                number: {\n                    eq: \"Is equal to\",\n                    neq: \"Is not equal to\",\n                    gte: \"Is greater than or equal to\",\n                    gt: \"Is greater than\",\n                    lte: \"Is less than or equal to\",\n                    lt: \"Is less than\"\n                }\n            }\n        };\n\n        var Details = Widget.extend({\n            init: function(element, options) {\n                Widget.fn.init.call(this, element, options);\n\n                this.element.addClass(FilterMenu.classNames.details);\n\n                this._summary = this.element.find(\".\" + FilterMenu.classNames.detailsSummary)\n                    .on(\"click\", this._toggle.bind(this));\n\n                var iconClass = options.expanded ? FilterMenu.classNames.iconCollapse : FilterMenu.classNames.iconExpand;\n                this._icon = $(\"<span />\", { \"class\": FilterMenu.classNames.icon + \" \" + iconClass })\n                    .prependTo(this._summary);\n\n                this._container = kendo.wrap(this._summary.next(), true);\n\n                if (!options.expanded) {\n                    this._container.hide();\n                }\n            },\n            options: {\n                name: \"Details\"\n            },\n            events: [ \"toggle\" ],\n            visible: function() {\n                return this.options.expanded;\n            },\n            toggle: function(show) {\n                var animation = kendo.fx(this._container).expand(\"vertical\");\n\n                animation.stop()[show ? \"reverse\" : \"play\"]();\n\n                this._icon.toggleClass(FilterMenu.classNames.iconExpand, show)\n                          .toggleClass(FilterMenu.classNames.iconCollapse, !show);\n\n                this.options.expanded = !show;\n            },\n            _toggle: function() {\n                var show = this.visible();\n                this.toggle(show);\n                this.trigger(\"toggle\", { show: show });\n            }\n        });\n\n        kendo.data.binders.spreadsheetFilterValue = kendo.data.Binder.extend({\n            init: function(element, bindings, options) {\n                kendo.data.Binder.fn.init.call(this, element, bindings, options);\n\n                this._change = this.change.bind(this);\n                $(this.element).on(\"change\", this._change);\n            },\n            refresh: function() {\n                var that = this,\n                    value = that.bindings.spreadsheetFilterValue.get(); //get the value from the View-Model\n\n                $(that.element).val(value instanceof Date ? \"\" : value);\n            },\n            change: function() {\n                var value = this.element.value;\n                this.bindings.spreadsheetFilterValue.set(value); //update the View-Model\n            }\n        });\n\n        kendo.data.binders.widget.spreadsheetFilterValue = kendo.data.Binder.extend({\n            init: function(widget, bindings, options) {\n                kendo.data.Binder.fn.init.call(this, widget.element[0], bindings, options);\n\n                this.widget = widget;\n                this._change = this.change.bind(this);\n                this.widget.first(\"change\", this._change);\n            },\n            refresh: function() {\n                var binding = this.bindings.spreadsheetFilterValue,\n                    value = binding.get(),\n                    type = $(this.widget.element).data(\"filterType\");\n\n                if ((type === \"date\" && value instanceof Date) || (type === \"number\" && !isNaN(value))) {\n                    this.widget.value(value);\n                } else {\n                    this.widget.value(null);\n                }\n            },\n            change: function() {\n                var value = this.widget.value(),\n                    binding = this.bindings.spreadsheetFilterValue;\n\n                binding.set(value);\n            }\n        });\n\n        var templates = {\n            filterByValue:\n                \"<div class='\" + classNames.detailsSummary + \"'>#= messages.filterByValue #</div>\" +\n                \"<div class='\" + classNames.detailsContent + \"'>\" +\n                    \"<div class='k-searchbox k-input k-input-md k-rounded-md k-input-solid'>\" +\n                        \"<span class='k-input-icon k-icon k-i-search'></span>\" +\n                        \"<input class='k-input-inner' autocomplete='off' placeholder='#= messages.search #' data-#=ns#bind='events: { input: filterValues }' />\" +\n                    \"</div>\" +\n                    \"<div data-#=ns#bind='visible: hasActiveSearch'><input class='k-checkbox k-checkbox-md k-rounded-md' type='checkbox' data-#=ns#bind='checked: appendToSearch' id='_#=guid#'/><label class='k-checkbox-label' for='_#=guid#'>#= messages.addToCurrent #</label></div>\" +\n                    \"<div class='\" + classNames.valuesTreeViewWrapper + \"'>\" +\n                        \"<div data-#=ns#role='treeview' \" +\n                            \"data-#=ns#checkboxes='{ checkChildren: true }' \"+\n                            \"data-#=ns#bind='source: valuesDataSource, events: { check: valuesChange, select: valueSelect }' \"+\n                            \"></div>\" +\n                    \"</div>\" +\n                \"</div>\",\n            filterByCondition:\n                \"<div class='\" + classNames.detailsSummary + \"'>#= messages.filterByCondition #</div>\" +\n                \"<div class='\" + classNames.detailsContent + \"'>\" +\n                    '<div>' +\n                        '<select ' +\n                            'aria-label=\"#= messages.filterByCondition #\" ' +\n                            'data-#=ns#role=\"dropdownlist\"' +\n                            'data-#=ns#bind=\"value: operator, source: operators, events: { change: operatorChange } \"' +\n                            'data-#=ns#value-primitive=\"false\"' +\n                            'data-#=ns#option-label=\"#=messages.operatorNone#\"' +\n                            'data-#=ns#height=\"auto\"' +\n                            'data-#=ns#text-field=\"text\"' +\n                            'data-#=ns#value-field=\"unique\">'+\n                        '</select>'+\n                    '</div>' +\n\n                    '<div data-#=ns#bind=\"visible: isString\">' +\n                        '<input aria-label=\"string-value\" data-filter-type=\"string\" data-#=ns#bind=\"spreadsheetFilterValue: customFilter.criteria[0].value\" class=\"k-textbox\" />'+\n                    '</div>' +\n\n                    '<div data-#=ns#bind=\"visible: isNumber\">' +\n                        '<input aria-label=\"number-value\" data-filter-type=\"number\" data-#=ns#role=\"numerictextbox\" data-#=ns#bind=\"spreadsheetFilterValue: customFilter.criteria[0].value\" />'+\n                    '</div>' +\n\n                    '<div data-#=ns#bind=\"visible: isDate\">' +\n                        '<input aria-label=\"date-value\" data-filter-type=\"date\" data-#=ns#role=\"datepicker\" data-#=ns#bind=\"spreadsheetFilterValue: customFilter.criteria[0].value\" />'+\n                    '</div>' +\n                \"</div>\",\n            menuItem:\n                \"<li data-command='#=command#' data-dir='#=dir#'>\" +\n                    \"<span class='k-icon k-i-#=iconClass#'></span>#=text#\" +\n                \"</li>\",\n            actionButtons:\n                \"<button data-#=ns#bind='click: apply' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary'><span class='k-button-text'>#=messages.apply#</span></button>\" +\n                \"<button data-#=ns#bind='click: clear' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base'><span class='k-button-text'>#=messages.clear#</span></button>\"\n        };\n\n        function distinctValues(values) {\n            var hash = {};\n            var result = [];\n\n            for (var i = 0; i < values.length; i++) {\n                if (!hash[values[i].value]) {\n                    hash[values[i].value] = values[i];\n                    result.push(values[i]);\n                } else if (!hash[values[i].value].checked && values[i].checked) {\n                    hash[values[i].value].checked = true;\n                }\n            }\n\n            return result;\n        }\n\n        function filter(dataSource, query) {\n            var hasVisibleChildren = false;\n            var data = dataSource instanceof kendo.data.HierarchicalDataSource && dataSource.data();\n            var valuesFilter = this;\n            var values = this.values;\n            for (var i = 0; i < data.length; i++) {\n                var item = data[i];\n                var text = item.text.toString().toLocaleLowerCase(kendo.culture().name);\n                var itemVisible = query === true || query === \"\" || text.indexOf(query) >= 0;\n                var filterSpread = filter.bind(valuesFilter);\n                var anyVisibleChildren = filterSpread(item.children, query); // pass true if parent matches\n\n                hasVisibleChildren = hasVisibleChildren || anyVisibleChildren || itemVisible;\n                item.hidden = !itemVisible && !anyVisibleChildren;\n\n                if (query.length || (values && !values.length)) {\n                    item.checked = !item.hidden;\n                } else if (values && values.indexOf(item.text) != -1){\n                    item.checked = true;\n                }\n            }\n\n            if (data) {\n                // re-apply filter on children\n                dataSource.filter({ field: \"hidden\", operator: \"neq\", value: true });\n            }\n\n            return hasVisibleChildren;\n        }\n\n        function uncheckAll(dataSource) {\n            var data = dataSource instanceof kendo.data.HierarchicalDataSource && dataSource.data();\n\n            for (var i = 0; i < data.length; i++) {\n                var item = data[i];\n                item.checked = false;\n\n                if (item.hasChildren) {\n                    uncheckAll(item.children);\n                }\n            }\n        }\n\n        var FilterMenuViewModel = kendo.spreadsheet.FilterMenuViewModel = kendo.data.ObservableObject.extend({\n            valuesChange: function(e) {\n                var dataSource = e ? e.sender.dataSource : this.valuesDataSource;\n                var checked = function(item) {\n                    return item.checked;\n                };\n                var value = function(item) {\n                    return item.dataType === \"date\" ? kendo.spreadsheet.dateToNumber(item.value) : item.value;\n                };\n                var unique = function(value, index, array) {\n                    return array.lastIndexOf(value) === index;\n                };\n                var data = dataSource.data();\n                var values = data.toJSON()[0].items;\n                var blanks = values.filter(function(item) {\n                    return item.dataType === \"blank\";\n                });\n\n                blanks = blanks.length ? blanks[0].checked : false;\n                values = values.filter(checked).map(value);\n\n                if (this.appendToSearch && this.valueFilter && this.valueFilter.values.length) {\n                    values = values.concat(this.valueFilter.values.toJSON()).sort().filter(unique);\n                }\n\n                this.set(\"valueFilter\", {\n                    values: values,\n                    blanks: blanks\n                });\n            },\n            valueSelect: function(e) {\n                e.preventDefault();\n\n                var node = e.sender.dataItem(e.node);\n                node.set(\"checked\", !node.checked);\n            },\n            hasActiveSearch: false,\n            appendToSearch: false,\n            filterValues: function(e) {\n                var query = typeof e == \"string\" ? e : $(e.target).val().toLocaleLowerCase(kendo.culture().name);\n                var dataSource = this.valuesDataSource;\n\n                this.set(\"hasActiveSearch\", !!query);\n\n                var filterSpread = filter.bind(this.valueFilter);\n                uncheckAll(dataSource);\n                filterSpread(dataSource, query);\n            },\n            reset: function() {\n                this.set(\"customFilter\", { logic: \"and\", criteria: [ { operator: null, value: null } ] });\n                this.set(\"valueFilter\", { values: [] });\n            },\n            operatorChange: function(e) {\n                var dataItem = e.sender.dataItem();\n                this.set(\"operatorType\", dataItem.type);\n\n                // https://github.com/telerik/kendo-ui-core/issues/3317 - when switching from Value\n                // filter to filter by condition, the customFilter property is lost.\n                if (!this.get(\"customFilter\")) {\n                    this.reset();\n                }\n\n                this.set(\"customFilter.criteria[0].operator\", dataItem.value);\n            },\n            isNone: function() {\n                return this.get(\"operatorType\") === undefined;\n            },\n            isString: function() {\n                return this.get(\"operatorType\") === \"string\";\n            },\n            isNumber: function() {\n                return this.get(\"operatorType\") === \"number\";\n            },\n            isDate: function() {\n                return this.get(\"operatorType\") === \"date\";\n            }\n        });\n\n        function flattenOperators(operators) {\n            var messages = kendo.spreadsheet.messages.filterMenu.operators;\n            var result = [];\n            for (var type in operators) {\n                if (!operators.hasOwnProperty(type)) {\n                    continue;\n                }\n\n                for (var operator in operators[type]) {\n                    if (!operators[type].hasOwnProperty(operator)) {\n                        continue;\n                    }\n\n                    result.push({\n                        text: messages[type][operator],\n                        value: operator,\n                        unique: type + \"_\" + operator,\n                        type: type\n                    });\n                }\n            }\n            return result;\n        }\n\n        var FilterMenuController = kendo.spreadsheet.FilterMenuController = {\n            valuesTree: function(range, column) {\n                return [{\n                    text: kendo.spreadsheet.messages.filterMenu.all,\n                    expanded: true,\n                    checked: false,\n                    items: this.values(range.resize({ top: 1 }), column)\n                }];\n            },\n            values: function(range, column) {\n                var values = [];\n                var messages = kendo.spreadsheet.messages.filterMenu;\n                var columnRange = range.column(column);\n                var sheet = range.sheet();\n\n                columnRange.forEachCell(function(row, col, cell) {\n                    var checked = true;\n                    if (sheet.isHiddenRow(row)) {\n                        checked = false;\n                    }\n\n                    var value = cell.value;\n                    var dataType = cell.dataType;\n                    var text = cell.text;\n\n                    if (value === undefined) {\n                        dataType = \"blank\";\n                    } else if (cell.format) {\n                        dataType = kendo.spreadsheet.formatting.type(value, cell.format);\n                    } else {\n                        dataType = typeof value;\n                    }\n\n                    if (value !== null && cell.format) {\n                        text = kendo.spreadsheet.formatting.text(value, cell.format);\n                    } else {\n                        text = dataType == \"blank\" ? messages.blanks : value;\n                    }\n\n                    if (dataType === \"percent\" || dataType === \"currency\") { //treat percent as number\n                        dataType = \"number\";\n                    }\n\n                    if (dataType === \"date\") {\n                        value = kendo.spreadsheet.numberToDate(value);\n                    }\n\n                    values.push({\n                        dataType: dataType,\n                        value: value,\n                        text: text,\n                        checked: checked\n                    });\n                });\n\n                values = distinctValues(values);\n\n                values.sort(function(a, b) {\n                    if (a.dataType === b.dataType) {\n                        return 0;\n                    }\n\n                    if (a.dataType === \"blank\" || b.dataType === \"blank\") {\n                        return a.dataType === \"blank\" ? -1 : 1;\n                    }\n\n                    if (a.dataType === \"number\" || b.dataType === \"number\") {\n                        return a.dataType === \"number\" ? -1 : 1;\n                    }\n\n                    if (a.dataType === \"date\" || b.dataType === \"date\") {\n                        return a.dataType === \"date\" ? -1 : 1;\n                    }\n\n                    return 0;\n                });\n\n                return values;\n            },\n\n            filterType: function(range, column) {\n                // 1. try to infer type from current filter\n                var sheet = range.sheet();\n                var filter = this.filterForColumn(column, sheet);\n                var type;\n\n                filter = filter && filter.filter.toJSON();\n\n                if (filter && filter.filter == \"custom\") {\n                    var value = filter.criteria[0].value;\n\n                    if (value instanceof Date) {\n                        type = \"date\";\n                    } else if (typeof value == \"string\") {\n                        type = \"string\";\n                    } else if (typeof value == \"number\") {\n                        type = \"number\";\n                    }\n                }\n\n                if (!type) {\n                    // 2. try to infer type from column data\n                    var topValue = this.values(range.row(1), column)[0];\n                    type = topValue && topValue.dataType;\n\n                    if (type == \"blank\") {\n                        type = null;\n                    }\n                }\n\n                return type;\n            },\n\n            filterForColumn: function(column, sheet) {\n                var allFilters = sheet.filter();\n                var filters;\n\n                if (allFilters) {\n                    filters =  allFilters.columns.filter(function(item) {\n                        return item.index === column;\n                    })[0];\n                }\n\n                return filters;\n            },\n\n            filter: function(column, sheet) {\n                var columnFilters = this.filterForColumn(column, sheet);\n\n                if (!columnFilters) {\n                    return;\n                }\n\n                var options = columnFilters.filter.toJSON();\n                var type = options.filter;\n\n                delete options.filter;\n\n                var result = {\n                    type: type,\n                    options: options\n                };\n\n                var criteria = options.criteria;\n                if (criteria && criteria.length) {\n                    result.operator = criteria[0].operator;\n                }\n\n                return result;\n            }\n        };\n\n        var FilterMenu = Widget.extend({\n            init: function(element, options) {\n                Widget.call(this, element, options);\n\n                this.element.addClass(FilterMenu.classNames.wrapper);\n\n                this.viewModel = new FilterMenuViewModel({\n                    active: \"value\",\n                    operator: null,\n                    operators: flattenOperators(this.options.operators),\n                    clear: this.clear.bind(this),\n                    apply: this.apply.bind(this)\n                });\n\n                this._filterInit();\n                this._popup();\n                this._sort();\n                this._filterByCondition();\n                this._filterByValue();\n                this._actionButtons();\n            },\n\n            options: {\n                name: \"FilterMenu\",\n                column: 0,\n                range: null,\n                operators: {\n                    string: {\n                        contains: \"Text contains\",\n                        doesnotcontain: \"Text does not contain\",\n                        startswith: \"Text starts with\",\n                        endswith: \"Text ends with\",\n                        matches: \"Text matches\",\n                        doesnotmatch: \"Text does not match\"\n                    },\n                    date: {\n                        eq:  \"Date is\",\n                        neq: \"Date is not\",\n                        lt:  \"Date is before\",\n                        gt:  \"Date is after\"\n                    },\n                    number: {\n                        eq: \"Is equal to\",\n                        neq: \"Is not equal to\",\n                        gte: \"Is greater than or equal to\",\n                        gt: \"Is greater than\",\n                        lte: \"Is less than or equal to\",\n                        lt: \"Is less than\"\n                    }\n                }\n            },\n\n            events: [\n                \"action\"\n            ],\n\n            destroy: function() {\n                Widget.fn.destroy.call(this);\n\n                this.menu.destroy();\n                this.valuesTreeView.destroy();\n                this.popup.destroy();\n            },\n\n            openFor: function(anchor, event) {\n                if ($(anchor).hasClass(\"k-spreadsheet-view-size\")) {\n                    // on touch devices this element will sit above to\n                    // enable scrolling; it's not useful as an anchor,\n                    // use event coords instead.\n                    this.popup.open(event.pageX, event.pageY);\n                } else {\n                    this.popup.setOptions({ anchor: anchor });\n                    this.popup.open();\n                }\n            },\n\n            close: function() {\n                this.popup.close();\n            },\n\n            clear: function() {\n                this.action({\n                    command: \"ClearFilterCommand\",\n                    options: {\n                        column: this.options.column\n                    }\n                });\n                this.viewModel.reset();\n                this.close();\n            },\n\n            apply: function() {\n                this._active();\n\n                var options = {\n                    operatingRange: this.options.range,\n                    column: this.options.column\n                };\n\n                var valueFilter;\n                var customFilter;\n\n                if (this.viewModel.active === \"value\") {\n                    this.viewModel.valuesChange({ sender: this.valuesTreeView });\n                    valueFilter = this.viewModel.valueFilter.toJSON();\n\n                    if (valueFilter.blanks || (valueFilter.values && valueFilter.values.length)) {\n                        options.valueFilter = valueFilter;\n                    }\n                } else if (this.viewModel.active === \"custom\") {\n                    customFilter = this.viewModel.customFilter.toJSON();\n\n                    if (customFilter.criteria.length && customFilter.criteria[0].value !== null) {\n                        options.customFilter = customFilter;\n                    }\n                }\n\n                if (options.valueFilter || options.customFilter) {\n                    this.action({ command: \"ApplyFilterCommand\", options: options });\n                }\n            },\n\n            action: function(options) {\n                this.trigger(\"action\", $.extend({ }, options));\n            },\n\n            _filterInit: function() {\n                var column = this.options.column;\n                var range = this.options.range;\n                var sheet = range.sheet();\n                var activeFilter = FilterMenuController.filter(column, sheet);\n\n                if (activeFilter) {\n                    var filterType = FilterMenuController.filterType(range, column);\n\n                    this.viewModel.set(\"active\", activeFilter.type);\n                    this.viewModel.set(activeFilter.type + \"Filter\", activeFilter.options);\n\n                    if (activeFilter.type == \"custom\") {\n                        this.viewModel.set(\"operator\", filterType + \"_\" + activeFilter.operator);\n                        this.viewModel.set(\"operatorType\", filterType);\n                    }\n                } else {\n                    this.viewModel.reset();\n                }\n            },\n\n            _popup: function() {\n                this.popup = this.element.kendoPopup({\n                    copyAnchorStyles: false\n                }).data(\"kendoPopup\");\n            },\n\n            _sort: function() {\n                var template = kendo.template(FilterMenu.templates.menuItem);\n                var messages = kendo.spreadsheet.messages.filterMenu;\n                var items = [\n                    { command: \"sort\", dir: \"asc\", text: messages.sortAscending, iconClass: \"sort-asc\" },\n                    { command: \"sort\", dir: \"desc\", text: messages.sortDescending, iconClass: \"sort-desc\" }\n                ];\n\n                var ul = $(\"<ul></ul>\", {\n                    \"html\": kendo.render(template, items)\n                }).appendTo(this.element);\n\n                this.menu = ul.kendoMenu({\n                    orientation: \"vertical\",\n                    select: function(e) {\n                        var dir = $(e.item).data(\"dir\");\n                        var range = this.options.range.resize({ top: 1 });\n                        var options = {\n                            value: dir,\n                            sheet: false,\n                            operatingRange: range,\n                            column: this.options.column\n                        };\n\n                        this.action({ command: \"SortCommand\", options: options });\n                    }.bind(this)\n                }).data(\"kendoMenu\");\n            },\n\n            _appendTemplate: function(template, className, details, expanded) {\n                var compiledTemplate = kendo.template(template);\n                var wrapper = $(\"<div class='\" + className + \"'/>\").html(compiledTemplate({\n                    messages: kendo.spreadsheet.messages.filterMenu,\n                    guid: kendo.guid(),\n                    ns: kendo.ns\n                }));\n\n                this.element.append(wrapper);\n\n                if (details) {\n                    details = new Details(wrapper, { expanded: expanded, toggle: this._detailToggle.bind(this) }); \n                }\n\n                kendo.bind(wrapper, this.viewModel);\n\n                return wrapper;\n            },\n\n            _detailToggle: function(e) {\n                this.element\n                    .find(\"[\" + kendo.attr(\"role\") + \"=details]\")\n                    .not(e.sender.element)\n                    .data(\"kendoDetails\")\n                    .toggle(!e.show);\n            },\n\n            _filterByCondition: function() {\n                var isExpanded = this.viewModel.active === \"custom\";\n                this._appendTemplate(FilterMenu.templates.filterByCondition, FilterMenu.classNames.filterByCondition, true, isExpanded);\n            },\n\n            _filterByValue: function() {\n                var isExpanded = this.viewModel.active === \"value\";\n                var wrapper = this._appendTemplate(FilterMenu.templates.filterByValue, FilterMenu.classNames.filterByValue, true, isExpanded);\n\n                this.valuesTreeView = wrapper.find(\"[\" + kendo.attr(\"role\") + \"=treeview]\").data(\"kendoTreeView\");\n\n                var values = FilterMenuController.valuesTree(this.options.range, this.options.column);\n\n                this.viewModel.set(\"valuesDataSource\", new kendo.data.HierarchicalDataSource({ data: values, accentFoldingFiltering: kendo.culture().name }));\n            },\n\n            _actionButtons: function() {\n                this._appendTemplate(FilterMenu.templates.actionButtons, FilterMenu.classNames.actionButtons, false);\n            },\n\n            _active: function() {\n                var activeContainer = this.element.find(\"[\" + kendo.attr(\"role\") + \"=details]\").filter(function(index, element) {\n                    return $(element).data(\"kendoDetails\").visible();\n                });\n\n                if (activeContainer.hasClass(FilterMenu.classNames.filterByValue)) {\n                    this.viewModel.set(\"active\", \"value\");\n                } else if (activeContainer.hasClass(FilterMenu.classNames.filterByCondition)) {\n                    this.viewModel.set(\"active\", \"custom\");\n                }\n            }\n        });\n\n        kendo.spreadsheet.FilterMenu = FilterMenu;\n        $.extend(true, FilterMenu, { classNames: classNames, templates: templates });\n\n    })(window.kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/editor',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    var SheetEditor = kendo.Observable.extend({\n        init: function(view) {\n            kendo.Observable.fn.init.call(this);\n\n            this.view = view;\n            this.formulaBar = view.formulaBar;\n            this._active = false;\n\n            this.barInput = view.formulaBar.formulaInput;\n            this.cellInput = view.formulaInput;\n\n            this.barInput.syncWith(this.cellInput);\n            this.cellInput.syncWith(this.barInput);\n\n            this.barInput.bind(\"keyup\", this._triggerUpdate.bind(this));\n            this.cellInput.bind(\"keyup\", this._triggerUpdate.bind(this));\n\n            this.barInput.bind(\"blur\", this._blur.bind(this));\n            this.cellInput.bind(\"blur\", this._blur.bind(this));\n        },\n\n        events: [\n            \"activate\",\n            \"deactivate\",\n            \"change\",\n            \"update\"\n        ],\n\n        _blur: function() {\n            this.deactivate();\n        },\n\n        _triggerUpdate: function() {\n            this.trigger(\"update\", { value: this.value() });\n        },\n\n        activeEditor: function() {\n            var editor = null;\n            var activeElement = kendo._activeElement();\n\n            if (this.barElement()[0] === activeElement) {\n                editor = this.barInput;\n            } else if (this.cellElement()[0] === activeElement) {\n                editor = this.cellInput;\n            }\n\n            return editor;\n        },\n\n        activate: function(options) {\n            var viewElement = this.view.element,\n                viewWidth, scrollerElement, scrollbarWidth;\n\n            this._active = true;\n            this._rect = options.rect;\n            this._range = options.range;\n\n            this.cellInput.position(options.rect);\n            this.cellInput.resize(options.rect);\n            this.cellInput.tooltip(options.tooltip);\n            this.cellInput.activeCell = this.barInput.activeCell = this._range.topLeft();\n            this.cellInput.activeSheet = this.barInput.activeSheet = this._range._sheet;\n\n            if(viewElement) {\n                viewWidth = viewElement.width();\n                scrollerElement = viewElement.find(\".k-spreadsheet-scroller\")[0];\n                scrollbarWidth = scrollerElement.offsetWidth - scrollerElement.clientWidth;\n\n                this.cellInput.element.css(\"max-width\", viewWidth - scrollbarWidth - this.cellInput.element.position().left + \"px\");\n            }\n\n            this.trigger(\"activate\");\n\n            return this;\n        },\n\n        deactivate: function(noChange) {\n            var cellInput = this.cellInput;\n\n            if (!this._active) {\n                return;\n            }\n\n            this._active = false;\n\n            if (!noChange && cellInput.value() != this._value) {\n                this.trigger(\"change\", {\n                    value: cellInput.value(),\n                    range: this._range\n                });\n            }\n\n            this._rect = null;\n            cellInput.hide();\n            this.trigger(\"deactivate\");\n        },\n\n        enable: function(enable) {\n            this.barInput.enable(enable);\n            this.cellInput.enable(enable);\n        },\n\n        barElement: function() {\n            return this.barInput.element;\n        },\n\n        cellElement: function() {\n            return this.cellInput.element;\n        },\n\n        focus: function(inputType) {\n            inputType = inputType || \"cell\";\n\n            if (inputType === \"cell\") {\n                this.cellInput.element.trigger(\"focus\");\n                this.cellInput.end();\n            } else {\n                this.barInput.element.trigger(\"focus\");\n            }\n        },\n\n        isActive: function() {\n            return this._active;\n        },\n\n        isFiltered: function() {\n            return this.barInput.popup.visible() || this.cellInput.popup.visible();\n        },\n\n        canInsertRef: function(isKeyboardAction) {\n            var editor = this.activeEditor();\n            return editor && editor.canInsertRef(isKeyboardAction);\n        },\n\n        highlightedRefs: function() {\n            var editor = this.activeEditor();\n            var refs = [];\n\n            if (editor) {\n                refs = editor.highlightedRefs();\n            }\n\n            return refs;\n        },\n\n        scale: function() {\n            this.cellInput.scale();\n        },\n\n        toggleTooltip: function(rect) {\n            this.cellInput.toggleTooltip(notEqual(this._rect, rect));\n        },\n\n        value: function(value, isArrayFormula) {\n            if (value === undefined) {\n                return this.barInput.value();\n            }\n\n            if (value === null) {\n                value = \"\";\n            }\n\n            this._value = value;\n\n            this.barInput.value(value);\n            this.cellInput.value(value);\n\n            this.barInput.element.toggleClass(\"k-spreadsheet-array-formula\", !!isArrayFormula);\n        },\n\n        insertNewline: function() {\n            this.activeEditor().insertNewline();\n            this.scale();\n        },\n\n        select: function() {\n            this.activeEditor().select();\n        }\n    });\n\n    function notEqual(oldRect, newRect) {\n        return oldRect && (oldRect.top !== newRect.top || oldRect.left !== newRect.left);\n    }\n\n    kendo.spreadsheet.SheetEditor = SheetEditor;\n})(kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n// -*- fill-column: 100 -*-\n\n(function(f, define){\n    define('spreadsheet/autofill',[ \"./runtime\", \"./range\" ], f);\n})(function(){\n    \"use strict\";\n\n    var spreadsheet = kendo.spreadsheet;\n    var Range = spreadsheet.Range;\n    var runtime = spreadsheet.calc.runtime;\n    var Formula = runtime.Formula;\n\n    var ERR_INCOMPATIBLE = \"incompatibleRanges\";\n    var ERR_NO_DIRECTION = \"noFillDirection\";\n\n    var FillError = Range.FillError = function(msg) {\n        this.code = msg;\n    };\n\n    // `srcRange`: the range containing data that we wish to fill.  `direction`: 0, 1, 2, 3.  So\n    // when bit 0 is set we're doing horizontal filling, and when bit 1 is set we're doing it in\n    // reverse order.\n    Range.prototype._previewFillFrom = function(srcRange, direction) {\n        var destRange = this, sheet = destRange._sheet;\n        if (typeof srcRange == \"string\") {\n            srcRange = sheet.range(srcRange);\n        }\n        var src = srcRange._ref.toRangeRef().clone().setSheet(sheet.name());\n        var dest = destRange._ref.toRangeRef().clone().setSheet(sheet.name());\n\n        if (src.intersects(dest)) {\n            // the UI will send e.g. C2:C8.fillFrom(C7:D8) (intersecting ranges).  this figures out\n            // the actual destination range.\n            if (src.eq(dest)) {\n                return null; // nothing to do\n            }\n            dest = dest.clone();\n            if (src.topLeft.eq(dest.topLeft)) {\n                if (src.width() == dest.width()) {\n                    dest.topLeft.row += src.height();\n                    direction = 0;\n                } else if (src.height() == dest.height()) {\n                    dest.topLeft.col += src.width();\n                    direction = 1;\n                } else {\n                    throw new FillError(ERR_INCOMPATIBLE);\n                }\n            } else if (src.bottomRight.eq(dest.bottomRight)) {\n                if (src.width() == dest.width()) {\n                    dest.bottomRight.row -= src.height();\n                    direction = 2;\n                } else if (src.height() == dest.height()) {\n                    dest.bottomRight.col -= src.width();\n                    direction = 3;\n                } else {\n                    throw new FillError(ERR_INCOMPATIBLE);\n                }\n            } else {\n                throw new FillError(ERR_INCOMPATIBLE);\n            }\n            return sheet.range(dest)._previewFillFrom(srcRange, direction);\n        }\n\n        if (direction == null) {\n            // try to determine based on ranges location/geometry\n            if (src.topLeft.col == dest.topLeft.col) {\n                // assume vertical filling\n                direction = src.topLeft.row < dest.topLeft.row ? 0 : 2;\n            } else if (src.topLeft.row == dest.topLeft.row) {\n                direction = src.topLeft.col < dest.topLeft.col ? 1 : 3;\n            } else {\n                throw new FillError(ERR_NO_DIRECTION);\n            }\n        }\n        var horizontal = direction & 1;\n        var descending = direction & 2;\n        if ((horizontal && src.height() != dest.height()) ||\n            (!horizontal && src.width() != dest.width())) {\n            throw new FillError(ERR_INCOMPATIBLE);\n        }\n        var data = srcRange._properties(), n;\n        if (!horizontal) {\n            data = transpose(data);\n            n = dest.height();\n        } else {\n            n = dest.width();\n        }\n        var fill = new Array(data.length);\n        var hint = null;\n        for (var i = 0; i < data.length; ++i) {\n            var s = data[i];\n            var f = findSeries(s);\n            var a = fill[i] = new Array(n);\n            for (var j = 0; j < n; ++j) {\n                var idx = descending ? -j - 1 : s.length + j;\n                var srcIdx = descending ? s.length - (j % s.length) - 1 : (j % s.length);\n                var cell = a[descending ? n - j - 1 : j] = f(idx, srcIdx);\n                if (cell.value != null) {\n                    hint = cell.value;\n                }\n            }\n        }\n        if (!horizontal) {\n            fill = transpose(fill);\n        }\n        return { props: fill, direction: direction, dest: destRange, hint: hint };\n    };\n\n    Range.prototype.fillFrom = function(srcRange, direction) {\n        var x = this._previewFillFrom(srcRange, direction);\n        x.dest._properties(x.props, true);\n        return x.dest;\n    };\n\n    // This is essentially the FORECAST function, see ./runtime.functions.2.js.\n    // It receives an array of values, and returns a function that \"predicts\"\n    // the value in cell N.\n    function linearRegression(data) {\n        var N = data.length;\n        var mx = (N + 1) / 2, my = data.reduce(function(a, b){\n            return a + b;\n        }, 0) / N;\n        var s1 = 0, s2 = 0;\n        for (var i = 0; i < N; i++) {\n            var t1 = (i + 1) - mx, t2 = data[i] - my;\n            s1 += t1 * t2;\n            s2 += t1 * t1;\n        }\n        if (!s2) {\n            return function(N){\n                return data[N % data.length];\n            };\n        }\n        var b = s1 / s2, a = my - b * mx;\n        return function(N) {\n            return a + b * (N + 1);\n        };\n    }\n\n    function findSeries(properties) {\n        function findStep(a) {\n            var diff = a[1] - a[0];\n            for (var i = 2; i < a.length; ++i) {\n                if (a[i] - a[i-1] != diff) {\n                    return null;\n                }\n            }\n            return diff;\n        }\n        function getData(a) {\n            return a.map(function(v){\n                return v.number;\n            });\n        }\n        var series = [];\n        var data = properties.map(function(x){\n            return x.formula || x.value;\n        });\n        forEachSeries(data, function(begin, end, type, a){\n            var f, values;\n            if (type == \"number\") {\n                values = getData(a);\n\n                // This code would increase a date even if a single cell was selected.  Seems it's\n                // not desirable so I commented it out.\n                // https://github.com/telerik/kendo-ui-core/issues/3565\n                //\n                // if (values.length == 1 && (begin > 0 || end < data.length ||\n                //                            formatType(values[0], properties[begin].format) == \"date\")) {\n                //     values.push(values[0] + 1);\n                // }\n\n                f = linearRegression(values);\n            } else if (type == \"string\" || type == \"formula\" || type == \"boolean\") {\n                // formulas are simply copied over; the sheet will internally clone the objects\n                f = function(N, i) {\n                    return data[i];\n                };\n            } else if (Array.isArray(type)) {\n                if (a.length == 1) {\n                    f = function(N) {\n                        return type[(a[0].number + N) % type.length];\n                    };\n                } else {\n                    // figure out the step\n                    var diff = findStep(getData(a));\n                    if (diff == null) {\n                        // seemingly no pattern, just repeat those strings\n                        f = function(N) {\n                            return a[(N) % a.length].value;\n                        };\n                    } else {\n                        f = function(N) {\n                            var idx = a[0].number + diff * N;\n                            return type[idx % type.length];\n                        };\n                    }\n                }\n            } else if (type != \"null\") {\n                values = getData(a);\n                if (values.length == 1) {\n                    values.push(values[0] + 1);\n                }\n                values = linearRegression(values);\n                f = function(N, i) {\n                    return data[i].replace(/^(.*[\\D0]+)\\d+/, \"$1\" + values(N, i));\n                };\n            } else {\n                f = function() { return null; };\n            }\n            var s = { f: f, begin: begin, end: end, len: end - begin };\n            for (var i = begin; i < end; ++i) {\n                series[i] = s;\n            }\n        });\n        return function(N, i) {\n            var s = series[i];\n            var q = N / data.length | 0;\n            var r = N % data.length;\n            var n = q * s.len + r - s.begin;\n            var value = s.f(n, i);\n            var props = clone(properties[i]);\n            delete props.enable;\n            if (value instanceof Formula) {\n                props.formula = value;\n            } else {\n                props.value = value;\n            }\n            return props;\n        };\n    }\n\n    // function formatType(value, format) {\n    //     if (format != null) {\n    //         return spreadsheet.formatting.type(value, format);\n    //     }\n    // }\n\n    function clone(obj) {\n        var copy = {};\n        Object.keys(obj || {}).forEach(function(key){\n            copy[key] = obj[key];\n        });\n        return copy;\n    }\n\n    function forEachSeries(data, f) {\n        var prev = null, start = 0, a = [], type;\n        for (var i = 0; i < data.length; ++i) {\n            type = getType(data[i]);\n            a.push(type);\n            if (prev != null && type.type !== prev.type) {\n                f(start, i, prev.type, a.slice(start, i));\n                start = i;\n            }\n            prev = type;\n        }\n        f(start, i, prev.type, a.slice(start, i));\n    }\n\n    function getType(el) {\n        if (typeof el == \"number\") {\n            return { type: \"number\", number: el };\n        }\n        if (typeof el == \"string\") {\n            var lst = findStringList(el);\n            if (lst) {\n                return lst;\n            }\n            var m = /^(.*\\D)(\\d+)/.exec(el);\n            if (m) {\n                el = el.replace(/^(.*\\D)\\d+/, \"$1-######\");\n                return { type: el, match: m, number: parseFloat(m[2]) };\n            }\n            return { type: \"string\" };\n        }\n        if (typeof el == \"boolean\") {\n            return { type: \"boolean\" };\n        }\n        if (el == null) {\n            return { type: \"null\" };\n        }\n        if (el instanceof Formula) {\n            return { type: \"formula\" };\n        }\n        window.console.error(el);\n        throw new Error(\"Cannot fill data\");\n    }\n\n    function stringLists() {\n        var culture = kendo.culture();\n        return [\n            culture.calendars.standard.days.namesAbbr,\n            culture.calendars.standard.days.names,\n            culture.calendars.standard.months.namesAbbr,\n            culture.calendars.standard.months.names\n        ];\n    }\n\n    function findStringList(str) {\n        var strl = str.toLowerCase();\n        var lists = stringLists();\n        for (var i = 0; i < lists.length; ++i) {\n            var a = lists[i];\n            for (var j = a.length; --j >= 0;) {\n                var el = a[j].toLowerCase();\n                if (el == strl) {\n                    return { type: a, number: j, value: str };\n                }\n            }\n        }\n    }\n\n    function transpose(a) {\n        var height = a.length, width = a[0].length;\n        var t = [];\n        for (var i = 0; i < width; ++i) {\n            t[i] = [];\n            for (var j = 0; j < height; ++j) {\n                t[i][j] = a[j][i];\n            }\n        }\n        return t;\n    }\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/nameeditor',[ \"kendo.core\" ], f);\n})(function(){\n\n(function(kendo) {\n\n    var $ = kendo.jQuery;\n\n    var CLASS_NAMES = {\n        input: \"k-spreadsheet-name-editor\",\n        list: \"k-spreadsheet-name-list\"\n    };\n\n    var NameEditor = kendo.ui.Widget.extend({\n        init: function(element, options) {\n            kendo.ui.Widget.call(this, element, options);\n            element.addClass(CLASS_NAMES.input);\n\n            var comboBoxTitle = options.messages.nameBox || \"Name Box\";\n            var dataSource = new kendo.data.DataSource({\n                transport: {\n                    read: function(options) {\n                        var data = [];\n                        this._workbook.forEachName(function(def){\n                            if (!def.hidden && def.value instanceof kendo.spreadsheet.Ref) {\n                                data.push({ name: def.name });\n                            }\n                        });\n                        options.success(data);\n                    }.bind(this),\n                    cache: false\n                }\n            });\n\n            var comboElement = $(\"<input />\")\n                .attr(\"title\", comboBoxTitle)\n                .attr(\"aria-label\", comboBoxTitle);\n\n            this.combo = comboElement.appendTo(element)\n                .kendoComboBox({\n                    clearButton: false,\n                    dataTextField: \"name\",\n                    dataValueField: \"name\",\n                    template: \"#:data.name#<a role='button' class='k-button-delete' href='\\\\#'><span class='k-icon k-i-close'></span></a>\",\n                    dataSource: dataSource,\n                    autoBind: false,\n                    ignoreCase: true,\n                    change: this._on_listChange.bind(this),\n                    noDataTemplate: \"<div></div>\",\n                    open: function() {\n                        dataSource.read();\n                    }\n                }).getKendoComboBox();\n\n            this.combo.input\n                .on(\"keydown\", this._on_keyDown.bind(this))\n                .on(\"focus\", this._on_focus.bind(this));\n\n            this.combo.popup.element\n                .addClass(\"k-spreadsheet-names-popup\")\n\n                .on(\"mousemove\", function(ev){\n                    // XXX: should remove this when we find a better\n                    // solution for the popup closing as we hover the\n                    // resize handles.\n                    ev.stopPropagation();\n                })\n\n                .on(\"click\", \".k-button-delete\", function(ev){\n                    ev.preventDefault();\n                    ev.stopPropagation();\n                    var item = $(ev.target).closest(\".k-item\");\n                    item = this.combo.dataItem(item);\n                    this._deleteItem(item.name);\n                }.bind(this));\n        },\n        value: function(val) {\n            if (val === undefined) {\n                return this.combo.value();\n            } else {\n                this.combo.value(val);\n            }\n        },\n        _deleteItem: function(name) {\n            this.trigger(\"delete\", { name: name });\n        },\n        _on_keyDown: function(ev) {\n            switch (ev.keyCode) {\n              case 27:\n                this.combo.value(this._prevValue);\n                this.trigger(\"cancel\");\n                break;\n              case 13:\n                this.trigger(\"enter\");\n                break;\n            }\n        },\n        _on_focus: function() {\n            this._prevValue = this.combo.value();\n        },\n        _on_listChange: function() {\n            var name = this.combo.value();\n            if (name) {\n                this.trigger(\"select\", { name: name });\n            }\n        }\n    });\n\n    kendo.spreadsheet.NameEditor = NameEditor;\n})(window.kendo);\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define){\n    define('spreadsheet/print',[ \"kendo.pdf\", \"./sheet\", \"./range\", \"./references\", \"./numformat\", \"../util/text-metrics\" ], f);\n})(function(){\n    \"use strict\";\n\n    var spreadsheet = kendo.spreadsheet;\n    var CellRef = spreadsheet.CellRef;\n    var kdrw = kendo.drawing;\n    var formatting = spreadsheet.formatting;\n    var geo = kendo.geometry;\n\n    var GUIDELINE_WIDTH = 0.8;\n\n\n\n\n    // This takes a list of row heights and the page height, and\n    // produces a list of Y coordinates for each row, such that rows\n    // are not truncated across pages.  However, the algorithm will\n    // decide to truncate a row in the event that more than\n    // `maxEmpty` (default 0.2) of the available space would\n    // otherwise be left blank.\n    //\n    // It will be used for horizontal splitting too (will receive\n    // column widths and page width, and produce a list of X coords).\n    //\n    // If the third argument (headerRows) is not null, it specifies a\n    // number of rows to repeat on each page.  On pages other than the\n    // first, the necessary space will be skipped at the top.  Header\n    // coordinates (except for the first page) are pushed in\n    // headerCoords.\n    function distributeCoords(heights, pageHeight, maxEmpty, headerRows, headerCoords) {\n        var curr = 0;\n        var out = [];\n        var bottom = pageHeight;\n        var header = 0;\n        if (pageHeight && maxEmpty) {\n            maxEmpty *= pageHeight;\n        }\n        heights.forEach(function(h, i){\n            if (headerRows != null && i < headerRows) {\n                header += h;\n            }\n            if (pageHeight && curr + h > bottom) {\n                if (bottom - curr < maxEmpty) {\n                    // align to next page\n                    curr = pageHeight * Math.ceil(curr / pageHeight) + header;\n                    if (header > 0) {\n                        headerCoords.push(curr - header);\n                    }\n                }\n                // update bottom anyway; don't just add pageHeight, as\n                // we might need multiple pages for the pathological\n                // case of one row higher than the page.\n                bottom += pageHeight * Math.ceil(h / pageHeight);\n            }\n            out.push(curr);\n            curr += h;\n        });\n        out.push(curr);\n        return out;\n    }\n\n    function doLayout(sheet, range, options) {\n        // normalize reference so we don't have to deal with Infinity here.\n        var grid = sheet._grid;\n        range = grid.normalize(range);\n\n        var wholeRect = grid.rectangle(range);\n        var drawings = [];\n        sheet._drawings.forEach(function(d) {\n            var box = sheet.drawingBoundingBox(d);\n            if (box.intersects(wholeRect)) {\n                drawings.push({\n                    drawing: d,\n                    box: box.offset(-wholeRect.left, -wholeRect.top)\n                });\n            }\n        });\n\n        // 1. obtain the list of cells that need to be printed, the\n        //    row heights and column widths.  Place in each cell row,\n        //    col (relative to range, i.e. first is 0,0), rowspan,\n        //    colspan and merged.  also place a list of drawings\n        //    anchored to that cell.\n        var cells = [];\n        var rowHeights = [];\n        var colWidths = [];\n        var mergedCells = sheet._getMergedCells(range);\n\n        var maxRow = -1, maxCol = -1;\n        sheet.forEach(range, function(row, col, cell){\n            var relrow = row - range.topLeft.row;\n            var relcol = col - range.topLeft.col;\n            var rh = sheet.rowHeight(row);\n            var cw = sheet.columnWidth(col);\n            if (!options.forScreen) {\n                // for printing we'll need the list of anchored\n                // drawings so that we can adjust them after page\n                // splitting.\n                cell.drawings = drawings.filter(function(d){\n                    var tl = d.drawing.topLeftCell;\n                    if (tl && tl.row == row && tl.col == col) {\n                        maxRow = Math.max(maxRow, sheet._rows.index(d.box.bottom));\n                        maxCol = Math.max(maxCol, sheet._columns.index(d.box.right));\n                        return true;\n                    }\n                });\n            }\n            if (!relcol) {\n                rowHeights.push(rh);\n            }\n            if (!relrow) {\n                colWidths.push(cw);\n            }\n            var id = new CellRef(row, col).print();\n            if (mergedCells.secondary[id]) {\n                return;\n            }\n            cell.row = relrow;\n            cell.col = relcol;\n            var m = mergedCells.primary[id];\n            if (m) {\n                delete mergedCells.primary[id];\n                cell.merged = true;\n                cell.rowspan = m.height();\n                cell.colspan = m.width();\n                if (options.forScreen) {\n                    cell.width = sheet._columns.sum(m.topLeft.col, m.bottomRight.col);\n                    cell.height = sheet._rows.sum(m.topLeft.row, m.bottomRight.row);\n                }\n            } else {\n                cell.rowspan = 1;\n                cell.colspan = 1;\n            }\n            if (!sheet._grid._columns.sum(col, col + cell.colspan - 1) ||\n                !sheet._grid._rows.sum(row, row + cell.rowspan - 1)) {\n                return;\n            }\n            var nonEmpty = options.forScreen || shouldDrawCell(cell);\n            if (!(options.emptyCells || nonEmpty)) {\n                return;\n            }\n            if (nonEmpty) {\n                maxRow = Math.max(maxRow, relrow + cell.rowspan - 1);\n                maxCol = Math.max(maxCol, relcol + cell.colspan - 1);\n            } else {\n                cell.empty = true;\n            }\n            cells.push(cell);\n        });\n\n        if (!options.forScreen) {\n            // keep only the drawable area\n            rowHeights = rowHeights.slice(0, maxRow + 1);\n            colWidths = colWidths.slice(0, maxCol + 1);\n        }\n\n        var pageWidth = options.pageWidth;\n        var pageHeight = options.pageHeight;\n        var scaleFactor = options.scale || 1;\n\n        // when fitWidth is requested, we must update the page size\n        // with the corresponding scale factor; the algorithm below\n        // (2) will continue to work, just drawing on a bigger page.\n        if (options.fitWidth) {\n            var width = colWidths.reduce(sum, 0);\n            if (width > pageWidth) {\n                scaleFactor = pageWidth / width;\n            }\n        }\n        pageWidth = Math.ceil(pageWidth / scaleFactor);\n        pageHeight = Math.ceil(pageHeight / scaleFactor);\n\n        // 2. calculate top, left, bottom, right, width and height for\n        //    printable cells.  Merged cells will be split across\n        //    pages, unless the first row/col is shifted to next page.\n        //    boxWidth and boxHeight get the complete drawing size.\n        //    Note that cell coordinates keep increasing, i.e. they\n        //    are not reset to zero for a new page.  The print\n        //    function translates the view to current page.\n        var hyCoords = []; // will receive header Y coordinates, if needed\n        var yCoords = distributeCoords(rowHeights, pageHeight || 0, options.maxEmpty,\n                                       options.headerRows, hyCoords);\n        var xCoords = distributeCoords(colWidths, pageWidth || 0, options.maxEmpty);\n        var boxWidth = 0;\n        var boxHeight = 0;\n        var headerCells = [];\n        cells = cells.filter(function(cell){\n            if (cell.empty && (cell.row > maxRow || cell.col > maxCol)) {\n                return false;\n            }\n            if (options.headerRows && cell.row < options.headerRows) {\n                headerCells.push(cell);\n            }\n            cell.left = xCoords[cell.col];\n            cell.top = yCoords[cell.row];\n            if (cell.merged) {\n                if (!options.forScreen) {\n                    cell.right = orlast(xCoords, cell.col + cell.colspan);\n                    cell.bottom = orlast(yCoords, cell.row + cell.rowspan);\n                    cell.width = cell.right - cell.left;\n                    cell.height = cell.bottom - cell.top;\n                } else {\n                    cell.right = cell.left + cell.width;\n                    cell.bottom = cell.top + cell.height;\n                }\n            } else {\n                cell.width = colWidths[cell.col];\n                cell.height = rowHeights[cell.row];\n                cell.bottom = cell.top + cell.height;\n                cell.right = cell.left + cell.width;\n            }\n            if (!options.forScreen) {\n                // page breaking will shift cell coordinates.  adjust\n                // anchored drawings.\n                cell.drawings.forEach(function(d){\n                    var box = d.box;\n                    box.left = cell.left + d.drawing.offsetX;\n                    box.top = cell.top + d.drawing.offsetY;\n                    box.right = box.left + box.width;\n                    box.bottom = box.top + box.height;\n                });\n            }\n            boxWidth = Math.max(boxWidth, cell.right);\n            boxHeight = Math.max(boxHeight, cell.bottom);\n            return true;\n        });\n\n        // 3. if any merged cells remain in \"primary\", they start\n        //    outside the printed range and we should still display\n        //    them partially.\n        Object.keys(mergedCells.primary).forEach(function(id){\n            var ref = mergedCells.primary[id];\n            sheet.forEach(ref.topLeft.toRangeRef(), function(row, col, cell){\n                var relrow = row - range.topLeft.row;\n                var relcol = col - range.topLeft.col;\n                cell.merged = true;\n                cell.colspan = ref.width();\n                cell.rowspan = ref.height();\n                if (relrow < 0) {\n                    cell.top = -sheet._rows.sum(row, row - relrow - 1);\n                } else {\n                    cell.top = yCoords[relrow];\n                }\n                if (relcol < 0) {\n                    cell.left = -sheet._columns.sum(col, col - relcol - 1);\n                } else {\n                    cell.left = xCoords[relcol];\n                }\n                cell.height = sheet._rows.sum(ref.topLeft.row, ref.bottomRight.row);\n                cell.width = sheet._columns.sum(ref.topLeft.col, ref.bottomRight.col);\n                if (cell.height > 0 && cell.width > 0) {\n                    // zero means a fully hidden merged cell (all rows/columns are hidden)\n                    // https://github.com/telerik/kendo-ui-core/issues/1794\n                    cell.right = cell.left + cell.width;\n                    cell.bottom = cell.top + cell.height;\n                    cell.row = relrow;\n                    cell.col = relcol;\n                    cells.push(cell);\n                }\n            });\n        });\n\n        // 4. replicate header rows on all pages\n        if (options.headerRows) {\n            hyCoords.forEach(function(y){\n                headerCells.forEach(function(cell){\n                    cell = clone(cell);\n                    cell.top += y;\n                    cell.bottom = cell.top + cell.height;\n                    cells.push(cell);\n                });\n                yCoords.push(y);\n            });\n            yCoords.sort(orderCoords);\n        }\n\n        return {\n            width    : boxWidth,\n            height   : boxHeight,\n            cells    : cells.sort(orderCells),\n            scale    : scaleFactor,\n            xCoords  : xCoords,\n            yCoords  : yCoords,\n            drawings : drawings\n        };\n    }\n\n    function clone(hash, target) {\n        if (!target) {\n            target = {};\n        }\n        if (Object.assign) {\n            return Object.assign(target, hash);\n        }\n        return Object.keys(hash).reduce(function(copy, key){\n            copy[key] = hash[key];\n            return copy;\n        }, target);\n    }\n\n    function sameBorder(a, b) {\n        return a.size === b.size && a.color === b.color;\n    }\n\n    function sum(a, b) {\n        return a + b;\n    }\n\n    function orlast(a, i) {\n        return i < a.length ? a[i] : a[a.length - 1];\n    }\n\n    function shouldDrawCell(cell) {\n        return cell.value != null\n            || cell.merged\n            || cell.background != null\n            || cell.borderRight != null\n            || cell.borderBottom != null\n            || (cell.validation != null && !cell.validation.value)\n            || (cell.drawings && cell.drawings.length);\n    }\n\n    function orderCells(a, b) {\n        if (a.top < b.top) {\n            return -1;\n        } else if (a.top == b.top) {\n            if (a.left < b.left) {\n                return -1;\n            } else if (a.left == b.left) {\n                return 0;\n            } else {\n                return 1;\n            }\n        } else {\n            return 1;\n        }\n    }\n\n    function orderCoords(a, b) {\n        return a < b ? -1 : a > b ? 1 : 0;\n    }\n\n    function drawLayout(sheet, layout, group, options) {\n        // options:\n        // - pageWidth\n        // - pageHeight\n        // - fitWidth\n        // - hCenter\n        // - vCenter\n        var ncols = Math.ceil(layout.width / options.pageWidth);\n        var nrows = Math.ceil(layout.height / options.pageHeight);\n        var pageWidth = Math.ceil(options.pageWidth / layout.scale);\n        var pageHeight = Math.ceil(options.pageHeight / layout.scale);\n\n        for (var j = 0; j < nrows; ++j) {\n            for (var i = 0; i < ncols; ++i) {\n                addPage(j, i);\n            }\n        }\n\n        function addPage(row, col) {\n            var left = col * pageWidth;\n            var right = left + pageWidth;\n            var top = row * pageHeight;\n            var bottom = top + pageHeight;\n            var endbottom = 0, endright = 0;\n\n            function isInside(box) {\n                if (box.right <= left || box.left >= right ||\n                    box.bottom <= top || box.top >= bottom) {\n                    return false;\n                }\n                endbottom = Math.max(box.bottom, endbottom);\n                endright = Math.max(box.right, endright);\n                return true;\n            }\n\n            // XXX: this can be optimized - discard cells that won't\n            // be used again, and don't walk cells that stand no\n            // chance to fit.\n            var cells = layout.cells.filter(isInside);\n\n            var drawings = layout.drawings.filter(function(d){\n                return isInside(d.box);\n            });\n\n            // merged cells might stretch beyond page; limit to that\n            endbottom = Math.min(endbottom, bottom);\n            endright = Math.min(endright, right);\n\n            if (cells.length || drawings.length) {\n                var page = new kdrw.Group();\n                group.append(page);\n                // page.clip(drawing.Path.fromRect(\n                //     new geo.Rect([ 0, 0 ],\n                //                  [ options.pageWidth, options.pageHeight ])));\n\n                var content = new kdrw.Group();\n                page.append(content);\n\n                content.clip(kdrw.Path.fromRect(\n                    new geo.Rect([ left - 1, top - 1 ], [ endright + 1, endbottom + 1 ])\n                ));\n\n                var matrix = geo.Matrix.scale(layout.scale, layout.scale)\n                    .multiplyCopy(geo.Matrix.translate(-left, -top));\n\n                if (options.hCenter || options.vCenter) {\n                    matrix = matrix.multiplyCopy(\n                        geo.Matrix.translate(\n                            options.hCenter ? (right - endright) / 2 : 0,\n                            options.vCenter ? (bottom - endbottom) / 2 : 0)\n                    );\n                }\n\n                content.transform(matrix);\n\n                if (options.guidelines) {\n                    var prev = null;\n                    layout.xCoords.forEach(function(x){\n                        x = Math.min(x, endright);\n                        if (x !== prev && x >= left && x <= right) {\n                            prev = x;\n                            content.append(\n                                new kdrw.Path()\n                                    .moveTo(x, top)\n                                    .lineTo(x, endbottom)\n                                    .close()\n                                    .stroke(options.guideColor, GUIDELINE_WIDTH)\n                            );\n                        }\n                    });\n                    var prev = null;\n                    layout.yCoords.forEach(function(y){\n                        y = Math.min(y, endbottom);\n                        if (y !== prev && y >= top && y <= bottom) {\n                            prev = y;\n                            content.append(\n                                new kdrw.Path()\n                                    .moveTo(left, y)\n                                    .lineTo(endright, y)\n                                    .close()\n                                    .stroke(options.guideColor, GUIDELINE_WIDTH)\n                            );\n                        }\n                    });\n                }\n\n                var borders = Borders(); \n                cells.forEach(function(cell){\n                    drawCell(cell, content, options);\n                    borders.add(cell, sheet);\n                });\n\n                var bordersGroup = new kdrw.Group();\n                borders.vert.forEach(function(a){\n                    a.forEach(function(b){\n                        if (!b.rendered) {\n                            b.rendered = true;\n                            bordersGroup.append(\n                                new kdrw.Path()\n                                    .moveTo(b.x, b.top)\n                                    .lineTo(b.x, b.bottom)\n                                    .close()\n                                    .stroke(b.color, b.size)\n                            );\n                        }\n                    });\n                });\n                borders.horiz.forEach(function(a){\n                    a.forEach(function(b){\n                        if (!b.rendered) {\n                            b.rendered = true;\n                            bordersGroup.append(\n                                new kdrw.Path()\n                                    .moveTo(b.left, b.y)\n                                    .lineTo(b.right, b.y)\n                                    .close()\n                                    .stroke(b.color, b.size)\n                            );\n                        }\n                    });\n                });\n                content.append(bordersGroup);\n\n                drawings.forEach(function(d){\n                    var drawing = d.drawing;\n                    var image = drawing.image;\n                    if (image != null) {\n                        var box = d.box;\n                        var url = sheet._workbook.imageUrl(image);\n                        content.append(\n                            new kdrw.Image(url, new geo.Rect(\n                                [ box.left, box.top ],\n                                [ box.width, box.height ]\n                            )).opacity(drawing.opacity)\n                        );\n                    }\n                });\n            }\n        }\n    }\n\n    function drawCell(cell, content, options) {\n        var g = new kdrw.Group();\n        content.append(g);\n        var rect = new geo.Rect([ cell.left, cell.top ],\n                                [ cell.width, cell.height ]);\n        if (cell.background || cell.merged) {\n            var r2d2 = rect;\n            if (options.guidelines) {\n                r2d2 = rect.clone();\n                r2d2.origin.x += GUIDELINE_WIDTH/2 + 0.1;\n                r2d2.origin.y += GUIDELINE_WIDTH/2 + 0.1;\n                r2d2.size.width -= GUIDELINE_WIDTH + 0.2;\n                r2d2.size.height -= GUIDELINE_WIDTH + 0.2;\n            }\n            g.append(\n                new kdrw.Rect(r2d2)\n                    .fill(cell.background || \"#fff\")\n                    .stroke(null)\n            );\n        }\n        var val = cell.value;\n        if (val != null) {\n            var type = typeof val == \"number\" ? \"number\" : null;\n            var clip = new kdrw.Group();\n            clip.clip(kdrw.Path.fromRect(rect));\n            g.append(clip);\n            var f, format = cell.format;\n            if (!format && type == \"number\" && val != Math.floor(val)) {\n                format = \"0.##############\";\n            }\n            if (format) {\n                f = formatting.textAndColor(val, format);\n                val = f.text;\n                if (f.type) {\n                    type = f.type;\n                }\n            } else {\n                val += \"\";\n            }\n            if (!cell.textAlign) {\n                switch (type) {\n                  case \"number\":\n                  case \"date\":\n                  case \"percent\":\n                  case \"currency\":\n                    cell.textAlign = \"right\";\n                    break;\n                  case \"boolean\":\n                    cell.textAlign = \"center\";\n                    break;\n                }\n            }\n            drawText(val, (f && f.color) || cell.color || \"#000\", cell, clip);\n        }\n    }\n\n    function applyIndent(cell, style) {\n        if (cell.indent) {\n            // OOXML spec states the indent is \"An integer value,\n            // where an increment of 1 represents 3 spaces\".  This, of\n            // course, bears no resemblance to what Excel actually\n            // does, so we need magic numbers here.\n            var indent = 1.4 * cell.indent;\n            switch (style.textAlign) {\n              case null:\n              case \"left\":\n                style.paddingLeft = indent + \"ch\";\n                break;\n              case \"right\":\n                style.paddingRight = indent + \"ch\";\n                break;\n              case \"center\":\n                style.paddingLeft = indent/2 + \"ch\";\n                style.paddingRight = indent/2 + \"ch\";\n                break;\n            }\n        }\n    }\n\n    var CONT;\n    function drawText(text, color, cell, group) {\n        if (!CONT) {\n            CONT = document.createElement(\"div\");\n            CONT.style.position = \"fixed\";\n            CONT.style.left = \"0px\";\n            CONT.style.top = \"0px\";\n            CONT.style.visibility = \"hidden\";\n            CONT.style.overflow = \"hidden\";\n            CONT.style.boxSizing = \"border-box\";\n            CONT.style.lineHeight = \"normal\";\n            document.body.appendChild(CONT);\n        }\n\n        if (CONT.firstChild) {\n            CONT.removeChild(CONT.firstChild);\n        }\n\n        CONT.style.padding = \"2px 4px\";\n        CONT.style.color = color;\n        CONT.style.font = makeFontDef(cell);\n        CONT.style.width = cell.width + \"px\";\n        CONT.style.textAlign = cell.textAlign || \"left\";\n        CONT.style.textDecoration = cell.underline ? \"underline\" : \"none\";\n\n        applyIndent(cell, CONT.style);\n\n        if (cell.wrap) {\n            CONT.style.whiteSpace = \"pre-wrap\";\n            CONT.style.overflowWrap = CONT.style.wordWrap = \"break-word\";\n        } else {\n            CONT.style.whiteSpace = \"pre\";\n            CONT.style.overflowWrap = CONT.style.wordWrap = \"normal\";\n        }\n\n        CONT.appendChild(document.createTextNode(text));\n\n        var vtrans = 0;\n        switch (cell.verticalAlign) {\n          case \"center\":\n            vtrans = (cell.height - CONT.offsetHeight) >> 1;\n            break;\n\n          case undefined:\n          case null:\n          case \"bottom\":\n            vtrans = (cell.height - CONT.offsetHeight);\n            break;\n        }\n        if (vtrans < 0) { vtrans = 0; }\n\n        var text_group  = kendo.drawing.drawDOM.drawText(CONT);\n        text_group.transform(geo.Matrix.translate(cell.left, cell.top + vtrans));\n        group.append(text_group);\n    }\n\n    function makeFontDef(cell) {\n        var font = [];\n        if (cell.italic) {\n            font.push(\"italic\");\n        }\n        if (cell.bold) {\n            font.push(\"bold\");\n        }\n        font.push((cell.fontSize || 12) + \"px\");\n        font.push((cell.fontFamily || \"Arial\"));\n        return font.join(\" \");\n    }\n\n    function draw(sheet, range, options, callback) {\n        if (options == null && callback == null) {\n            callback = range;\n            options = {};\n            range = spreadsheet.SHEETREF;\n        }\n        if (callback == null) {\n            callback = options;\n            if (range instanceof spreadsheet.Range\n                || range instanceof spreadsheet.Ref\n                || typeof range == \"string\") {\n                options = {};\n            } else {\n                options = range;\n                range = spreadsheet.SHEETREF;\n            }\n        }\n        options = kendo.jQuery.extend({\n            paperSize  : \"A4\",\n            landscape  : true,\n            margin     : \"1cm\",\n            guidelines : true,\n            guideColor : \"#aaa\",\n            emptyCells : true,\n            fitWidth   : false,\n            center     : false,\n            headerRows : null,\n            maxEmpty   : 0.2,\n            scale      : 1\n        }, options);\n        var group = new kdrw.Group();\n        var paper = kendo.pdf.getPaperOptions(options);\n        group.options.set(\"pdf\", {\n            author    : options.author,\n            creator   : options.creator,\n            date      : options.date,\n            keywords  : options.keywords,\n            margin    : paper.margin,\n            multiPage : true,\n            paperSize : paper.paperSize,\n            subject   : options.subject,\n            title     : options.title,\n            autoPrint : options.autoPrint\n        });\n        var pageWidth = paper.paperSize[0];\n        var pageHeight = paper.paperSize[1];\n        if (paper.margin) {\n            pageWidth -= paper.margin.left + paper.margin.right + 1;\n            pageHeight -= paper.margin.top + paper.margin.bottom + 1;\n        }\n        options.pageWidth = pageWidth;\n        options.pageHeight = pageHeight;\n        var layout = doLayout(sheet, sheet._ref(range), options);\n        drawLayout(sheet, layout, group, options);\n        callback(group);\n    }\n\n    spreadsheet.Sheet.prototype.draw = function(range, options, callback) {\n        var sheet = this;\n        if (sheet._workbook) {\n            sheet.recalc(sheet._workbook._context, function(){\n                draw(sheet, range, options, callback);\n            });\n        } else {\n            draw(sheet, range, options, callback);\n        }\n    };\n\n    // Hack: since we index the border arrays by relative row/col we\n    // could end up with negative indexes, i.e. horiz[-2] = border.\n    // Array forEach will ignore these, so we provide a simple\n    // container here (outside code only needs forEach at this time).\n    function Container() {}\n    Container.prototype = {\n        forEach: function(f) {\n            Object.keys(this).forEach(function(key){\n                f(this[key], key, this);\n            }, this);\n        }\n    };\n\n    function Borders() {\n        var horiz = new Container();\n        var vert = new Container();\n        function add(cell, sheet) {\n            if (sheet) {\n                // reset borders here; the propertybag doesn't keep track of merged cells :-/ this\n                // is ugly, but the inner details of data storage have leaked everywhere anyway.\n                var pb = sheet._properties;\n                var grid = sheet._grid;\n                cell.borderLeft    = pb.get(\"vBorders\", grid.index(cell.row, cell.col));\n                cell.borderRight   = pb.get(\"vBorders\", grid.index(cell.row, cell.col + cell.colspan));\n                cell.borderTop     = pb.get(\"hBorders\", grid.index(cell.row, cell.col));\n                cell.borderBottom  = pb.get(\"hBorders\", grid.index(cell.row + cell.rowspan, cell.col));\n            }\n            if (cell.borderLeft) {\n                addVert(cell.row, cell.col, cell.borderLeft,\n                        cell.left, cell.top, cell.bottom);\n            }\n            if (cell.borderRight) {\n                addVert(cell.row, cell.col + cell.colspan, cell.borderRight,\n                        cell.right, cell.top, cell.bottom);\n            }\n            if (cell.borderTop) {\n                addHoriz(cell.row, cell.col, cell.borderTop,\n                         cell.top, cell.left, cell.right);\n            }\n            if (cell.borderBottom) {\n                addHoriz(cell.row + cell.rowspan, cell.col, cell.borderBottom,\n                         cell.bottom, cell.left, cell.right);\n            }\n        }\n        function addVert(row, col, border, x, top, bottom) {\n            var a = vert[col] || (vert[col] = new Container());\n            var prev = row > 0 && a[row - 1];\n            if (prev && sameBorder(prev, border)) {\n                a[row] = prev;\n                prev.bottom = bottom;\n            } else {\n                a[row] = {\n                    size: border.size,\n                    color: border.color,\n                    x: x,\n                    top: top,\n                    bottom: bottom\n                };\n            }\n        }\n        function addHoriz(row, col, border, y, left, right) {\n            var a = horiz[row] || (horiz[row] = new Container());\n            var prev = col > 0 && a[col - 1];\n            if (prev && sameBorder(prev, border)) {\n                a[col] = prev;\n                prev.right = right;\n            } else {\n                a[col] = {\n                    size: border.size,\n                    color: border.color,\n                    y: y,\n                    left: left,\n                    right: right\n                };\n            }\n        }\n        return { add: add, horiz: horiz, vert: vert };\n    }\n\n    function drawTabularData(options) {\n        var progress = new $.Deferred();\n        var promise = progress.promise();\n\n        options = clone(options, {\n            dataSource       : null,\n            guidelines       : true,\n            guideColor       : \"#000\",\n            columns          : null,\n            headerBackground : \"#999\",\n            headerColor      : \"#000\",\n            oddBackground    : null,\n            evenBackground   : null,\n            fontFamily       : \"Arial\",\n            fontSize         : 12,\n            paperSize        : \"A4\",\n            margin           : \"1cm\",\n            landscape        : true,\n            fitWidth         : false,\n            scale            : 1,\n            rowHeight        : 20,\n            maxEmpty         : 1,\n            useGridFormat    : true\n        });\n\n        // retrieve fonts; custom fonts should be already loaded\n        kendo.drawing.pdf.defineFont(\n            kendo.drawing.drawDOM.getFontFaces(document)\n        );\n\n        var charWidth = charWidthFunction(options.fontFamily, options.fontSize);\n\n        function textWidth(value) {\n            if (value != null) {\n                var width = 12;         // magic numbers :-/\n                for (var i = value.length; --i >= 0;) {\n                    width += charWidth(value.charAt(i));\n                }\n                return width;\n            }\n            return 0;\n        }\n\n        var border = options.guidelines ? { size: 1, color: options.guideColor } : null;\n\n        function mkCell(data) {\n            if (!border) {\n                return data;\n            }\n            return clone(data, {\n                borderLeft: border,\n                borderTop: border,\n                borderRight: border,\n                borderBottom: border\n            });\n        }\n\n        options.dataSource.fetch(function(){\n            var data = options.dataSource.data();\n            if (!data.length) {\n                return progress.reject(\"Empty dataset\");\n            }\n\n            // this really must be present\n            var columns = options.columns.map(function(col){\n                if (typeof col == \"string\") {\n                    return { title: col, field: col };\n                } else {\n                    return col;\n                }\n            });\n            var columnTitles = columns.map(function(col){\n                return col.title || col.field;\n            });\n            var columnWidths = columnTitles.map(textWidth);\n\n            // prepare data for a Sheet object's fromJSON method\n            var rows = data.map(function(row, rowIndex){\n                return {\n                    cells: columns.map(function(col, colIndex){\n                        var value = row[col.field];\n\n                        // NOTE: value might not be string.  I added option useGridFormat (default\n                        // true), which will use a column's format, if present, to convert the value\n                        // to a string, so that we can measure the width right now.\n                        if (options.useGridFormat) {\n                            if (value != null) {\n                                if (col.format) {\n                                    value = kendo.format(col.format, value);\n                                } else {\n                                    value += \"\";\n                                }\n                            }\n                            // adjust the column widths while we're at it\n                            columnWidths[colIndex] = Math.max(\n                                textWidth(value),\n                                columnWidths[colIndex]\n                            );\n                        }\n\n                        // if options.useGridFormat is false and col.format is present, pass it over\n                        // to the spreadsheet.  In that case we should calculate the widths after\n                        // the spreadsheet is created (XXX to be implemented when someone needs it).\n                        return mkCell({\n                            value: value,\n                            format: options.useGridFormat ? null : col.format,\n                            background: rowIndex % 2 ? options.evenBackground : options.oddBackground\n                        });\n                    })\n                };\n            });\n\n            // insert header line\n            rows.unshift({\n                cells: columnTitles.map(function(label){\n                    return mkCell({\n                        value: label,\n                        background: options.headerBackground,\n                        color: options.headerColor\n                    });\n                })\n            });\n\n            // init a Sheet object.  Note that we have to add one\n            // extra-row and column, because the very last ones can't\n            // have right/bottom borders (known limitation).\n            var sheet = new kendo.spreadsheet.Sheet(\n                rows.length + 1,        // rows\n                columns.length + 1,     // columns\n                options.rowHeight,      // row height\n                50,                     // column width\n                20,                     // header height\n                20,                     // header width,\n                {                       // default cell style\n                    fontFamily: options.fontFamily,\n                    fontSize: options.fontSize,\n                    verticalAlign: \"center\"\n                }\n            );\n\n            // load data\n            sheet.fromJSON({\n                name: \"Sheet1\",\n                rows: rows,\n                columns: columnWidths.map(function(w, i){\n                    return { index: i, width: w };\n                })\n            });\n\n            sheet.draw({\n                paperSize  : options.paperSize,\n                landscape  : options.landscape,\n                margin     : options.margin,\n                guidelines : false, // using borders instead (better contrast)\n                scale      : options.scale,\n                fitWidth   : options.fitWidth,\n                maxEmpty   : options.maxEmpty,\n                headerRows : 1\n            }, progress.resolve.bind(progress));\n        });\n\n        return promise;\n    }\n\n    var CACHE_CHAR_WIDTH = {};\n\n    var charWidthFunction = function(fontFamily, fontSize) {\n        var id = fontSize + \":\" + fontFamily;\n        var func = CACHE_CHAR_WIDTH[id];\n        if (!func) {\n            var span, div = document.createElement(\"div\");\n            div.style.position = \"fixed\";\n            div.style.left = \"-10000px\";\n            div.style.top = \"-10000px\";\n            div.style.fontFamily = fontFamily;\n            div.style.fontSize = fontSize + \"px\";\n            div.style.whiteSpace = \"pre\";\n            for (var i = 32; i < 128; ++i) {\n                span = document.createElement(\"span\");\n                span.appendChild(document.createTextNode(String.fromCharCode(i)));\n                div.appendChild(span);\n            }\n            document.body.appendChild(div);\n            var widths = {};\n            for (i = 32, span = div.firstChild; i < 128 && span; ++i, span = span.nextSibling) {\n                widths[i] = span.offsetWidth;\n            }\n            while ((span = div.firstChild)) {\n                div.removeChild(span);\n            }\n            func = CACHE_CHAR_WIDTH[id] = function(ch) {\n                var code = ch.charCodeAt(0);\n                var width = widths[code];\n                if (width == null) {\n                    // probably not an ASCII character, let's cache its width as well\n                    span = document.createElement(\"span\");\n                    span.appendChild(document.createTextNode(String.fromCharCode(code)));\n                    div.appendChild(span);\n                    width = widths[code] = span.offsetWidth;\n                    div.removeChild(span);\n                }\n                return width;\n            };\n        }\n        return func;\n    };\n\n    spreadsheet.draw = {\n        Borders         : Borders,\n        doLayout        : doLayout,\n        applyIndent     : applyIndent\n    };\n\n    spreadsheet.drawTabularData = drawTabularData;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n(function(f, define) {\n    define('kendo.spreadsheet',[\n        \"./util/undoredostack\",\n        \"./util/text-metrics\",\n        \"./util/parse-xml\",\n        \"kendo.excel\",\n        \"kendo.progressbar\",\n        \"kendo.pdf\",\n        \"./spreadsheet/commands\",\n        \"./spreadsheet/formulabar\",\n        \"./spreadsheet/formulainput\",\n        \"./spreadsheet/eventlistener\",\n        \"./spreadsheet/rangelist\",\n        \"./spreadsheet/propertybag\",\n        \"./spreadsheet/references\",\n        \"./spreadsheet/navigator\",\n        \"./spreadsheet/axismanager\",\n        \"./spreadsheet/clipboard\",\n        \"./spreadsheet/range\",\n        \"./spreadsheet/sheet\",\n        \"./spreadsheet/sheetsbar\",\n        \"./spreadsheet/excel-reader\",\n        \"./spreadsheet/workbook\",\n        \"./spreadsheet/formulacontext\",\n        \"./spreadsheet/controller\",\n        \"./spreadsheet/view\",\n        \"./spreadsheet/customeditors\",\n        \"./spreadsheet/grid\",\n        \"./spreadsheet/axis\",\n        \"./spreadsheet/filter\",\n        \"./spreadsheet/sorter\",\n        \"./spreadsheet/runtime\",\n        \"./spreadsheet/calc\",\n        \"./spreadsheet/numformat\",\n        \"./spreadsheet/runtime.functions\",\n        \"./spreadsheet/runtime.functions.2\",\n        \"./spreadsheet/toolbar\",\n        \"./spreadsheet/dialogs\",\n        \"./spreadsheet/sheetbinder\",\n        \"./spreadsheet/filtermenu\",\n        \"./spreadsheet/editor\",\n        \"./spreadsheet/autofill\",\n        \"./spreadsheet/nameeditor\",\n        \"./spreadsheet/print\"\n    ], f);\n})(function() {\n    var __meta__ = {\n        id: \"spreadsheet\",\n        name: \"Spreadsheet\",\n        category: \"web\",\n        description: \"Spreadsheet component\",\n        depends: [\n            \"core\", \"binder\", \"colorpicker\", \"combobox\", \"data\", \"dom\", \"dropdownlist\",\n            \"menu\", \"ooxml\", \"popup\", \"sortable\", \"tabstrip\", \"toolbar\", \"treeview\",\n            \"window\", \"validator\", \"excel\", \"pdf\", \"drawing\" ]\n    };\n\n    (function(kendo, undefined) {\n        if (kendo.support.browser.msie && kendo.support.browser.version < 9) {\n            return;\n        }\n\n        var $ = kendo.jQuery;\n        var keys = $.extend({ F10: 121, F11: 122, B: 66, I: 73, U: 85, N: 78, H: 72, A: 65, PAGEDOWN: 34, PAGEUP: 33, DELETE: 46, R: 82 }, kendo.keys);\n        var Widget = kendo.ui.Widget;\n        var Workbook = kendo.spreadsheet.Workbook;\n        var Controller = kendo.spreadsheet.Controller;\n        var View = kendo.spreadsheet.View;\n        var NS = \".kendoSpreadsheet\";\n\n        var ALL_REASONS = {\n            recalc: true,\n            selection: true,\n            activeCell: true,\n            layout: true,\n            sheetSelection: true,\n            resize: true,\n            editorChange: false,\n            editorClose: false\n        };\n\n        var classNames = {\n            wrapper: \"k-widget k-spreadsheet\"\n        };\n\n        var Spreadsheet = kendo.ui.Widget.extend({\n            init: function(element, options) {\n                Widget.fn.init.call(this, element, options);\n\n                this.element.addClass(Spreadsheet.classNames.wrapper);\n                this.element.attr(\"role\", \"application\");\n\n                this._view = new View(this.element, {\n                    messages: this.options.messages.view,\n                    toolbar: this.options.toolbar,\n                    sheetsbar: this.options.sheetsbar\n                });\n\n                this._workbook = new Workbook(this.options, this._view);\n\n                this._controller = new Controller(this._view, this._workbook);\n\n                this._autoRefresh = true;\n\n                this._bindWorkbookEvents();\n\n                this._view.workbook(this._workbook);\n\n                this._view.enableClipboard(false);\n                this.refresh();\n                this._view.enableClipboard(true);\n\n                this._resizeHandler = function() { this.resize(); }.bind(this);\n                $(window).on(\"resize\" + NS, this._resizeHandler);\n\n                this.element.on(\"keydown\" + NS, this._keyDown.bind(this));\n            },\n\n            _keyDown: function(e) {\n                var key = e.keyCode;\n\n                if (key === keys.F11 && e.shiftKey) {\n                    this._view.sheetsbar._onAddSelect();\n                    e.preventDefault();\n                    return;\n                } else if (e.altKey && key === keys.PAGEDOWN) {\n                    this._view.sheetsbar.trigger(\"select\", {\n                                    name: this._view.sheetsbar._sheets[this._view.sheetsbar._selectedIndex + 1].name(),\n                                    isAddButton: false\n                    });\n                } else if (e.altKey && key === keys.PAGEUP) {\n                    this._view.sheetsbar.trigger(\"select\", {\n                                    name: this._view.sheetsbar._sheets[this._view.sheetsbar._selectedIndex - 1].name(),\n                                    isAddButton: false\n                    });\n                } else if (e.altKey && key === keys.DELETE) {\n                    var closeCallback = function(e) {\n                        var dlg = e.sender;\n\n                        if (dlg.isConfirmed()) {\n                            this._view.sheetsbar.trigger(\"remove\", { name: this.activeSheet()._name(), confirmation: true });\n                        }\n                    }.bind(this);\n\n                    this._view.sheetsbar._openDialog(\"confirmation\", {\n                        close: closeCallback\n                    });\n                    e.preventDefault();\n                    return;\n                } else if (e.altKey && key === keys.R) {\n                    this._view.sheetsbar._createEditor();\n                    e.preventDefault();\n                    return;\n                } else if (e.ctrlKey && key === keys.B) {\n                    $(\"[data-tool=bold]\")[0].click();\n                } else if (e.ctrlKey && key === keys.I) {\n                    $(\"[data-tool=italic]\")[0].click();\n                } else if (e.ctrlKey && key === keys.U) {\n                    $(\"[data-tool=underline]\")[0].click();\n                } else if (e.altKey && key === keys.H) {\n                    this._view.tabstrip.select(0);\n                    e.preventDefault();\n                    return;\n                } else if (e.altKey && key === keys.N) {\n                    this._view.tabstrip.select(1);\n                    e.preventDefault();\n                    return;\n                } else if (e.altKey && key === keys.A) {\n                    this._view.tabstrip.select(2);\n                    e.preventDefault();\n                    return;\n                }\n            },\n\n            _resize: function() {\n                this.refresh({ layout: true });\n            },\n\n            _workbookChanging: function(e) {\n                if (this.trigger(\"changing\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookChange: function(e) {\n                if (this._autoRefresh) {\n                    this.refresh(e);\n                }\n\n                if (e.recalc && e.ref) {\n                    var range = e.range || new kendo.spreadsheet.Range(e.ref, this.activeSheet());\n                    this.trigger(\"change\", { range: range });\n                }\n            },\n\n            _workbookCut: function(e) {\n                this.trigger(\"cut\", e);\n            },\n\n            _workbookCopy: function(e) {\n                this.trigger(\"copy\", e);\n            },\n\n            _workbookPaste: function(e) {\n                this.trigger(\"paste\", e);\n            },\n\n            activeSheet: function(sheet) {\n                return this._workbook.activeSheet(sheet);\n            },\n\n            moveSheetToIndex: function(sheet, index) {\n                return this._workbook.moveSheetToIndex(sheet, index);\n            },\n\n            insertSheet: function(options) {\n                return this._workbook.insertSheet(options);\n            },\n\n            sheets: function() {\n                return this._workbook.sheets();\n            },\n\n            removeSheet: function(sheet) {\n                return this._workbook.removeSheet(sheet);\n            },\n\n            sheetByName: function(sheetName) {\n                return this._workbook.sheetByName(sheetName);\n            },\n\n            sheetIndex: function(sheet) {\n                return this._workbook.sheetIndex(sheet);\n            },\n\n            sheetByIndex: function(index) {\n                return this._workbook.sheetByIndex(index);\n            },\n\n            renameSheet: function(sheet, newSheetName) {\n                return this._workbook.renameSheet(sheet, newSheetName);\n            },\n\n            refresh: function(reason) {\n                if (!reason) {\n                    reason = ALL_REASONS;\n                }\n\n                if (!reason.editorClose) {\n                    this._view.sheet(this._workbook.activeSheet());\n                    this._controller.sheet(this._workbook.activeSheet());\n\n                    this._workbook.refresh(reason);\n                }\n\n                if (!reason.editorChange) {\n                    this._view.refresh(reason);\n                    this._controller.refresh();\n\n                    this._view.render(reason);\n                    this.trigger(\"render\");\n                }\n\n                return this;\n            },\n\n            openDialog: function(name, options) {\n                return this._view.openDialog(name, options);\n            },\n\n            autoRefresh: function(value) {\n                if (value !== undefined) {\n                    this._autoRefresh = value;\n\n                    if (value === true) {\n                        this.refresh();\n                    }\n\n                    return this;\n                }\n\n                return this._autoRefresh;\n            },\n\n            toJSON: function() {\n                return this._workbook.toJSON();\n            },\n\n            fromJSON: function(json) {\n                if (json.sheets) {\n                    this._workbook.destroy();\n\n                    this._workbook = new Workbook($.extend({}, this.options, json));\n\n                    this._bindWorkbookEvents();\n\n                    this._view.workbook(this._workbook);\n                    this._controller.workbook(this._workbook);\n\n                    this.activeSheet(this.activeSheet());\n                } else {\n                    this.refresh();\n                }\n            },\n\n            saveJSON: function() {\n                return this._workbook.saveJSON();\n            },\n\n            fromFile: function(blob, name) {\n                return this._workbook.fromFile(blob, name);\n            },\n\n            saveAsPDF: function(options) {\n                this._workbook.saveAsPDF(\n                    $.extend({}, this.options.pdf, options, { workbook: this._workbook })\n                );\n            },\n\n            saveAsExcel: function(options) {\n                this._workbook.saveAsExcel(options);\n            },\n\n            draw: function(options, callback) {\n                this._workbook.draw(options, callback);\n            },\n\n            _workbookExcelExport: function(e) {\n                if (this.trigger(\"excelExport\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookExcelImport: function(e) {\n                if (this.trigger(\"excelImport\", e)) {\n                    e.preventDefault();\n                } else {\n                    this._initProgress(e.promise);\n                }\n            },\n\n            _initProgress: function(deferred) {\n                var loading =\n                    $(\"<div class='k-loading-mask' \" +\n                           \"style='width: 100%; height: 100%; top: 0;'>\" +\n                        \"<div class='k-loading-color'></div>\" +\n                    \"</div>\")\n                    .appendTo(this.element);\n\n                var pb = $(\"<div class='k-loading-progress'>\")\n                .appendTo(loading)\n                .kendoProgressBar({\n                    type: \"chunk\", chunkCount: 10,\n                    min: 0, max: 1, value: 0\n                }).data(\"kendoProgressBar\");\n\n                deferred.progress(function(e) {\n                    pb.value(e.progress);\n                })\n                .always(function() {\n                    kendo.destroy(loading);\n                    loading.remove();\n                });\n            },\n\n            _workbookPdfExport: function(e) {\n                if (this.trigger(\"pdfExport\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookInsertSheet: function(e) {\n                if (this.trigger(\"insertSheet\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookRemoveSheet: function(e) {\n                if (this.trigger(\"removeSheet\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookSelectSheet: function(e) {\n                if (this.trigger(\"selectSheet\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookRenameSheet: function(e) {\n                if (this.trigger(\"renameSheet\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookInsertRow: function(e) {\n                if (this.trigger(\"insertRow\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookInsertColumn: function(e) {\n                if (this.trigger(\"insertColumn\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookDeleteRow: function(e) {\n                if (this.trigger(\"deleteRow\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookDeleteColumn: function(e) {\n                if (this.trigger(\"deleteColumn\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookHideRow: function(e) {\n                if (this.trigger(\"hideRow\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookHideColumn: function(e) {\n                if (this.trigger(\"hideColumn\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookUnhideRow: function(e) {\n                if (this.trigger(\"unhideRow\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookUnhideColumn: function(e) {\n                if (this.trigger(\"unhideColumn\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookSelect: function(e) {\n                this.trigger(\"select\", e);\n            },\n\n            _workbookChangeFormat: function(e) {\n               this.trigger(\"changeFormat\", e);\n            },\n\n            _workbookDataBinding: function(e) {\n                if (this.trigger(\"dataBinding\", e)) {\n                    e.preventDefault();\n                }\n            },\n\n            _workbookDataBound: function(e) {\n                this.trigger(\"dataBound\", e);\n            },\n\n            _workbookProgress: function(e) {\n                kendo.ui.progress(this.element, e.toggle);\n            },\n\n            _bindWorkbookEvents: function() {\n                this._workbook.bind(\"cut\", this._workbookCut.bind(this));\n                this._workbook.bind(\"copy\", this._workbookCopy.bind(this));\n                this._workbook.bind(\"paste\", this._workbookPaste.bind(this));\n                this._workbook.bind(\"changing\", this._workbookChanging.bind(this));\n                this._workbook.bind(\"change\", this._workbookChange.bind(this));\n                this._workbook.bind(\"excelExport\", this._workbookExcelExport.bind(this));\n                this._workbook.bind(\"excelImport\", this._workbookExcelImport.bind(this));\n                this._workbook.bind(\"pdfExport\", this._workbookPdfExport.bind(this));\n                this._workbook.bind(\"insertSheet\", this._workbookInsertSheet.bind(this));\n                this._workbook.bind(\"removeSheet\", this._workbookRemoveSheet.bind(this));\n                this._workbook.bind(\"selectSheet\", this._workbookSelectSheet.bind(this));\n                this._workbook.bind(\"renameSheet\", this._workbookRenameSheet.bind(this));\n                this._workbook.bind(\"insertRow\", this._workbookInsertRow.bind(this));\n                this._workbook.bind(\"insertColumn\", this._workbookInsertColumn.bind(this));\n                this._workbook.bind(\"deleteRow\", this._workbookDeleteRow.bind(this));\n                this._workbook.bind(\"deleteColumn\", this._workbookDeleteColumn.bind(this));\n                this._workbook.bind(\"hideRow\", this._workbookHideRow.bind(this));\n                this._workbook.bind(\"hideColumn\", this._workbookHideColumn.bind(this));\n                this._workbook.bind(\"unhideRow\", this._workbookUnhideRow.bind(this));\n                this._workbook.bind(\"unhideColumn\", this._workbookUnhideColumn.bind(this));\n                this._workbook.bind(\"select\", this._workbookSelect.bind(this));\n                this._workbook.bind(\"changeFormat\", this._workbookChangeFormat.bind(this));\n                this._workbook.bind(\"dataBinding\", this._workbookDataBinding.bind(this));\n                this._workbook.bind(\"dataBound\", this._workbookDataBound.bind(this));\n                this._workbook.bind(\"progress\", this._workbookProgress.bind(this));\n            },\n\n            destroy: function() {\n                kendo.ui.Widget.fn.destroy.call(this);\n\n                this._workbook.destroy();\n                this._controller.destroy();\n                this._view.destroy();\n\n                if (this._resizeHandler) {\n                    $(window).off(\"resize\" + NS, this._resizeHandler);\n                }\n            },\n\n            options: {\n                name: \"Spreadsheet\",\n                toolbar: true,\n                sheetsbar: true,\n                rows: 200,\n                columns: 50,\n                rowHeight: 20,\n                columnWidth: 64,\n                headerHeight: 20,\n                headerWidth: 32,\n                excel: {\n                    proxyURL: \"\",\n                    fileName: \"Workbook.xlsx\"\n                },\n                messages: {},\n                pdf: {\n                    // which part of the workbook to be exported\n                    area: \"workbook\",\n                    fileName: \"Workbook.pdf\",\n                    proxyURL: \"\",\n                    // paperSize can be an usual name, i.e. \"A4\", or an array of two Number-s specifying the\n                    // width/height in points (1pt = 1/72in), or strings including unit, i.e. \"10mm\".  Supported\n                    // units are \"mm\", \"cm\", \"in\" and \"pt\".  The default \"auto\" means paper size is determined\n                    // by content.\n                    paperSize: \"a4\",\n                    // True to reverse the paper dimensions if needed such that width is the larger edge.\n                    landscape: true,\n                    // An object containing { left, top, bottom, right } margins with units.\n                    margin: null,\n                    // Optional information for the PDF Info dictionary; all strings except for the date.\n                    title: null,\n                    author: null,\n                    subject: null,\n                    keywords: null,\n                    creator: \"Kendo UI PDF Generator v.\" + kendo.version,\n                    // Creation Date; defaults to new Date()\n                    date: null\n                },\n                defaultCellStyle: {\n                    fontFamily: \"Arial\",\n                    fontSize: 12\n                },\n                useCultureDecimals: false\n            },\n\n            defineName: function(name, value, hidden) {\n                return this._workbook.defineName(name, value, hidden);\n            },\n\n            undefineName: function(name) {\n                return this._workbook.undefineName(name);\n            },\n\n            nameValue: function(name) {\n                return this._workbook.nameValue(name);\n            },\n\n            forEachName: function(func) {\n                return this._workbook.forEachName(func);\n            },\n\n            cellContextMenu: function() {\n                return this._view.cellContextMenu;\n            },\n\n            rowHeaderContextMenu: function() {\n                return this._view.rowHeaderContextMenu;\n            },\n\n            colHeaderContextMenu: function() {\n                return this._view.colHeaderContextMenu;\n            },\n\n            addImage: function(image) {\n                return this._workbook.addImage(image);\n            },\n\n            cleanupImages: function() {\n                return this._workbook.cleanupImages();\n            },\n\n            events: [\n                \"cut\",\n                \"copy\",\n                \"paste\",\n                \"pdfExport\",\n                \"excelExport\",\n                \"excelImport\",\n                \"changing\",\n                \"change\",\n                \"render\",\n                \"removeSheet\",\n                \"selectSheet\",\n                \"renameSheet\",\n                \"insertRow\",\n                \"insertColumn\",\n                \"deleteRow\",\n                \"insertSheet\",\n                \"deleteColumn\",\n                \"hideRow\",\n                \"hideColumn\",\n                \"unhideRow\",\n                \"unhideColumn\",\n                \"select\",\n                \"changeFormat\",\n                \"dataBinding\",\n                \"dataBound\"\n            ]\n        });\n\n        kendo.spreadsheet.ALL_REASONS = ALL_REASONS;\n        kendo.ui.plugin(Spreadsheet);\n        $.extend(true, Spreadsheet, { classNames: classNames });\n    })(window.kendo);\n\n    return window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n\n"],"names":["define","kendo","UndoRedoStack","Observable","extend","init","options","fn","call","this","clear","events","push","command","stack","slice","currentCommandIndex","undo","canUndo","trigger","redo","canRedo","length","deepExtend","util","amd","a1","a2","a3","$","window","jQuery","LRUCache","Class","size","_size","_length","_map","put","key","value","map","entry","_head","_tail","newer","older","get","REPLACE_REGEX","SPACE","normalizeText","text","String","replace","objectKey","object","parts","sort","join","hashKey","str","hash","i","charCodeAt","zeroSize","width","height","baseline","DEFAULT_OPTIONS","baselineMarkerSize","defaultMeasureBox","document","createElement","style","cssText","TextMetrics","_cache","measure","styleKey","cacheKey","cachedResult","measureBox","box","baselineMarker","_baselineMarker","cloneNode","textStr","textContent","appendChild","body","offsetWidth","offsetHeight","offsetTop","parentNode","removeChild","marker","measureText","current","sqr","now","Date","getTime","renderSize","renderPos","pos","result","toHyphens","split","arabicToRoman","n","literals","1","10","100","2","20","200","3","30","300","4","40","400","5","50","500","6","60","600","7","70","700","8","80","800","9","90","900","1000","values","roman","shift","romanToArabic","r","toLowerCase","digits","v","x","l","c","d","m","prev","charAt","memoize","f","cache","Object","create","id","arguments","apply","isUnicodeLetter","ch","RX_UNICODE_LETTER","test","withExit","obj","Return","ex","RegExp","STRING","fromCharCode","ENTITIES","amp","lt","gt","quot","apos","nbsp","CODE","out","UCS2","code","START_CDATA","END_CDATA","END_COMMENT","START_COMMENT","END_SHORT_TAG","END_TAG","END_DECLARATION","QUESTION_MARK","LESS_THAN","GREATER_THAN","SEMICOLON","EQUAL","AMPERSAND","QUOTE","APOSTROPHE","SHARP","LOWERCASE_X","UPPERCASE_X","EXIT","parse","data","callbacks","index","is","selector","j","$tag","exit","readChar","croak","msg","Error","readWhile","pred","a","readAsciiWhile","skipWhitespace","isWhitespace","eat","save","skip","isDigit","isHexDigit","isNameStart","isName","xmlComment","xmlTag","name","attrs","xmlDecl","xmlName","xmlAttrs","xmlContent","pop","xmlEntity","xmlString","quote","parseInt","isNaN","undefined","what","thing","arg1","arg2","tmp","parseXML","COMMAND_TYPES","AUTO_FILL","CLEAR","CUT","EDIT","PASTE","VALIDATION","Command","spreadsheet","_workbook","workbook","_property","property","_state","range","_setRange","_range","select","exec","setState","getState","state","rejectState","validationState","title","message","reason","type","_forEachCell","callback","ref","_ref","forEach","sheet","toRangeRef","bind","usesImage","DrawingCommand","DrawingUpdateCommand","_sheet","_drawing","drawing","_orig","clone","_previous","previous","reset","_activeDrawing","triggerChange","layout","img","image","ReorderDrawingsCommand","InsertImageCommand","_blob","blob","_width","_height","aspect","Math","min","addDrawing","topLeftCell","topLeft","offsetX","offsetY","opacity","addImage","removeDrawing","DeleteDrawingCommand","_origIndex","_drawings","indexOf","splice","_newIndex","_reorder","drawings","TargetValueCommand","BringToFrontCommand","SendToBackCommand","_target","target","_value","PropertyChangeCommand","ColumnWidthCommand","columnWidth","RowHeightCommand","rowHeight","HyperlinkCommand","_link","link","_prevLink","_prevUnderline","underline","_hasSetValue","GridLinesChangeCommand","showGridLines","prototype","skipHiddenCells","enable","ApplyFilterCommand","ClearContentCommand","rowValues","nullValues","currentRange","canEditArrayFormula","refs","concat","row","changeType","clearContent","_getValidationState","cell","EditCommand","_editRange","arrayFormula","activeCellSelection","withCultureDecimals","_exec","editRange","input","wrap","_adjustRowHeight","calc","ParseError","InsertCommentCommand","TextWrapCommand","forEachRow","_rowHeight","AdjustDecimalsCommand","_delta","delta","formatting","batch","forEachCell","col","format","adjustDecimals","BorderChangeCommand","_type","border","_style","_batch","self","noBorders","insideBorders","outsideBorders","allBorders","leftBorder","leftColumn","borderLeft","rightBorder","rightColumn","borderRight","topBorder","topRow","borderTop","bottomBorder","bottomRow","borderBottom","insideHorizontalBorders","insideVerticalBorders","MergeCellCommand","recalc","activate","activeCell","unmerge","cells","merge","horizontally","vertically","forEachColumn","FreezePanesCommand","_topLeft","panes","frozenColumns","frozenRows","rows","columns","unfreeze","PasteCommand","_clipboard","clipboard","_event","event","_clipboardContent","_content","activeSheet","selection","pasteRef","_targetRangeRefs","UnionRef","status","canPaste","menuInvoked","pasteOnMerged","pasteOnDisabled","preventDefault","clipboardContent","_processPaste","_adjustPasteTarget","multipliers","sourceRows","sourceCols","that","targetRangeRefs","RangeRef","compare","b","topLeftA","topLeftB","refToSelect","rangeToSelect","multiplier","bottomRight","cols","sourceData","_targetRanges","_rows","_count","_columns","resize","max","_populateTargetRange","_targetRangeDimensions","targetRangeRows","targetRangeCols","rowsMultiplier","colsMultiplier","AdjustRowHeightCommand","rowIndex","ToolbarPasteCommand","support","paste","_view","focus","execCommand","CutCommand","_eventType","canCopy","rangeValues","currentRow","multiSelection","cut","copy","CopyCommand","noop","ToolbarCopyCommand","AutoFillCommand","origin","_origin","autoFillData","intersectingArrayFormula","_previewFillFrom","props","dest","_properties","Range","FillError","ToolbarCutCommand","cannotUndo","FilterCommand","filter","hasFilter","SortCommand","column","ascending","expandRange","cantSort","_sheetRef","clearFilter","filterRule","exists","valueFilter","ValueFilter","customFilter","CustomFilter","eq","element","DeleteCommand","ClearFilterCommand","HideLineCommand","axis","setAxisState","getAxisState","axisManager","hideSelectedRows","hideSelectedColumns","UnHideLineCommand","unhideSelectedRows","unhideSelectedColumns","_expandedRange","_expand","_indexes","_undoOne","_restoreModifiedFormulas","formulas","isValue","AddCommand","DeleteRowCommand","left","Infinity","right","deleteSelectedRows","insertRow","DeleteColumnCommand","top","bottom","deleteSelectedColumns","insertColumn","_pos","count","base","NameCommand","AddColumnCommand","addColumnLeft","addColumnRight","deleteColumn","AddRowCommand","addRowAbove","addRowBelow","deleteRow","EditValidationCommand","validation","OpenCommand","file","match","fromFile","then","errors","excelImportErrors","openDialog","SaveAsCommand","fileName","extension","saveAsExcel","saveAsPDF","pdf","_name","nameDefinition","DefineNameCommand","defineName","DeleteNameCommand","undefineName","classNames","wrapper","FormulaBar","ui","Widget","addClass","prependTo","formulaBarWidth","formulaInput","FormulaInput","appendTo","destroy","ns","keys","listWrapper","styles","KEY_NAMES","27","37","39","35","36","32","PRIVATE_FORMULA_CHECK","attr","css","autoScale","on","scale","_highlightedRefs","_formulaSource","_formulaList","_popup","_tooltip","_keydown","_keyup","_blur","_input","_focus","_paste","filterOperator","scalePadding","minLength","removeAttr","toggleClass","getPos","div","sel","getSelection","lookup","focusNode","focusOffset","anchorNode","anchorOffset","begin","end","collapsed","lookupNode","loop","node","nodeType","firstChild","nextSibling","nodeValue","setPos","eiv","createRange","setStart","setEnd","getRangeAt","differ","removeAllRanges","addRange","startOffset","endOffset","startContainer","endContainer","len","el","home","runtime","FUNCS","toUpperCase","formulaSource","DataSource","list","StaticList","insertAfter","autoBind","selectable","change","_formulaListChange","dataSource","dataValueField","template","e","tokenCtx","_tokenContext","_mute","activeToken","token","completion","ctx","nextToken","_replaceAt","popup","close","Popup","anchor","clearTimeout","_focusId","_isFormula","keyCode","_navigated","_move","_keyDownTimeout","setTimeout","_syntaxHighlight","view","visible","focusFirst","_sync","_focusTimeout","ev","browser","msie","clipboardData","getData","originalEvent","val","substr","DOWN","focusNext","UP","focusPrev","focusLast","ENTER","TAB","PAGEUP","PAGEDOWN","point","tokens","tokenize","tok","touches","_editorToSync","isActive","_textContainer","computedStyles","getComputedStyles","position","visibility","whiteSpace","_span","_cellTooltip","tooltip","toggleTooltip","show","toggle","_activeElement","field","operator","hide","rectangle","canInsertRef","isKeyboardAction","_canInsertRef","strictMode","canReplace","afterPoint","canInsertBetween","isOpenParen","refAtPoint","simplify","relative","isMerged","setSheet","print","newValue","rest","syncWith","eventName","handler","iehandler","off","html","txt","innerText","highlightedRefs","refClasses","Pane","series","refIndex","parens","active","cls","colorClass","unshift","isCloseParen","open","isMatchingParen","knownFunction","reverse","htmlEncode","substring","insertNewline","eof","13","38","33","34","46","113","Mac","navigator","platform","isAlphaNum","keyName","EventListener","observer","handlers","_handlers","_observer","keyDownProxy","keyDown","mouseProxy","mouse","touchProxy","touch","threshold","_pressLocation","documentElement","altKey","handleEvent","rightClick","which","button","pageX","y","pageY","dx","dy","distance","sqrt","eventKey","mod","metaKey","ctrlKey","shiftKey","catchAllHandler","RangeTreeNode","Node","level","NilNode","NIL","skew","temp","insert","start","remove","diff","heir","ValueRange","intersects","RangeTree","root","findrange","intersecting","ranges","tree","first","last","RangeList","firstRange","lastRange","rangeValue","rangeStart","rangeEnd","expandedValues","rangeIndex","sortedIndices","valueComparer","indices","comparer","sourceStart","sourceEnd","targetStart","iterator","Iterator","toJSON","fromJSON","unique","at","SparseRangeList","_defaultValue","lastRangeStart","Property","set","dst","JsonProperty","JSON","stringify","ValueProperty","formats","dateToNumber","toExcelFormat","culture","calendar","patterns","limitPrecision","cloneFormulaValue","deepClone","cloneFormulaTree","PropertyBag","specs","sortable","serializable","depends","rowCount","columnCount","defaultValues","cellCount","properties","lists","spec","prop","formula","_resize","new_rows","new_cols","old_rows","cell_count","scaleIndex","scaleNode","si","iter","iterators","reduce","ret","hBorders","leftBorders","rightBorders","addBorder","forEachProperty","ALL_PROPERTIES","columnName","colIndex","letter","floor","displaySheet","displayRef","rel","aa","isFinite","Ref","hasSheet","_hasSheet","absolute","adjust","toString","intersect","NULL","isCell","toRow","toColumn","rangeAt","nextRangeIndex","previousRangeIndex","reference","r1","r2","CellRef","single","refs1","refs2","replaceAt","forEachColumnIndex","forEachAxisIndex","forEachRowIndex","sorted","method","valid","renameSheet","oldSheetName","newSheetName","display","NullRef","NameRef","trow","tcol","abs","arow","acol","forRow","tl","br","endSheet","normalize","_containsRange","_containsCell","contains","Array","some","_intersectRange","a_left","a_top","a_right","a_bottom","b_left","b_top","b_right","b_bottom","c1","c2","rr1","rc1","rr2","rc2","changes","relTL","relBR","collapse","toCell","startRow","endRow","startCol","endCol","union","topLeftRow","topLeftCol","bottomRightRow","bottomRightCol","modified","limit","num","move","tr","u","empty","theRef","newRefs","NULLREF","SHEETREF","FIRSTREF","AutoFillCalculator","grid","_grid","rectIsVertical","startRect","endRect","autoFillDest","cursor","quadrant","lower","further","pivot","opposite","cornerResult","expanding","bottomLeft","topRight","EdgeNavigator","rangeGetter","prevLeft","prevVisible","nextRight","nextVisible","nextLeft","prevRight","boundary","SheetNavigator","autoFillCalculator","colEdge","columnRange","rowEdge","rowRange","_viewPortHeight","unionWithMerged","leftCol","rightCol","selectionIncludesMergedCells","_mergedCells","setSelectionValue","selectAll","mode","addToExisting","refForMode","rowRef","colRef","startSelection","startAutoFill","completeSelection","selectForContextMenu","selectDrawingForContextMenu","modifySelection","action","direction","determineDirection","viewPortHeight","originalSelection","currentOriginalSelectionRange","scrollInto","prevPage","nextPage","firstVisible","lastVisible","nextUntil","makeWordMovement","prevUntil","newSelection","updateCurrentSelectionRange","moveActiveCell","originalActiveCell","navigateInSelection","isFirstCell","isLastCell","selTopLeft","selBottomRight","setSelection","currentNavigationRange","done","navigatedAway","isSingleCellSelected","singleCellSelection","focusNextElement","nextNavigationRange","find","previousNavigationRange","shouldSkip","extendSelection","resizeAutoFill","isHiddenRow","isHiddenColumn","forEachMergedCell","merged","_autoFillOrigin","punch","hint","preview","updateAutoFill","currentSelectionRange","leftMode","rightMode","topMode","bottomMode","originalSelect","selectionRangeIndex","subset","bottomCol","isCol","firstVal","advanced","hidden","AxisManager","forEachSelectedColumn","forEachSelectedRow","includesHiddenColumns","includesHidden","includesHiddenRows","selectionIncludesHiddenColumns","selectionIncludesHiddenRows","indexes","_saveModifiedFormulas","hideColumn","hasRight","hasLeft","hideRow","hasBottom","hasTop","unhideColumn","unhideRow","selectedRows","Clipboard","_externalContent","_internalContent","iframe","className","setAttribute","_uid","guid","intersectsMerged","origRef","plain","destination","originActiveCell","rowDelta","colDelta","external","isExternal","_isInternal","newState","doc","contentWindow","write","table","querySelector","parseHTML","parseTSV","internalHTML","internalPlain","mergedCells","foreign","setStateData","stripStyle","borderObject","color","cellState","vBorders","getComputedStyle","borders","fontSize","background","italic","bold","textAlign","verticalAlign","Matrix","ri","ci","td","rowSpan","colSpan","getAttribute","ignoreColspan","dr","dc","PROPERTIES","skipHiddenRows","skipHiddenCols","_normalize","partition","_set","noTrigger","valueProp","topLeftRef","_get","_resizedRef","existingFormat","compile","existingFormatType","currency","editorChange","isInEditMode","OUT","t1","t2","numberToDate","looksLikeANumber","_useCultureDecimals","numberFormat","_","__","setArrayFormulaRange","_forFormulas","arrayFormulaRange","intersection","_validation","_merge","mergedRef","vi","isAutofill","line","setProp","propName","propValue","isFilteredRow","clearAll","contentsOnly","formatOnly","keepBorders","clearFormat","isSortable","mc","_getMergedCells","primary","secondary","cant","hasMerged","_sortBy","isFilterable","clearFilters","_filterBy","_filter","intersectingMerged","propertyName","Formula","Validation","internalClipboard","externalClipboard","sum","textHeight","getTextHeight","fontFamily","hasValue","defStyle","_defaultCellStyle","flag","draw","predicate","each","font-size","font-family","white-space","overflow-wrap","word-wrap","exports","CalcError","Context","ss","parent","resolve","resolveCells","_resolve","error","isArray","asMatrix","maybeRoundFloatErrors","_arrayArg","onFormula","context","add","getRefCells","pending","fetch","cellValues","wantNulls","getRefData","fetchName","nameValue","ValidationFormulaContext","force","func","fname","args","bool","h","isRange","Number","hiddenInfo","getNA","includeEmpty","eachRow","eachCol","mapRow","mapCol","transpose","unit","multiply","s","va","vb","adds","sign","determinant","C","L","k","t","inverse","augment","imax","argmax","printer","absrefs","onReady","forceRefs","lcsheet","parentContext","next","affectedSheet","operation","formulaRow","formulaCol","formulaSheet","formulaMoves","newFormulaRow","newFormulaCol","prevRefs","newRef","sameRef","prevRange","constructor","compileArgumentChecks","functionName","arrayArgs","forced","main","haveForced","canBeArrayArg","hasArrayArgs","comp","Function","cond","allowError","typeCheck","forceNum","round","err","toPrecision","withErrorHandling","makeSyncFunction","check","doit","xargs","arrays","makeAsyncFunction","makeCallback","defineFunction","log","console","kendoSpreadsheetArgs","argsAsync","dateToJulianDays","julianDaysToDate","jd","year","month","date","day","ord","ORDINAL_ADD_DAYS","isLeapYear","co","th","comatrix","thmatrix","elmatrix","BASE_DATE","DAYS_IN_MONTH","yr","daysInYear","daysInMonth","mo","validDate","da","unpackDate","serial","packDate","MS_IN_MIN","MS_IN_HOUR","MS_IN_DAY","unpackTime","frac","ms","hours","minutes","seconds","milliseconds","serialToDate","packTime","hh","mm","dateToSerial","time","getHours","getMinutes","getSeconds","getMilliseconds","getFullYear","getMonth","getDate","parseDate","makeDateFormat","parseExactDate","defineAlias","alias","orig","kendoSpreadsheetAliases","NUMBER_OR_ZERO","ARGS_NUMERIC","ARGS_ANYVALUE","equals","binaryCompare","pow","TRANSPOSE_FORMAT","DATE_FORMAT","compileValidation","validationHandler","parsedFromDate","parsedToDate","from","dataType","fromIsListValue","fromIsDateValue","parseFormula","to","toIsDateValue","validationComparers","custom","comparerType","valueToCompare","toValue","to_value","allowNulls","from_value","_getListData","showButton","tooltipMessageTemplate","tooltipTitleTemplate","messageTemplate","titleTemplate","_formatMessages","fromFormula","toFormula","_setMessages","tooltipTitle","tooltipMessage","cube","array","_getOptions","compareValue","compareFormat","getValue","calculateFromCallBack","prevFrom","prevTo","greaterThan","lessThan","between","equalTo","notEqualTo","greaterThanOrEqualTo","lessThanOrEqualTo","notBetween","MODIFIED_FORMULAS","Selection","_activeCell","currentOriginalNavigationRange","expanded","changeActiveCell","triggerSelect","pane","_currentView","Sheet","_reinit","headerHeight","headerWidth","defaultCellStyle","Axis","_filteredRows","_frozenRows","_frozenColumns","_suspendChanges","_showGridLines","_gridLinesColor","Grid","_sorter","Sorter","_viewSelection","_editSelection","_formulaSelections","newRows","newCols","oldRows","oldCols","_resizeAddRow","_resizeAddColumn","_resizeDeleteRow","_resizeDeleteColumn","_resizeForJSON","colCount","_selectionState","_inEdit","_navigator","_axisManager","_sheetName","accessor","_field","suspendChanges","_valueChanged","setDataSource","dataSourceBinder","SheetDataSourceBinder","columnIndex","unhide","_copyRange","sourceRangeRef","targetRef","nextRefTopLeft","nextRefBottomRight","nextIndex","nextBottomIndex","targetIndex","wb","sheetByName","cellRefIndex","_adjustReferences","_sheets","_forValidations","adjustNames","skipDataSourceInsert","nextRef","isEnabledRow","skipDataSourceDelete","isEnabledColumn","_filterRow","gridLinesColor","numRows","numColumns","parseReference","cellRef","forEachFilterHeader","columnRef","forEachRange","doIt","startCellIndex","endCellIndex","startResizing","initialPosition","_initialPosition","_resizeInProgress","_autoFillInProgress","_autoFillDest","_autoFillPunch","_autoFillHint","_autoFillDirection","autoFillRef","autoFillPunch","autoFillInProgress","resizingInProgress","draggingInProgress","_draggingInProgress","completeResizing","hintPosition","resizeHintPosition","handlePosition","resizeHandlePosition","_visualRange","_renderComment","comment","_commentRef","_resizeHandlePosition","location","_resizeHintPosition","removeResizeHandle","positionResizeHandle","startDragging","completeDragging","drag","drawingBoundingBox","indexVisible","refBox","refBoundingBox","dragging","_selectionInProgress","operatingRange","selectionInProgress","selectionState","expandedRef","isAxis","trim","trims","selectedHeaders","allCols","allRows","maxRow","maxCol","rowState","colState","rowSelection","colSelection","all","isInEdit","_setFormulaSelections","_viewActiveCell","positions","viewSelection","hyperlinks","clearDefaultStyle","src","parseColor","toCss","json","_sort","_compileFormula","_compileValidation","Drawing","activeCellRef","logToConsole","Filter","_refreshFilter","_refresh","resetFormulas","resetValidations","revalidate","_copyValuesInRange","suspended","sortBy","prepare","matches","filterColumn","filterRef","_clearFilter","ALL_REASONS","currentRef","useCultureDecimals","dot","withDecimalSeparator","Rectangle","drw","outerWidth","_outerWidth","DOT","EMPTYCHAR","sheetsBarClassNames","sheetsBarWrapper","sheetsBarSheetsWrapper","sheetsBarActive","sheetsBarInactive","sheetsBarAdd","sheetsBarRemove","sheetsBarItems","sheetsBarEditor","sheetsBarScrollable","sheetsBarNext","sheetsBarPrev","sheetsBarKItem","sheetsBarKActive","sheetsBarKTextbox","sheetsBarKLink","sheetsBarKIcon","sheetsBarKFontIcon","sheetsBarKButton","sheetsBarKButtonDefaults","sheetsBarKButtonBare","sheetsBarKArrowW","sheetsBarKArrowE","sheetsBarKReset","sheetsBarKIconX","sheetsBarKSprite","sheetsBarKIconPlus","sheetsBarHintWrapper","sheetsBarKResetItems","SheetsBar","_openDialog","_tree","dom","Tree","render","_addButton","_createSheetsWrapper","_toggleScrollEvents","_createSortable","_sortable","_onSheetReorderStart","_onSheetReorderEnd","_onSheetRemove","_onSheetSelect","_createEditor","_onAddSelect","scrollable","_editor","_renderSheets","_selectedIndex","_onEditorKeydown","_onEditorBlur","_destroyEditor","canceled","_onSheetRename","renderSheets","sheets","selectedIndex","_isRtl","isRtl","_renderHtml","_scrollableAllowed","sheetsWrapper","_sheetsWrapper","_toggleScrollButtons","ul","_sheetsGroup","scrollLeft","scrollWidth","scrollPrevButton","scrollNextButton","stopPropagation","_nowScrollingSheets","_scrollSheetsByDelta","renderScrollButtons","idx","sheetElements","isSelectedSheet","elementContent","maxlength","deleteIcon","data-type","itemsWrapper","childrenElements","baseButtonClass","children","Sortable","container","animation","ignore","draggable","closest","oldIndex","newIndex","removedSheetName","closeCallback","dlg","sender","isConfirmed","confirmation","selectedSheetText","_scrollSheetsToItem","isAddButton","sheetIndex","item","sheetsGroup","currentScrollOffset","itemWidth","itemOffset","sheetsGroupWidth","itemPosition","finish","animate","scrLeft","OPERATORS_STANDARD","OPERATORS_COMMA","ops","OPERATORS","op","SEPARATORS","DEC","ARG","COL","setDecimalSeparator","sep","_separators","TRUE","FALSE","getcol","getrow","noThrow","stream","TokenStream","ast","parseExpression","addReference","allowEOF","peek","commas","maybeBinary","maybeIntersect","parseAtom","parseSymbol","upper","parseFuncall","fixReference","exp","parseArray","maybePercent","my_prec","his_prec","parseNameDefinition","def","nameRef","defAST","makeFormula","makeClosure","makePrinter","prec","withParens","parenthesize","arg","needParens","toCPS","GENSYM","cps","cpsRef","cpsAtom","cpsUnary","cpsBinary","cpsFunc","cpsLambda","cpsMatrix","cpsNameRef","makeContinuation","cpsIf","thenK","gensym","elseK","vars","cpsAnd","cpsOr","cont","elements","isMatrix","FORMULA_CACHE","js","jsArray","identity","RawTokenStream","InputStream","ahead","fixCell","addPos","forEditor","startToken","endToken","readNext","refRange3D","refCell3D","refSheetRange","refSheetCell","refRange","refCell","funcall","isFirst","g","space","EOF","isIdStart","isId","isOpChar","isPunc","readNumber","has_dot","number","parseFloat","symbol","getRC","readSymbol","lookingAt","readString","readEscaped","readSheetName","readOperator","readPunc","forward","escaped","rx","FORMAT_PARSERS","registerFormatParser","p","parseSqref","monthFirst","comma","rxnum","getNumberRegexp","rxcur","suffix","has_currency","has_percent","repeat","NUMBER_FORMAT_RX","MAP_EXCEL_OPERATOR","greaterThanOrEqual","lessThanOrEqual","ERROR_LOG","readExcel","deferred","reader","FileReader","onload","zip","JSZip","readWorkbook","readAsArrayBuffer","SEL_CELL","SEL_COL","SEL_DEFINED_NAME","SEL_FORMULA","SEL_MERGE","SEL_PANE","SEL_ROW","SEL_SELECTION","SEL_SHEET","SEL_STRING","SEL_TEXT","SEL_SHARED_STRING","SEL_VALUE","SEL_VIEW","SEL_SHEET_VIEW","SEL_HYPERLINK","SEL_VALIDATION","SEL_VALIDATION_FORMULA1","SEL_VALIDATION_FORMULA2","SEL_VALIDATION_INSANE","SEL_VALIDATION_SQREF_INSANE","SEL_VALIDATION_FORMULA1_INSANE","SEL_VALIDATION_FORMULA2_INSANE","SEL_COMMENT","SEL_AUTHOR","SEL_COMMENT_TEXT","xl","progress","strings","readStrings","relationships","readRelationships","theme","readTheme","byType","readStyles","items","enter","tag","relId","byId","dim","sheetDimensions","activeTab","integer","vbProcedure","localSheetId","withErrorLog","loading","Deferred","notify","recalcSheets","loadSheets","ready","insertSheet","promise","queueSheet","readSheet","defaultColWidth","toColWidth","defaultRowHeight","toRowHeight","maximumDigitWidth","fraction","pts","sharedFormulas","formulaRange","isArrayFormula","nCols","prevCellRef","relsFile","formula1","formula2","customFilterLogic","customFilterCriteria","valueFilterBlanks","valueFilterValues","filters","closed","styleIndex","applyStyle","stop","ht","acRef","xSplit","ySplit","addAutoFilter","colId","and","getCustomFilter","DynamicFilter","dynamicFilterType","TopFilter","getFilterVal","percent","blank","leave","failed","sqref","showErrorMessage","allowBlank","showDropDown","errorTitle","logic","criteria","blanks","comments","commentFile","relative_file","readComments","drawingFile","readDrawings","getContentType","filename","jpg","jpeg","png","gif","getFileName","sel_two_cell_anchor","sel_ext","sel_one_cell_anchor","sel_from","sel_to","sel_row","sel_col","sel_row_offset","sel_col_offset","sel_blip","files","asArrayBuffer","edge","File","Blob","cdr","excelToPixels","cx","cy","colOffset","rowOffset","brCell","brX","brY","authors","author","authorId","ourOp","equal","notEqual","Q1","Q2","Q3","Q4","M1","M2","M3","M4","M5","M6","M7","M8","M9","M10","M11","M12","BORDER_WIDTHS","none","thin","medium","dashed","dotted","thick","double","hair","mediumDashed","dashDot","mediumDashDot","dashDotDot","mediumDashDotDot","slantDashDot","DEFAULT_FORMATS","0","11","12","14","15","16","17","18","19","21","22","45","47","48","49","xf","inlineStyles","xfId","namedStyles","shouldSet","setBorder","setFont","fonts","indent","setFill","fills","setFormat","numFmts","formatCode","side","applyName","part","asUint8Array","Id","Target","Type","entries","SEL_BORDER","SEL_FILL","SEL_FONT","SEL_INLINE_STYLE","SEL_NAMED_STYLE","SEL_NUM_FMT","INDEXED_COLORS","toCSSColor","font","fill","numFmtId","getColor","patternType","getXf","horizontal","vertical","wrapText","borderId","fillId","fontId","pivotButton","quotePrefix","addBool","defaultThemeColor","rgb","indexed","themeColor","colorScheme","tint","toHSL","toCssRgba","SEL_SCHEME_RGBCLR","SEL_SCHEME_SYSCLR","scheme","swap","arr","_readSheet","_readStrings","_readStyles","_readTheme","_readWorkbook","loadBinary","url","xhr","XMLHttpRequest","response","getResponseHeader","onerror","responseType","send","messages","defaultSheetName","Workbook","_images","_imgID","_sheetsSearchCache","undoRedoStack","_onUndoRedo","_context","FormulaContext","_validationContext","_names","unbind","_sheetChanging","_sheetChange","_sheetInsertRow","_sheetInsertColumn","_sheetDeleteRow","_sheetDeleteColumn","_sheetHideRow","_sheetHideColumn","_sheetUnhideRow","_sheetUnhideColumn","_sheetSelect","_sheetDataBinding","_sheetDataBound","_sheetProgress","_sheetCommandRequest","_inputForRef","execute","commandOptions","cleanupImages","refresh","moveSheetToIndex","toIndex","fromIndex","sheetSelection","insertIndex","sheetName","getUniqueSheetName","sheetNameSuffix","_bindSheetEvents","sheetByIndex","forEachName","nameref","removeSheet","newSheet","_clearSheets","images","sheetParamsFromJSON","names","localName","saveJSON","ids","readAsDataURL","reject","excel","ooxml","saveAs","dataURI","forceProxy","toDataURL","toBlob","proxyURL","group","nameForRef","imageUrl","URL","createObjectURL","revokeObjectURL","or","PDFMixin","_drawPDF","exportPDF","exportPDFToBlob","proxyTarget","fail","area","fsheet","frow","fcol","states","_displayString","currentFormula","arrayRange","tlRow","tlCol","vrow","vcol","_formulaContextRefresh","alphaNumRegExp","ACTIONS","up","down","ctrl+left","ctrl+right","ctrl+up","ctrl+down","ctrl+home","ctrl+end","pageup","pagedown","ENTRY_ACTIONS","tab","shift+tab","shift+enter","delete","backspace","shift+:alphanum","alt+:alphanum",":alphanum","ctrl+:alphanum","alt+ctrl+:alphanum",":edit","CONTAINER_EVENTS","wheel","*+mousedown","contextmenu","*+mousedrag","*+mouseup","*+dblclick","mousemove","CLIPBOARD_EVENTS","mouseup","*+cut","*+paste","*+copy","EDITOR_EVENTS","esc","alt+enter","shift+ctrl+enter","FORMULABAR_EVENTS","FORMULAINPUT_EVENTS","SELECTION_MODES","rowheader","columnheader","topcorner","autofill","toActionSelector","selectors","COMPOSITE_UNAVAILABLE_ACTION_SELECTORS","UNHIDE_ACTION_SELECTORS","ACTION_KEYS","SHIFT_ACTION_KEYS","ENTRY_ACTION_KEYS","Controller","clipboardElement","cellContextMenu","rowHeaderContextMenu","colHeaderContextMenu","drawingContextMenu","scroller","tabstrip","sheetsbar","nameEditor","onNameEditorEnter","onNameEditorCancel","onNameEditorSelect","onNameEditorDelete","editor","onEditorChange","onEditorActivate","onEditorDeactivate","onEditorUpdate","onScroll","listener","onMouseDown","_enableEditorEvents","onSheetBarSelect","onSheetBarReorder","onSheetBarRename","onSheetBarRemove","onContextMenuSelect","onCommandRequest","onDialogRequest","keyListener","barKeyListener","barElement","inputKeyListener","cellElement","_execute","editorClose","_preventNavigation","deactivate","showError","activateEditor","_lastEditorValue","_activeTooltip","activeSheetName","clientHeight","isEditorDisabled","resetEditorValue","scroll","onWheel","deltaX","deltaY","deltaMode","scrollWith","onAction","onPageUp","scrollDown","onPageDown","onEntryAction","shouldPrevent","disabled","casual","onShiftAction","appendSelection","onMouseMove","objectAt","originFrame","_startResizingDrawing","win","widgetInstance","modal","startBox","onEditorEsc","openCustomEditor","_selectionMode","openFilterMenu","handle","translateCoords","startX","startY","onContextMenu","menu","isComposite","showUnhide","showUnmerge","prevent","constrainResize","resizeHandle","_dragDrawing","onMouseDrag","clientX","clientY","startAutoScroll","selectToLocation","frame","scrollTop","onMouseUp","stopAutoScroll","activeEditor","onDblClick","onCut","clipBoardValue","_pasteImage","Image","onPaste","hasHTML","hasPlainText","DOMStringList","types","kind","getAsFile","onCopy","scrollRight","getBoundingClientRect","noDrawing","cellLocation","lastKnownCellLocation","autoScroll","_autoScrollTarget","boundaries","scrollStep","finalLocation","viewObject","_scrollInterval","setInterval","clearInterval","filterMenu","createFilterMenu","openFor","_saveEditorValue","onEditorArrayFormula","onEditorBarFocus","rect","activeCellRectangle","onEditorCellFocus","onEditorBlur","isFiltered","onEditorAction","_casualEditing","deactivateEditor","onEditorShiftAction","additionalOptions","pdfExport","excelExport","RESIZE_HANDLE_WIDTH","EDIT_BUTTON_WIDTH","ERROR","viewClassNames","fixedContainer","editContainer","viewSize","cellEditor","barEditor","topCorner","filterHeadersWrapper","filterRange","filterButton","filterButtonSelected","horizontalResize","verticalResize","icon","iconFilterDefault","sheetsBar","selectElementContents","selectNodeContents","cellBefore","trs","cellAbove","prevRow","cellBorder","asURL","drawCell","collection","showGrid","maybeLink","textDecoration","href","shouldDraw","defaultBorder","toHSV","outline","backgroundColor","fontStyle","fontWeight","overflowWrap","wordWrap","__dataType","applyIndent","paneClassNames","addCell","borderRightColor","borderBottomColor","sibling","borderLeftColor","borderTopColor","nameBox","openUnsupported","shiftingNonblankCells","insertColumnWhenRowIsSelected","insertRowWhenColumnIsSelected","filterRangeContainingMerges","sortRangeContainingMerges","cantSortMultipleSelection","cantSortNullRef","cantSortMixedCells","validationError","cannotModifyDisabled","insertRowBelowLastRow","insertColAfterLastCol","tabs","menus","bringToFront","sendToBack","HtmlTable","addColumn","addRow","toDomTree","offset","role","CELL_CONTEXT_MENU","ROW_HEADER_CONTEXT_MENU","COL_HEADER_CONTEXT_MENU","DRAWING_CONTEXT_MENU","VIEW_CONTENTS","ContextMenu","within","View","_chrome","_dialogs","append","_formulaInput","clipboardContents","SheetEditor","_sheetsbar","contextMenuConfig","showOn","enableClipboard","isClipboardDeactivated","actionBar","formulaBar","parents","outerHeight","_outerHeight","tabstripHeight","formulaBarHeight","sheetsBarHeight","quickAccessAdjust","NameEditor","toolbar","_tabstrip","content","TabStrip","dataTextField","dataContentField","toolbarOptions","_executeCommand","cellRectangle","_rectangle","boundingRectangle","isColumnResizer","_headerWidth","frozen","locate","w","isRowResizer","_headerHeight","isFilterIcon","theGrid","filterIconRect","isAutoFill","isEditButton","ed","activeCellCustomEditor","_editorInLastColumn","drawingAt","drx","dry","clientWidth","paneAt","selecting","paneLocationWithin","containingPane","refreshTools","totalHeight","totalWidth","_pane","_destroyFilterMenu","FilterMenu","_filterMenu","selectClipboardContents","scrollIntoView","willScroll","scrollBoundaries","scrollBottom","_destroyDialog","edit","dialog","dialogs","reopenEditor","currentDialogs","errorMessages","hasOpenedError","focusButton","ESC","onClose","_retry","registered","dialogOptions","_filterMenuColumn","scrollbarSize","scrollbar","contentWidth","contentHeight","resizeDirection","toplevelElements","renderResizeHint","renderClipboardContents","resizeHint","resizeHintVertical","resizeHintHandle","resizeHintMarker","selectionView","rangeDimensions","primaryMergedCells","secondaryMergedCells","mergedCell","colspan","rowspan","vaxis","haxis","vborder","hborder","rowHeader","columnHeader","mergedCellsWrapper","selectionWrapper","autoFillWrapper","columnResizeHandle","rowResizeHandle","selectionHighlight","isVisible","_currentRect","_selectedHeaders","renderData","renderSelection","renderAutoFill","renderEditorSelection","renderFilterHeaders","hasRowHeader","headerClassName","hasColumnHeader","columnOffset","renderResizeHandle","paneClasses","itemSelection","allHeaders","doLayout","forScreen","xCoords","borderColor","yCoords","Borders","activeCellRange","absRow","absCol","_activeFormulaColor","_directionClasses","ttOffset","vert","rendered","borderWidth","transform","horiz","renderDrawings","toDiv","backgroundImage","drawingResizeHandles","_start","BUTTON_SIZE","BUTTON_OFFSET","filtered","classes","_addDiv","selections","selectionClasses","_renderCustomEditorButton","autoFillRectangle","cssClass","_axis","btnClass","isLastColumn","_buttonOutOfVisiblePane","btn","activeFormulaSelection","colorClasses","cellClasses","mergedCellLeft","mergedCellTop","data-direction","EDITORS","registerEditor","kendoCalendar","kendoPopup","getKendoCalendar","getKendoPopup","setOptions","Calendar","fromValidation","toValidation","_rowAndColPresent","disableDates","kendoStaticList","getKendoStaticList","read","intersectsRect","total","PaneGrid","PaneAxis","rangeRef","headerSize","hasHeader","paneSegment","_viewSize","widthCompensation","defaultValue","heightCompensation","_hidden","scrollBarSize","pageSize","firstHidden","lastHidden","startSegment","endSegment","lastPage","_pixelValues","startIndex","endIndex","nowCount","quarter","sameYear","today","setFullYear","sameMonth","firstDayOfMonth","setMonth","sameWeek","firstWeek","dayOfWeek","secondWeek","_values","_dates","_blanks","dates","_logic","_criteria","expression","Query","filterExpr","accentFoldingFiltering","_matches","criterionValue","criterionType","valueType","_predicate","_average","aboveAverage","belowAverage","tomorrow","addDays","isToday","yesterday","nextWeek","thisWeek","lastWeek","nextMonth","thisMonth","lastMonth","nextQuarter","thisQuarter","lastQuarter","nextYear","thisYear","lastYear","yearToDate","cultures","months","_lists","ascendingComparer","descendingComparer","li","typeA","typeB","localeCompare","RX_COLORS","RX_CONDITION","sections","haveConditional","decimalPart","sec","readSection","maybeColor","maybeCondition","readFormat","maybeFraction","decimal","am","pm","printSection","printToken","fmt","padLeft","adjusted","restart","compileFormatPart","hasDate","hasTime","hasAmpm","percentCount","scaleCount","separeThousands","declen","intFormat","decFormat","condition","preamble","checkComma","TEXT","section","found","calendars","standard","days","namesAbbr","ampm","fraclen","toFixed","eltime","formatInt","lastPart","shouldInsertMinus","iv","skipMinus","chf","formatDec","decimals","digNumber","intpart","decpart","padRight","span","textAndColor","_cosh","_sinh","_tanh","_gcd","_lcm","forIFS","chunks","matrix","parseCriteria","ROW","PI","rad","deg","cos","sin","atan","tan","ceil","mult","numbers","prod","coef","seen","ARGS_COUNTIFS","ARGS_SUMIFS","m1","ARGS_SUMIF","numericPredicate","fetchSumRange","continuation","sumRange","nth","_avg","_var_sp","divisor","avg","_stdev_sp","_percentrank","exc","nlt","ngt","descending","res","discard","bins","asc","variance","stddev","ARGS_PERCENTRANK","_covariance","ax","ay","significance","_fact","fact","_combinations","f1","f2","p1","p2","_percentile","rank","_percentile_inc","_percentile_exc","AGGREGATE_FUNCS","fetchValuesForAggregate","opt_ignore_hidden_rows","opt_ignore_errors","opt_use_aggregates","fetchValues","_binom_dist","cumulative","weeksInYear","_days_360","d1","d2","funcId","ignoreHidden","alpha","s2","approx","resultCol","areanum","colRange","cmp","resultRow","fw","sy","isoweeknum","dow","wk","holidays","inc","random","rom","radix","minLen","RX_NON_PRINTABLE","Hyperlink","dec","denomitator","string","noCommas","newText","oldText","valueIfError","RXCACHE","makeComparator","lc","compLT","compLTE","compGT","compGTE","compNE","compEQ","COUPS_ARGS","ll","ERF","ERFC","GAMMALN","GAMMA","GAMMA_DIST","GAMMA_INV","NORM_S_DIST","NORM_S_INV","NORM_DIST","NORM_INV","BETADIST","BETA_DIST","BETA_INV","chisq_left","chisq_right","chisq_left_inv","chisq_right_inv","ac","chisq_test","expon","poisson","Fdist","Fdist_right","Finv","Finv_right","Ftest","fisher","fisherinv","Tdist","Tdist_right","Tdist_2tail","Tdist_inv","Tdist_2tail_inv","Tdist_test","confidence_t","confidence_norm","gauss","phi","lognorm_dist","lognorm_inv","prob","slope","intercept","pearson","rsq","steyx","forecast","linest","logest","trend","growth","FV","PV","PMT","NPER","RATE","IPMT","PPMT","CUMPRINC","CUMIPMT","NPV","IRR","EFFECT","NOMINAL","XNPV","XIRR","ISPMT","DB","DDB","SLN","SYD","VDB","MAX_IT","COUPDAYBS","COUPDAYS","COUPDAYSNC","COUPPCD","COUPNCD","COUPNUM","ACCRINTM","ACCRINT","DISC","INTRATE","RECEIVED","PRICE","PRICEDISC","EPS","FP_MIN","f_abs","S","an","cof","ser","pi","BETALN","BETA","gamma_inc","g_series","g_contfrac","ap","gln","aj","bj","M","ab","q","plow","phigh","betastd_pdf","betastd_cdf","beta_lentz","m2","del","qab","qam","qap","betastd_inv","cdf","cds","obsv","expect","eij","lnf","_mean","me","_var_sq","arr1","arr2","n1","n2","va1","va2","e2","gr1","gr2","tail","t_st","df","md","v1","v2","u1","u2","q1","q2","z","x_","p_","lw","y_","mx","my","b1","b2","whipNumberArrays","s1","s3","_mat_mean","Mat","_mat_devsq","mean","sq","Y","X","konst","stats","Xt","B","line_1","Y1","y_y1","mp","SSreg","SSresid","line_5","R2","degfre","err_est","line_3","F_sta","line_4","SCP","line_2","W","new_X","root_newton","guess","max_it","eps","f_d","rate","nper","pmt","pv","h1","h2","fv","xfd","per","ipmt","tn","ts","te","monthlyPayment","remainingBalanceAtStart","remainingBalanceAtEnd","cip","flows","npv","npv1","nominal_rate","npery","effect_rate","cost","salvage","life","period","db","factor","prior","dep","no_switch","interest","_getGDA","gda","oldValue","_interVDB","life1","remValue","intEnd","term","lia","vdb","nowLia","intStart","_edate","_daysBetween","basis","_borderCoupons","settlement","maturity","freq","sett","periods","_borderCoupons_fw","frequency","settl","matur","mat","issue","par","year_days","accr","brace","prev1","next1","nrc","annual","_numCoupons","pr","redemption","investment","discount","yld","N","beg_settl","settl_end","beg_end","den","yf","dsm","BORDER_TYPES","BORDER_PALETTE_MESSAGES","borderPalette","COLOR_PICKER_MESSAGES","colorPicker","customColor","cancel","withPreventDefault","ColorChooser","_resetButton","_colorPalette","_customColorPalette","_customColorButton","resetButton","resetColor","customColorButton","colorPalette","flatColorPicker","_change","class","kendoColorPalette","palette","kendoWindow","resizable","maximizable","center","one","_hueSlider","kendoFlatColorPicker","viewModel","observable","BorderPalette","_borderTypePalette","_borderColorPalette","_click","colorChooser","buttons","_colorChange","currentTarget","ToolBar","MESSAGES","alignment","alignmentButtons","justtifyLeft","justifyCenter","justifyRight","justifyFull","alignTop","alignMiddle","alignBottom","formatTypes","automatic","financial","dateTime","duration","moreFormats","formatDecreaseDecimal","formatIncreaseDecimal","freeze","freezeButtons","freezePanes","freezeRows","freezeColumns","insertComment","insertImage","mergeButtons","mergeCells","mergeHorizontally","mergeVertically","quickAccess","exportAs","toggleGridlines","sortButtons","sortRangeAsc","sortRangeDesc","textColor","textWrap","hyperlink","defaultTools","toolDefaults","overflow","iconClass","dialogName","togglable","separator","formatCells","SpreadsheetToolBar","_expandTools","tools","toolbarName","handleClick","_addSeparators","removeClass","click","_nextTool","not","activeIndex","activeElement","groups","before","expandTool","toolName","isPlainObject","spriteCssClass","typeDefaults","showText","toolIcon","tool","attributes","aria-label","menuButtons","commandType","checked","_tools","setToggle","hasOwnProperty","update","enabled","isFunction","toArray","_getItem","instance","DropDownTool","TemplateItem","dropDownList","kendoDropDownList","autoWidth","_open","data-command","data-property","ddl","listWidth","_listWidth","dataItem","popupName","PopupTool","Item","addUidAttr","addOverflowAttr","OverflowDialogButton","registerComponent","ToolBarButton","_dialogName","_title","OverflowButton","ColorPicker","ColorPickerButton","iconName","FONT_SIZES","DEFAULT_FONT_SIZE","FontSize","comboBox","kendoComboBox","_valueChange","clearButton","fontSizes","FontSizeButton","sizes","defaultSize","FONT_FAMILIES","DEFAULT_FONT_FAMILY","FontFamily","fontFamilies","FontFamilyButton","defaultFont","defaultFormats","Format","_revertTitle","dataValuePrimitive","valueTemplate","sample","FormatButton","BorderChangeTool","_borderPalette","_action","BorderChangeButton","AlignmentTool","_defineButtons","_commandPalette","AlignmentButton","MergeTool","MergeButton","FreezeTool","FreezeButton","Sort","SortButton","FilterButton","Open","_reset","_quickAccessButtons","toolbars","contentElements","_toolbar","contentElement","_tabIndex","quickAccessToolBar","buttonTemplate","insertBefore","tabGroup","ObservableObject","retry","revert","okText","formatCellsDialog","categories","fontFamilyDialog","fontSizeDialog","bordersDialog","alignmentDialog","mergeDialog","freezeDialog","confirmationDialog","validationDialog","hintMessage","hintTitle","any","comparers","comparerMessages","labels","onInvalidData","rejectInput","showWarning","showHint","ignoreBlank","showListButton","showCalendarButton","placeholders","typeTitle","typeMessage","exportAsDialog","defaultFileName","xlsx","description","paper","a4","a5","b3","b4","b5","folio","legal","tabloid","executive","margin","normal","narrow","wide","fit","saveAsType","exportArea","paperSize","margins","orientation","guidelines","modifyMergedDialog","errorMessage","rangeDisabledDialog","intersectsArrayDialog","incompatibleRangesDialog","noFillDirectionDialog","duplicateSheetNameDialog","overflowDialog","useKeyboardDialog","forCopy","forCut","forPaste","unsupportedSelectionDialog","linkDialog","removeLink","insertCommentDialog","removeComment","insertImageDialog","info","typeError","registry","SpreadsheetDialog","register","dialogClass","translate","autoFocus","_dialog","_onDialogClose","_onDialogActivate","_onDialogDeactivate","formattedValue","FormatCellsViewModel","useCategory","category","formatCurrency","currencies","allFormats","useFirstFormat","_currency","iso","convert","categoryFilter","uniqueBy","inArray","pattern","abbr","FormatCellsDialog","defaultOptions","_generateFormats","currenciesFrom","numberFormats","dateFormats","calendarPatterns","currencyFilter","roleSelector","MessageDialog","messageId","getter","ConfirmationDialog","confirm","_confirmed","ValidationErrorDialog","FontFamilyDialog","_list","FontSizeDialog","BordersDialog","ColorPickerDialog","CustomColorDialog","_colorPicker","AlignmentDialog","MergeDialog","FreezeDialog","ValidationViewModel","ValidationCellsViewModel","criterion","setHintMessageTemplate","shouldBuild","buildMessages","hintTitleTemplate","hintMessageTemplate","setComparers","defaultHintTitle","defaultComparers","text_comparers","defaultHintMessage","isAny","isNumber","showToForNumber","showTo","showToForDate","isDate","isText","isList","isCustom","showRemove","fromValidationObject","useCustomMessages","toValidationObject","ValidationDialog","errorTemplate","validatable","Validator","validateOnBlur","validate","PDF_PAPER_SIZE","ExportAsDialog","fileFormats","autoPrint","subject","keywords","creator","fitWidth","areas","paperSizes","landscape","hCenter","vCenter","basicErrorDialog","ImportErrorDialog","UseKeyboardDialog","HyperlinkDialog","model","InsertCommentDialog","InsertImageDialog","okEnabled","hasImage","isHovered","_url","_image","stopEvent","drop","selectFile","dataTransfer","dragEnter","dragLeave","Localizable","path","trans","o","_normalizeColumns","_dataSource","_header","_boundRowsCount","_sheetChangeHandler","_sheetDeleteRowHandler","_sheetInsertRowHandler","fields","getters","normalizedRef","normalizedRefs","setValues","record","valueIndex","colValueIndex","currentValue","_skipRebind","_changeHandler","_progressHandler","_errorHandler","_requestStart","_error","_progress","getterIdx","details","detailsSummary","detailsContent","iconCollapse","iconExpand","iconSearch","textbox","filterByCondition","filterByValue","valuesTreeViewWrapper","actionButtons","Details","sortAscending","sortDescending","search","addToCurrent","operatorNone","operators","doesnotcontain","startswith","endswith","doesnotmatch","neq","gte","lte","_summary","_toggle","_icon","_container","fx","expand","templates","binders","spreadsheetFilterValue","Binder","bindings","widget","binding","menuItem","distinctValues","query","hasVisibleChildren","HierarchicalDataSource","valuesFilter","toLocaleLowerCase","itemVisible","filterSpread","anyVisibleChildren","uncheckAll","hasChildren","FilterMenuViewModel","valuesChange","valuesDataSource","lastIndexOf","appendToSearch","valueSelect","hasActiveSearch","filterValues","operatorChange","isNone","isString","flattenOperators","FilterMenuController","valuesTree","filterType","filterForColumn","topValue","allFilters","columnFilters","_filterInit","_filterByCondition","_filterByValue","_actionButtons","valuesTreeView","hasClass","_active","activeFilter","copyAnchorStyles","dir","kendoMenu","_appendTemplate","compiledTemplate","_detailToggle","isExpanded","activeContainer","barInput","cellInput","_triggerUpdate","viewElement","viewWidth","scrollerElement","scrollbarWidth","_rect","noChange","inputType","oldRect","newRect","ERR_INCOMPATIBLE","ERR_NO_DIRECTION","linearRegression","findSeries","findStep","forEachSeries","getType","lst","findStringList","stringLists","strl","srcRange","destRange","srcIdx","fillFrom","CLASS_NAMES","comboBoxTitle","transport","success","comboElement","combo","ignoreCase","_on_listChange","noDataTemplate","getKendoComboBox","_on_keyDown","_on_focus","_deleteItem","_prevValue","kdrw","geo","geometry","GUIDELINE_WIDTH","CONT","distributeCoords","heights","pageHeight","maxEmpty","headerRows","headerCoords","curr","header","wholeRect","rowHeights","colWidths","relrow","relcol","rh","cw","nonEmpty","shouldDrawCell","emptyCells","pageWidth","scaleFactor","hyCoords","boxWidth","boxHeight","headerCells","orlast","orderCoords","orderCells","assign","sameBorder","drawLayout","ncols","nrows","addPage","endbottom","endright","isInside","page","Group","clip","Path","fromRect","Rect","multiplyCopy","moveTo","lineTo","stroke","guideColor","bordersGroup","r2d2","drawText","paddingLeft","paddingRight","boxSizing","lineHeight","padding","makeFontDef","createTextNode","vtrans","text_group","drawDOM","getPaperOptions","multiPage","Container","pb","addVert","addHoriz","drawTabularData","headerBackground","headerColor","oddBackground","evenBackground","useGridFormat","defineFont","getFontFaces","charWidth","charWidthFunction","textWidth","mkCell","columnTitles","columnWidths","label","CACHE_CHAR_WIDTH","widths","__meta__","version","F10","F11","I","U","H","A","DELETE","R","NS","Spreadsheet","_controller","_autoRefresh","_bindWorkbookEvents","_resizeHandler","_keyDown","_workbookChanging","_workbookChange","_workbookCut","_workbookCopy","_workbookPaste","autoRefresh","_workbookExcelExport","_workbookExcelImport","_initProgress","kendoProgressBar","chunkCount","always","_workbookPdfExport","_workbookInsertSheet","_workbookRemoveSheet","_workbookSelectSheet","_workbookRenameSheet","_workbookInsertRow","_workbookInsertColumn","_workbookDeleteRow","_workbookDeleteColumn","_workbookHideRow","_workbookHideColumn","_workbookUnhideRow","_workbookUnhideColumn","_workbookSelect","_workbookChangeFormat","_workbookDataBinding","_workbookDataBound","_workbookProgress","plugin"],"mappings":"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"}